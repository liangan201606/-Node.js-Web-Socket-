(this["webpackJsonp"]=this["webpackJsonp"]||[]).push([["app-service"],{"07d4":function(e,t){e.exports="/static/images/index/moreone.png"},"07e4":function(e,t){e.exports="/static/images/index/yuyin.png"},"0de9":function(e,t,n){"use strict";function i(e){var t=Object.prototype.toString.call(e);return t.substring(8,t.length-1)}function o(){return"string"===typeof __channelId__&&__channelId__}function s(e,t){switch(i(t)){case"Function":return"function() { [native code] }";default:return t}}function r(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];console[e].apply(console,n)}function a(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var r=t.shift();if(o())return t.push(t.pop().replace("at ","uni-app:///")),console[r].apply(console,t);var a=t.map((function(e){var t=Object.prototype.toString.call(e).toLowerCase();if("[object object]"===t||"[object array]"===t)try{e="---BEGIN:JSON---"+JSON.stringify(e,s)+"---END:JSON---"}catch(o){e=t}else if(null===e)e="---NULL---";else if(void 0===e)e="---UNDEFINED---";else{var n=i(e).toUpperCase();e="NUMBER"===n||"BOOLEAN"===n?"---BEGIN:"+n+"---"+e+"---END:"+n+"---":String(e)}return e})),c="";if(a.length>1){var u=a.pop();c=a.join("---COMMA---"),0===u.indexOf(" at ")?c+=u:c+="---COMMA---"+u}else c=a[0];console[r](c)}n.r(t),n.d(t,"log",(function(){return r})),n.d(t,"default",(function(){return a}))},"0edd":function(e,t,n){"use strict";n.r(t);var i=n("2ac1");for(var o in i)["default"].indexOf(o)<0&&function(e){n.d(t,e,(function(){return i[e]}))}(o);var s=n("f0c5"),r=Object(s["a"])(i["default"],void 0,void 0,!1,null,null,null,!1,void 0,void 0);t["default"]=r.exports},"10a4":function(e,t,n){"use strict";(function(e){var i=n("4ea4");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o=i(n("b5d1")),s=n("7cd2"),r=uni.requireNativePlugin("TencentCloud-TUICallKit"),a=uni.requireNativePlugin("globalEvent"),c=uni.requireNativePlugin("TencentCloud-TUICallKit-TUICallEngine"),u={onLaunch:function(){e("log","App Launch"," at App.vue:16"),uni.$TUICallKit=r,uni.$TUICallingEvent=a,uni.$TUICallEngine=c,uni.$TUIKit=o.default.create({SDKAppID:(0,s.genTestUserSig)("").sdkAppID}),uni.$TIM=o.default,uni.$TUIKit.on(o.default.EVENT.ERROR,(function(t){e("log",t,"\u6536\u5230 SDK \u53d1\u751f\u9519\u8bef\u901a\u77e5"," at App.vue:29")})),uni.$TUIKit.on(o.default.EVENT.SDK_NOT_READY,(function(t){e("log",t,"\u6536\u5230 SDK \u8fdb\u5165 not ready \u72b6\u6001\u901a\u77e5"," at App.vue:32")}))},onShow:function(){e("log","App Show"," at App.vue:36")},onHide:function(){e("log","App Hide"," at App.vue:39")}};t.default=u}).call(this,n("0de9")["default"])},1552:function(e,t){e.exports="/static/images/index/eyes.png"},1587:function(e,t,n){"use strict";n.d(t,"b",(function(){return i})),n.d(t,"c",(function(){return o})),n.d(t,"a",(function(){}));var i=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("view",{staticClass:e._$s(0,"sc","box"),attrs:{_i:0}},[i("Header",{attrs:{_i:1}}),i("view",{staticClass:e._$s(2,"sc","inform"),attrs:{_i:2}},[i("navigator",{staticClass:e._$s(3,"sc","Inform-friend"),attrs:{_i:3}},[i("view",{staticClass:e._$s(4,"sc","friend"),attrs:{_i:4}}),i("view",{staticClass:e._$s(5,"sc","number"),attrs:{_i:5}},[e._v(e._$s(5,"t0-0",e._s(e.requesterNum)))]),i("image",{staticClass:e._$s(6,"sc","image"),attrs:{src:e._$s(6,"a-src",n("1934")),_i:6}})])]),i("view",{staticClass:e._$s(7,"sc","tab"),attrs:{_i:7}},[i("scroll-view",{staticClass:e._$s(8,"sc","tab-top"),attrs:{"scroll-into-view":e._$s(8,"a-scroll-into-view",e.tabCurrent),_i:8}},e._l(e._$s(9,"f",{forItems:e.tabs}),(function(t,n,o,s){return i("view",{key:e._$s(9,"f",{forIndex:o,key:t.id-1}),staticClass:e._$s("9-"+s,"sc","tab-view"),attrs:{id:e._$s("9-"+s,"a-id","tabNum"+t.id),_i:"9-"+s},on:{click:function(n){return e.swichMenu(t.id-1)}}},[i("view",{class:e._$s("10-"+s,"c",e.currentTab==t.id-1?"title-act":"title"),attrs:{_i:"10-"+s}},[i("text",{staticClass:e._$s("11-"+s,"sc","title-text"),attrs:{_i:"11-"+s}},[e._v(e._$s("11-"+s,"t0-0",e._s(t.name)))]),i("view",{staticClass:e._$s("12-"+s,"sc","title-bottom"),attrs:{_i:"12-"+s}},[i("view",{staticClass:e._$s("13-"+s,"sc","title-bottom-color"),attrs:{_i:"13-"+s}})])])])})),0),i("swiper",{staticClass:e._$s(14,"sc","swiper-box-list"),style:e._$s(14,"s",{height:e.Height+"px"}),attrs:{current:e._$s(14,"a-current",e.currentTab),_i:14},on:{change:e.swiperChange}},e._l(e._$s(15,"f",{forItems:e.swiperDateList}),(function(t,n,o,s){return i("swiper-item",{key:e._$s(15,"f",{forIndex:o,key:t.id}),staticClass:e._$s("15-"+s,"sc","swiper-topic-list"),attrs:{_i:"15-"+s}},e._l(e._$s("16-"+s,"f",{forItems:t.content}),(function(t,n,o,r){return i("view",{key:e._$s("16-"+s,"f",{forIndex:o,key:n}),staticClass:e._$s("16-"+s+"-"+r,"sc","swiper-item"),attrs:{_i:"16-"+s+"-"+r}},[i("image",{staticClass:e._$s("17-"+s+"-"+r,"sc","image"),attrs:{src:e._$s("17-"+s+"-"+r,"a-src",t.imgUrl),_i:"17-"+s+"-"+r}}),i("view",{staticClass:e._$s("18-"+s+"-"+r,"sc","item-content"),attrs:{_i:"18-"+s+"-"+r}},[i("view",{staticClass:e._$s("19-"+s+"-"+r,"sc","name"),attrs:{_i:"19-"+s+"-"+r}},[e._v(e._$s("19-"+s+"-"+r,"t0-0",e._s(t.name)))]),i("view",{staticClass:e._$s("20-"+s+"-"+r,"sc","sign"),attrs:{_i:"20-"+s+"-"+r}},[e._v(e._$s("20-"+s+"-"+r,"t0-0",e._s(t.explain)))])])])})),0)})),0)])],1)},o=[]},1934:function(e,t){e.exports="/static/images/index/right.png"},"194b":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;t.default={data:function(){return{emoji:[["\ud83d\ude00","\ud83d\ude01","\ud83d\ude02","\ud83e\udd23","\ud83d\ude03","\ud83d\ude04","\ud83d\ude05","\ud83d\ude06"],["\ud83d\ude09","\ud83d\ude0a","\ud83d\ude0b","\ud83d\ude0e","\ud83d\ude0d","\ud83d\ude18","\ud83d\ude17","\ud83d\ude19"],["\ud83d\ude1a","\ud83e\udd17","\ud83e\udd14","\ud83d\ude10","\ud83d\ude11","\ud83d\ude36","\ud83d\ude44","\ud83d\ude0f"],["\ud83d\ude23","\ud83d\ude25","\ud83d\ude2e","\ud83e\udd10","\ud83d\ude2f","\ud83d\ude2a","\ud83d\ude2b","\ud83d\ude34"],["\ud83d\ude0c","\ud83d\ude1b","\ud83d\ude1c","\ud83d\ude1d","\ud83e\udd24","\ud83d\ude12","\ud83d\ude13","\ud83d\ude14"],["\ud83d\ude15","\ud83d\ude43","\ud83e\udd11","\ud83d\ude32","\ud83d\ude41","\ud83d\ude16","\ud83d\ude1e","\ud83d\ude1f"],["\ud83d\ude24","\ud83d\ude22","\ud83d\ude2d","\ud83d\ude26","\ud83d\ude27","\ud83d\ude28","\ud83d\ude29","\ud83d\ude2c"],["\ud83d\ude30","\ud83d\ude31","\ud83d\ude33","\ud83d\ude35","\ud83d\ude21","\ud83d\ude20","\ud83d\ude37","\ud83e\udd12"],["\ud83e\udd22","\ud83e\udd15","\ud83e\udd27","\ud83d\ude07","\ud83e\udd20","\ud83e\udd21","\ud83e\udd25","\ud83e\udd13"],["\ud83d\ude08","\ud83d\udc7a","\ud83d\udc80","\ud83d\udc7b","\ud83d\udc7d","\ud83d\udca9","\ud83d\udc42\ud83c\udffb","\ud83d\udc40"],["\ud83d\udc45","\ud83d\udc44","\ud83d\udc8b","\ud83d\udc53","\ud83d\udd76","\ud83d\udc57","\ud83d\udc59","\ud83d\udc84"],["\ud83d\udc43\ud83c\udffb","\ud83d\udc63","\ud83d\udc6b","\ud83d\udc6c","\ud83d\udc6d","\ud83c\udf02","\ud83d\udc51","\ud83c\udf93"],["\ud83d\ude48","\ud83d\ude49","\ud83d\ude4a","\ud83d\udca5","\ud83d\udc76\ud83c\udffb","\ud83d\udc66\ud83c\udffb","\ud83d\udc67\ud83c\udffb","\ud83d\udc68\ud83c\udffb"],["\ud83d\udc69\ud83c\udffb","\ud83d\udc74\ud83c\udffb","\ud83d\udc75\ud83c\udffb","\ud83d\udc68\ud83c\udffb\u200d\u2695\ufe0f","\ud83d\udc69\ud83c\udffb\u200d\u2695\ufe0f","\ud83d\udc68\ud83c\udffb\u200d\ud83c\udf93","\ud83d\udc68\ud83c\udffb\u200d\ud83c\udfeb","\ud83d\udc69\ud83c\udffb\u200d\ud83c\udfeb"],["\ud83d\udc68\ud83c\udffb\u200d\u2696\ufe0f","\ud83d\udc69\ud83c\udffc\u200d\u2696\ufe0f","\ud83d\udc68\ud83c\udffb\u200d\ud83d\udd27","\ud83d\udc69\u200d\ud83d\udd27","\ud83d\udc68\ud83c\udffb\u200d\ud83c\udfed","\ud83d\udc69\ud83c\udffc\u200d\ud83c\udfed","\ud83d\udc68\ud83c\udffb\u200d\ud83d\udcbc","\ud83d\udc69\ud83c\udffb\u200d\ud83d\udcbc"],["\ud83d\udc98","\ud83d\udc94","\ud83d\udc93","\ud83d\udcaa","\ud83d\udc48","\ud83d\udc49","\u261d","\ud83d\udc46"],["\ud83d\udd95","\ud83d\udc47","\u270c","\ud83e\udd18","\ud83d\udd90","\ud83d\udc4c","\ud83d\udc4d","\ud83d\udc4e"],["\u270a","\ud83d\udc4a","\ud83e\udd1b","\ud83e\udd1c","\ud83d\udc4b","\u270d","\ud83d\udc4f","\ud83d\udc50"],["\ud83e\udd1d","\ud83d\udc85","\ud83d\ude4f","\ud83d\udc2e","\ud83d\udc37","\ud83d\udc34","\ud83d\udc36","\ud83d\udea3"]]}},methods:{clickEmoji:function(e){this.$emit("SendEmoji",e)}}}},"1d9f":function(e,t,n){"use strict";n.d(t,"b",(function(){return i})),n.d(t,"c",(function(){return o})),n.d(t,"a",(function(){}));var i=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("view",{staticClass:e._$s(0,"sc","box"),attrs:{_i:0}},[i("view",{staticClass:e._$s(1,"sc","top-bar"),attrs:{_i:1}},[i("image",{staticClass:e._$s(2,"sc","image"),attrs:{src:e._$s(2,"a-src",n("7b54")),_i:2},on:{click:e.goBack}}),i("view",{staticClass:e._$s(3,"sc","title"),attrs:{_i:3}})]),i("view",{staticClass:e._$s(4,"sc","main"),attrs:{_i:4}},[i("view",{staticClass:e._$s(5,"sc","user-head"),attrs:{_i:5}},[i("view",{staticClass:e._$s(6,"sc","title"),attrs:{_i:6}}),e._$s(7,"i",e.user._id==e.uid)?i("view",{staticClass:e._$s(7,"sc","head"),attrs:{_i:7}},[i("image-cropper",{attrs:{src:e.tempFilePath,_i:8},on:{confirm:e.confirm,cancel:e.cancel}}),i("image",{staticClass:e._$s(9,"sc","head-image"),attrs:{src:e._$s(9,"a-src",e.cropFilePath),_i:9},on:{click:e.upload}})],1):e._e(),e._$s(10,"i",e.user._id==e.uid)?i("view",{staticClass:e._$s(10,"sc","more"),attrs:{_i:10}},[i("image",{staticClass:e._$s(11,"sc","head-more"),attrs:{src:e._$s(11,"a-src",n("1934")),_i:11}})]):e._e(),e._$s(12,"i",e.user._id!=e.uid)?i("view",{staticClass:e._$s(12,"sc","head"),attrs:{_i:12}},[i("image",{staticClass:e._$s(13,"sc","head-image"),attrs:{src:e._$s(13,"a-src",e.user.imgUrl),_i:13},on:{click:e.upload}})]):e._e()]),e._$s(14,"i",e.user._id==e.uid)?i("view",{staticClass:e._$s(14,"sc","user"),attrs:{_i:14},on:{click:function(t){return e.modify("explain","\u7b7e\u540d",e.user.explain,!1)}}},[i("view",{staticClass:e._$s(15,"sc","title"),attrs:{_i:15}}),i("view",{staticClass:e._$s(16,"sc","content"),attrs:{_i:16}},[e._v(e._$s(16,"t0-0",e._s(e.user.explain)))]),i("view",{staticClass:e._$s(17,"sc","more"),attrs:{_i:17}},[i("image",{staticClass:e._$s(18,"sc","head-more"),attrs:{src:e._$s(18,"a-src",n("1934")),_i:18}})])]):e._e(),e._$s(19,"i",e.user._id!=e.uid)?i("view",{staticClass:e._$s(19,"sc","user"),attrs:{_i:19}},[i("view",{staticClass:e._$s(20,"sc","title"),attrs:{_i:20}}),i("view",{staticClass:e._$s(21,"sc","content"),attrs:{_i:21}},[e._v(e._$s(21,"t0-0",e._s(e.user.explain)))]),i("view",{staticClass:e._$s(22,"sc","more"),attrs:{_i:22}},[i("image",{staticClass:e._$s(23,"sc","head-more"),attrs:{src:e._$s(23,"a-src",n("1934")),_i:23}})])]):e._e(),i("view",{staticClass:e._$s(24,"sc","user"),attrs:{_i:24}},[i("view",{staticClass:e._$s(25,"sc","title"),attrs:{_i:25}}),i("view",{staticClass:e._$s(26,"sc","content"),attrs:{_i:26}},[e._v(e._$s(26,"t0-0",e._s(e.changeTime(e.user.time))))])])]),i("view",{staticClass:e._$s(27,"sc","other"),attrs:{_i:27}},[e._$s(28,"i",e.user._id==e.uid)?i("view",{staticClass:e._$s(28,"sc","user"),attrs:{_i:28},on:{click:function(t){return e.modify("name","\u6635\u79f0",e.user.name,!1)}}},[i("view",{staticClass:e._$s(29,"sc","title"),attrs:{_i:29}}),i("view",{staticClass:e._$s(30,"sc","content"),attrs:{_i:30}},[e._v(e._$s(30,"t0-0",e._s(e.user.name)))]),i("view",{staticClass:e._$s(31,"sc","more"),attrs:{_i:31}},[i("image",{staticClass:e._$s(32,"sc","head-more"),attrs:{src:e._$s(32,"a-src",n("1934")),_i:32}})])]):e._e(),e._$s(33,"i",e.user._id!=e.uid)?i("view",{staticClass:e._$s(33,"sc","user"),attrs:{_i:33},on:{click:function(t){return e.modify("nickname","\u6635\u79f0",e.nickname,!1)}}},[i("view",{staticClass:e._$s(34,"sc","title"),attrs:{_i:34}}),i("view",{staticClass:e._$s(35,"sc","content"),attrs:{_i:35}},[e._v(e._$s(35,"t0-0",e._s(e.nickname)))]),i("view",{staticClass:e._$s(36,"sc","more"),attrs:{_i:36}},[i("image",{staticClass:e._$s(37,"sc","head-more"),attrs:{src:e._$s(37,"a-src",n("1934")),_i:37}})])]):e._e(),i("view",{staticClass:e._$s(38,"sc","user"),attrs:{_i:38}},[i("view",{staticClass:e._$s(39,"sc","title"),attrs:{_i:39}}),i("view",{staticClass:e._$s(40,"sc","content"),attrs:{_i:40}},[i("picker",{attrs:{value:e._$s(41,"a-value",e.index),range:e._$s(41,"a-range",e.array),_i:41},on:{change:e.bindPickerChange}},[e._$s(42,"i",e.user._id==e.uid)?i("view",{staticClass:e._$s(42,"sc","uni-input"),attrs:{_i:42}},[e._v(e._$s(42,"t0-0",e._s(e.array[e.index])))]):e._e(),e._$s(43,"i",e.user._id!=e.uid)?i("view",{staticClass:e._$s(43,"sc","uni-input"),attrs:{_i:43}},[e._v(e._$s(43,"t0-0",e._s(e.array[e.index])))]):e._e()])]),i("view",{staticClass:e._$s(44,"sc","more"),attrs:{_i:44}})]),i("view",{staticClass:e._$s(45,"sc","user"),attrs:{_i:45}},[i("view",{staticClass:e._$s(46,"sc","title"),attrs:{_i:46}}),i("view",{staticClass:e._$s(47,"sc","content"),attrs:{_i:47}},[e._$s(48,"i",e.user._id==e.uid)?i("picker",{attrs:{value:e._$s(48,"a-value",e.user.birth),start:e._$s(48,"a-start",e.startDate),end:e._$s(48,"a-end",e.endDate),_i:48},on:{change:e.bindDateChange}},[i("view",{staticClass:e._$s(49,"sc","uni-input"),attrs:{_i:49}},[e._v(e._$s(49,"t0-0",e._s(e.user.birth)))])]):e._e(),e._$s(50,"i",e.user._id!=e.uid)?i("view",{staticClass:e._$s(50,"sc","uni-input"),attrs:{_i:50}},[e._v(e._$s(50,"t0-0",e._s(e.user.birth)))]):e._e()]),e._$s(51,"i",e.user._id==e.uid)?i("view",{staticClass:e._$s(51,"sc","more"),attrs:{_i:51}},[i("image",{staticClass:e._$s(52,"sc","head-more"),attrs:{src:e._$s(52,"a-src",n("1934")),_i:52}})]):e._e()]),e._$s(53,"i",e.user._id==e.uid)?i("view",{staticClass:e._$s(53,"sc","user"),attrs:{_i:53},on:{click:function(t){return e.modify("phone","\u7535\u8bdd",e.user.phone,!0)}}},[i("view",{staticClass:e._$s(54,"sc","title"),attrs:{_i:54}}),i("view",{staticClass:e._$s(55,"sc","content"),attrs:{_i:55}},[e._v(e._$s(55,"t0-0",e._s(e.user.phone)))]),i("view",{staticClass:e._$s(56,"sc","more"),attrs:{_i:56}},[i("image",{staticClass:e._$s(57,"sc","head-more"),attrs:{src:e._$s(57,"a-src",n("1934")),_i:57}})])]):e._e(),e._$s(58,"i",e.user._id!=e.uid)?i("view",{staticClass:e._$s(58,"sc","user"),attrs:{_i:58}},[i("view",{staticClass:e._$s(59,"sc","title"),attrs:{_i:59}}),i("view",{staticClass:e._$s(60,"sc","content"),attrs:{_i:60}},[e._v(e._$s(60,"t0-0",e._s(e.user.phone)))]),i("view",{staticClass:e._$s(61,"sc","more"),attrs:{_i:61}})]):e._e(),e._$s(62,"i",e.user._id==e.uid)?i("view",{staticClass:e._$s(62,"sc","user"),attrs:{_i:62},on:{click:function(t){return e.modify("email","\u90ae\u7bb1",e.user.email,!0)}}},[i("view",{staticClass:e._$s(63,"sc","title"),attrs:{_i:63}}),i("view",{staticClass:e._$s(64,"sc","content"),attrs:{_i:64}},[e._v(e._$s(64,"t0-0",e._s(e.user.email)))]),i("view",{staticClass:e._$s(65,"sc","more"),attrs:{_i:65}},[i("image",{staticClass:e._$s(66,"sc","head-more"),attrs:{src:e._$s(66,"a-src",n("1934")),_i:66}})])]):e._e(),e._$s(67,"i",e.user._id!=e.uid)?i("view",{staticClass:e._$s(67,"sc","user"),attrs:{_i:67}},[i("view",{staticClass:e._$s(68,"sc","title"),attrs:{_i:68}}),i("view",{staticClass:e._$s(69,"sc","content"),attrs:{_i:69}},[e._v(e._$s(69,"t0-0",e._s(e.user.email)))]),i("view",{staticClass:e._$s(70,"sc","more"),attrs:{_i:70}})]):e._e(),e._$s(71,"i",e.user._id==e.uid)?i("view",{staticClass:e._$s(71,"sc","user-password"),attrs:{_i:71},on:{click:function(t){return e.modify("password","\u5bc6\u7801",e.pwd,!0)}}},[i("view",{staticClass:e._$s(72,"sc","title"),attrs:{_i:72}}),i("view",{staticClass:e._$s(73,"sc","content"),attrs:{_i:73}}),i("view",{staticClass:e._$s(74,"sc","more"),attrs:{_i:74}},[i("image",{staticClass:e._$s(75,"sc","head-more"),attrs:{src:e._$s(75,"a-src",n("1934")),_i:75}})])]):e._e(),e._$s(76,"i",e.user._id!=e.uid)?i("view",{staticClass:e._$s(76,"sc","user-password"),attrs:{_i:76}},[i("view",{staticClass:e._$s(77,"sc","title"),attrs:{_i:77}}),i("view",{staticClass:e._$s(78,"sc","content"),attrs:{_i:78}}),i("view",{staticClass:e._$s(79,"sc","more"),attrs:{_i:79}})]):e._e()]),e._$s(80,"i",e.user._id==e.uid)?i("view",{staticClass:e._$s(80,"sc","button"),attrs:{_i:80},on:{click:e.quit}}):e._e(),e._$s(81,"i",e.user._id!=e.uid)?i("view",{staticClass:e._$s(81,"sc","button"),attrs:{_i:81},on:{click:e.deleteFriend}}):e._e(),i("view",{staticClass:e._$s(82,"sc","modify"),style:e._$s(82,"s",{bottom:-e.modifyHeight+"px"}),attrs:{animation:e._$s(82,"a-animation",e.animationData),_i:82}},[i("view",{staticClass:e._$s(83,"sc","modify-header"),attrs:{_i:83}},[i("view",{staticClass:e._$s(84,"sc","close"),attrs:{_i:84},on:{click:function(t){return e.modify()}}}),i("view",{staticClass:e._$s(85,"sc","title"),attrs:{_i:85}},[e._v(e._$s(85,"t0-0",e._s(e.title)))]),i("view",{staticClass:e._$s(86,"sc","define"),attrs:{_i:86},on:{click:e.modifySubmit}})]),i("view",{staticClass:e._$s(87,"sc","modify-main"),attrs:{_i:87}},[e._$s(88,"i",e.isPwd)?i("input",{directives:[{name:"model",rawName:"v-model",value:e.pwd,expression:"pwd"}],staticClass:e._$s(88,"sc","modify-password"),attrs:{_i:88},domProps:{value:e._$s(88,"v-model",e.pwd)},on:{input:function(t){t.target.composing||(e.pwd=t.target.value)}}}):e._e(),i("textarea",{directives:[{name:"model",rawName:"v-model",value:e.data,expression:"data"}],staticClass:e._$s(89,"sc","modify-content"),attrs:{_i:89},domProps:{value:e._$s(89,"v-model",e.data)},on:{input:function(t){t.target.composing||(e.data=t.target.value)}}})])])])},o=[]},"1e58":function(e,t,n){"use strict";n.r(t);var i=n("5b5a"),o=n.n(i);for(var s in i)["default"].indexOf(s)<0&&function(e){n.d(t,e,(function(){return i[e]}))}(s);t["default"]=o.a},"20f3":function(e,t){e.exports="/static/images/index/voiceright.png"},"22ca":function(e,t){e.exports="/static/images/index/pen.png"},"23c1":function(e,t,n){"use strict";n.r(t);var i=n("9fc5"),o=n.n(i);for(var s in i)["default"].indexOf(s)<0&&function(e){n.d(t,e,(function(){return i[e]}))}(s);t["default"]=o.a},"256d":function(e,t){e.exports="/static/images/index/pwd.png"},2715:function(e,t){e.exports="/static/images/index/shipin.png"},"278c":function(e,t,n){var i=n("c135"),o=n("9b42"),s=n("6613"),r=n("c240");e.exports=function(e,t){return i(e)||o(e,t)||s(e,t)||r()},e.exports.__esModule=!0,e.exports["default"]=e.exports},"29e4":function(e,t){e.exports="/static/images/index/moretwo.png"},"2ac1":function(e,t,n){"use strict";n.r(t);var i=n("10a4"),o=n.n(i);for(var s in i)["default"].indexOf(s)<0&&function(e){n.d(t,e,(function(){return i[e]}))}(s);t["default"]=o.a},"2b8c":function(module,exports,__webpack_require__){"use strict";(function(__f__){var _interopRequireDefault=__webpack_require__("4ea4");Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _data=_interopRequireDefault(__webpack_require__("d602")),_search=_interopRequireDefault(__webpack_require__("3ba1")),_myFun=_interopRequireDefault(__webpack_require__("df93")),_default={name:"Search",data:function(){return{userArr:[],groupArr:[],uid:"",imgUrl:"",token:"",name:"",animationData:{},isModfiy:!1,modifyHeight:"",msg:"",fid:""}},mounted:function(){},onLoad:function(){this.getStorage()},onReady:function(){this.getElementStyle()},methods:{toMessage:function(e,t){uni.navigateTo({url:"../message/message?id="+e._id+"&name="+e.uname+"&imgUrl="+e.imgUrl+"&type="+t})},getStorage:function(){try{var e=uni.getStorageSync("user");e?(this.uid=e.id,this.imgUrl=this.serverUrl+e.imgUrl,this.name=e.name,this.token=e.token):uni.navigateTo({url:"../login/login"})}catch(t){}},search:_myFun.default.debounce((function(e){this.userArr=[];var t=e.detail.value;t.length>0&&(this.searchUser(t),this.searchGroup(t))}),500),searchUser:function searchUser(e){var _this=this;uni.request({url:this.serverUrl+"/search/searchUser",data:{data:e,token:this.token},method:"POST",success:function success(data){var code=data.data.code;if(200==code)for(var arr=data.data.result,exp=eval("/"+e+"/g"),i=0;i<arr.length;i++)-1==arr[i].name.search(e)&&-1==arr[i].email.search(e)||(arr[i].imgUrl=_this.serverUrl+arr[i].imgUrl,arr[i].uname=arr[i].name,arr[i].name=arr[i].name.replace(exp,"<span style='color:rgba(87,153,255,1)'>"+e+"</span>"),arr[i].email=arr[i].email.replace(exp,"<span style='color:rgba(87,153,255,1)'>"+e+"</span>"),_this.userArr.push(arr[i]),_this.isFriend(arr[i]));else 500==code?uni.showToast({title:"\u670d\u52a1\u5668\u51fa\u9519\u5566\uff01",icon:"none",duration:2e3}):300==code&&uni.navigateTo({url:"../login/login?name="+_this.name})}})},isFriend:function(e){var t=this,n=0;e._id==this.uid?(n=2,e.tip=n):(uni.request({url:this.serverUrl+"/search/matchFriend",data:{uid:this.uid,fid:e._id,token:this.token},method:"POST",success:function(i){var o=i.data.code;200==o?(n=0,e.tip=n):400==o?(n=1,e.tip=n,t.$forceUpdate()):500==o?uni.showToast({title:"\u670d\u52a1\u5668\u51fa\u9519\u5566\uff01",icon:"none",duration:2e3}):300==o&&uni.navigateTo({url:"../login/login?name="+t.name})}}),e.tip=n)},searchGroup:function searchGroup(e){var _this3=this;uni.request({url:this.serverUrl+"/search/searchGroup",data:{data:e,token:this.token},method:"POST",success:function success(data){var code=data.data.code;if(200==code){for(var arr=data.data.result,exp=eval("/"+e+"/g"),i=0;i<arr.length;i++)-1==arr[i].name.search(e)&&-1==arr[i].email.search(e)||(arr[i].imgUrl=_this3.serverUrl+arr[i].imgUrl,arr[i].uname=arr[i].name,arr[i].name=arr[i].name.replace(exp,"<span style='color:rgba(87,153,255,1)'>"+e+"</span>"),_this3.groupArr.push(arr[i]),_this3.isGroup(arr[i]));__f__("log",_this3.groupArr," at pages/search/search.vue:256")}else 500==code?uni.showToast({title:"\u670d\u52a1\u5668\u51fa\u9519\u5566\uff01",icon:"none",duration:2e3}):300==code&&uni.navigateTo({url:"../login/login?name="+_this3.name})}})},isGroup:function(e){var t=this,n=0;uni.request({url:this.serverUrl+"/search/matchGroup",data:{uid:this.uid,gid:e._id,token:this.token},method:"POST",success:function(i){var o=i.data.code;200==o?(n=0,e.tip=n):400==o?(n=1,e.tip=n,t.$forceUpdate()):500==o?uni.showToast({title:"\u670d\u52a1\u5668\u51fa\u9519\u5566\uff01",icon:"none",duration:2e3}):300==o&&uni.navigateTo({url:"../login/login?name="+t.name})}}),e.tip=n},getElementStyle:function(){var e=this,t=uni.createSelectorQuery().in(this);t.select(".modify").boundingClientRect((function(t){e.modifyHeight=t.height})).exec()},modify:function(){this.isModfiy=!this.isModfiy;var e=uni.createAnimation({duration:1e3,timingFunction:"ease"});this.isModfiy?e.bottom(0).step():e.bottom(-this.modifyHeight).step(),this.animationData=e.export()},addFrined:function(e){this.fid=e,this.msg=this.name+"\u8bf7\u6c42\u6dfb\u52a0\u597d\u53cb~",this.modify()},addSubmit:function(){var e=this;this.msg.length>0&&(this.modify(),uni.request({url:this.serverUrl+"/friend/request",data:{uid:this.uid,fid:this.fid,msg:this.msg,token:this.token},method:"POST",success:function(t){var n=t.data.code;200==n?__f__("log","\u7533\u8bf7\u6210\u529f"," at pages/search/search.vue:357"):500==n?uni.showToast({title:"\u670d\u52a1\u5668\u51fa\u9519\u5566\uff01",icon:"none",duration:2e3}):300==n&&uni.navigateTo({url:"../login/login?name="+e.name})}}))},addGroup:function(e){var t=this,n=[this.uid];uni.request({url:this.serverUrl+"/group/insertGroup",data:{gid:e._id,user:n,token:this.token},method:"POST",success:function(n){var i=n.data.code;200==i?uni.navigateTo({url:"../message/message?id="+e._id+"&name="+e.uname+"&imgUrl="+e.imgUrl+"&type=1"}):500==i?uni.showToast({title:"\u670d\u52a1\u5668\u51fa\u9519\u5566\uff01",icon:"none",duration:2e3}):300==i&&uni.navigateTo({url:"../login/login?name="+t.name})}})},goBack:function(){uni.reLaunch({url:".index/index"})}}};exports.default=_default}).call(this,__webpack_require__("0de9")["default"])},"2c8c":function(e,t,n){"use strict";(function(e){var i=n("4ea4");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;n("8bbf");var o=i(n("52ef")),s={name:"UserPage",data:function(){return{addHeight:"",animationData:{},animationData1:{},animationData2:{},isAdd:!1,id:"",uid:"",token:"",name:"",imgUrl:"",nickname:"",msg:"",user:{},relation:"",sexImg:"",sex:""}},onReady:function(){this.getElementStyle()},onLoad:function(e){this.id=e.id,this.getStorage(),this.getUser(),this.MatchFriend()},mounted:function(){},methods:{goBack:function(){uni.reLaunch({url:"../index/index"})},toMesaage:function(){uni.navigateTo({url:"../message/message?id="+this.user._id+"&name="+this.nickname+"&imgUrl="+this.user.imgUrl+"&type=0"})},getStorage:function(){try{var e=uni.getStorageSync("user");e?(this.uid=e.id,this.name=e.name,this.imgUrl=e.imgUrl,this.token=e.token):uni.navigateTo({url:"../login/login"})}catch(t){}},getUser:function(){var e=this;uni.request({url:this.serverUrl+"/user/detail",data:{id:this.id,token:this.token},method:"POST",success:function(t){var n=t.data.code;if(200==n){var i=t.data.result;if(i.imgUrl=e.serverUrl+t.data.result.imgUrl,e.ChooseSex(i.sex),void 0==i.explain&&(i.explain="\u8fd9\u4e2a\u4eba\u61d2\uff0c\u4ec0\u4e48\u90fd\u6ca1\u6709\u7559\u4e0b~"),void 0==i.birth)i.birth="0000-00-00";else{var s=o.default.dateTime_Three(i.birth);i.birth=s}0==e.nickname.length&&(e.nickname=i.name),e.user=i}else 500==n?uni.showToast({title:"\u670d\u52a1\u5668\u51fa\u9519\u5566\uff01",icon:"none",duration:2e3}):300==n&&uni.navigateTo({url:"../login/login?name="+e.name})}})},ChooseSex:function(e){"female"==e?(this.sexImg="../../static/images/index/grils.png",this.sex="\u5973\u6027"):"male"==e?(this.sexImg="../../static/images/index/male.png",this.sex="\u7537\u6027"):(this.sexImg="../../static/images/index/male.png",this.sex="\u672a\u77e5")},MatchFriend:function(){var e=this;this.uid==this.id?this.relation=0:uni.request({url:this.serverUrl+"/search/matchFriend",data:{uid:this.uid,fid:this.id,token:this.token},method:"POST",success:function(t){var n=t.data.code;200==n?(e.relation=1,e.getNickname()):400==n?e.relation=2:500==n?uni.showToast({title:"\u670d\u52a1\u5668\u51fa\u9519\u5566\uff01",icon:"none",duration:2e3}):300==n&&uni.navigateTo({url:"../login/login?name="+e.name})}})},getNickname:function(){var e=this;1==this.relation&&uni.request({url:this.serverUrl+"/user/nicknameGet",data:{uid:this.uid,fid:this.id,token:this.token},method:"POST",success:function(t){var n=t.data.code;if(200==n){var i=t.data.result;void 0!=i.nickname&&(e.nickname=i.nickname)}else 500==n?uni.showToast({title:"\u670d\u52a1\u5668\u51fa\u9519\u5566\uff01",icon:"none",duration:2e3}):300==n&&uni.navigateTo({url:"../login/login?name="+e.name})}})},getElementStyle:function(){var e=this,t=uni.createSelectorQuery().in(this);t.select(".background").boundingClientRect((function(t){e.addHeight=.7*t.height})).exec()},addFriendAnimat:function(){this.isAdd=!this.isAdd;var e=uni.createAnimation({duration:3e3,timingFunction:"ease"}),t=uni.createAnimation({duration:5e3,timingFunction:"ease"}),n=uni.createAnimation({duration:4e3,timingFunction:"ease"});this.isAdd?(e.bottom(0).step(),t.bottom(20).step(),n.bottom(this.addHeight-75).step()):(e.bottom(-this.addHeight-100).step(),t.bottom(-100).step(),n.bottom(75-this.addHeight).step()),this.animationData=e.export(),this.animationData1=t.export(),this.animationData2=n.export()},addFriend:function(){this.msg=this.name+"\u8bf7\u6c42\u6dfb\u52a0\u597d\u53cb~",this.addFriendAnimat()},addSubmit:function(){var t=this;this.msg.length>0&&(this.addFriendAnimat(),uni.request({url:this.serverUrl+"/friend/request",data:{uid:this.uid,fid:this.id,msg:this.msg,token:this.token},method:"POST",success:function(n){var i=n.data.code;200==i?e("log","\u7533\u8bf7\u6210\u529f"," at pages/user/userpage.vue:319"):500==i?uni.showToast({title:"\u670d\u52a1\u5668\u51fa\u9519\u5566\uff01",icon:"none",duration:2e3}):300==i&&uni.navigateTo({url:"../login/login?name="+t.name})}}))},toUserDetail:function(){uni.navigateTo({url:"../user/userdetail?id="+this.id})}}};t.default=s}).call(this,n("0de9")["default"])},"2dd4":function(e,t,n){"use strict";n.d(t,"b",(function(){return i})),n.d(t,"c",(function(){return o})),n.d(t,"a",(function(){}));var i=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("view",{staticClass:e._$s(0,"sc","content"),attrs:{_i:0}},[i("image",{staticClass:e._$s(1,"sc","background"),attrs:{src:e._$s(1,"a-src",e.user.imgUrl),_i:1}}),i("view",{staticClass:e._$s(2,"sc","top-bar"),attrs:{_i:2}},[i("image",{staticClass:e._$s(3,"sc","image"),attrs:{src:e._$s(3,"a-src",n("7b54")),_i:3},on:{click:e.goBack}}),e._$s(4,"i",0==e.relation||1==e.relation)?i("view",{staticClass:e._$s(4,"sc","more"),attrs:{_i:4},on:{click:e.toUserDetail}},[i("image",{staticClass:e._$s(5,"sc","more-image"),attrs:{src:e._$s(5,"a-src",n("85f2")),_i:5}})]):e._e()]),i("view",{staticClass:e._$s(6,"sc","main"),attrs:{_i:6}},[i("view",{staticClass:e._$s(7,"sc","user"),attrs:{_i:7}},[i("image",{staticClass:e._$s(8,"sc","imgUrl"),attrs:{src:e._$s(8,"a-src",e.user.imgUrl),_i:8}}),i("view",{staticClass:e._$s(9,"sc","detail"),attrs:{_i:9}},[i("view",{staticClass:e._$s(10,"sc","name"),attrs:{_i:10}},[e._v(e._$s(10,"t0-0",e._s(e.nickname)))]),i("view",{staticClass:e._$s(11,"sc","nickname"),attrs:{_i:11}},[e._v(e._$s(11,"t0-0",e._s(e.user.name)))])])]),i("view",{staticClass:e._$s(12,"sc","other"),attrs:{_i:12}},[i("view",{staticClass:e._$s(13,"sc","sex"),attrs:{_i:13}},[i("image",{staticClass:e._$s(14,"sc","imageSex"),attrs:{src:e._$s(14,"a-src",e.sexImg),_i:14}}),e._v(e._$s(13,"t1-0",e._s(e.sex)))]),i("view",{staticClass:e._$s(15,"sc","birth"),attrs:{_i:15}},[e._v(e._$s(15,"t0-0",e._s(e.user.birth)))])]),i("view",{staticClass:e._$s(16,"sc","sign"),attrs:{_i:16}},[i("image",{staticClass:e._$s(17,"sc","imageSign"),attrs:{src:e._$s(17,"a-src",n("22ca")),_i:17}}),e._v(e._$s(16,"t1-0",e._s(e.user.explain)))]),i("view",{staticClass:e._$s(18,"sc","bottom"),attrs:{_i:18}},[e._$s(19,"i",1==e.relation)?i("view",{staticClass:e._$s(19,"sc","apply"),attrs:{_i:19},on:{click:function(t){return e.toMesaage()}}}):e._e(),e._$s(20,"i",2==e.relation)?i("view",{staticClass:e._$s(20,"sc","send"),attrs:{_i:20},on:{click:e.addFriend}}):e._e()]),i("image",{staticClass:e._$s(21,"sc","imgUrlAdd"),style:e._$s(21,"s",{bottom:-e.addHeight-100+"px"}),attrs:{src:e._$s(21,"a-src",e.user.imgUrl),animation:e._$s(21,"a-animation",e.animationData2),_i:21}}),i("view",{staticClass:e._$s(22,"sc","addFriend"),style:e._$s(22,"s",{height:e.addHeight+"px",bottom:-e.addHeight-100+"px"}),attrs:{animation:e._$s(22,"a-animation",e.animationData),_i:22}},[i("view",{staticClass:e._$s(23,"sc","name"),attrs:{_i:23}},[e._v(e._$s(23,"t0-0",e._s(e.user.name)))]),i("textarea",{directives:[{name:"model",rawName:"v-model",value:e.msg,expression:"msg"}],staticClass:e._$s(24,"sc","addMsg"),attrs:{_i:24},domProps:{value:e._$s(24,"v-model",e.msg)},on:{input:function(t){t.target.composing||(e.msg=t.target.value)}}})]),i("view",{staticClass:e._$s(25,"sc","addButton"),attrs:{animation:e._$s(25,"a-animation",e.animationData1),_i:25}},[i("view",{staticClass:e._$s(26,"sc","remove"),attrs:{_i:26},on:{click:e.addFriendAnimat}}),i("view",{staticClass:e._$s(27,"sc","send"),attrs:{_i:27},on:{click:e.addSubmit}})])])])},o=[]},3065:function(e,t){e.exports="/static/images/index/keyboard.png"},"306a":function(e,t){e.exports="/static/images/index/search.png"},"32c1":function(e,t,n){"use strict";n.r(t);var i=n("2dd4"),o=n("cb48");for(var s in o)["default"].indexOf(s)<0&&function(e){n.d(t,e,(function(){return o[e]}))}(s);var r=n("f0c5"),a=Object(r["a"])(o["default"],i["b"],i["c"],!1,null,null,null,!1,i["a"],void 0);t["default"]=a.exports},"36c6":function(e,t){function n(t){return e.exports=n=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},e.exports.__esModule=!0,e.exports["default"]=e.exports,n(t)}e.exports=n,e.exports.__esModule=!0,e.exports["default"]=e.exports},"37c0":function(e,t,n){"use strict";n.r(t);var i=n("4d0e"),o=n.n(i);for(var s in i)["default"].indexOf(s)<0&&function(e){n.d(t,e,(function(){return i[e]}))}(s);t["default"]=o.a},"39c0":function(e,t,n){"use strict";n.d(t,"b",(function(){return i})),n.d(t,"c",(function(){return o})),n.d(t,"a",(function(){}));var i=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("view",{staticClass:e._$s(0,"sc","box"),attrs:{_i:0}},[i("view",{staticClass:e._$s(1,"sc","top-bar"),attrs:{_i:1}},[i("image",{staticClass:e._$s(2,"sc","image"),attrs:{src:e._$s(2,"a-src",n("7b54")),_i:2},on:{click:e.goBack}}),i("view",{staticClass:e._$s(3,"sc","more"),attrs:{_i:3}},[i("image",{staticClass:e._$s(4,"sc","more-image"),attrs:{src:e._$s(4,"a-src",n("85f2")),_i:4}})])]),i("view",{staticClass:e._$s(5,"sc","top-bar bgBar"),attrs:{animation:e._$s(5,"a-animation",e.animationData),_i:5}},[i("image",{staticClass:e._$s(6,"sc","image"),attrs:{src:e._$s(6,"a-src",n("509f")),_i:6},on:{click:e.goBack}}),i("view",{staticClass:e._$s(7,"sc","more"),attrs:{_i:7}},[i("image",{staticClass:e._$s(8,"sc","more-image"),attrs:{src:e._$s(8,"a-src",n("07d4")),_i:8}})])]),i("view",{staticClass:e._$s(9,"sc","bg"),attrs:{_i:9}},[i("image",{staticClass:e._$s(10,"sc","bg-img"),attrs:{src:e._$s(10,"a-src",e.gimg),_i:10}})]),i("view",{staticClass:e._$s(11,"sc","main"),attrs:{_i:11}},[i("view",{staticClass:e._$s(12,"sc","main-inner"),attrs:{_i:12}},[i("view",{staticClass:e._$s(13,"sc","inf"),attrs:{_i:13}},[i("view",{staticClass:e._$s(14,"sc","name"),attrs:{_i:14}},[e._v(e._$s(14,"t0-0",e._s(e.gname)))]),i("view",{staticClass:e._$s(15,"sc","time"),attrs:{_i:15}},[e._v(e._$s(15,"t0-0",e._s(e.changeTime(e.time))))]),i("view",{staticClass:e._$s(16,"sc","notice"),attrs:{_i:16}},[e._v(e._$s(16,"t0-0",e._s(e.notice)))])]),i("view",{staticClass:e._$s(17,"sc","member"),attrs:{_i:17}},[i("view",{staticClass:e._$s(18,"sc","top"),attrs:{_i:18}},[i("view",{staticClass:e._$s(19,"sc","title"),attrs:{_i:19}}),i("view",{staticClass:e._$s(20,"sc","more"),attrs:{_i:20}}),i("image",{staticClass:e._$s(21,"sc","more-img"),attrs:{src:e._$s(21,"a-src",n("1934")),_i:21}})]),i("view",{staticClass:e._$s(22,"sc","member-ls"),attrs:{_i:22}},[e._l(e._$s(23,"f",{forItems:e.groupMember}),(function(t,o,s,r){return i("view",{key:e._$s(23,"f",{forIndex:s,key:o}),staticClass:e._$s("23-"+r,"sc","member-li"),attrs:{_i:"23-"+r}},[i("view",{staticClass:e._$s("24-"+r,"sc","imgs"),attrs:{_i:"24-"+r}},[e._$s("25-"+r,"i",e.UserID==e.uid&&e.UserID!=t.uid)?i("image",{staticClass:e._$s("25-"+r,"sc","delete"),attrs:{src:e._$s("25-"+r,"a-src",n("9be0")),_i:"25-"+r},on:{click:function(n){return e.deleteGroupMeb(t.uid)}}}):e._e(),i("image",{staticClass:e._$s("26-"+r,"sc","user-img"),attrs:{src:e._$s("26-"+r,"a-src",t.imgUrl),_i:"26-"+r}}),i("view",{staticClass:e._$s("27-"+r,"sc","name"),attrs:{_i:"27-"+r}},[e._v(e._$s("27-"+r,"t0-0",e._s(t.name)))])])])})),i("view",{staticClass:e._$s(28,"sc","member-li"),attrs:{_i:28}},[i("view",{staticClass:e._$s(29,"sc","imgs add"),attrs:{_i:29},on:{click:function(t){return e.modify(void 0,"\u65b0\u6210\u5458",void 0,!0)}}},[i("image",{staticClass:e._$s(30,"sc","user-img"),attrs:{src:e._$s(30,"a-src",n("d0f9")),_i:30}}),i("view",{staticClass:e._$s(31,"sc","name"),attrs:{_i:31}})])])],2),i("view",{staticClass:e._$s(32,"sc","clear"),attrs:{_i:32}})]),i("view",{staticClass:e._$s(33,"sc","mitem"),attrs:{_i:33}},[e._$s(34,"i",e.UserID==e.uid)?i("view",{staticClass:e._$s(34,"sc","row"),attrs:{_i:34},on:{click:function(t){return e.modify("name","\u7fa4\u540d\u79f0",e.gname,!1)}}},[i("view",{staticClass:e._$s(35,"sc","title"),attrs:{_i:35}}),i("view",{staticClass:e._$s(36,"sc","content"),attrs:{_i:36}},[e._v(e._$s(36,"t0-0",e._s(e.gname)))]),i("view",{staticClass:e._$s(37,"sc","more"),attrs:{_i:37}},[i("image",{staticClass:e._$s(38,"sc","head-more"),attrs:{src:e._$s(38,"a-src",n("1934")),_i:38}})])]):e._e(),e._$s(39,"i",e.UserID!=e.uid)?i("view",{staticClass:e._$s(39,"sc","row"),attrs:{_i:39}},[i("view",{staticClass:e._$s(40,"sc","title"),attrs:{_i:40}}),i("view",{staticClass:e._$s(41,"sc","content"),attrs:{_i:41}},[e._v(e._$s(41,"t0-0",e._s(e.gname)))]),i("view",{staticClass:e._$s(42,"sc","more"),attrs:{_i:42}})]):e._e(),i("view",{staticClass:e._$s(43,"sc","row"),attrs:{_i:43}},[i("view",{staticClass:e._$s(44,"sc","title"),attrs:{_i:44}}),e._$s(45,"i",e.UserID==e.uid)?i("view",{staticClass:e._$s(45,"sc","head"),attrs:{_i:45}},[i("image-cropper",{attrs:{src:e.tempFilePath,_i:46},on:{confirm:e.confirm,cancel:e.cancel}}),i("image",{staticClass:e._$s(47,"sc","head-image"),attrs:{src:e._$s(47,"a-src",e.cropFilePath),_i:47},on:{click:e.upload}})],1):e._e(),e._$s(48,"i",e.UserID==e.uid)?i("view",{staticClass:e._$s(48,"sc","more"),attrs:{_i:48}},[i("image",{staticClass:e._$s(49,"sc","head-more"),attrs:{src:e._$s(49,"a-src",n("1934")),_i:49}})]):e._e(),e._$s(50,"i",e.UserID!=e.uid)?i("view",{staticClass:e._$s(50,"sc","head"),attrs:{_i:50}},[i("image",{staticClass:e._$s(51,"sc","head-image"),attrs:{src:e._$s(51,"a-src",e.gimg),_i:51}})]):e._e()]),e._$s(52,"i",e.UserID==e.uid)?i("view",{staticClass:e._$s(52,"sc","row"),attrs:{_i:52},on:{click:function(t){return e.modify("notice","\u7fa4\u516c\u544a",e.notice,!1)}}},[i("view",{staticClass:e._$s(53,"sc","title"),attrs:{_i:53}}),i("view",{staticClass:e._$s(54,"sc","content"),attrs:{_i:54}},[e._v(e._$s(54,"t0-0",e._s(e.notice)))]),i("view",{staticClass:e._$s(55,"sc","more"),attrs:{_i:55}},[i("image",{staticClass:e._$s(56,"sc","head-more"),attrs:{src:e._$s(56,"a-src",n("1934")),_i:56}})])]):e._e(),e._$s(57,"i",e.UserID!=e.uid)?i("view",{staticClass:e._$s(57,"sc","row"),attrs:{_i:57}},[i("view",{staticClass:e._$s(58,"sc","title"),attrs:{_i:58}}),i("view",{staticClass:e._$s(59,"sc","content"),attrs:{_i:59}},[e._v(e._$s(59,"t0-0",e._s(e.notice)))]),i("view",{staticClass:e._$s(60,"sc","more"),attrs:{_i:60}})]):e._e(),i("view",{staticClass:e._$s(61,"sc","row"),attrs:{_i:61},on:{click:function(t){return e.modify("nickname","\u7fa4\u5185\u540d",e.nickname,!1)}}},[i("view",{staticClass:e._$s(62,"sc","title"),attrs:{_i:62}}),i("view",{staticClass:e._$s(63,"sc","content"),attrs:{_i:63}},[e._v(e._$s(63,"t0-0",e._s(e.nickname)))]),i("view",{staticClass:e._$s(64,"sc","more"),attrs:{_i:64}},[i("image",{staticClass:e._$s(65,"sc","head-more"),attrs:{src:e._$s(65,"a-src",n("1934")),_i:65}})])]),i("view",{staticClass:e._$s(66,"sc","row"),attrs:{_i:66}},[i("view",{staticClass:e._$s(67,"sc","title"),attrs:{_i:67}}),i("view",{staticClass:e._$s(68,"sc","content"),attrs:{_i:68}}),i("view",{staticClass:e._$s(69,"sc","more"),attrs:{_i:69}},[i("switch",{staticClass:e._$s(70,"sc","swiper"),attrs:{checked:e._$s(70,"a-checked",e.autoplay),_i:70},on:{change:e.changeSwiper}})])])]),e._$s(71,"i",e.UserID!=e.uid)?i("view",{staticClass:e._$s(71,"sc","button"),attrs:{_i:71},on:{click:e.leaveGroup}}):e._e(),e._$s(72,"i",e.UserID==e.uid)?i("view",{staticClass:e._$s(72,"sc","button"),attrs:{_i:72},on:{click:e.deleteGroup}}):e._e()])]),i("view",{staticClass:e._$s(73,"sc","modify"),style:e._$s(73,"s",{bottom:-e.modifyHeight+"px"}),attrs:{animation:e._$s(73,"a-animation",e.animationData2),_i:73}},[i("view",{staticClass:e._$s(74,"sc","modify-header"),attrs:{_i:74}},[i("view",{staticClass:e._$s(75,"sc","close"),attrs:{_i:75},on:{click:function(t){return e.modify()}}}),i("view",{staticClass:e._$s(76,"sc","title"),attrs:{_i:76}},[e._v(e._$s(76,"t0-0",e._s(e.modifyTitle)))]),e._$s(77,"i",!e.isAdd)?i("view",{staticClass:e._$s(77,"sc","define"),attrs:{_i:77},on:{click:e.modifySubmit}}):e._e(),e._$s(78,"i",e.isAdd)?i("view",{staticClass:e._$s(78,"sc","define"),attrs:{_i:78}}):e._e()]),e._$s(79,"i",!e.isAdd)?i("view",{staticClass:e._$s(79,"sc","modify-main"),attrs:{_i:79}},[i("textarea",{directives:[{name:"model",rawName:"v-model",value:e.data,expression:"data"}],staticClass:e._$s(80,"sc","modify-content"),attrs:{_i:80},domProps:{value:e._$s(80,"v-model",e.data)},on:{input:function(t){t.target.composing||(e.data=t.target.value)}}})]):e._e(),e._$s(81,"i",e.isAdd)?i("view",{staticClass:e._$s(81,"sc","friends"),attrs:{_i:81}},[e._l(e._$s(82,"f",{forItems:e.newMember}),(function(t,o,s,r){return i("view",{key:e._$s(82,"f",{forIndex:s,key:o}),staticClass:e._$s("82-"+r,"sc","user"),attrs:{_i:"82-"+r},on:{click:function(t){return e.selectFriend(o)}}},[i("view",{staticClass:e._$s("83-"+r,"sc","selected"),class:e._$s("83-"+r,"c",{isSelected:t.selected}),attrs:{_i:"83-"+r}},[i("image",{directives:[{name:"show",rawName:"v-show",value:e._$s("84-"+r,"v-show",t.selected),expression:"_$s((\"84-\"+$31),'v-show',item.selected)"}],staticClass:e._$s("84-"+r,"sc","selected-img"),attrs:{src:e._$s("84-"+r,"a-src",n("7d2f")),_i:"84-"+r}})]),i("image",{staticClass:e._$s("85-"+r,"sc","user-img"),attrs:{src:e._$s("85-"+r,"a-src",t.imgUrl),_i:"85-"+r}}),i("view",{staticClass:e._$s("86-"+r,"sc","name"),attrs:{_i:"86-"+r}},[e._v(e._$s("86-"+r,"t0-0",e._s(t.name)))])])})),i("view",{staticClass:e._$s(87,"sc","bottom-bar"),attrs:{_i:87},on:{click:e.addMember}},[i("view",{staticClass:e._$s(88,"sc","bottom-btn"),attrs:{_i:88}},[e._v(e._$s(88,"t0-0",e._s(e.selectedNum)))])])],2):e._e()])])},o=[]},"39e5":function(e,t){e.exports="/static/images/index/user.png"},"3a0f":function(e,t,n){"use strict";n.r(t);var i=n("459f"),o=n("6a3f");for(var s in o)["default"].indexOf(s)<0&&function(e){n.d(t,e,(function(){return o[e]}))}(s);var r=n("f0c5"),a=Object(r["a"])(o["default"],i["b"],i["c"],!1,null,null,null,!1,i["a"],void 0);t["default"]=a.exports},"3ba1":function(e,t,n){"use strict";n.r(t);var i=n("7b13"),o=n("e3aa");for(var s in o)["default"].indexOf(s)<0&&function(e){n.d(t,e,(function(){return o[e]}))}(s);var r=n("f0c5"),a=Object(r["a"])(o["default"],i["b"],i["c"],!1,null,null,null,!1,i["a"],void 0);t["default"]=a.exports},"3c96":function(e,t){e.exports=function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e},e.exports.__esModule=!0,e.exports["default"]=e.exports},4438:function(e,t,n){"use strict";n.r(t);var i=n("fbb2"),o=n("1e58");for(var s in o)["default"].indexOf(s)<0&&function(e){n.d(t,e,(function(){return o[e]}))}(s);var r=n("f0c5"),a=Object(r["a"])(o["default"],i["b"],i["c"],!1,null,null,null,!1,i["a"],void 0);t["default"]=a.exports},"459f":function(e,t,n){"use strict";n.d(t,"b",(function(){return i})),n.d(t,"c",(function(){return o})),n.d(t,"a",(function(){}));var i=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("view",{staticClass:e._$s(0,"sc","login"),attrs:{_i:0}},[i("view",{staticClass:e._$s(1,"sc","login-img"),attrs:{_i:1}},[i("image",{attrs:{src:e._$s(2,"a-src",n("586b")),_i:2}})]),i("view",{staticClass:e._$s(3,"sc","login-forms"),attrs:{_i:3}},[i("form",{staticClass:e._$s(4,"sc","login-create"),attrs:{id:"login-up",_i:4}},[i("view",{staticClass:e._$s(5,"sc","login-title"),attrs:{_i:5}}),i("view",{staticClass:e._$s(6,"sc","login-box"),attrs:{_i:6}},[i("image",{staticClass:e._$s(7,"sc","login-icon"),attrs:{src:e._$s(7,"a-src",n("39e5")),_i:7}}),i("input",{staticClass:e._$s(8,"sc","login-input"),attrs:{_i:8},on:{blur:e.MatchUser}}),e._$s(9,"i",e.isUser)?i("view",{staticClass:e._$s(9,"sc","employ"),attrs:{_i:9}}):e._e()]),i("view",{staticClass:e._$s(10,"sc","login-box"),attrs:{_i:10}},[i("image",{staticClass:e._$s(11,"sc","login-icon"),attrs:{src:e._$s(11,"a-src",n("256d")),_i:11}}),i("input",{staticClass:e._$s(12,"sc","login-input"),attrs:{_i:12},on:{blur:e.Email}}),e._$s(13,"i",e.isEmail)?i("view",{staticClass:e._$s(13,"sc","employ"),attrs:{_i:13}}):e._e(),e._$s(14,"i",e.invalid)?i("view",{staticClass:e._$s(14,"sc","invalid"),attrs:{_i:14}}):e._e()]),i("view",{staticClass:e._$s(15,"sc","login-box"),attrs:{_i:15}},[i("image",{staticClass:e._$s(16,"sc","login-icon"),attrs:{src:e._$s(16,"a-src",n("256d")),_i:16}}),i("input",{staticClass:e._$s(17,"sc","login-input"),attrs:{password:e._$s(17,"a-password",e.flag),_i:17},on:{input:e.Password}}),e._$s(18,"i",e.look)?i("image",{staticClass:e._$s(18,"sc","login-icon"),attrs:{src:e._$s(18,"a-src",n("8128")),_i:18},on:{click:e.changeLook}}):i("image",{staticClass:e._$s(19,"sc","login-icon"),attrs:{src:e._$s(19,"a-src",n("1552")),_i:19},on:{click:e.changeLook}})]),e._$s(20,"i",e.isPwd)?i("view",{staticClass:e._$s(20,"sc","login-warning"),attrs:{_i:20}}):e._e(),i("button",{class:e._$s(21,"c",[{button:e.isSign},{button2:!e.isSign}]),attrs:{_i:21},on:{click:e.Sign}}),i("view",[i("text",{staticClass:e._$s(23,"sc","login-account"),attrs:{_i:23}}),i("text",{staticClass:e._$s(24,"sc","login-signin"),attrs:{_i:24},on:{click:e.toLoginIn}})])])])])},o=[]},"47dd":function(e,t,n){"use strict";n.r(t);var i=n("a336"),o=n("ab83");for(var s in o)["default"].indexOf(s)<0&&function(e){n.d(t,e,(function(){return o[e]}))}(s);var r=n("f0c5"),a=Object(r["a"])(o["default"],i["b"],i["c"],!1,null,null,null,!1,i["a"],void 0);t["default"]=a.exports},4882:function(e,t,n){"use strict";(function(e){var i=n("4ea4");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o=i(n("76e1")),s={data:function(){return{uid:"",token:"",tempFilePath:"",cropFilePath:"../../static/images/index/background.jpeg",image:"",GimgUrl:"/group/group.png",name:"",user:[],Friends:[],selectedNum:0}},components:{ImageCropper:o.default},onLoad:function(){this.getStorage(),this.getFriends(),this.GetselecetNum()},methods:{goBack:function(){uni.navigateBack({delta:1})},getStorage:function(){try{var e=uni.getStorageSync("user");e?(this.uid=e.id,this.token=e.token):uni.navigateTo({url:"../login/login"})}catch(t){}},upload:function(){var e=this;uni.chooseImage({count:1,sizeType:["original","compressed"],sourceType:["album"],success:function(t){e.tempFilePath=t.tempFilePaths.shift()}})},confirm:function(t){var n=this;this.tempFilePath="",this.cropFilePath=t.detail.tempFilePath,this.image=t.detail.tempFilePath,uni.uploadFile({url:this.serverUrl+"/files/upload",filePath:this.cropFilePath,name:"file",fileType:this.image,formData:{url:"group",name:this.uid,token:this.token},success:function(e){var t=e.data;n.GimgUrl=t},fail:function(t){e("log","this is errormes "+t.message," at pages/group/group.vue:120")}})},cancel:function(){e("log","canceled"," at pages/group/group.vue:125"),this.tempFilePath=""},getFriends:function(){var e=this;uni.request({url:this.serverUrl+"/home/getFriend",data:{uid:this.uid,state:0,token:this.token},method:"POST",success:function(t){var n=t.data.code;if(200==n){for(var i=t.data.result,o=0;o<i.length;o++)i[o].imgUrl=e.serverUrl+i[o].imgUrl,i[o].selected=!1;e.Friends=i}else 500==n?uni.showToast({title:"\u670d\u52a1\u5668\u51fa\u9519\u5566\uff01",icon:"none",duration:2e3}):300==n&&uni.navigateTo({url:"../login/login?name="+e.name})}})},GetselecetNum:function(){for(var e=0;e<this.Friends.length;e++)this.Friends[e].selected&&this.selectedNum++},selectFriend:function(e){this.Friends[e].selected?(this.Friends[e].selected=!1,this.selectedNum--):(this.Friends[e].selected=!0,this.selectedNum++)},createGroup:function(){var t=this;if(this.selectedNum&&this.name.length){this.user.push(this.uid);for(var n=0;n<this.Friends.length;n++)this.Friends[n].selected&&this.user.push(this.Friends[n].id);e("log",this.user," at pages/group/group.vue:190"),uni.request({url:this.serverUrl+"/group/buildGroup",data:{uid:this.uid,groupname:this.name,imgUrl:this.GimgUrl,user:this.user,token:this.token},method:"POST",success:function(n){var i=n.data.code;200==i?(e("log","\u521b\u5efa\u6210\u529f"," at pages/group/group.vue:204"),uni.reLaunch({url:"../index/index"})):500==i?uni.showToast({title:"\u670d\u52a1\u5668\u51fa\u9519\u5566\uff01",icon:"none",duration:2e3}):300==i&&uni.navigateTo({url:"../login/login?name="+t.name})}})}}}};t.default=s}).call(this,n("0de9")["default"])},"4a4b":function(e,t){function n(t,i){return e.exports=n=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},e.exports.__esModule=!0,e.exports["default"]=e.exports,n(t,i)}e.exports=n,e.exports.__esModule=!0,e.exports["default"]=e.exports},"4d0e":function(e,t,n){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n={data:function(){return{id:"liangan_",img:[]}},methods:{upload:function(){var t=this;uni.chooseImage({count:9,sizeType:["original","compressed"],sourceType:["album","camera"],maxDuration:30,camera:"back",success:function(n){var i=n.tempFilePaths;e("log",t.id," at pages/test.vue:28"),e("log",(new Date).getTime()," at pages/test.vue:29");for(var o=0;o<i.length;o++){e("log",o," at pages/test.vue:31");var s=uni.uploadFile({url:t.serverUrl+"files/upload",filePath:i[o],name:"file",formData:{url:"user",name:(new Date).getTime()+t.id+o},success:function(n){var i=t.serverUrl+n.data;t.img.push(i),e("log",n.data," at pages/test.vue:44")}});s.onProgressUpdate((function(t){e("log","\u4e0a\u4f20\u8fdb\u5ea6"+t.progress," at pages/test.vue:48"),e("log","\u5df2\u7ecf\u4e0a\u4f20\u7684\u6570\u636e\u957f\u5ea6"+t.totalBytesSent," at pages/test.vue:49"),e("log","\u9884\u671f\u9700\u8981\u4e0a\u4f20\u7684\u6570\u636e\u603b\u957f\u5ea6"+t.totalBytesExpectedToSend," at pages/test.vue:50")}))}}})}}};t.default=n}).call(this,n("0de9")["default"])},"4ea4":function(e,t){e.exports=function(e){return e&&e.__esModule?e:{default:e}},e.exports.__esModule=!0,e.exports["default"]=e.exports},"509f":function(e,t){e.exports="/static/images/index/left.png"},"510e":function(e,t,n){"use strict";n.r(t);var i=n("2b8c"),o=n.n(i);for(var s in i)["default"].indexOf(s)<0&&function(e){n.d(t,e,(function(){return i[e]}))}(s);t["default"]=o.a},"52a5":function(e,t){e.exports="/static/images/index/dingwei.png"},"52ef":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i={dateTime:function(e){var t=new Date(e),n=t.getFullYear(),i=t.getMonth()+1,o=t.getDate(),s=t.getHours(),r=t.getMinutes(),a=(t.getSeconds(),t.getDay(),new Date),c=a.getFullYear(),u=a.getMonth()+1,l=a.getDate();a.getHours(),a.getMinutes(),a.getSeconds();return n===c&&i===u&&l===o?(s=s<10?"0"+s:s,r=r<10?"0"+r:r,s+":"+r):n===c&&i===u&&l===o+1?(s=s<10?"0"+s:s,r=r<10?"0"+r:r,"\u6628\u5929"+s+":"+r):n===c&&i===u&&l===o+2?(s=s<10?"0"+s:s,r=r<10?"0"+r:r,"\u524d\u5929"+s+":"+r):(i=i<10?"0"+i:i,o=o<10?"0"+o:o,n+"/"+i+"/"+o)},dateTime_Two:function(e){var t=new Date(e),n=t.getFullYear(),i=t.getMonth()+1,o=t.getDate(),s=t.getHours(),r=t.getMinutes(),a=t.getSeconds();return i<10&&(i="0"+i),s<10&&(s="0"+s),o<10&&(o="0"+o),r<10&&(r="0"+r),a<10&&(a="0"+a),n+"-"+i+"-"+o+" "+s+":"+r+":"+a},dateTime_Three:function(e){var t=new Date(e),n=t.getFullYear(),i=t.getMonth()+1,o=t.getDate();return i<10&&(i="0"+i),o<10&&(o="0"+o),n+"-"+i+"-"+o},dateTime_Thour:function(e){var t=new Date(e),n=t.getFullYear(),i=t.getMonth()+1,o=t.getDate();return i<10&&(i="0"+i),o<10&&(o="0"+o),n+i+o},dateTime_Msg:function(e){var t=new Date(e),n=t.getFullYear(),i=t.getMonth()+1,o=t.getDate(),s=t.getHours(),r=t.getMinutes(),a=(t.getSeconds(),t.getDay(),new Date),c=a.getFullYear(),u=a.getMonth()+1,l=a.getDate();a.getHours(),a.getMinutes(),a.getSeconds();return n===c&&i===u&&l===o?(s=s<10?"0"+s:s,r=r<10?"0"+r:r,s+":"+r):n===c&&i===u&&l===o+1?(s=s<10?"0"+s:s,r=r<10?"0"+r:r,"\u6628\u5929 "+s+":"+r):n===c?(i=i<10?"0"+i:i,o=o<10?"0"+o:o,s=s<10?"0"+s:s,r=r<10?"0"+r:r,i+"\u6708"+o+"\u65e5 "+s+":"+r):(i=i<10?"0"+i:i,o=o<10?"0"+o:o,s=s<10?"0"+s:s,r=r<10?"0"+r:r,n+"\u5e74"+i+"\u6708"+o+"\u65e5"+s+":"+r)},spaceTime:function(e,t){e=new Date(e),t=new Date(t);var n=e.getTime(),i=t.getTime();return i>n+18e4?t:""}};t.default=i},"54bc":function(e,t,n){"use strict";n.r(t);var i=n("a091"),o=n.n(i);for(var s in i)["default"].indexOf(s)<0&&function(e){n.d(t,e,(function(){return i[e]}))}(s);t["default"]=o.a},"586b":function(e,t){e.exports="/static/images/index/start.png"},"5a43":function(e,t){e.exports=function(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i},e.exports.__esModule=!0,e.exports["default"]=e.exports},"5ab8":function(e,t,n){"use strict";(function(e){var i=n("4ea4");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o=i(n("76f3")),s=uni.getRecorderManager(),r={data:function(){return{isRcord:!1,isEmogji:!1,isMore:!1,isVoice:!1,message:"",timer:"",voiceLength:0,pageY:"",selected:[],Fid:this.fid,Fname:this.fname,FimgUrl:this.fimgUrl,Type:this.type,uid:"",token:"",groupMember:[],groupID:"",userIDList:[]}},components:{Emoji:o.default},onLoad:function(){},created:function(){this.getStorage(),this.getGroupuser()},props:{fid:{type:String,default:" "},fname:{type:String,default:""},fimgUrl:{type:String,default:""},type:{type:String,default:""}},methods:{playSubmit:function(){e("log",this.Type," at components/submit.vue:116"),0==this.Type?uni.$TUICallKit.call({userID:this.Fid,callMediaType:2},(function(t){0===t.code?e("log","call success"," at components/submit.vue:124"):e("log",t.msg," at components/submit.vue:126")})):1==this.Type&&(this.creatGroup(),uni.$TUICallKit.groupCall({groupID:this.groupID,userIDList:this.userIDList,callMediaType:2},(function(t){0===t.code?e("log","groupCall success"," at components/submit.vue:138"):e("log","groupCall failed, error message = ".concat(t.msg)," at components/submit.vue:140")})))},getStorage:function(){try{var e=uni.getStorageSync("user");e?(this.uid=e.id,this.token=e.token):uni.navigateTo({url:"../login/login"})}catch(t){}},getGroupuser:function(){var e=this;uni.request({url:this.serverUrl+"/group/getGroupMeb",data:{gid:this.Fid,token:this.token},method:"POST",success:function(t){var n=t.data.code;if(200==n){for(var i=t.data.result,o=0;o<i.length;o++)i[o]=i[o].uid,e.userIDList.push(i[o]);for(var s=0;s<i.length;s++){var r={userID:i[s]};e.groupMember[s]=r}}else 500==n?uni.showToast({title:"\u7fa4\u804a\u670d\u52a1\u5668\u51fa\u9519\u5566\uff01",icon:"none",duration:2e3}):300==n&&uni.navigateTo({url:"../login/login?name="+e.name})}})},voiceSubmit:function(){0==this.Type?uni.$TUICallKit.call({userID:this.Fid,callMediaType:1},(function(t){0===t.code?e("log","call success"," at components/submit.vue:210"):e("log",t.msg," at components/submit.vue:212")})):1==this.Type&&(this.creatGroup(),uni.$TUICallKit.groupCall({groupID:this.groupID,userIDList:this.userIDList,callMediaType:1},(function(t){0===t.code?e("log","groupCall success"," at components/submit.vue:224"):e("log","groupCall failed, error message = ".concat(t.msg)," at components/submit.vue:226")})))},creatGroup:function(){var t=this;uni.$TUIKit.createGroup({type:uni.$TIM.TYPES.GRP_MEETING,name:this.Fname,memberList:this.groupMember}).then((function(n){e("log",n," at components/submit.vue:238"),t.groupID=n.data.group.groupID})).catch((function(t){e("warn",t," at components/submit.vue:241")}))},getModify:function(){var e=this,t=uni.createSelectorQuery().in(this);t.select(".modify").boundingClientRect((function(t){e.modifyHeight=t.height})).exec()},modify:function(){var e=uni.createAnimation({duration:1e3,timingFunction:"ease"});this.isModfiy?e.bottom(0).step():e.bottom(-this.modifyHeight).step(),this.animationData2=e.export()},recordSubmit:function(){var e=this;this.isRcord=!this.isRcord,this.isEmogji=!1,this.isMore=!1,setTimeout((function(){e.getElementStyle()}),10)},emojiSubmit:function(){var e=this;this.isEmogji=!this.isEmogji,this.isMore=!1,setTimeout((function(){e.getElementStyle()}),10)},moreSubmit:function(){var e=this;this.isMore=!this.isMore,this.isEmogji=!1,setTimeout((function(){e.getElementStyle()}),10)},Emoji:function(e){this.message=this.message+e},inputSubmit:function(e){var t=e.detail.value,n=t.indexOf("\n");-1!=n&&t.length>0&&this.send(this.message,0)},Focus:function(e){var t=this;this.isEmogji=!1,this.isMore=!1,setTimeout((function(){t.getElementStyle()}),10)},EmojiSend:function(){this.message.length>0&&this.send(this.message,0)},EmojiBack:function(){this.message.length>0&&(this.message=this.message.substring(0,this.message.length-1))},getElementStyle:function(){var e=this,t=uni.createSelectorQuery().in(this);t.select(".box").boundingClientRect((function(t){e.$emit("Height",t.height)})).exec()},touchstart:function(e){var t=this;this.pageY=e.changedTouches[0].pageY,this.isVoice=!0;var n=1;this.timer=setInterval((function(){t.voiceLength=n,n++,n>60&&(clearInterval(t.timer),t.touchend())}),1e3),s.start()},touchend:function(){var e=this;clearInterval(this.timer),s.stop(),s.onStop((function(t){var n={voice:t.tempFilePath,time:e.voiceLength};1==e.isVoice&&e.send(n,2),e.voiceLength=1,e.isVoice=!1}))},touchmove:function(e){this.pageY-e.changedTouches[0].pageY&&(this.isVoice=!1)},sendImg:function(e){var t=this,n=9;n="ablum"==e?9:1,uni.chooseImage({count:n,sizeType:["original","compressed"],sourceType:[e],success:function(e){for(var n=e.tempFilePaths,i=0;i<n.length;i++)t.send(n[i],1)}})},getLocation:function(){var t=this;uni.chooseLocation({success:function(n){var i={name:n.name,address:n.address,latitude:n.latitude,longitude:n.longitude};e("log","\u5b9a\u4f4d"," at components/submit.vue:402"),e("log",i," at components/submit.vue:403");var o=JSON.stringify(i);t.send(o,3)}})},send:function(e,t){var n=this,i={message:e,types:t};this.$emit("InputMessage",i),setTimeout((function(){n.message=""}),0)}}};t.default=r}).call(this,n("0de9")["default"])},"5b5a":function(e,t,n){"use strict";(function(e){var i=n("4ea4");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o=n("7cd2"),s=i(n("9b0e")),r=(i(n("d602")),i(n("52ef"))),a=i(n("df93")),c={data:function(){return{friends:[],groups:[],Data:[],uid:"",token:"",isReFresh:!1,isOne:!1,name:"",imgUrl:""}},components:{Header:s.default},onLoad:function(t){var n=this;setTimeout((function(){e("log","start pulldown"," at pages/index/index.vue:60")}),1e3),uni.startPullDownRefresh(),this.getStorage(),this.Friends(),this.getGroup(),this.join(this.uid),this.receiveSocketMsg(),this.groupMsg(),this.leaveChat();var i={SDKAppID:(0,o.genTestUserSig)("").sdkAppID,userID:this.uid,userSig:(0,o.genTestUserSig)(this.uid).userSig},s=uni.$TUIKit.login({userID:this.uid,userSig:(0,o.genTestUserSig)(this.uid).userSig});s.then((function(t){e("log","\u767b\u5f55\u6210\u529f"," at pages/index/index.vue:82")})).catch((function(t){e("log","\u767b\u5f55\u5931\u8d25"," at pages/index/index.vue:84")})),uni.$TUICallKit.login(i,(function(t){0===t.code?(uni.$TUICallKit.enableFloatWindow(!0),e("log","\u767b\u5f55\u6210\u529fTUICallKit"," at pages/index/index.vue:92"),uni.$TUICallKit.setSelfInfo({nickName:n.name,avatar:n.serverUrl+n.imgUrl},(function(t){0===t.code?e("log","\u8bbe\u7f6e\u5934\u50cf\u7528\u6237\u6635\u79f0\u6210\u529f"," at pages/index/index.vue:99"):e("log",t.msg," at pages/index/index.vue:101")}))):e("log",t.msg," at pages/index/index.vue:106")}))},onPullDownRefresh:function(){this.friends=[],this.getStorage(),this.Friends(),setTimeout((function(){uni.stopPullDownRefresh()}),1e3)},methods:{toMessage:function(e){uni.navigateTo({url:"../message/message?id="+e.id+"&name="+e.name+"&imgUrl="+e.imgUrl+"&type="+e.type})},toDetail:function(e){},changTime:function(e){return r.default.dateTime(e)},getStorage:function(){try{var e=uni.getStorageSync("user");e?(this.uid=e.id,this.token=e.token,this.name=e.name,this.imgUrl=e.imgUrl):uni.navigateTo({url:"../login/login"})}catch(t){}},Friends:function(){var e=this;uni.request({url:this.serverUrl+"/home/getFriend",data:{uid:this.uid,state:0,token:this.token},method:"POST",success:function(t){e.isReFresh=!0;var n=t.data.code;if(200==n){var i=t.data.result;if(e.isOne=!1,0==i.length)e.isOne=!0;else if(i.length>0)for(var o=0;o<i.length;o++)i[o].imgUrl=e.serverUrl+i[o].imgUrl,i[o].nickname&&(i[o].name=i[o].nickname),e.friends.push(i[o]);e.SortArr(e.groups)}else 500==n?uni.showToast({title:"\u670d\u52a1\u5668\u51fa\u9519\u5566\uff01",icon:"none",duration:2e3}):300==n&&uni.navigateTo({url:"../login/login?name="+e.name})}})},getGroup:function(){var e=this;uni.request({url:this.serverUrl+"/home/getGroups",data:{uid:this.uid,token:this.token},method:"POST",success:function(t){var n=t.data.code;if(200==n){var i=t.data.result;if(e.isOne=!1,0==i.length)e.isOne=!0;else if(i.length>0){for(var o=0;o<i.length;o++)i[o].imgUrl=e.serverUrl+i[o].imgUrl,e.groups.push(i[o]),e.socket.emit("group",i[o].id);for(var s=0;s<e.groups.length;s++)e.getLastGroupMsg(e.groups,s)}e.SortArr(e.friends)}else 500==n?uni.showToast({title:"\u7fa4\u804a\u670d\u52a1\u5668\u51fa\u9519\u5566\uff01",icon:"none",duration:2e3}):300==n&&uni.navigateTo({url:"../login/login?name="+e.name})}})},SortArr:function(t){t.length>0&&(this.friends=this.friends.concat(this.groups),this.friends=a.default.ArraySort(this.friends,"lastTime",0),e("log",this.friends," at pages/index/index.vue:246"))},getLastGroupMsg:function(t,n){var i=this;uni.request({url:this.serverUrl+"/home/getLastGroupMsg",data:{gid:t[n].id,token:this.token},method:"POST",success:function(o){var s=o.data.code;if(200==s){var r=o.data.result;0==r.types||(1==r.types?r.message="[\u56fe\u7247]":2==r.types?r.message="[\u8bed\u97f3]":3==r.types&&(r.message="[\u4f4d\u7f6e]"));var a=t[n];a.message=r.message,t.splice(n,1,a),e("log","\u8fd9\u662f\u6700\u540e\u4e00\u6761\u6d88\u606f",r.message," at pages/index/index.vue:352")}else 500==s?uni.showToast({title:"\u670d\u52a1\u5668\u51fa\u9519\u5566\uff01",icon:"none",duration:2e3}):300==s&&uni.navigateTo({url:"../login/login?name="+i.name})}})},join:function(e){this.socket.emit("login",e)},receiveSocketMsg:function(){var e=this;this.socket.on("msgs",(function(t,n){var i="";0==t.types?i=t.message:1==t.types?i="[\u56fe\u7247]":2==t.types?i="[\u8bed\u97f3]":3==t.types&&(i="[\u4f4d\u7f6e]");for(var o=0;o<e.friends.length;o++)if(e.friends[o].id==n){var s=e.friends[o];s.lastTime=new Date,s.message=i,s.tip++,e.friends.splice(o,1),e.friends.unshift(s)}}))},groupMsg:function(){var e=this;this.socket.on("groupMsg",(function(t,n,i,o){var s="";0==t.types?s=t.message:1==t.types?s="[\u56fe\u7247]":2==t.types?s="[\u8bed\u97f3]":3==t.types&&(s="[\u4f4d\u7f6e]");for(var r=0;r<e.friends.length;r++)if(e.friends[r].id==i){var a=e.friends[r];a.lastTime=new Date,n==e.uid?a.message=s:a.message=o+":"+s,a.tip++,e.friends.splice(r,1),e.friends.unshift(a)}}))},leaveChat:function(){var e=this;this.socket.on("leaveChat",(function(t,n){for(var i=0;i<e.friends.length;i++)if(e.friends[i].id==n){var o=e.friends[i];o.tip=0,e.friends.splice(i,1,o)}}))}}};t.default=c}).call(this,n("0de9")["default"])},"5bc3":function(e,t,n){var i=n("a395");function o(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,i(o.key),o)}}e.exports=function(e,t,n){return t&&o(e.prototype,t),n&&o(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e},e.exports.__esModule=!0,e.exports["default"]=e.exports},6025:function(e,t,n){"use strict";(function(e,i){var o=n("4ea4");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var s=o(n("970b")),r=o(n("5bc3")),a=o(n("7037")),c="undefined"!=typeof e?e:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},u=[],l=[],d="undefined"!=typeof Uint8Array?Uint8Array:Array,p=!1;function h(){p=!0;for(var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",t=0,n=e.length;t<n;++t)u[t]=e[t],l[e.charCodeAt(t)]=t;l["-".charCodeAt(0)]=62,l["_".charCodeAt(0)]=63}function f(e,t,n){for(var i,o,s=[],r=t;r<n;r+=3)i=(e[r]<<16)+(e[r+1]<<8)+e[r+2],s.push(u[(o=i)>>18&63]+u[o>>12&63]+u[o>>6&63]+u[63&o]);return s.join("")}function g(e){var t;p||h();for(var n=e.length,i=n%3,o="",s=[],r=0,a=n-i;r<a;r+=16383)s.push(f(e,r,r+16383>a?a:r+16383));return 1===i?(t=e[n-1],o+=u[t>>2],o+=u[t<<4&63],o+="=="):2===i&&(t=(e[n-2]<<8)+e[n-1],o+=u[t>>10],o+=u[t>>4&63],o+=u[t<<2&63],o+="="),s.push(o),s.join("")}function _(e,t,n,i,o){var s,r,a=8*o-i-1,c=(1<<a)-1,u=c>>1,l=-7,d=n?o-1:0,p=n?-1:1,h=e[t+d];for(d+=p,s=h&(1<<-l)-1,h>>=-l,l+=a;l>0;s=256*s+e[t+d],d+=p,l-=8);for(r=s&(1<<-l)-1,s>>=-l,l+=i;l>0;r=256*r+e[t+d],d+=p,l-=8);if(0===s)s=1-u;else{if(s===c)return r?NaN:1/0*(h?-1:1);r+=Math.pow(2,i),s-=u}return(h?-1:1)*r*Math.pow(2,s-i)}function v(e,t,n,i,o,s){var r,a,c,u=8*s-o-1,l=(1<<u)-1,d=l>>1,p=23===o?Math.pow(2,-24)-Math.pow(2,-77):0,h=i?0:s-1,f=i?1:-1,g=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(a=isNaN(t)?1:0,r=l):(r=Math.floor(Math.log(t)/Math.LN2),t*(c=Math.pow(2,-r))<1&&(r--,c*=2),(t+=r+d>=1?p/c:p*Math.pow(2,1-d))*c>=2&&(r++,c/=2),r+d>=l?(a=0,r=l):r+d>=1?(a=(t*c-1)*Math.pow(2,o),r+=d):(a=t*Math.pow(2,d-1)*Math.pow(2,o),r=0));o>=8;e[n+h]=255&a,h+=f,a/=256,o-=8);for(r=r<<o|a,u+=o;u>0;e[n+h]=255&r,h+=f,r/=256,u-=8);e[n+h-f]|=128*g}var m={}.toString,y=Array.isArray||function(e){return"[object Array]"==m.call(e)};function M(){return C.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function I(e,t){if(M()<t)throw new RangeError("Invalid typed array length");return C.TYPED_ARRAY_SUPPORT?(e=new Uint8Array(t)).__proto__=C.prototype:(null===e&&(e=new C(t)),e.length=t),e}function C(e,t,n){if(!(C.TYPED_ARRAY_SUPPORT||this instanceof C))return new C(e,t,n);if("number"==typeof e){if("string"==typeof t)throw new Error("If encoding is specified then the first argument must be a string");return S(this,e)}return T(this,e,t,n)}function T(e,t,n,i){if("number"==typeof t)throw new TypeError('"value" argument must not be a number');return"undefined"!=typeof ArrayBuffer&&t instanceof ArrayBuffer?function(e,t,n,i){if(t.byteLength,n<0||t.byteLength<n)throw new RangeError("'offset' is out of bounds");if(t.byteLength<n+(i||0))throw new RangeError("'length' is out of bounds");return t=void 0===n&&void 0===i?new Uint8Array(t):void 0===i?new Uint8Array(t,n):new Uint8Array(t,n,i),C.TYPED_ARRAY_SUPPORT?(e=t).__proto__=C.prototype:e=E(e,t),e}(e,t,n,i):"string"==typeof t?function(e,t,n){if("string"==typeof n&&""!==n||(n="utf8"),!C.isEncoding(n))throw new TypeError('"encoding" must be a valid string encoding');var i=0|A(t,n),o=(e=I(e,i)).write(t,n);return o!==i&&(e=e.slice(0,o)),e}(e,t,n):function(e,t){if(w(t)){var n=0|D(t.length);return 0===(e=I(e,n)).length||t.copy(e,0,0,n),e}if(t){if("undefined"!=typeof ArrayBuffer&&t.buffer instanceof ArrayBuffer||"length"in t)return"number"!=typeof t.length||(i=t.length)!=i?I(e,0):E(e,t);if("Buffer"===t.type&&y(t.data))return E(e,t.data)}var i;throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}(e,t)}function k(e){if("number"!=typeof e)throw new TypeError('"size" argument must be a number');if(e<0)throw new RangeError('"size" argument must not be negative')}function S(e,t){if(k(t),e=I(e,t<0?0:0|D(t)),!C.TYPED_ARRAY_SUPPORT)for(var n=0;n<t;++n)e[n]=0;return e}function E(e,t){var n=t.length<0?0:0|D(t.length);e=I(e,n);for(var i=0;i<n;i+=1)e[i]=255&t[i];return e}function D(e){if(e>=M())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+M().toString(16)+" bytes");return 0|e}function w(e){return!(null==e||!e._isBuffer)}function A(e,t){if(w(e))return e.length;if("undefined"!=typeof ArrayBuffer&&"function"==typeof ArrayBuffer.isView&&(ArrayBuffer.isView(e)||e instanceof ArrayBuffer))return e.byteLength;"string"!=typeof e&&(e=""+e);var n=e.length;if(0===n)return 0;for(var i=!1;;)switch(t){case"ascii":case"latin1":case"binary":return n;case"utf8":case"utf-8":case void 0:return ne(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*n;case"hex":return n>>>1;case"base64":return ie(e).length;default:if(i)return ne(e).length;t=(""+t).toLowerCase(),i=!0}}function b(e,t,n){var i=!1;if((void 0===t||t<0)&&(t=0),t>this.length)return"";if((void 0===n||n>this.length)&&(n=this.length),n<=0)return"";if((n>>>=0)<=(t>>>=0))return"";for(e||(e="utf8");;)switch(e){case"hex":return K(this,t,n);case"utf8":case"utf-8":return B(this,t,n);case"ascii":return V(this,t,n);case"latin1":case"binary":return H(this,t,n);case"base64":return q(this,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return j(this,t,n);default:if(i)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),i=!0}}function L(e,t,n){var i=e[t];e[t]=e[n],e[n]=i}function R(e,t,n,i,o){if(0===e.length)return-1;if("string"==typeof n?(i=n,n=0):n>2147483647?n=2147483647:n<-2147483648&&(n=-2147483648),n=+n,isNaN(n)&&(n=o?0:e.length-1),n<0&&(n=e.length+n),n>=e.length){if(o)return-1;n=e.length-1}else if(n<0){if(!o)return-1;n=0}if("string"==typeof t&&(t=C.from(t,i)),w(t))return 0===t.length?-1:O(e,t,n,i,o);if("number"==typeof t)return t&=255,C.TYPED_ARRAY_SUPPORT&&"function"==typeof Uint8Array.prototype.indexOf?o?Uint8Array.prototype.indexOf.call(e,t,n):Uint8Array.prototype.lastIndexOf.call(e,t,n):O(e,[t],n,i,o);throw new TypeError("val must be string, number or Buffer")}function O(e,t,n,i,o){var s,r=1,a=e.length,c=t.length;if(void 0!==i&&("ucs2"===(i=String(i).toLowerCase())||"ucs-2"===i||"utf16le"===i||"utf-16le"===i)){if(e.length<2||t.length<2)return-1;r=2,a/=2,c/=2,n/=2}function u(e,t){return 1===r?e[t]:e.readUInt16BE(t*r)}if(o){var l=-1;for(s=n;s<a;s++)if(u(e,s)===u(t,-1===l?0:s-l)){if(-1===l&&(l=s),s-l+1===c)return l*r}else-1!==l&&(s-=s-l),l=-1}else for(n+c>a&&(n=a-c),s=n;s>=0;s--){for(var d=!0,p=0;p<c;p++)if(u(e,s+p)!==u(t,p)){d=!1;break}if(d)return s}return-1}function N(e,t,n,i){n=Number(n)||0;var o=e.length-n;i?(i=Number(i))>o&&(i=o):i=o;var s=t.length;if(s%2!=0)throw new TypeError("Invalid hex string");i>s/2&&(i=s/2);for(var r=0;r<i;++r){var a=parseInt(t.substr(2*r,2),16);if(isNaN(a))return r;e[n+r]=a}return r}function P(e,t,n,i){return oe(ne(t,e.length-n),e,n,i)}function U(e,t,n,i){return oe(function(e){for(var t=[],n=0;n<e.length;++n)t.push(255&e.charCodeAt(n));return t}(t),e,n,i)}function G(e,t,n,i){return U(e,t,n,i)}function x(e,t,n,i){return oe(ie(t),e,n,i)}function F(e,t,n,i){return oe(function(e,t){for(var n,i,o,s=[],r=0;r<e.length&&!((t-=2)<0);++r)n=e.charCodeAt(r),i=n>>8,o=n%256,s.push(o),s.push(i);return s}(t,e.length-n),e,n,i)}function q(e,t,n){return 0===t&&n===e.length?g(e):g(e.slice(t,n))}function B(e,t,n){n=Math.min(e.length,n);for(var i=[],o=t;o<n;){var s,r,a,c,u=e[o],l=null,d=u>239?4:u>223?3:u>191?2:1;if(o+d<=n)switch(d){case 1:u<128&&(l=u);break;case 2:128==(192&(s=e[o+1]))&&(c=(31&u)<<6|63&s)>127&&(l=c);break;case 3:s=e[o+1],r=e[o+2],128==(192&s)&&128==(192&r)&&(c=(15&u)<<12|(63&s)<<6|63&r)>2047&&(c<55296||c>57343)&&(l=c);break;case 4:s=e[o+1],r=e[o+2],a=e[o+3],128==(192&s)&&128==(192&r)&&128==(192&a)&&(c=(15&u)<<18|(63&s)<<12|(63&r)<<6|63&a)>65535&&c<1114112&&(l=c)}null===l?(l=65533,d=1):l>65535&&(l-=65536,i.push(l>>>10&1023|55296),l=56320|1023&l),i.push(l),o+=d}return function(e){var t=e.length;if(t<=$)return String.fromCharCode.apply(String,e);for(var n="",i=0;i<t;)n+=String.fromCharCode.apply(String,e.slice(i,i+=$));return n}(i)}C.TYPED_ARRAY_SUPPORT=void 0===c.TYPED_ARRAY_SUPPORT||c.TYPED_ARRAY_SUPPORT,C.poolSize=8192,C._augment=function(e){return e.__proto__=C.prototype,e},C.from=function(e,t,n){return T(null,e,t,n)},C.TYPED_ARRAY_SUPPORT&&(C.prototype.__proto__=Uint8Array.prototype,C.__proto__=Uint8Array),C.alloc=function(e,t,n){return function(e,t,n,i){return k(t),t<=0?I(e,t):void 0!==n?"string"==typeof i?I(e,t).fill(n,i):I(e,t).fill(n):I(e,t)}(null,e,t,n)},C.allocUnsafe=function(e){return S(null,e)},C.allocUnsafeSlow=function(e){return S(null,e)},C.isBuffer=se,C.compare=function(e,t){if(!w(e)||!w(t))throw new TypeError("Arguments must be Buffers");if(e===t)return 0;for(var n=e.length,i=t.length,o=0,s=Math.min(n,i);o<s;++o)if(e[o]!==t[o]){n=e[o],i=t[o];break}return n<i?-1:i<n?1:0},C.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},C.concat=function(e,t){if(!y(e))throw new TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return C.alloc(0);var n;if(void 0===t)for(t=0,n=0;n<e.length;++n)t+=e[n].length;var i=C.allocUnsafe(t),o=0;for(n=0;n<e.length;++n){var s=e[n];if(!w(s))throw new TypeError('"list" argument must be an Array of Buffers');s.copy(i,o),o+=s.length}return i},C.byteLength=A,C.prototype._isBuffer=!0,C.prototype.swap16=function(){var e=this.length;if(e%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var t=0;t<e;t+=2)L(this,t,t+1);return this},C.prototype.swap32=function(){var e=this.length;if(e%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var t=0;t<e;t+=4)L(this,t,t+3),L(this,t+1,t+2);return this},C.prototype.swap64=function(){var e=this.length;if(e%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var t=0;t<e;t+=8)L(this,t,t+7),L(this,t+1,t+6),L(this,t+2,t+5),L(this,t+3,t+4);return this},C.prototype.toString=function(){var e=0|this.length;return 0===e?"":0===arguments.length?B(this,0,e):b.apply(this,arguments)},C.prototype.equals=function(e){if(!w(e))throw new TypeError("Argument must be a Buffer");return this===e||0===C.compare(this,e)},C.prototype.inspect=function(){var e="";return this.length>0&&(e=this.toString("hex",0,50).match(/.{2}/g).join(" "),this.length>50&&(e+=" ... ")),"<Buffer "+e+">"},C.prototype.compare=function(e,t,n,i,o){if(!w(e))throw new TypeError("Argument must be a Buffer");if(void 0===t&&(t=0),void 0===n&&(n=e?e.length:0),void 0===i&&(i=0),void 0===o&&(o=this.length),t<0||n>e.length||i<0||o>this.length)throw new RangeError("out of range index");if(i>=o&&t>=n)return 0;if(i>=o)return-1;if(t>=n)return 1;if(this===e)return 0;for(var s=(o>>>=0)-(i>>>=0),r=(n>>>=0)-(t>>>=0),a=Math.min(s,r),c=this.slice(i,o),u=e.slice(t,n),l=0;l<a;++l)if(c[l]!==u[l]){s=c[l],r=u[l];break}return s<r?-1:r<s?1:0},C.prototype.includes=function(e,t,n){return-1!==this.indexOf(e,t,n)},C.prototype.indexOf=function(e,t,n){return R(this,e,t,n,!0)},C.prototype.lastIndexOf=function(e,t,n){return R(this,e,t,n,!1)},C.prototype.write=function(e,t,n,i){if(void 0===t)i="utf8",n=this.length,t=0;else if(void 0===n&&"string"==typeof t)i=t,n=this.length,t=0;else{if(!isFinite(t))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");t|=0,isFinite(n)?(n|=0,void 0===i&&(i="utf8")):(i=n,n=void 0)}var o=this.length-t;if((void 0===n||n>o)&&(n=o),e.length>0&&(n<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");i||(i="utf8");for(var s=!1;;)switch(i){case"hex":return N(this,e,t,n);case"utf8":case"utf-8":return P(this,e,t,n);case"ascii":return U(this,e,t,n);case"latin1":case"binary":return G(this,e,t,n);case"base64":return x(this,e,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return F(this,e,t,n);default:if(s)throw new TypeError("Unknown encoding: "+i);i=(""+i).toLowerCase(),s=!0}},C.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var $=4096;function V(e,t,n){var i="";n=Math.min(e.length,n);for(var o=t;o<n;++o)i+=String.fromCharCode(127&e[o]);return i}function H(e,t,n){var i="";n=Math.min(e.length,n);for(var o=t;o<n;++o)i+=String.fromCharCode(e[o]);return i}function K(e,t,n){var i=e.length;(!t||t<0)&&(t=0),(!n||n<0||n>i)&&(n=i);for(var o="",s=t;s<n;++s)o+=te(e[s]);return o}function j(e,t,n){for(var i=e.slice(t,n),o="",s=0;s<i.length;s+=2)o+=String.fromCharCode(i[s]+256*i[s+1]);return o}function z(e,t,n){if(e%1!=0||e<0)throw new RangeError("offset is not uint");if(e+t>n)throw new RangeError("Trying to access beyond buffer length")}function Y(e,t,n,i,o,s){if(!w(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(t>o||t<s)throw new RangeError('"value" argument is out of bounds');if(n+i>e.length)throw new RangeError("Index out of range")}function W(e,t,n,i){t<0&&(t=65535+t+1);for(var o=0,s=Math.min(e.length-n,2);o<s;++o)e[n+o]=(t&255<<8*(i?o:1-o))>>>8*(i?o:1-o)}function J(e,t,n,i){t<0&&(t=4294967295+t+1);for(var o=0,s=Math.min(e.length-n,4);o<s;++o)e[n+o]=t>>>8*(i?o:3-o)&255}function X(e,t,n,i,o,s){if(n+i>e.length)throw new RangeError("Index out of range");if(n<0)throw new RangeError("Index out of range")}function Z(e,t,n,i,o){return o||X(e,0,n,4),v(e,t,n,i,23,4),n+4}function Q(e,t,n,i,o){return o||X(e,0,n,8),v(e,t,n,i,52,8),n+8}C.prototype.slice=function(e,t){var n,i=this.length;if((e=~~e)<0?(e+=i)<0&&(e=0):e>i&&(e=i),(t=void 0===t?i:~~t)<0?(t+=i)<0&&(t=0):t>i&&(t=i),t<e&&(t=e),C.TYPED_ARRAY_SUPPORT)(n=this.subarray(e,t)).__proto__=C.prototype;else{var o=t-e;n=new C(o,void 0);for(var s=0;s<o;++s)n[s]=this[s+e]}return n},C.prototype.readUIntLE=function(e,t,n){e|=0,t|=0,n||z(e,t,this.length);for(var i=this[e],o=1,s=0;++s<t&&(o*=256);)i+=this[e+s]*o;return i},C.prototype.readUIntBE=function(e,t,n){e|=0,t|=0,n||z(e,t,this.length);for(var i=this[e+--t],o=1;t>0&&(o*=256);)i+=this[e+--t]*o;return i},C.prototype.readUInt8=function(e,t){return t||z(e,1,this.length),this[e]},C.prototype.readUInt16LE=function(e,t){return t||z(e,2,this.length),this[e]|this[e+1]<<8},C.prototype.readUInt16BE=function(e,t){return t||z(e,2,this.length),this[e]<<8|this[e+1]},C.prototype.readUInt32LE=function(e,t){return t||z(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},C.prototype.readUInt32BE=function(e,t){return t||z(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},C.prototype.readIntLE=function(e,t,n){e|=0,t|=0,n||z(e,t,this.length);for(var i=this[e],o=1,s=0;++s<t&&(o*=256);)i+=this[e+s]*o;return i>=(o*=128)&&(i-=Math.pow(2,8*t)),i},C.prototype.readIntBE=function(e,t,n){e|=0,t|=0,n||z(e,t,this.length);for(var i=t,o=1,s=this[e+--i];i>0&&(o*=256);)s+=this[e+--i]*o;return s>=(o*=128)&&(s-=Math.pow(2,8*t)),s},C.prototype.readInt8=function(e,t){return t||z(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},C.prototype.readInt16LE=function(e,t){t||z(e,2,this.length);var n=this[e]|this[e+1]<<8;return 32768&n?4294901760|n:n},C.prototype.readInt16BE=function(e,t){t||z(e,2,this.length);var n=this[e+1]|this[e]<<8;return 32768&n?4294901760|n:n},C.prototype.readInt32LE=function(e,t){return t||z(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},C.prototype.readInt32BE=function(e,t){return t||z(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},C.prototype.readFloatLE=function(e,t){return t||z(e,4,this.length),_(this,e,!0,23,4)},C.prototype.readFloatBE=function(e,t){return t||z(e,4,this.length),_(this,e,!1,23,4)},C.prototype.readDoubleLE=function(e,t){return t||z(e,8,this.length),_(this,e,!0,52,8)},C.prototype.readDoubleBE=function(e,t){return t||z(e,8,this.length),_(this,e,!1,52,8)},C.prototype.writeUIntLE=function(e,t,n,i){e=+e,t|=0,n|=0,i||Y(this,e,t,n,Math.pow(2,8*n)-1,0);var o=1,s=0;for(this[t]=255&e;++s<n&&(o*=256);)this[t+s]=e/o&255;return t+n},C.prototype.writeUIntBE=function(e,t,n,i){e=+e,t|=0,n|=0,i||Y(this,e,t,n,Math.pow(2,8*n)-1,0);var o=n-1,s=1;for(this[t+o]=255&e;--o>=0&&(s*=256);)this[t+o]=e/s&255;return t+n},C.prototype.writeUInt8=function(e,t,n){return e=+e,t|=0,n||Y(this,e,t,1,255,0),C.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),this[t]=255&e,t+1},C.prototype.writeUInt16LE=function(e,t,n){return e=+e,t|=0,n||Y(this,e,t,2,65535,0),C.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):W(this,e,t,!0),t+2},C.prototype.writeUInt16BE=function(e,t,n){return e=+e,t|=0,n||Y(this,e,t,2,65535,0),C.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):W(this,e,t,!1),t+2},C.prototype.writeUInt32LE=function(e,t,n){return e=+e,t|=0,n||Y(this,e,t,4,4294967295,0),C.TYPED_ARRAY_SUPPORT?(this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e):J(this,e,t,!0),t+4},C.prototype.writeUInt32BE=function(e,t,n){return e=+e,t|=0,n||Y(this,e,t,4,4294967295,0),C.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):J(this,e,t,!1),t+4},C.prototype.writeIntLE=function(e,t,n,i){if(e=+e,t|=0,!i){var o=Math.pow(2,8*n-1);Y(this,e,t,n,o-1,-o)}var s=0,r=1,a=0;for(this[t]=255&e;++s<n&&(r*=256);)e<0&&0===a&&0!==this[t+s-1]&&(a=1),this[t+s]=(e/r>>0)-a&255;return t+n},C.prototype.writeIntBE=function(e,t,n,i){if(e=+e,t|=0,!i){var o=Math.pow(2,8*n-1);Y(this,e,t,n,o-1,-o)}var s=n-1,r=1,a=0;for(this[t+s]=255&e;--s>=0&&(r*=256);)e<0&&0===a&&0!==this[t+s+1]&&(a=1),this[t+s]=(e/r>>0)-a&255;return t+n},C.prototype.writeInt8=function(e,t,n){return e=+e,t|=0,n||Y(this,e,t,1,127,-128),C.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),e<0&&(e=255+e+1),this[t]=255&e,t+1},C.prototype.writeInt16LE=function(e,t,n){return e=+e,t|=0,n||Y(this,e,t,2,32767,-32768),C.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):W(this,e,t,!0),t+2},C.prototype.writeInt16BE=function(e,t,n){return e=+e,t|=0,n||Y(this,e,t,2,32767,-32768),C.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):W(this,e,t,!1),t+2},C.prototype.writeInt32LE=function(e,t,n){return e=+e,t|=0,n||Y(this,e,t,4,2147483647,-2147483648),C.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24):J(this,e,t,!0),t+4},C.prototype.writeInt32BE=function(e,t,n){return e=+e,t|=0,n||Y(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),C.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):J(this,e,t,!1),t+4},C.prototype.writeFloatLE=function(e,t,n){return Z(this,e,t,!0,n)},C.prototype.writeFloatBE=function(e,t,n){return Z(this,e,t,!1,n)},C.prototype.writeDoubleLE=function(e,t,n){return Q(this,e,t,!0,n)},C.prototype.writeDoubleBE=function(e,t,n){return Q(this,e,t,!1,n)},C.prototype.copy=function(e,t,n,i){if(n||(n=0),i||0===i||(i=this.length),t>=e.length&&(t=e.length),t||(t=0),i>0&&i<n&&(i=n),i===n)return 0;if(0===e.length||0===this.length)return 0;if(t<0)throw new RangeError("targetStart out of bounds");if(n<0||n>=this.length)throw new RangeError("sourceStart out of bounds");if(i<0)throw new RangeError("sourceEnd out of bounds");i>this.length&&(i=this.length),e.length-t<i-n&&(i=e.length-t+n);var o,s=i-n;if(this===e&&n<t&&t<i)for(o=s-1;o>=0;--o)e[o+t]=this[o+n];else if(s<1e3||!C.TYPED_ARRAY_SUPPORT)for(o=0;o<s;++o)e[o+t]=this[o+n];else Uint8Array.prototype.set.call(e,this.subarray(n,n+s),t);return s},C.prototype.fill=function(e,t,n,i){if("string"==typeof e){if("string"==typeof t?(i=t,t=0,n=this.length):"string"==typeof n&&(i=n,n=this.length),1===e.length){var o=e.charCodeAt(0);o<256&&(e=o)}if(void 0!==i&&"string"!=typeof i)throw new TypeError("encoding must be a string");if("string"==typeof i&&!C.isEncoding(i))throw new TypeError("Unknown encoding: "+i)}else"number"==typeof e&&(e&=255);if(t<0||this.length<t||this.length<n)throw new RangeError("Out of range index");if(n<=t)return this;var s;if(t>>>=0,n=void 0===n?this.length:n>>>0,e||(e=0),"number"==typeof e)for(s=t;s<n;++s)this[s]=e;else{var r=w(e)?e:ne(new C(e,i).toString()),a=r.length;for(s=0;s<n-t;++s)this[s+t]=r[s%a]}return this};var ee=/[^+\/0-9A-Za-z-_]/g;function te(e){return e<16?"0"+e.toString(16):e.toString(16)}function ne(e,t){var n;t=t||1/0;for(var i=e.length,o=null,s=[],r=0;r<i;++r){if((n=e.charCodeAt(r))>55295&&n<57344){if(!o){if(n>56319){(t-=3)>-1&&s.push(239,191,189);continue}if(r+1===i){(t-=3)>-1&&s.push(239,191,189);continue}o=n;continue}if(n<56320){(t-=3)>-1&&s.push(239,191,189),o=n;continue}n=65536+(o-55296<<10|n-56320)}else o&&(t-=3)>-1&&s.push(239,191,189);if(o=null,n<128){if((t-=1)<0)break;s.push(n)}else if(n<2048){if((t-=2)<0)break;s.push(n>>6|192,63&n|128)}else if(n<65536){if((t-=3)<0)break;s.push(n>>12|224,n>>6&63|128,63&n|128)}else{if(!(n<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;s.push(n>>18|240,n>>12&63|128,n>>6&63|128,63&n|128)}}return s}function ie(e){return function(e){var t,n,i,o,s,r;p||h();var a=e.length;if(a%4>0)throw new Error("Invalid string. Length must be a multiple of 4");s="="===e[a-2]?2:"="===e[a-1]?1:0,r=new d(3*a/4-s),i=s>0?a-4:a;var c=0;for(t=0,n=0;t<i;t+=4,n+=3)o=l[e.charCodeAt(t)]<<18|l[e.charCodeAt(t+1)]<<12|l[e.charCodeAt(t+2)]<<6|l[e.charCodeAt(t+3)],r[c++]=o>>16&255,r[c++]=o>>8&255,r[c++]=255&o;return 2===s?(o=l[e.charCodeAt(t)]<<2|l[e.charCodeAt(t+1)]>>4,r[c++]=255&o):1===s&&(o=l[e.charCodeAt(t)]<<10|l[e.charCodeAt(t+1)]<<4|l[e.charCodeAt(t+2)]>>2,r[c++]=o>>8&255,r[c++]=255&o),r}(function(e){if((e=function(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")}(e).replace(ee,"")).length<2)return"";for(;e.length%4!=0;)e+="=";return e}(e))}function oe(e,t,n,i){for(var o=0;o<i&&!(o+n>=t.length||o>=e.length);++o)t[o+n]=e[o];return o}function se(e){return null!=e&&(!!e._isBuffer||re(e)||function(e){return"function"==typeof e.readFloatLE&&"function"==typeof e.slice&&re(e.slice(0,0))}(e))}function re(e){return!!e.constructor&&"function"==typeof e.constructor.isBuffer&&e.constructor.isBuffer(e)}function ae(e,t){return e(t={exports:{}},t.exports),t.exports}"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof e||"undefined"!=typeof self&&self;var ce=ae((function(e,t){var n;e.exports=(n=n||function(e,t){var n=Object.create||function(){function e(){}return function(t){var n;return e.prototype=t,n=new e,e.prototype=null,n}}(),i={},o=i.lib={},s=o.Base={extend:function(e){var t=n(this);return e&&t.mixIn(e),t.hasOwnProperty("init")&&this.init!==t.init||(t.init=function(){t.$super.init.apply(this,arguments)}),t.init.prototype=t,t.$super=this,t},create:function(){var e=this.extend();return e.init.apply(e,arguments),e},init:function(){},mixIn:function(e){for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t]);e.hasOwnProperty("toString")&&(this.toString=e.toString)},clone:function(){return this.init.prototype.extend(this)}},r=o.WordArray=s.extend({init:function(e,t){e=this.words=e||[],this.sigBytes=null!=t?t:4*e.length},toString:function(e){return(e||c).stringify(this)},concat:function(e){var t=this.words,n=e.words,i=this.sigBytes,o=e.sigBytes;if(this.clamp(),i%4)for(var s=0;s<o;s++){var r=n[s>>>2]>>>24-s%4*8&255;t[i+s>>>2]|=r<<24-(i+s)%4*8}else for(s=0;s<o;s+=4)t[i+s>>>2]=n[s>>>2];return this.sigBytes+=o,this},clamp:function(){var t=this.words,n=this.sigBytes;t[n>>>2]&=4294967295<<32-n%4*8,t.length=e.ceil(n/4)},clone:function(){var e=s.clone.call(this);return e.words=this.words.slice(0),e},random:function(t){for(var n,i=[],o=function(t){t=t;var n=987654321,i=4294967295;return function(){var o=((n=36969*(65535&n)+(n>>16)&i)<<16)+(t=18e3*(65535&t)+(t>>16)&i)&i;return o/=4294967296,(o+=.5)*(e.random()>.5?1:-1)}},s=0;s<t;s+=4){var a=o(4294967296*(n||e.random()));n=987654071*a(),i.push(4294967296*a()|0)}return new r.init(i,t)}}),a=i.enc={},c=a.Hex={stringify:function(e){for(var t=e.words,n=e.sigBytes,i=[],o=0;o<n;o++){var s=t[o>>>2]>>>24-o%4*8&255;i.push((s>>>4).toString(16)),i.push((15&s).toString(16))}return i.join("")},parse:function(e){for(var t=e.length,n=[],i=0;i<t;i+=2)n[i>>>3]|=parseInt(e.substr(i,2),16)<<24-i%8*4;return new r.init(n,t/2)}},u=a.Latin1={stringify:function(e){for(var t=e.words,n=e.sigBytes,i=[],o=0;o<n;o++){var s=t[o>>>2]>>>24-o%4*8&255;i.push(String.fromCharCode(s))}return i.join("")},parse:function(e){for(var t=e.length,n=[],i=0;i<t;i++)n[i>>>2]|=(255&e.charCodeAt(i))<<24-i%4*8;return new r.init(n,t)}},l=a.Utf8={stringify:function(e){try{return decodeURIComponent(escape(u.stringify(e)))}catch(e){throw new Error("Malformed UTF-8 data")}},parse:function(e){return u.parse(unescape(encodeURIComponent(e)))}},d=o.BufferedBlockAlgorithm=s.extend({reset:function(){this._data=new r.init,this._nDataBytes=0},_append:function(e){"string"==typeof e&&(e=l.parse(e)),this._data.concat(e),this._nDataBytes+=e.sigBytes},_process:function(t){var n=this._data,i=n.words,o=n.sigBytes,s=this.blockSize,a=4*s,c=o/a,u=(c=t?e.ceil(c):e.max((0|c)-this._minBufferSize,0))*s,l=e.min(4*u,o);if(u){for(var d=0;d<u;d+=s)this._doProcessBlock(i,d);var p=i.splice(0,u);n.sigBytes-=l}return new r.init(p,l)},clone:function(){var e=s.clone.call(this);return e._data=this._data.clone(),e},_minBufferSize:0}),p=(o.Hasher=d.extend({cfg:s.extend(),init:function(e){this.cfg=this.cfg.extend(e),this.reset()},reset:function(){d.reset.call(this),this._doReset()},update:function(e){return this._append(e),this._process(),this},finalize:function(e){e&&this._append(e);var t=this._doFinalize();return t},blockSize:16,_createHelper:function(e){return function(t,n){return new e.init(n).finalize(t)}},_createHmacHelper:function(e){return function(t,n){return new p.HMAC.init(e,n).finalize(t)}}}),i.algo={});return i}(Math),n)})),ue=(ae((function(e,t){var n,i,o,s,r,a;e.exports=(o=(i=n=ce).lib,s=o.Base,r=o.WordArray,(a=i.x64={}).Word=s.extend({init:function(e,t){this.high=e,this.low=t}}),a.WordArray=s.extend({init:function(e,t){e=this.words=e||[],this.sigBytes=null!=t?t:8*e.length},toX32:function(){for(var e=this.words,t=e.length,n=[],i=0;i<t;i++){var o=e[i];n.push(o.high),n.push(o.low)}return r.create(n,this.sigBytes)},clone:function(){for(var e=s.clone.call(this),t=e.words=this.words.slice(0),n=t.length,i=0;i<n;i++)t[i]=t[i].clone();return e}}),n)})),ae((function(e,t){var n;e.exports=(n=ce,function(){if("function"==typeof ArrayBuffer){var e=n.lib.WordArray,t=e.init;(e.init=function(e){if(e instanceof ArrayBuffer&&(e=new Uint8Array(e)),(e instanceof Int8Array||"undefined"!=typeof Uint8ClampedArray&&e instanceof Uint8ClampedArray||e instanceof Int16Array||e instanceof Uint16Array||e instanceof Int32Array||e instanceof Uint32Array||e instanceof Float32Array||e instanceof Float64Array)&&(e=new Uint8Array(e.buffer,e.byteOffset,e.byteLength)),e instanceof Uint8Array){for(var n=e.byteLength,i=[],o=0;o<n;o++)i[o>>>2]|=e[o]<<24-o%4*8;t.call(this,i,n)}else t.apply(this,arguments)}).prototype=e}}(),n.lib.WordArray)})),ae((function(e,t){var n;e.exports=(n=ce,function(){var e=n,t=e.lib.WordArray,i=e.enc;function o(e){return e<<8&4278255360|e>>>8&16711935}i.Utf16=i.Utf16BE={stringify:function(e){for(var t=e.words,n=e.sigBytes,i=[],o=0;o<n;o+=2){var s=t[o>>>2]>>>16-o%4*8&65535;i.push(String.fromCharCode(s))}return i.join("")},parse:function(e){for(var n=e.length,i=[],o=0;o<n;o++)i[o>>>1]|=e.charCodeAt(o)<<16-o%2*16;return t.create(i,2*n)}},i.Utf16LE={stringify:function(e){for(var t=e.words,n=e.sigBytes,i=[],s=0;s<n;s+=2){var r=o(t[s>>>2]>>>16-s%4*8&65535);i.push(String.fromCharCode(r))}return i.join("")},parse:function(e){for(var n=e.length,i=[],s=0;s<n;s++)i[s>>>1]|=o(e.charCodeAt(s)<<16-s%2*16);return t.create(i,2*n)}}}(),n.enc.Utf16)})),ae((function(e,t){var n,i,o;e.exports=(o=(i=n=ce).lib.WordArray,i.enc.Base64={stringify:function(e){var t=e.words,n=e.sigBytes,i=this._map;e.clamp();for(var o=[],s=0;s<n;s+=3)for(var r=(t[s>>>2]>>>24-s%4*8&255)<<16|(t[s+1>>>2]>>>24-(s+1)%4*8&255)<<8|t[s+2>>>2]>>>24-(s+2)%4*8&255,a=0;a<4&&s+.75*a<n;a++)o.push(i.charAt(r>>>6*(3-a)&63));var c=i.charAt(64);if(c)for(;o.length%4;)o.push(c);return o.join("")},parse:function(e){var t=e.length,n=this._map,i=this._reverseMap;if(!i){i=this._reverseMap=[];for(var s=0;s<n.length;s++)i[n.charCodeAt(s)]=s}var r=n.charAt(64);if(r){var a=e.indexOf(r);-1!==a&&(t=a)}return function(e,t,n){for(var i=[],s=0,r=0;r<t;r++)if(r%4){var a=n[e.charCodeAt(r-1)]<<r%4*2,c=n[e.charCodeAt(r)]>>>6-r%4*2;i[s>>>2]|=(a|c)<<24-s%4*8,s++}return o.create(i,s)}(e,t,i)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="},n.enc.Base64)})),ae((function(e,t){var n;e.exports=(n=ce,function(e){var t=n,i=t.lib,o=i.WordArray,s=i.Hasher,r=t.algo,a=[];!function(){for(var t=0;t<64;t++)a[t]=4294967296*e.abs(e.sin(t+1))|0}();var c=r.MD5=s.extend({_doReset:function(){this._hash=new o.init([1732584193,4023233417,2562383102,271733878])},_doProcessBlock:function(e,t){for(var n=0;n<16;n++){var i=t+n,o=e[i];e[i]=16711935&(o<<8|o>>>24)|4278255360&(o<<24|o>>>8)}var s=this._hash.words,r=e[t+0],c=e[t+1],h=e[t+2],f=e[t+3],g=e[t+4],_=e[t+5],v=e[t+6],m=e[t+7],y=e[t+8],M=e[t+9],I=e[t+10],C=e[t+11],T=e[t+12],k=e[t+13],S=e[t+14],E=e[t+15],D=s[0],w=s[1],A=s[2],b=s[3];D=u(D,w,A,b,r,7,a[0]),b=u(b,D,w,A,c,12,a[1]),A=u(A,b,D,w,h,17,a[2]),w=u(w,A,b,D,f,22,a[3]),D=u(D,w,A,b,g,7,a[4]),b=u(b,D,w,A,_,12,a[5]),A=u(A,b,D,w,v,17,a[6]),w=u(w,A,b,D,m,22,a[7]),D=u(D,w,A,b,y,7,a[8]),b=u(b,D,w,A,M,12,a[9]),A=u(A,b,D,w,I,17,a[10]),w=u(w,A,b,D,C,22,a[11]),D=u(D,w,A,b,T,7,a[12]),b=u(b,D,w,A,k,12,a[13]),A=u(A,b,D,w,S,17,a[14]),D=l(D,w=u(w,A,b,D,E,22,a[15]),A,b,c,5,a[16]),b=l(b,D,w,A,v,9,a[17]),A=l(A,b,D,w,C,14,a[18]),w=l(w,A,b,D,r,20,a[19]),D=l(D,w,A,b,_,5,a[20]),b=l(b,D,w,A,I,9,a[21]),A=l(A,b,D,w,E,14,a[22]),w=l(w,A,b,D,g,20,a[23]),D=l(D,w,A,b,M,5,a[24]),b=l(b,D,w,A,S,9,a[25]),A=l(A,b,D,w,f,14,a[26]),w=l(w,A,b,D,y,20,a[27]),D=l(D,w,A,b,k,5,a[28]),b=l(b,D,w,A,h,9,a[29]),A=l(A,b,D,w,m,14,a[30]),D=d(D,w=l(w,A,b,D,T,20,a[31]),A,b,_,4,a[32]),b=d(b,D,w,A,y,11,a[33]),A=d(A,b,D,w,C,16,a[34]),w=d(w,A,b,D,S,23,a[35]),D=d(D,w,A,b,c,4,a[36]),b=d(b,D,w,A,g,11,a[37]),A=d(A,b,D,w,m,16,a[38]),w=d(w,A,b,D,I,23,a[39]),D=d(D,w,A,b,k,4,a[40]),b=d(b,D,w,A,r,11,a[41]),A=d(A,b,D,w,f,16,a[42]),w=d(w,A,b,D,v,23,a[43]),D=d(D,w,A,b,M,4,a[44]),b=d(b,D,w,A,T,11,a[45]),A=d(A,b,D,w,E,16,a[46]),D=p(D,w=d(w,A,b,D,h,23,a[47]),A,b,r,6,a[48]),b=p(b,D,w,A,m,10,a[49]),A=p(A,b,D,w,S,15,a[50]),w=p(w,A,b,D,_,21,a[51]),D=p(D,w,A,b,T,6,a[52]),b=p(b,D,w,A,f,10,a[53]),A=p(A,b,D,w,I,15,a[54]),w=p(w,A,b,D,c,21,a[55]),D=p(D,w,A,b,y,6,a[56]),b=p(b,D,w,A,E,10,a[57]),A=p(A,b,D,w,v,15,a[58]),w=p(w,A,b,D,k,21,a[59]),D=p(D,w,A,b,g,6,a[60]),b=p(b,D,w,A,C,10,a[61]),A=p(A,b,D,w,h,15,a[62]),w=p(w,A,b,D,M,21,a[63]),s[0]=s[0]+D|0,s[1]=s[1]+w|0,s[2]=s[2]+A|0,s[3]=s[3]+b|0},_doFinalize:function(){var t=this._data,n=t.words,i=8*this._nDataBytes,o=8*t.sigBytes;n[o>>>5]|=128<<24-o%32;var s=e.floor(i/4294967296),r=i;n[15+(o+64>>>9<<4)]=16711935&(s<<8|s>>>24)|4278255360&(s<<24|s>>>8),n[14+(o+64>>>9<<4)]=16711935&(r<<8|r>>>24)|4278255360&(r<<24|r>>>8),t.sigBytes=4*(n.length+1),this._process();for(var a=this._hash,c=a.words,u=0;u<4;u++){var l=c[u];c[u]=16711935&(l<<8|l>>>24)|4278255360&(l<<24|l>>>8)}return a},clone:function(){var e=s.clone.call(this);return e._hash=this._hash.clone(),e}});function u(e,t,n,i,o,s,r){var a=e+(t&n|~t&i)+o+r;return(a<<s|a>>>32-s)+t}function l(e,t,n,i,o,s,r){var a=e+(t&i|n&~i)+o+r;return(a<<s|a>>>32-s)+t}function d(e,t,n,i,o,s,r){var a=e+(t^n^i)+o+r;return(a<<s|a>>>32-s)+t}function p(e,t,n,i,o,s,r){var a=e+(n^(t|~i))+o+r;return(a<<s|a>>>32-s)+t}t.MD5=s._createHelper(c),t.HmacMD5=s._createHmacHelper(c)}(Math),n.MD5)})),ae((function(e,t){var n,i,o,s,r,a,c,u;e.exports=(o=(i=n=ce).lib,s=o.WordArray,r=o.Hasher,a=i.algo,c=[],u=a.SHA1=r.extend({_doReset:function(){this._hash=new s.init([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(e,t){for(var n=this._hash.words,i=n[0],o=n[1],s=n[2],r=n[3],a=n[4],u=0;u<80;u++){if(u<16)c[u]=0|e[t+u];else{var l=c[u-3]^c[u-8]^c[u-14]^c[u-16];c[u]=l<<1|l>>>31}var d=(i<<5|i>>>27)+a+c[u];d+=u<20?1518500249+(o&s|~o&r):u<40?1859775393+(o^s^r):u<60?(o&s|o&r|s&r)-1894007588:(o^s^r)-899497514,a=r,r=s,s=o<<30|o>>>2,o=i,i=d}n[0]=n[0]+i|0,n[1]=n[1]+o|0,n[2]=n[2]+s|0,n[3]=n[3]+r|0,n[4]=n[4]+a|0},_doFinalize:function(){var e=this._data,t=e.words,n=8*this._nDataBytes,i=8*e.sigBytes;return t[i>>>5]|=128<<24-i%32,t[14+(i+64>>>9<<4)]=Math.floor(n/4294967296),t[15+(i+64>>>9<<4)]=n,e.sigBytes=4*t.length,this._process(),this._hash},clone:function(){var e=r.clone.call(this);return e._hash=this._hash.clone(),e}}),i.SHA1=r._createHelper(u),i.HmacSHA1=r._createHmacHelper(u),n.SHA1)})),ae((function(e,t){var n;e.exports=(n=ce,function(e){var t=n,i=t.lib,o=i.WordArray,s=i.Hasher,r=t.algo,a=[],c=[];!function(){function t(t){for(var n=e.sqrt(t),i=2;i<=n;i++)if(!(t%i))return!1;return!0}function n(e){return 4294967296*(e-(0|e))|0}for(var i=2,o=0;o<64;)t(i)&&(o<8&&(a[o]=n(e.pow(i,.5))),c[o]=n(e.pow(i,1/3)),o++),i++}();var u=[],l=r.SHA256=s.extend({_doReset:function(){this._hash=new o.init(a.slice(0))},_doProcessBlock:function(e,t){for(var n=this._hash.words,i=n[0],o=n[1],s=n[2],r=n[3],a=n[4],l=n[5],d=n[6],p=n[7],h=0;h<64;h++){if(h<16)u[h]=0|e[t+h];else{var f=u[h-15],g=(f<<25|f>>>7)^(f<<14|f>>>18)^f>>>3,_=u[h-2],v=(_<<15|_>>>17)^(_<<13|_>>>19)^_>>>10;u[h]=g+u[h-7]+v+u[h-16]}var m=i&o^i&s^o&s,y=(i<<30|i>>>2)^(i<<19|i>>>13)^(i<<10|i>>>22),M=p+((a<<26|a>>>6)^(a<<21|a>>>11)^(a<<7|a>>>25))+(a&l^~a&d)+c[h]+u[h];p=d,d=l,l=a,a=r+M|0,r=s,s=o,o=i,i=M+(y+m)|0}n[0]=n[0]+i|0,n[1]=n[1]+o|0,n[2]=n[2]+s|0,n[3]=n[3]+r|0,n[4]=n[4]+a|0,n[5]=n[5]+l|0,n[6]=n[6]+d|0,n[7]=n[7]+p|0},_doFinalize:function(){var t=this._data,n=t.words,i=8*this._nDataBytes,o=8*t.sigBytes;return n[o>>>5]|=128<<24-o%32,n[14+(o+64>>>9<<4)]=e.floor(i/4294967296),n[15+(o+64>>>9<<4)]=i,t.sigBytes=4*n.length,this._process(),this._hash},clone:function(){var e=s.clone.call(this);return e._hash=this._hash.clone(),e}});t.SHA256=s._createHelper(l),t.HmacSHA256=s._createHmacHelper(l)}(Math),n.SHA256)})),ae((function(e,t){var n,i,o,s,r,a;e.exports=(o=(i=n=ce).lib.WordArray,s=i.algo,r=s.SHA256,a=s.SHA224=r.extend({_doReset:function(){this._hash=new o.init([3238371032,914150663,812702999,4144912697,4290775857,1750603025,1694076839,3204075428])},_doFinalize:function(){var e=r._doFinalize.call(this);return e.sigBytes-=4,e}}),i.SHA224=r._createHelper(a),i.HmacSHA224=r._createHmacHelper(a),n.SHA224)})),ae((function(e,t){var n;e.exports=(n=ce,function(){var e=n,t=e.lib.Hasher,i=e.x64,o=i.Word,s=i.WordArray,r=e.algo;function a(){return o.create.apply(o,arguments)}var c=[a(1116352408,3609767458),a(1899447441,602891725),a(3049323471,3964484399),a(3921009573,2173295548),a(961987163,4081628472),a(1508970993,3053834265),a(2453635748,2937671579),a(2870763221,3664609560),a(3624381080,2734883394),a(310598401,1164996542),a(607225278,1323610764),a(1426881987,3590304994),a(1925078388,4068182383),a(2162078206,991336113),a(2614888103,633803317),a(3248222580,3479774868),a(3835390401,2666613458),a(4022224774,944711139),a(264347078,2341262773),a(604807628,2007800933),a(770255983,1495990901),a(1249150122,1856431235),a(1555081692,3175218132),a(1996064986,2198950837),a(2554220882,3999719339),a(2821834349,766784016),a(2952996808,2566594879),a(3210313671,3203337956),a(3336571891,1034457026),a(3584528711,2466948901),a(113926993,3758326383),a(338241895,168717936),a(666307205,1188179964),a(773529912,1546045734),a(1294757372,1522805485),a(1396182291,2643833823),a(1695183700,2343527390),a(1986661051,1014477480),a(2177026350,1206759142),a(2456956037,344077627),a(2730485921,1290863460),a(2820302411,3158454273),a(3259730800,3505952657),a(3345764771,106217008),a(3516065817,3606008344),a(3600352804,1432725776),a(4094571909,1467031594),a(275423344,851169720),a(430227734,3100823752),a(506948616,1363258195),a(659060556,3750685593),a(883997877,3785050280),a(958139571,3318307427),a(1322822218,3812723403),a(1537002063,2003034995),a(1747873779,3602036899),a(1955562222,1575990012),a(2024104815,1125592928),a(2227730452,2716904306),a(2361852424,442776044),a(2428436474,593698344),a(2756734187,3733110249),a(3204031479,2999351573),a(3329325298,3815920427),a(3391569614,3928383900),a(3515267271,566280711),a(3940187606,3454069534),a(4118630271,4000239992),a(116418474,1914138554),a(174292421,2731055270),a(289380356,3203993006),a(460393269,320620315),a(685471733,587496836),a(852142971,1086792851),a(1017036298,365543100),a(1126000580,2618297676),a(1288033470,3409855158),a(1501505948,4234509866),a(1607167915,987167468),a(1816402316,1246189591)],u=[];!function(){for(var e=0;e<80;e++)u[e]=a()}();var l=r.SHA512=t.extend({_doReset:function(){this._hash=new s.init([new o.init(1779033703,4089235720),new o.init(3144134277,2227873595),new o.init(1013904242,4271175723),new o.init(2773480762,1595750129),new o.init(1359893119,2917565137),new o.init(2600822924,725511199),new o.init(528734635,4215389547),new o.init(1541459225,327033209)])},_doProcessBlock:function(e,t){for(var n=this._hash.words,i=n[0],o=n[1],s=n[2],r=n[3],a=n[4],l=n[5],d=n[6],p=n[7],h=i.high,f=i.low,g=o.high,_=o.low,v=s.high,m=s.low,y=r.high,M=r.low,I=a.high,C=a.low,T=l.high,k=l.low,S=d.high,E=d.low,D=p.high,w=p.low,A=h,b=f,L=g,R=_,O=v,N=m,P=y,U=M,G=I,x=C,F=T,q=k,B=S,$=E,V=D,H=w,K=0;K<80;K++){var j=u[K];if(K<16)var z=j.high=0|e[t+2*K],Y=j.low=0|e[t+2*K+1];else{var W=u[K-15],J=W.high,X=W.low,Z=(J>>>1|X<<31)^(J>>>8|X<<24)^J>>>7,Q=(X>>>1|J<<31)^(X>>>8|J<<24)^(X>>>7|J<<25),ee=u[K-2],te=ee.high,ne=ee.low,ie=(te>>>19|ne<<13)^(te<<3|ne>>>29)^te>>>6,oe=(ne>>>19|te<<13)^(ne<<3|te>>>29)^(ne>>>6|te<<26),se=u[K-7],re=se.high,ae=se.low,ce=u[K-16],ue=ce.high,le=ce.low;z=(z=(z=Z+re+((Y=Q+ae)>>>0<Q>>>0?1:0))+ie+((Y+=oe)>>>0<oe>>>0?1:0))+ue+((Y+=le)>>>0<le>>>0?1:0),j.high=z,j.low=Y}var de,pe=G&F^~G&B,he=x&q^~x&$,fe=A&L^A&O^L&O,ge=b&R^b&N^R&N,_e=(A>>>28|b<<4)^(A<<30|b>>>2)^(A<<25|b>>>7),ve=(b>>>28|A<<4)^(b<<30|A>>>2)^(b<<25|A>>>7),me=(G>>>14|x<<18)^(G>>>18|x<<14)^(G<<23|x>>>9),ye=(x>>>14|G<<18)^(x>>>18|G<<14)^(x<<23|G>>>9),Me=c[K],Ie=Me.high,Ce=Me.low,Te=V+me+((de=H+ye)>>>0<H>>>0?1:0),ke=ve+ge;V=B,H=$,B=F,$=q,F=G,q=x,G=P+(Te=(Te=(Te=Te+pe+((de+=he)>>>0<he>>>0?1:0))+Ie+((de+=Ce)>>>0<Ce>>>0?1:0))+z+((de+=Y)>>>0<Y>>>0?1:0))+((x=U+de|0)>>>0<U>>>0?1:0)|0,P=O,U=N,O=L,N=R,L=A,R=b,A=Te+(_e+fe+(ke>>>0<ve>>>0?1:0))+((b=de+ke|0)>>>0<de>>>0?1:0)|0}f=i.low=f+b,i.high=h+A+(f>>>0<b>>>0?1:0),_=o.low=_+R,o.high=g+L+(_>>>0<R>>>0?1:0),m=s.low=m+N,s.high=v+O+(m>>>0<N>>>0?1:0),M=r.low=M+U,r.high=y+P+(M>>>0<U>>>0?1:0),C=a.low=C+x,a.high=I+G+(C>>>0<x>>>0?1:0),k=l.low=k+q,l.high=T+F+(k>>>0<q>>>0?1:0),E=d.low=E+$,d.high=S+B+(E>>>0<$>>>0?1:0),w=p.low=w+H,p.high=D+V+(w>>>0<H>>>0?1:0)},_doFinalize:function(){var e=this._data,t=e.words,n=8*this._nDataBytes,i=8*e.sigBytes;return t[i>>>5]|=128<<24-i%32,t[30+(i+128>>>10<<5)]=Math.floor(n/4294967296),t[31+(i+128>>>10<<5)]=n,e.sigBytes=4*t.length,this._process(),this._hash.toX32()},clone:function(){var e=t.clone.call(this);return e._hash=this._hash.clone(),e},blockSize:32});e.SHA512=t._createHelper(l),e.HmacSHA512=t._createHmacHelper(l)}(),n.SHA512)})),ae((function(e,t){var n,i,o,s,r,a,c,u;e.exports=(o=(i=n=ce).x64,s=o.Word,r=o.WordArray,a=i.algo,c=a.SHA512,u=a.SHA384=c.extend({_doReset:function(){this._hash=new r.init([new s.init(3418070365,3238371032),new s.init(1654270250,914150663),new s.init(2438529370,812702999),new s.init(355462360,4144912697),new s.init(1731405415,4290775857),new s.init(2394180231,1750603025),new s.init(3675008525,1694076839),new s.init(1203062813,3204075428)])},_doFinalize:function(){var e=c._doFinalize.call(this);return e.sigBytes-=16,e}}),i.SHA384=c._createHelper(u),i.HmacSHA384=c._createHmacHelper(u),n.SHA384)})),ae((function(e,t){var n;e.exports=(n=ce,function(e){var t=n,i=t.lib,o=i.WordArray,s=i.Hasher,r=t.x64.Word,a=t.algo,c=[],u=[],l=[];!function(){for(var e=1,t=0,n=0;n<24;n++){c[e+5*t]=(n+1)*(n+2)/2%64;var i=(2*e+3*t)%5;e=t%5,t=i}for(e=0;e<5;e++)for(t=0;t<5;t++)u[e+5*t]=t+(2*e+3*t)%5*5;for(var o=1,s=0;s<24;s++){for(var a=0,d=0,p=0;p<7;p++){if(1&o){var h=(1<<p)-1;h<32?d^=1<<h:a^=1<<h-32}128&o?o=o<<1^113:o<<=1}l[s]=r.create(a,d)}}();var d=[];!function(){for(var e=0;e<25;e++)d[e]=r.create()}();var p=a.SHA3=s.extend({cfg:s.cfg.extend({outputLength:512}),_doReset:function(){for(var e=this._state=[],t=0;t<25;t++)e[t]=new r.init;this.blockSize=(1600-2*this.cfg.outputLength)/32},_doProcessBlock:function(e,t){for(var n=this._state,i=this.blockSize/2,o=0;o<i;o++){var s=e[t+2*o],r=e[t+2*o+1];s=16711935&(s<<8|s>>>24)|4278255360&(s<<24|s>>>8),r=16711935&(r<<8|r>>>24)|4278255360&(r<<24|r>>>8),(w=n[o]).high^=r,w.low^=s}for(var a=0;a<24;a++){for(var p=0;p<5;p++){for(var h=0,f=0,g=0;g<5;g++)h^=(w=n[p+5*g]).high,f^=w.low;var _=d[p];_.high=h,_.low=f}for(p=0;p<5;p++){var v=d[(p+4)%5],m=d[(p+1)%5],y=m.high,M=m.low;for(h=v.high^(y<<1|M>>>31),f=v.low^(M<<1|y>>>31),g=0;g<5;g++)(w=n[p+5*g]).high^=h,w.low^=f}for(var I=1;I<25;I++){var C=(w=n[I]).high,T=w.low,k=c[I];k<32?(h=C<<k|T>>>32-k,f=T<<k|C>>>32-k):(h=T<<k-32|C>>>64-k,f=C<<k-32|T>>>64-k);var S=d[u[I]];S.high=h,S.low=f}var E=d[0],D=n[0];for(E.high=D.high,E.low=D.low,p=0;p<5;p++)for(g=0;g<5;g++){var w=n[I=p+5*g],A=d[I],b=d[(p+1)%5+5*g],L=d[(p+2)%5+5*g];w.high=A.high^~b.high&L.high,w.low=A.low^~b.low&L.low}w=n[0];var R=l[a];w.high^=R.high,w.low^=R.low}},_doFinalize:function(){var t=this._data,n=t.words,i=(this._nDataBytes,8*t.sigBytes),s=32*this.blockSize;n[i>>>5]|=1<<24-i%32,n[(e.ceil((i+1)/s)*s>>>5)-1]|=128,t.sigBytes=4*n.length,this._process();for(var r=this._state,a=this.cfg.outputLength/8,c=a/8,u=[],l=0;l<c;l++){var d=r[l],p=d.high,h=d.low;p=16711935&(p<<8|p>>>24)|4278255360&(p<<24|p>>>8),h=16711935&(h<<8|h>>>24)|4278255360&(h<<24|h>>>8),u.push(h),u.push(p)}return new o.init(u,a)},clone:function(){for(var e=s.clone.call(this),t=e._state=this._state.slice(0),n=0;n<25;n++)t[n]=t[n].clone();return e}});t.SHA3=s._createHelper(p),t.HmacSHA3=s._createHmacHelper(p)}(Math),n.SHA3)})),ae((function(e,t){var n;e.exports=(n=ce,function(e){var t=n,i=t.lib,o=i.WordArray,s=i.Hasher,r=t.algo,a=o.create([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,7,4,13,1,10,6,15,3,12,0,9,5,2,14,11,8,3,10,14,4,9,15,8,1,2,7,0,6,13,11,5,12,1,9,11,10,0,8,12,4,13,3,7,15,14,5,6,2,4,0,5,9,7,12,2,10,14,1,3,8,11,6,15,13]),c=o.create([5,14,7,0,9,2,11,4,13,6,15,8,1,10,3,12,6,11,3,7,0,13,5,10,14,15,8,12,4,9,1,2,15,5,1,3,7,14,6,9,11,8,12,2,10,0,4,13,8,6,4,1,3,11,15,0,5,12,2,13,9,7,10,14,12,15,10,4,1,5,8,7,6,2,13,14,0,3,9,11]),u=o.create([11,14,15,12,5,8,7,9,11,13,14,15,6,7,9,8,7,6,8,13,11,9,7,15,7,12,15,9,11,7,13,12,11,13,6,7,14,9,13,15,14,8,13,6,5,12,7,5,11,12,14,15,14,15,9,8,9,14,5,6,8,6,5,12,9,15,5,11,6,8,13,12,5,12,13,14,11,8,5,6]),l=o.create([8,9,9,11,13,15,15,5,7,7,8,11,14,14,12,6,9,13,15,7,12,8,9,11,7,7,12,7,6,15,13,11,9,7,15,11,8,6,6,14,12,13,5,14,13,13,7,5,15,5,8,11,14,14,6,14,6,9,12,9,12,5,15,8,8,5,12,9,12,5,14,6,8,13,6,5,15,13,11,11]),d=o.create([0,1518500249,1859775393,2400959708,2840853838]),p=o.create([1352829926,1548603684,1836072691,2053994217,0]),h=r.RIPEMD160=s.extend({_doReset:function(){this._hash=o.create([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(e,t){for(var n=0;n<16;n++){var i=t+n,o=e[i];e[i]=16711935&(o<<8|o>>>24)|4278255360&(o<<24|o>>>8)}var s,r,h,M,I,C,T,k,S,E,D,w=this._hash.words,A=d.words,b=p.words,L=a.words,R=c.words,O=u.words,N=l.words;for(C=s=w[0],T=r=w[1],k=h=w[2],S=M=w[3],E=I=w[4],n=0;n<80;n+=1)D=s+e[t+L[n]]|0,D+=n<16?f(r,h,M)+A[0]:n<32?g(r,h,M)+A[1]:n<48?_(r,h,M)+A[2]:n<64?v(r,h,M)+A[3]:m(r,h,M)+A[4],D=(D=y(D|=0,O[n]))+I|0,s=I,I=M,M=y(h,10),h=r,r=D,D=C+e[t+R[n]]|0,D+=n<16?m(T,k,S)+b[0]:n<32?v(T,k,S)+b[1]:n<48?_(T,k,S)+b[2]:n<64?g(T,k,S)+b[3]:f(T,k,S)+b[4],D=(D=y(D|=0,N[n]))+E|0,C=E,E=S,S=y(k,10),k=T,T=D;D=w[1]+h+S|0,w[1]=w[2]+M+E|0,w[2]=w[3]+I+C|0,w[3]=w[4]+s+T|0,w[4]=w[0]+r+k|0,w[0]=D},_doFinalize:function(){var e=this._data,t=e.words,n=8*this._nDataBytes,i=8*e.sigBytes;t[i>>>5]|=128<<24-i%32,t[14+(i+64>>>9<<4)]=16711935&(n<<8|n>>>24)|4278255360&(n<<24|n>>>8),e.sigBytes=4*(t.length+1),this._process();for(var o=this._hash,s=o.words,r=0;r<5;r++){var a=s[r];s[r]=16711935&(a<<8|a>>>24)|4278255360&(a<<24|a>>>8)}return o},clone:function(){var e=s.clone.call(this);return e._hash=this._hash.clone(),e}});function f(e,t,n){return e^t^n}function g(e,t,n){return e&t|~e&n}function _(e,t,n){return(e|~t)^n}function v(e,t,n){return e&n|t&~n}function m(e,t,n){return e^(t|~n)}function y(e,t){return e<<t|e>>>32-t}t.RIPEMD160=s._createHelper(h),t.HmacRIPEMD160=s._createHmacHelper(h)}(),n.RIPEMD160)})),ae((function(e,t){var n,i,o,s,r,a;e.exports=(i=(n=ce).lib,o=i.Base,s=n.enc,r=s.Utf8,a=n.algo,void(a.HMAC=o.extend({init:function(e,t){e=this._hasher=new e.init,"string"==typeof t&&(t=r.parse(t));var n=e.blockSize,i=4*n;t.sigBytes>i&&(t=e.finalize(t)),t.clamp();for(var o=this._oKey=t.clone(),s=this._iKey=t.clone(),a=o.words,c=s.words,u=0;u<n;u++)a[u]^=1549556828,c[u]^=909522486;o.sigBytes=s.sigBytes=i,this.reset()},reset:function(){var e=this._hasher;e.reset(),e.update(this._iKey)},update:function(e){return this._hasher.update(e),this},finalize:function(e){var t=this._hasher,n=t.finalize(e);t.reset();var i=t.finalize(this._oKey.clone().concat(n));return i}})))})),ae((function(e,t){var n,i,o,s,r,a,c,u,l;e.exports=(o=(i=n=ce).lib,s=o.Base,r=o.WordArray,a=i.algo,c=a.SHA1,u=a.HMAC,l=a.PBKDF2=s.extend({cfg:s.extend({keySize:4,hasher:c,iterations:1}),init:function(e){this.cfg=this.cfg.extend(e)},compute:function(e,t){for(var n=this.cfg,i=u.create(n.hasher,e),o=r.create(),s=r.create([1]),a=o.words,c=s.words,l=n.keySize,d=n.iterations;a.length<l;){var p=i.update(t).finalize(s);i.reset();for(var h=p.words,f=h.length,g=p,_=1;_<d;_++){g=i.finalize(g),i.reset();for(var v=g.words,m=0;m<f;m++)h[m]^=v[m]}o.concat(p),c[0]++}return o.sigBytes=4*l,o}}),i.PBKDF2=function(e,t,n){return l.create(n).compute(e,t)},n.PBKDF2)})),ae((function(e,t){var n,i,o,s,r,a,c,u;e.exports=(o=(i=n=ce).lib,s=o.Base,r=o.WordArray,a=i.algo,c=a.MD5,u=a.EvpKDF=s.extend({cfg:s.extend({keySize:4,hasher:c,iterations:1}),init:function(e){this.cfg=this.cfg.extend(e)},compute:function(e,t){for(var n=this.cfg,i=n.hasher.create(),o=r.create(),s=o.words,a=n.keySize,c=n.iterations;s.length<a;){u&&i.update(u);var u=i.update(e).finalize(t);i.reset();for(var l=1;l<c;l++)u=i.finalize(u),i.reset();o.concat(u)}return o.sigBytes=4*a,o}}),i.EvpKDF=function(e,t,n){return u.create(n).compute(e,t)},n.EvpKDF)})),ae((function(e,t){var n,i,o,s,r,a,c,u,l,d,p,h,f,g,_,v,m,y,M,I,C,T,k;e.exports=void((n=ce).lib.Cipher||(i=n,o=i.lib,s=o.Base,r=o.WordArray,a=o.BufferedBlockAlgorithm,c=i.enc,c.Utf8,u=c.Base64,l=i.algo,d=l.EvpKDF,p=o.Cipher=a.extend({cfg:s.extend(),createEncryptor:function(e,t){return this.create(this._ENC_XFORM_MODE,e,t)},createDecryptor:function(e,t){return this.create(this._DEC_XFORM_MODE,e,t)},init:function(e,t,n){this.cfg=this.cfg.extend(n),this._xformMode=e,this._key=t,this.reset()},reset:function(){a.reset.call(this),this._doReset()},process:function(e){return this._append(e),this._process()},finalize:function(e){e&&this._append(e);var t=this._doFinalize();return t},keySize:4,ivSize:4,_ENC_XFORM_MODE:1,_DEC_XFORM_MODE:2,_createHelper:function(){function e(e){return"string"==typeof e?k:I}return function(t){return{encrypt:function(n,i,o){return e(i).encrypt(t,n,i,o)},decrypt:function(n,i,o){return e(i).decrypt(t,n,i,o)}}}}()}),o.StreamCipher=p.extend({_doFinalize:function(){var e=this._process(!0);return e},blockSize:1}),h=i.mode={},f=o.BlockCipherMode=s.extend({createEncryptor:function(e,t){return this.Encryptor.create(e,t)},createDecryptor:function(e,t){return this.Decryptor.create(e,t)},init:function(e,t){this._cipher=e,this._iv=t}}),g=h.CBC=function(){var e=f.extend();function t(e,t,n){var i=this._iv;if(i){var o=i;this._iv=void 0}else o=this._prevBlock;for(var s=0;s<n;s++)e[t+s]^=o[s]}return e.Encryptor=e.extend({processBlock:function(e,n){var i=this._cipher,o=i.blockSize;t.call(this,e,n,o),i.encryptBlock(e,n),this._prevBlock=e.slice(n,n+o)}}),e.Decryptor=e.extend({processBlock:function(e,n){var i=this._cipher,o=i.blockSize,s=e.slice(n,n+o);i.decryptBlock(e,n),t.call(this,e,n,o),this._prevBlock=s}}),e}(),_=i.pad={},v=_.Pkcs7={pad:function(e,t){for(var n=4*t,i=n-e.sigBytes%n,o=i<<24|i<<16|i<<8|i,s=[],a=0;a<i;a+=4)s.push(o);var c=r.create(s,i);e.concat(c)},unpad:function(e){var t=255&e.words[e.sigBytes-1>>>2];e.sigBytes-=t}},o.BlockCipher=p.extend({cfg:p.cfg.extend({mode:g,padding:v}),reset:function(){p.reset.call(this);var e=this.cfg,t=e.iv,n=e.mode;if(this._xformMode==this._ENC_XFORM_MODE)var i=n.createEncryptor;else{i=n.createDecryptor;this._minBufferSize=1}this._mode&&this._mode.__creator==i?this._mode.init(this,t&&t.words):(this._mode=i.call(n,this,t&&t.words),this._mode.__creator=i)},_doProcessBlock:function(e,t){this._mode.processBlock(e,t)},_doFinalize:function(){var e=this.cfg.padding;if(this._xformMode==this._ENC_XFORM_MODE){e.pad(this._data,this.blockSize);var t=this._process(!0)}else{t=this._process(!0);e.unpad(t)}return t},blockSize:4}),m=o.CipherParams=s.extend({init:function(e){this.mixIn(e)},toString:function(e){return(e||this.formatter).stringify(this)}}),y=i.format={},M=y.OpenSSL={stringify:function(e){var t=e.ciphertext,n=e.salt;if(n)var i=r.create([1398893684,1701076831]).concat(n).concat(t);else i=t;return i.toString(u)},parse:function(e){var t=u.parse(e),n=t.words;if(1398893684==n[0]&&1701076831==n[1]){var i=r.create(n.slice(2,4));n.splice(0,4),t.sigBytes-=16}return m.create({ciphertext:t,salt:i})}},I=o.SerializableCipher=s.extend({cfg:s.extend({format:M}),encrypt:function(e,t,n,i){i=this.cfg.extend(i);var o=e.createEncryptor(n,i),s=o.finalize(t),r=o.cfg;return m.create({ciphertext:s,key:n,iv:r.iv,algorithm:e,mode:r.mode,padding:r.padding,blockSize:e.blockSize,formatter:i.format})},decrypt:function(e,t,n,i){i=this.cfg.extend(i),t=this._parse(t,i.format);var o=e.createDecryptor(n,i).finalize(t.ciphertext);return o},_parse:function(e,t){return"string"==typeof e?t.parse(e,this):e}}),C=i.kdf={},T=C.OpenSSL={execute:function(e,t,n,i){i||(i=r.random(8));var o=d.create({keySize:t+n}).compute(e,i),s=r.create(o.words.slice(t),4*n);return o.sigBytes=4*t,m.create({key:o,iv:s,salt:i})}},k=o.PasswordBasedCipher=I.extend({cfg:I.cfg.extend({kdf:T}),encrypt:function(e,t,n,i){var o=(i=this.cfg.extend(i)).kdf.execute(n,e.keySize,e.ivSize);i.iv=o.iv;var s=I.encrypt.call(this,e,t,o.key,i);return s.mixIn(o),s},decrypt:function(e,t,n,i){i=this.cfg.extend(i),t=this._parse(t,i.format);var o=i.kdf.execute(n,e.keySize,e.ivSize,t.salt);i.iv=o.iv;var s=I.decrypt.call(this,e,t,o.key,i);return s}})))})),ae((function(e,t){var n;e.exports=((n=ce).mode.CFB=function(){var e=n.lib.BlockCipherMode.extend();function t(e,t,n,i){var o=this._iv;if(o){var s=o.slice(0);this._iv=void 0}else s=this._prevBlock;i.encryptBlock(s,0);for(var r=0;r<n;r++)e[t+r]^=s[r]}return e.Encryptor=e.extend({processBlock:function(e,n){var i=this._cipher,o=i.blockSize;t.call(this,e,n,o,i),this._prevBlock=e.slice(n,n+o)}}),e.Decryptor=e.extend({processBlock:function(e,n){var i=this._cipher,o=i.blockSize,s=e.slice(n,n+o);t.call(this,e,n,o,i),this._prevBlock=s}}),e}(),n.mode.CFB)})),ae((function(e,t){var n,i,o;e.exports=((n=ce).mode.CTR=(i=n.lib.BlockCipherMode.extend(),o=i.Encryptor=i.extend({processBlock:function(e,t){var n=this._cipher,i=n.blockSize,o=this._iv,s=this._counter;o&&(s=this._counter=o.slice(0),this._iv=void 0);var r=s.slice(0);n.encryptBlock(r,0),s[i-1]=s[i-1]+1|0;for(var a=0;a<i;a++)e[t+a]^=r[a]}}),i.Decryptor=o,i),n.mode.CTR)})),ae((function(e,t){var n;e.exports=((n=ce).mode.CTRGladman=function(){var e=n.lib.BlockCipherMode.extend();function t(e){if(255==(e>>24&255)){var t=e>>16&255,n=e>>8&255,i=255&e;255===t?(t=0,255===n?(n=0,255===i?i=0:++i):++n):++t,e=0,e+=t<<16,e+=n<<8,e+=i}else e+=1<<24;return e}var i=e.Encryptor=e.extend({processBlock:function(e,n){var i=this._cipher,o=i.blockSize,s=this._iv,r=this._counter;s&&(r=this._counter=s.slice(0),this._iv=void 0),function(e){0===(e[0]=t(e[0]))&&(e[1]=t(e[1]))}(r);var a=r.slice(0);i.encryptBlock(a,0);for(var c=0;c<o;c++)e[n+c]^=a[c]}});return e.Decryptor=i,e}(),n.mode.CTRGladman)})),ae((function(e,t){var n,i,o;e.exports=((n=ce).mode.OFB=(i=n.lib.BlockCipherMode.extend(),o=i.Encryptor=i.extend({processBlock:function(e,t){var n=this._cipher,i=n.blockSize,o=this._iv,s=this._keystream;o&&(s=this._keystream=o.slice(0),this._iv=void 0),n.encryptBlock(s,0);for(var r=0;r<i;r++)e[t+r]^=s[r]}}),i.Decryptor=o,i),n.mode.OFB)})),ae((function(e,t){var n,i;e.exports=((n=ce).mode.ECB=((i=n.lib.BlockCipherMode.extend()).Encryptor=i.extend({processBlock:function(e,t){this._cipher.encryptBlock(e,t)}}),i.Decryptor=i.extend({processBlock:function(e,t){this._cipher.decryptBlock(e,t)}}),i),n.mode.ECB)})),ae((function(e,t){var n;e.exports=((n=ce).pad.AnsiX923={pad:function(e,t){var n=e.sigBytes,i=4*t,o=i-n%i,s=n+o-1;e.clamp(),e.words[s>>>2]|=o<<24-s%4*8,e.sigBytes+=o},unpad:function(e){var t=255&e.words[e.sigBytes-1>>>2];e.sigBytes-=t}},n.pad.Ansix923)})),ae((function(e,t){var n;e.exports=((n=ce).pad.Iso10126={pad:function(e,t){var i=4*t,o=i-e.sigBytes%i;e.concat(n.lib.WordArray.random(o-1)).concat(n.lib.WordArray.create([o<<24],1))},unpad:function(e){var t=255&e.words[e.sigBytes-1>>>2];e.sigBytes-=t}},n.pad.Iso10126)})),ae((function(e,t){var n;e.exports=((n=ce).pad.Iso97971={pad:function(e,t){e.concat(n.lib.WordArray.create([2147483648],1)),n.pad.ZeroPadding.pad(e,t)},unpad:function(e){n.pad.ZeroPadding.unpad(e),e.sigBytes--}},n.pad.Iso97971)})),ae((function(e,t){var n;e.exports=((n=ce).pad.ZeroPadding={pad:function(e,t){var n=4*t;e.clamp(),e.sigBytes+=n-(e.sigBytes%n||n)},unpad:function(e){for(var t=e.words,n=e.sigBytes-1;!(t[n>>>2]>>>24-n%4*8&255);)n--;e.sigBytes=n+1}},n.pad.ZeroPadding)})),ae((function(e,t){var n;e.exports=((n=ce).pad.NoPadding={pad:function(){},unpad:function(){}},n.pad.NoPadding)})),ae((function(e,t){var n,i,o,s;e.exports=(o=(i=n=ce).lib.CipherParams,s=i.enc.Hex,i.format.Hex={stringify:function(e){return e.ciphertext.toString(s)},parse:function(e){var t=s.parse(e);return o.create({ciphertext:t})}},n.format.Hex)})),ae((function(e,t){var n;e.exports=(n=ce,function(){var e=n,t=e.lib.BlockCipher,i=e.algo,o=[],s=[],r=[],a=[],c=[],u=[],l=[],d=[],p=[],h=[];!function(){for(var e=[],t=0;t<256;t++)e[t]=t<128?t<<1:t<<1^283;var n=0,i=0;for(t=0;t<256;t++){var f=i^i<<1^i<<2^i<<3^i<<4;f=f>>>8^255&f^99,o[n]=f,s[f]=n;var g=e[n],_=e[g],v=e[_],m=257*e[f]^16843008*f;r[n]=m<<24|m>>>8,a[n]=m<<16|m>>>16,c[n]=m<<8|m>>>24,u[n]=m,m=16843009*v^65537*_^257*g^16843008*n,l[f]=m<<24|m>>>8,d[f]=m<<16|m>>>16,p[f]=m<<8|m>>>24,h[f]=m,n?(n=g^e[e[e[v^g]]],i^=e[e[i]]):n=i=1}}();var f=[0,1,2,4,8,16,32,64,128,27,54],g=i.AES=t.extend({_doReset:function(){if(!this._nRounds||this._keyPriorReset!==this._key){for(var e=this._keyPriorReset=this._key,t=e.words,n=e.sigBytes/4,i=4*((this._nRounds=n+6)+1),s=this._keySchedule=[],r=0;r<i;r++)if(r<n)s[r]=t[r];else{var a=s[r-1];r%n?n>6&&r%n==4&&(a=o[a>>>24]<<24|o[a>>>16&255]<<16|o[a>>>8&255]<<8|o[255&a]):(a=o[(a=a<<8|a>>>24)>>>24]<<24|o[a>>>16&255]<<16|o[a>>>8&255]<<8|o[255&a],a^=f[r/n|0]<<24),s[r]=s[r-n]^a}for(var c=this._invKeySchedule=[],u=0;u<i;u++)r=i-u,a=u%4?s[r]:s[r-4],c[u]=u<4||r<=4?a:l[o[a>>>24]]^d[o[a>>>16&255]]^p[o[a>>>8&255]]^h[o[255&a]]}},encryptBlock:function(e,t){this._doCryptBlock(e,t,this._keySchedule,r,a,c,u,o)},decryptBlock:function(e,t){var n=e[t+1];e[t+1]=e[t+3],e[t+3]=n,this._doCryptBlock(e,t,this._invKeySchedule,l,d,p,h,s),n=e[t+1],e[t+1]=e[t+3],e[t+3]=n},_doCryptBlock:function(e,t,n,i,o,s,r,a){for(var c=this._nRounds,u=e[t]^n[0],l=e[t+1]^n[1],d=e[t+2]^n[2],p=e[t+3]^n[3],h=4,f=1;f<c;f++){var g=i[u>>>24]^o[l>>>16&255]^s[d>>>8&255]^r[255&p]^n[h++],_=i[l>>>24]^o[d>>>16&255]^s[p>>>8&255]^r[255&u]^n[h++],v=i[d>>>24]^o[p>>>16&255]^s[u>>>8&255]^r[255&l]^n[h++],m=i[p>>>24]^o[u>>>16&255]^s[l>>>8&255]^r[255&d]^n[h++];u=g,l=_,d=v,p=m}g=(a[u>>>24]<<24|a[l>>>16&255]<<16|a[d>>>8&255]<<8|a[255&p])^n[h++],_=(a[l>>>24]<<24|a[d>>>16&255]<<16|a[p>>>8&255]<<8|a[255&u])^n[h++],v=(a[d>>>24]<<24|a[p>>>16&255]<<16|a[u>>>8&255]<<8|a[255&l])^n[h++],m=(a[p>>>24]<<24|a[u>>>16&255]<<16|a[l>>>8&255]<<8|a[255&d])^n[h++],e[t]=g,e[t+1]=_,e[t+2]=v,e[t+3]=m},keySize:8});e.AES=t._createHelper(g)}(),n.AES)})),ae((function(e,t){var n;e.exports=(n=ce,function(){var e=n,t=e.lib,i=t.WordArray,o=t.BlockCipher,s=e.algo,r=[57,49,41,33,25,17,9,1,58,50,42,34,26,18,10,2,59,51,43,35,27,19,11,3,60,52,44,36,63,55,47,39,31,23,15,7,62,54,46,38,30,22,14,6,61,53,45,37,29,21,13,5,28,20,12,4],a=[14,17,11,24,1,5,3,28,15,6,21,10,23,19,12,4,26,8,16,7,27,20,13,2,41,52,31,37,47,55,30,40,51,45,33,48,44,49,39,56,34,53,46,42,50,36,29,32],c=[1,2,4,6,8,10,12,14,15,17,19,21,23,25,27,28],u=[{0:8421888,268435456:32768,536870912:8421378,805306368:2,1073741824:512,1342177280:8421890,1610612736:8389122,1879048192:8388608,2147483648:514,2415919104:8389120,2684354560:33280,2952790016:8421376,3221225472:32770,3489660928:8388610,3758096384:0,4026531840:33282,134217728:0,402653184:8421890,671088640:33282,939524096:32768,1207959552:8421888,1476395008:512,1744830464:8421378,2013265920:2,2281701376:8389120,2550136832:33280,2818572288:8421376,3087007744:8389122,3355443200:8388610,3623878656:32770,3892314112:514,4160749568:8388608,1:32768,268435457:2,536870913:8421888,805306369:8388608,1073741825:8421378,1342177281:33280,1610612737:512,1879048193:8389122,2147483649:8421890,2415919105:8421376,2684354561:8388610,2952790017:33282,3221225473:514,3489660929:8389120,3758096385:32770,4026531841:0,134217729:8421890,402653185:8421376,671088641:8388608,939524097:512,1207959553:32768,1476395009:8388610,1744830465:2,2013265921:33282,2281701377:32770,2550136833:8389122,2818572289:514,3087007745:8421888,3355443201:8389120,3623878657:0,3892314113:33280,4160749569:8421378},{0:1074282512,16777216:16384,33554432:524288,50331648:1074266128,67108864:1073741840,83886080:1074282496,100663296:1073758208,117440512:16,134217728:540672,150994944:1073758224,167772160:1073741824,184549376:540688,201326592:524304,218103808:0,234881024:16400,251658240:1074266112,8388608:1073758208,25165824:540688,41943040:16,58720256:1073758224,75497472:1074282512,92274688:1073741824,109051904:524288,125829120:1074266128,142606336:524304,159383552:0,176160768:16384,192937984:1074266112,209715200:1073741840,226492416:540672,243269632:1074282496,260046848:16400,268435456:0,285212672:1074266128,301989888:1073758224,318767104:1074282496,335544320:1074266112,352321536:16,369098752:540688,385875968:16384,402653184:16400,419430400:524288,436207616:524304,452984832:1073741840,469762048:540672,486539264:1073758208,503316480:1073741824,520093696:1074282512,276824064:540688,293601280:524288,310378496:1074266112,327155712:16384,343932928:1073758208,360710144:1074282512,377487360:16,394264576:1073741824,411041792:1074282496,427819008:1073741840,444596224:1073758224,461373440:524304,478150656:0,494927872:16400,511705088:1074266128,528482304:540672},{0:260,1048576:0,2097152:67109120,3145728:65796,4194304:65540,5242880:67108868,6291456:67174660,7340032:67174400,8388608:67108864,9437184:67174656,10485760:65792,11534336:67174404,12582912:67109124,13631488:65536,14680064:4,15728640:256,524288:67174656,1572864:67174404,2621440:0,3670016:67109120,4718592:67108868,5767168:65536,6815744:65540,7864320:260,8912896:4,9961472:256,11010048:67174400,12058624:65796,13107200:65792,14155776:67109124,15204352:67174660,16252928:67108864,16777216:67174656,17825792:65540,18874368:65536,19922944:67109120,20971520:256,22020096:67174660,23068672:67108868,24117248:0,25165824:67109124,26214400:67108864,27262976:4,28311552:65792,29360128:67174400,30408704:260,31457280:65796,32505856:67174404,17301504:67108864,18350080:260,19398656:67174656,20447232:0,21495808:65540,22544384:67109120,23592960:256,24641536:67174404,25690112:65536,26738688:67174660,27787264:65796,28835840:67108868,29884416:67109124,30932992:67174400,31981568:4,33030144:65792},{0:2151682048,65536:2147487808,131072:4198464,196608:2151677952,262144:0,327680:4198400,393216:2147483712,458752:4194368,524288:2147483648,589824:4194304,655360:64,720896:2147487744,786432:2151678016,851968:4160,917504:4096,983040:2151682112,32768:2147487808,98304:64,163840:2151678016,229376:2147487744,294912:4198400,360448:2151682112,425984:0,491520:2151677952,557056:4096,622592:2151682048,688128:4194304,753664:4160,819200:2147483648,884736:4194368,950272:4198464,1015808:2147483712,1048576:4194368,1114112:4198400,1179648:2147483712,1245184:0,1310720:4160,1376256:2151678016,1441792:2151682048,1507328:2147487808,1572864:2151682112,1638400:2147483648,1703936:2151677952,1769472:4198464,1835008:2147487744,1900544:4194304,1966080:64,2031616:4096,1081344:2151677952,1146880:2151682112,1212416:0,1277952:4198400,1343488:4194368,1409024:2147483648,1474560:2147487808,1540096:64,1605632:2147483712,1671168:4096,1736704:2147487744,1802240:2151678016,1867776:4160,1933312:2151682048,1998848:4194304,2064384:4198464},{0:128,4096:17039360,8192:262144,12288:536870912,16384:537133184,20480:16777344,24576:553648256,28672:262272,32768:16777216,36864:537133056,40960:536871040,45056:553910400,49152:553910272,53248:0,57344:17039488,61440:553648128,2048:17039488,6144:553648256,10240:128,14336:17039360,18432:262144,22528:537133184,26624:553910272,30720:536870912,34816:537133056,38912:0,43008:553910400,47104:16777344,51200:536871040,55296:553648128,59392:16777216,63488:262272,65536:262144,69632:128,73728:536870912,77824:553648256,81920:16777344,86016:553910272,90112:537133184,94208:16777216,98304:553910400,102400:553648128,106496:17039360,110592:537133056,114688:262272,118784:536871040,122880:0,126976:17039488,67584:553648256,71680:16777216,75776:17039360,79872:537133184,83968:536870912,88064:17039488,92160:128,96256:553910272,100352:262272,104448:553910400,108544:0,112640:553648128,116736:16777344,120832:262144,124928:537133056,129024:536871040},{0:268435464,256:8192,512:270532608,768:270540808,1024:268443648,1280:2097152,1536:2097160,1792:268435456,2048:0,2304:268443656,2560:2105344,2816:8,3072:270532616,3328:2105352,3584:8200,3840:270540800,128:270532608,384:270540808,640:8,896:2097152,1152:2105352,1408:268435464,1664:268443648,1920:8200,2176:2097160,2432:8192,2688:268443656,2944:270532616,3200:0,3456:270540800,3712:2105344,3968:268435456,4096:268443648,4352:270532616,4608:270540808,4864:8200,5120:2097152,5376:268435456,5632:268435464,5888:2105344,6144:2105352,6400:0,6656:8,6912:270532608,7168:8192,7424:268443656,7680:270540800,7936:2097160,4224:8,4480:2105344,4736:2097152,4992:268435464,5248:268443648,5504:8200,5760:270540808,6016:270532608,6272:270540800,6528:270532616,6784:8192,7040:2105352,7296:2097160,7552:0,7808:268435456,8064:268443656},{0:1048576,16:33555457,32:1024,48:1049601,64:34604033,80:0,96:1,112:34603009,128:33555456,144:1048577,160:33554433,176:34604032,192:34603008,208:1025,224:1049600,240:33554432,8:34603009,24:0,40:33555457,56:34604032,72:1048576,88:33554433,104:33554432,120:1025,136:1049601,152:33555456,168:34603008,184:1048577,200:1024,216:34604033,232:1,248:1049600,256:33554432,272:1048576,288:33555457,304:34603009,320:1048577,336:33555456,352:34604032,368:1049601,384:1025,400:34604033,416:1049600,432:1,448:0,464:34603008,480:33554433,496:1024,264:1049600,280:33555457,296:34603009,312:1,328:33554432,344:1048576,360:1025,376:34604032,392:33554433,408:34603008,424:0,440:34604033,456:1049601,472:1024,488:33555456,504:1048577},{0:134219808,1:131072,2:134217728,3:32,4:131104,5:134350880,6:134350848,7:2048,8:134348800,9:134219776,10:133120,11:134348832,12:2080,13:0,14:134217760,15:133152,2147483648:2048,2147483649:134350880,2147483650:134219808,2147483651:134217728,2147483652:134348800,2147483653:133120,2147483654:133152,2147483655:32,2147483656:134217760,2147483657:2080,2147483658:131104,2147483659:134350848,2147483660:0,2147483661:134348832,2147483662:134219776,2147483663:131072,16:133152,17:134350848,18:32,19:2048,20:134219776,21:134217760,22:134348832,23:131072,24:0,25:131104,26:134348800,27:134219808,28:134350880,29:133120,30:2080,31:134217728,2147483664:131072,2147483665:2048,2147483666:134348832,2147483667:133152,2147483668:32,2147483669:134348800,2147483670:134217728,2147483671:134219808,2147483672:134350880,2147483673:134217760,2147483674:134219776,2147483675:0,2147483676:133120,2147483677:2080,2147483678:131104,2147483679:134350848}],l=[4160749569,528482304,33030144,2064384,129024,8064,504,2147483679],d=s.DES=o.extend({_doReset:function(){for(var e=this._key.words,t=[],n=0;n<56;n++){var i=r[n]-1;t[n]=e[i>>>5]>>>31-i%32&1}for(var o=this._subKeys=[],s=0;s<16;s++){var u=o[s]=[],l=c[s];for(n=0;n<24;n++)u[n/6|0]|=t[(a[n]-1+l)%28]<<31-n%6,u[4+(n/6|0)]|=t[28+(a[n+24]-1+l)%28]<<31-n%6;for(u[0]=u[0]<<1|u[0]>>>31,n=1;n<7;n++)u[n]=u[n]>>>4*(n-1)+3;u[7]=u[7]<<5|u[7]>>>27}var d=this._invSubKeys=[];for(n=0;n<16;n++)d[n]=o[15-n]},encryptBlock:function(e,t){this._doCryptBlock(e,t,this._subKeys)},decryptBlock:function(e,t){this._doCryptBlock(e,t,this._invSubKeys)},_doCryptBlock:function(e,t,n){this._lBlock=e[t],this._rBlock=e[t+1],p.call(this,4,252645135),p.call(this,16,65535),h.call(this,2,858993459),h.call(this,8,16711935),p.call(this,1,1431655765);for(var i=0;i<16;i++){for(var o=n[i],s=this._lBlock,r=this._rBlock,a=0,c=0;c<8;c++)a|=u[c][((r^o[c])&l[c])>>>0];this._lBlock=r,this._rBlock=s^a}var d=this._lBlock;this._lBlock=this._rBlock,this._rBlock=d,p.call(this,1,1431655765),h.call(this,8,16711935),h.call(this,2,858993459),p.call(this,16,65535),p.call(this,4,252645135),e[t]=this._lBlock,e[t+1]=this._rBlock},keySize:2,ivSize:2,blockSize:2});function p(e,t){var n=(this._lBlock>>>e^this._rBlock)&t;this._rBlock^=n,this._lBlock^=n<<e}function h(e,t){var n=(this._rBlock>>>e^this._lBlock)&t;this._lBlock^=n,this._rBlock^=n<<e}e.DES=o._createHelper(d);var f=s.TripleDES=o.extend({_doReset:function(){var e=this._key.words;this._des1=d.createEncryptor(i.create(e.slice(0,2))),this._des2=d.createEncryptor(i.create(e.slice(2,4))),this._des3=d.createEncryptor(i.create(e.slice(4,6)))},encryptBlock:function(e,t){this._des1.encryptBlock(e,t),this._des2.decryptBlock(e,t),this._des3.encryptBlock(e,t)},decryptBlock:function(e,t){this._des3.decryptBlock(e,t),this._des2.encryptBlock(e,t),this._des1.decryptBlock(e,t)},keySize:6,ivSize:2,blockSize:2});e.TripleDES=o._createHelper(f)}(),n.TripleDES)})),ae((function(e,t){var n;e.exports=(n=ce,function(){var e=n,t=e.lib.StreamCipher,i=e.algo,o=i.RC4=t.extend({_doReset:function(){for(var e=this._key,t=e.words,n=e.sigBytes,i=this._S=[],o=0;o<256;o++)i[o]=o;o=0;for(var s=0;o<256;o++){var r=o%n,a=t[r>>>2]>>>24-r%4*8&255;s=(s+i[o]+a)%256;var c=i[o];i[o]=i[s],i[s]=c}this._i=this._j=0},_doProcessBlock:function(e,t){e[t]^=s.call(this)},keySize:8,ivSize:0});function s(){for(var e=this._S,t=this._i,n=this._j,i=0,o=0;o<4;o++){n=(n+e[t=(t+1)%256])%256;var s=e[t];e[t]=e[n],e[n]=s,i|=e[(e[t]+e[n])%256]<<24-8*o}return this._i=t,this._j=n,i}e.RC4=t._createHelper(o);var r=i.RC4Drop=o.extend({cfg:o.cfg.extend({drop:192}),_doReset:function(){o._doReset.call(this);for(var e=this.cfg.drop;e>0;e--)s.call(this)}});e.RC4Drop=t._createHelper(r)}(),n.RC4)})),ae((function(e,t){var n;e.exports=(n=ce,function(){var e=n,t=e.lib.StreamCipher,i=e.algo,o=[],s=[],r=[],a=i.Rabbit=t.extend({_doReset:function(){for(var e=this._key.words,t=this.cfg.iv,n=0;n<4;n++)e[n]=16711935&(e[n]<<8|e[n]>>>24)|4278255360&(e[n]<<24|e[n]>>>8);var i=this._X=[e[0],e[3]<<16|e[2]>>>16,e[1],e[0]<<16|e[3]>>>16,e[2],e[1]<<16|e[0]>>>16,e[3],e[2]<<16|e[1]>>>16],o=this._C=[e[2]<<16|e[2]>>>16,4294901760&e[0]|65535&e[1],e[3]<<16|e[3]>>>16,4294901760&e[1]|65535&e[2],e[0]<<16|e[0]>>>16,4294901760&e[2]|65535&e[3],e[1]<<16|e[1]>>>16,4294901760&e[3]|65535&e[0]];for(this._b=0,n=0;n<4;n++)c.call(this);for(n=0;n<8;n++)o[n]^=i[n+4&7];if(t){var s=t.words,r=s[0],a=s[1],u=16711935&(r<<8|r>>>24)|4278255360&(r<<24|r>>>8),l=16711935&(a<<8|a>>>24)|4278255360&(a<<24|a>>>8),d=u>>>16|4294901760&l,p=l<<16|65535&u;for(o[0]^=u,o[1]^=d,o[2]^=l,o[3]^=p,o[4]^=u,o[5]^=d,o[6]^=l,o[7]^=p,n=0;n<4;n++)c.call(this)}},_doProcessBlock:function(e,t){var n=this._X;c.call(this),o[0]=n[0]^n[5]>>>16^n[3]<<16,o[1]=n[2]^n[7]>>>16^n[5]<<16,o[2]=n[4]^n[1]>>>16^n[7]<<16,o[3]=n[6]^n[3]>>>16^n[1]<<16;for(var i=0;i<4;i++)o[i]=16711935&(o[i]<<8|o[i]>>>24)|4278255360&(o[i]<<24|o[i]>>>8),e[t+i]^=o[i]},blockSize:4,ivSize:2});function c(){for(var e=this._X,t=this._C,n=0;n<8;n++)s[n]=t[n];for(t[0]=t[0]+1295307597+this._b|0,t[1]=t[1]+3545052371+(t[0]>>>0<s[0]>>>0?1:0)|0,t[2]=t[2]+886263092+(t[1]>>>0<s[1]>>>0?1:0)|0,t[3]=t[3]+1295307597+(t[2]>>>0<s[2]>>>0?1:0)|0,t[4]=t[4]+3545052371+(t[3]>>>0<s[3]>>>0?1:0)|0,t[5]=t[5]+886263092+(t[4]>>>0<s[4]>>>0?1:0)|0,t[6]=t[6]+1295307597+(t[5]>>>0<s[5]>>>0?1:0)|0,t[7]=t[7]+3545052371+(t[6]>>>0<s[6]>>>0?1:0)|0,this._b=t[7]>>>0<s[7]>>>0?1:0,n=0;n<8;n++){var i=e[n]+t[n],o=65535&i,a=i>>>16,c=((o*o>>>17)+o*a>>>15)+a*a,u=((4294901760&i)*i|0)+((65535&i)*i|0);r[n]=c^u}e[0]=r[0]+(r[7]<<16|r[7]>>>16)+(r[6]<<16|r[6]>>>16)|0,e[1]=r[1]+(r[0]<<8|r[0]>>>24)+r[7]|0,e[2]=r[2]+(r[1]<<16|r[1]>>>16)+(r[0]<<16|r[0]>>>16)|0,e[3]=r[3]+(r[2]<<8|r[2]>>>24)+r[1]|0,e[4]=r[4]+(r[3]<<16|r[3]>>>16)+(r[2]<<16|r[2]>>>16)|0,e[5]=r[5]+(r[4]<<8|r[4]>>>24)+r[3]|0,e[6]=r[6]+(r[5]<<16|r[5]>>>16)+(r[4]<<16|r[4]>>>16)|0,e[7]=r[7]+(r[6]<<8|r[6]>>>24)+r[5]|0}e.Rabbit=t._createHelper(a)}(),n.Rabbit)})),ae((function(e,t){var n;e.exports=(n=ce,function(){var e=n,t=e.lib.StreamCipher,i=e.algo,o=[],s=[],r=[],a=i.RabbitLegacy=t.extend({_doReset:function(){var e=this._key.words,t=this.cfg.iv,n=this._X=[e[0],e[3]<<16|e[2]>>>16,e[1],e[0]<<16|e[3]>>>16,e[2],e[1]<<16|e[0]>>>16,e[3],e[2]<<16|e[1]>>>16],i=this._C=[e[2]<<16|e[2]>>>16,4294901760&e[0]|65535&e[1],e[3]<<16|e[3]>>>16,4294901760&e[1]|65535&e[2],e[0]<<16|e[0]>>>16,4294901760&e[2]|65535&e[3],e[1]<<16|e[1]>>>16,4294901760&e[3]|65535&e[0]];this._b=0;for(var o=0;o<4;o++)c.call(this);for(o=0;o<8;o++)i[o]^=n[o+4&7];if(t){var s=t.words,r=s[0],a=s[1],u=16711935&(r<<8|r>>>24)|4278255360&(r<<24|r>>>8),l=16711935&(a<<8|a>>>24)|4278255360&(a<<24|a>>>8),d=u>>>16|4294901760&l,p=l<<16|65535&u;for(i[0]^=u,i[1]^=d,i[2]^=l,i[3]^=p,i[4]^=u,i[5]^=d,i[6]^=l,i[7]^=p,o=0;o<4;o++)c.call(this)}},_doProcessBlock:function(e,t){var n=this._X;c.call(this),o[0]=n[0]^n[5]>>>16^n[3]<<16,o[1]=n[2]^n[7]>>>16^n[5]<<16,o[2]=n[4]^n[1]>>>16^n[7]<<16,o[3]=n[6]^n[3]>>>16^n[1]<<16;for(var i=0;i<4;i++)o[i]=16711935&(o[i]<<8|o[i]>>>24)|4278255360&(o[i]<<24|o[i]>>>8),e[t+i]^=o[i]},blockSize:4,ivSize:2});function c(){for(var e=this._X,t=this._C,n=0;n<8;n++)s[n]=t[n];for(t[0]=t[0]+1295307597+this._b|0,t[1]=t[1]+3545052371+(t[0]>>>0<s[0]>>>0?1:0)|0,t[2]=t[2]+886263092+(t[1]>>>0<s[1]>>>0?1:0)|0,t[3]=t[3]+1295307597+(t[2]>>>0<s[2]>>>0?1:0)|0,t[4]=t[4]+3545052371+(t[3]>>>0<s[3]>>>0?1:0)|0,t[5]=t[5]+886263092+(t[4]>>>0<s[4]>>>0?1:0)|0,t[6]=t[6]+1295307597+(t[5]>>>0<s[5]>>>0?1:0)|0,t[7]=t[7]+3545052371+(t[6]>>>0<s[6]>>>0?1:0)|0,this._b=t[7]>>>0<s[7]>>>0?1:0,n=0;n<8;n++){var i=e[n]+t[n],o=65535&i,a=i>>>16,c=((o*o>>>17)+o*a>>>15)+a*a,u=((4294901760&i)*i|0)+((65535&i)*i|0);r[n]=c^u}e[0]=r[0]+(r[7]<<16|r[7]>>>16)+(r[6]<<16|r[6]>>>16)|0,e[1]=r[1]+(r[0]<<8|r[0]>>>24)+r[7]|0,e[2]=r[2]+(r[1]<<16|r[1]>>>16)+(r[0]<<16|r[0]>>>16)|0,e[3]=r[3]+(r[2]<<8|r[2]>>>24)+r[1]|0,e[4]=r[4]+(r[3]<<16|r[3]>>>16)+(r[2]<<16|r[2]>>>16)|0,e[5]=r[5]+(r[4]<<8|r[4]>>>24)+r[3]|0,e[6]=r[6]+(r[5]<<16|r[5]>>>16)+(r[4]<<16|r[4]>>>16)|0,e[7]=r[7]+(r[6]<<8|r[6]>>>24)+r[5]|0}e.RabbitLegacy=t._createHelper(a)}(),n.RabbitLegacy)})),ae((function(e,t){e.exports=ce})));function le(){throw new Error("setTimeout has not been defined")}function de(){throw new Error("clearTimeout has not been defined")}var pe=le,he=de;function fe(e){if(pe===setTimeout)return setTimeout(e,0);if((pe===le||!pe)&&setTimeout)return pe=setTimeout,setTimeout(e,0);try{return pe(e,0)}catch(u){try{return pe.call(null,e,0)}catch(u){return pe.call(this,e,0)}}}"function"==typeof c.setTimeout&&(pe=setTimeout),"function"==typeof c.clearTimeout&&(he=clearTimeout);var ge,_e=[],ve=!1,me=-1;function ye(){ve&&ge&&(ve=!1,ge.length?_e=ge.concat(_e):me=-1,_e.length&&Me())}function Me(){if(!ve){var e=fe(ye);ve=!0;for(var t=_e.length;t;){for(ge=_e,_e=[];++me<t;)ge&&ge[me].run();me=-1,t=_e.length}ge=null,ve=!1,function(e){if(he===clearTimeout)return clearTimeout(e);if((he===de||!he)&&clearTimeout)return he=clearTimeout,clearTimeout(e);try{he(e)}catch(t){try{return he.call(null,e)}catch(t){return he.call(this,e)}}}(e)}}function Ie(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];_e.push(new Ce(e,t)),1!==_e.length||ve||fe(Me)}function Ce(e,t){this.fun=e,this.array=t}Ce.prototype.run=function(){this.fun.apply(null,this.array)};var Te=c.performance||{};function ke(){}function Se(){Se.init.call(this)}function Ee(e){return void 0===e._maxListeners?Se.defaultMaxListeners:e._maxListeners}function De(e,t,n){if(t)e.call(n);else for(var i=e.length,o=Pe(e,i),s=0;s<i;++s)o[s].call(n)}function we(e,t,n,i){if(t)e.call(n,i);else for(var o=e.length,s=Pe(e,o),r=0;r<o;++r)s[r].call(n,i)}function Ae(e,t,n,i,o){if(t)e.call(n,i,o);else for(var s=e.length,r=Pe(e,s),a=0;a<s;++a)r[a].call(n,i,o)}function be(e,t,n,i,o,s){if(t)e.call(n,i,o,s);else for(var r=e.length,a=Pe(e,r),c=0;c<r;++c)a[c].call(n,i,o,s)}function Le(e,t,n,i){if(t)e.apply(n,i);else for(var o=e.length,s=Pe(e,o),r=0;r<o;++r)s[r].apply(n,i)}function Re(e,t,n,o){var s,r,a,c;if("function"!=typeof n)throw new TypeError('"listener" argument must be a function');if((r=e._events)?(r.newListener&&(e.emit("newListener",t,n.listener?n.listener:n),r=e._events),a=r[t]):(r=e._events=new ke,e._eventsCount=0),a){if("function"==typeof a?a=r[t]=o?[n,a]:[a,n]:o?a.unshift(n):a.push(n),!a.warned&&(s=Ee(e))&&s>0&&a.length>s){a.warned=!0;var u=new Error("Possible EventEmitter memory leak detected. "+a.length+" "+t+" listeners added. Use emitter.setMaxListeners() to increase limit");u.name="MaxListenersExceededWarning",u.emitter=e,u.type=t,u.count=a.length,c=u,"function"==typeof console.warn?i("warn",c," at uilts/lib-generate-test-usersig-es.min.js:3130"):i("log",c," at uilts/lib-generate-test-usersig-es.min.js:3130")}}else a=r[t]=n,++e._eventsCount;return e}function Oe(e,t,n){var i=!1;function o(){e.removeListener(t,o),i||(i=!0,n.apply(e,arguments))}return o.listener=n,o}function Ne(e){var t=this._events;if(t){var n=t[e];if("function"==typeof n)return 1;if(n)return n.length}return 0}function Pe(e,t){for(var n=new Array(t);t--;)n[t]=e[t];return n}Te.now||Te.mozNow||Te.msNow||Te.oNow||Te.webkitNow,ke.prototype=Object.create(null),Se.EventEmitter=Se,Se.usingDomains=!1,Se.prototype.domain=void 0,Se.prototype._events=void 0,Se.prototype._maxListeners=void 0,Se.defaultMaxListeners=10,Se.init=function(){this.domain=null,Se.usingDomains&&(void 0).active&&(void 0).Domain,this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=new ke,this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},Se.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||isNaN(e))throw new TypeError('"n" argument must be a positive number');return this._maxListeners=e,this},Se.prototype.getMaxListeners=function(){return Ee(this)},Se.prototype.emit=function(e){var t,n,i,o,s,r,a,c="error"===e;if(r=this._events)c=c&&null==r.error;else if(!c)return!1;if(a=this.domain,c){if(t=arguments[1],!a){if(t instanceof Error)throw t;var u=new Error('Uncaught, unspecified "error" event. ('+t+")");throw u.context=t,u}return t||(t=new Error('Uncaught, unspecified "error" event')),t.domainEmitter=this,t.domain=a,t.domainThrown=!1,a.emit("error",t),!1}if(!(n=r[e]))return!1;var l="function"==typeof n;switch(i=arguments.length){case 1:De(n,l,this);break;case 2:we(n,l,this,arguments[1]);break;case 3:Ae(n,l,this,arguments[1],arguments[2]);break;case 4:be(n,l,this,arguments[1],arguments[2],arguments[3]);break;default:for(o=new Array(i-1),s=1;s<i;s++)o[s-1]=arguments[s];Le(n,l,this,o)}return!0},Se.prototype.addListener=function(e,t){return Re(this,e,t,!1)},Se.prototype.on=Se.prototype.addListener,Se.prototype.prependListener=function(e,t){return Re(this,e,t,!0)},Se.prototype.once=function(e,t){if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');return this.on(e,Oe(this,e,t)),this},Se.prototype.prependOnceListener=function(e,t){if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');return this.prependListener(e,Oe(this,e,t)),this},Se.prototype.removeListener=function(e,t){var n,i,o,s,r;if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');if(!(i=this._events))return this;if(!(n=i[e]))return this;if(n===t||n.listener&&n.listener===t)0==--this._eventsCount?this._events=new ke:(delete i[e],i.removeListener&&this.emit("removeListener",e,n.listener||t));else if("function"!=typeof n){for(o=-1,s=n.length;s-- >0;)if(n[s]===t||n[s].listener&&n[s].listener===t){r=n[s].listener,o=s;break}if(o<0)return this;if(1===n.length){if(n[0]=void 0,0==--this._eventsCount)return this._events=new ke,this;delete i[e]}else!function(e,t){for(var n=t,i=n+1,o=e.length;i<o;n+=1,i+=1)e[n]=e[i];e.pop()}(n,o);i.removeListener&&this.emit("removeListener",e,r||t)}return this},Se.prototype.removeAllListeners=function(e){var t,n;if(!(n=this._events))return this;if(!n.removeListener)return 0===arguments.length?(this._events=new ke,this._eventsCount=0):n[e]&&(0==--this._eventsCount?this._events=new ke:delete n[e]),this;if(0===arguments.length){for(var i,o=Object.keys(n),s=0;s<o.length;++s)"removeListener"!==(i=o[s])&&this.removeAllListeners(i);return this.removeAllListeners("removeListener"),this._events=new ke,this._eventsCount=0,this}if("function"==typeof(t=n[e]))this.removeListener(e,t);else if(t)do{this.removeListener(e,t[t.length-1])}while(t[0]);return this},Se.prototype.listeners=function(e){var t,n=this._events;return n&&(t=n[e])?"function"==typeof t?[t.listener||t]:function(e){for(var t=new Array(e.length),n=0;n<t.length;++n)t[n]=e[n].listener||e[n];return t}(t):[]},Se.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):Ne.call(e,t)},Se.prototype.listenerCount=Ne,Se.prototype.eventNames=function(){return this._eventsCount>0?Reflect.ownKeys(this._events):[]};var Ue="function"==typeof Object.create?function(e,t){e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}})}:function(e,t){e.super_=t;var n=function(){};n.prototype=t.prototype,e.prototype=new n,e.prototype.constructor=e},Ge=/%[sdj%]/g;function xe(e){if(!Je(e)){for(var t=[],n=0;n<arguments.length;n++)t.push($e(arguments[n]));return t.join(" ")}n=1;for(var i=arguments,o=i.length,s=String(e).replace(Ge,(function(e){if("%%"===e)return"%";if(n>=o)return e;switch(e){case"%s":return String(i[n++]);case"%d":return Number(i[n++]);case"%j":try{return JSON.stringify(i[n++])}catch(e){return"[Circular]"}default:return e}})),r=i[n];n<o;r=i[++n])We(r)||!Qe(r)?s+=" "+r:s+=" "+$e(r);return s}function Fe(e,t){if(Xe(c.process))return function(){return Fe(e,t).apply(this,arguments)};var n=!1;return function(){return n||(i("error",t," at uilts/lib-generate-test-usersig-es.min.js:3342"),n=!0),e.apply(this,arguments)}}var qe,Be={};function $e(e,t){var n={seen:[],stylize:He};return arguments.length>=3&&(n.depth=arguments[2]),arguments.length>=4&&(n.colors=arguments[3]),Ye(t)?n.showHidden=t:t&&function(e,t){if(!t||!Qe(t))return e;for(var n=Object.keys(t),i=n.length;i--;)e[n[i]]=t[n[i]]}(n,t),Xe(n.showHidden)&&(n.showHidden=!1),Xe(n.depth)&&(n.depth=2),Xe(n.colors)&&(n.colors=!1),Xe(n.customInspect)&&(n.customInspect=!0),n.colors&&(n.stylize=Ve),Ke(n,e,n.depth)}function Ve(e,t){var n=$e.styles[t];return n?"\x1b["+$e.colors[n][0]+"m"+e+"\x1b["+$e.colors[n][1]+"m":e}function He(e,t){return e}function Ke(e,t,n){if(e.customInspect&&t&&nt(t.inspect)&&t.inspect!==$e&&(!t.constructor||t.constructor.prototype!==t)){var i=t.inspect(n,e);return Je(i)||(i=Ke(e,i,n)),i}var o=function(e,t){if(Xe(t))return e.stylize("undefined","undefined");if(Je(t)){var n="'"+JSON.stringify(t).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return e.stylize(n,"string")}return i=t,"number"==typeof i?e.stylize(""+t,"number"):Ye(t)?e.stylize(""+t,"boolean"):We(t)?e.stylize("null","null"):void 0;var i}(e,t);if(o)return o;var s=Object.keys(t),r=function(e){var t={};return e.forEach((function(e,n){t[e]=!0})),t}(s);if(e.showHidden&&(s=Object.getOwnPropertyNames(t)),tt(t)&&(s.indexOf("message")>=0||s.indexOf("description")>=0))return je(t);if(0===s.length){if(nt(t)){var a=t.name?": "+t.name:"";return e.stylize("[Function"+a+"]","special")}if(Ze(t))return e.stylize(RegExp.prototype.toString.call(t),"regexp");if(et(t))return e.stylize(Date.prototype.toString.call(t),"date");if(tt(t))return je(t)}var c,u,l="",d=!1,p=["{","}"];return c=t,Array.isArray(c)&&(d=!0,p=["[","]"]),nt(t)&&(l=" [Function"+(t.name?": "+t.name:"")+"]"),Ze(t)&&(l=" "+RegExp.prototype.toString.call(t)),et(t)&&(l=" "+Date.prototype.toUTCString.call(t)),tt(t)&&(l=" "+je(t)),0!==s.length||d&&0!=t.length?n<0?Ze(t)?e.stylize(RegExp.prototype.toString.call(t),"regexp"):e.stylize("[Object]","special"):(e.seen.push(t),u=d?function(e,t,n,i,o){for(var s=[],r=0,a=t.length;r<a;++r)ot(t,String(r))?s.push(ze(e,t,n,i,String(r),!0)):s.push("");return o.forEach((function(o){o.match(/^\d+$/)||s.push(ze(e,t,n,i,o,!0))})),s}(e,t,n,r,s):s.map((function(i){return ze(e,t,n,r,i,d)})),e.seen.pop(),function(e,t,n){return e.reduce((function(e,t){return t.indexOf("\n"),e+t.replace(/\u001b\[\d\d?m/g,"").length+1}),0)>60?n[0]+(""===t?"":t+"\n ")+" "+e.join(",\n  ")+" "+n[1]:n[0]+t+" "+e.join(", ")+" "+n[1]}(u,l,p)):p[0]+l+p[1]}function je(e){return"["+Error.prototype.toString.call(e)+"]"}function ze(e,t,n,i,o,s){var r,a,c;if((c=Object.getOwnPropertyDescriptor(t,o)||{value:t[o]}).get?a=c.set?e.stylize("[Getter/Setter]","special"):e.stylize("[Getter]","special"):c.set&&(a=e.stylize("[Setter]","special")),ot(i,o)||(r="["+o+"]"),a||(e.seen.indexOf(c.value)<0?(a=We(n)?Ke(e,c.value,null):Ke(e,c.value,n-1)).indexOf("\n")>-1&&(a=s?a.split("\n").map((function(e){return"  "+e})).join("\n").substr(2):"\n"+a.split("\n").map((function(e){return"   "+e})).join("\n")):a=e.stylize("[Circular]","special")),Xe(r)){if(s&&o.match(/^\d+$/))return a;(r=JSON.stringify(""+o)).match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(r=r.substr(1,r.length-2),r=e.stylize(r,"name")):(r=r.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),r=e.stylize(r,"string"))}return r+": "+a}function Ye(e){return"boolean"==typeof e}function We(e){return null===e}function Je(e){return"string"==typeof e}function Xe(e){return void 0===e}function Ze(e){return Qe(e)&&"[object RegExp]"===it(e)}function Qe(e){return"object"==(0,a.default)(e)&&null!==e}function et(e){return Qe(e)&&"[object Date]"===it(e)}function tt(e){return Qe(e)&&("[object Error]"===it(e)||e instanceof Error)}function nt(e){return"function"==typeof e}function it(e){return Object.prototype.toString.call(e)}function ot(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function st(){this.head=null,this.tail=null,this.length=0}$e.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},$e.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"},st.prototype.push=function(e){var t={data:e,next:null};this.length>0?this.tail.next=t:this.head=t,this.tail=t,++this.length},st.prototype.unshift=function(e){var t={data:e,next:this.head};0===this.length&&(this.tail=t),this.head=t,++this.length},st.prototype.shift=function(){if(0!==this.length){var e=this.head.data;return 1===this.length?this.head=this.tail=null:this.head=this.head.next,--this.length,e}},st.prototype.clear=function(){this.head=this.tail=null,this.length=0},st.prototype.join=function(e){if(0===this.length)return"";for(var t=this.head,n=""+t.data;t=t.next;)n+=e+t.data;return n},st.prototype.concat=function(e){if(0===this.length)return C.alloc(0);if(1===this.length)return this.head.data;for(var t=C.allocUnsafe(e>>>0),n=this.head,i=0;n;)n.data.copy(t,i),i+=n.data.length,n=n.next;return t};var rt=C.isEncoding||function(e){switch(e&&e.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}};function at(e){switch(this.encoding=(e||"utf8").toLowerCase().replace(/[-_]/,""),function(e){if(e&&!rt(e))throw new Error("Unknown encoding: "+e)}(e),this.encoding){case"utf8":this.surrogateSize=3;break;case"ucs2":case"utf16le":this.surrogateSize=2,this.detectIncompleteChar=ut;break;case"base64":this.surrogateSize=3,this.detectIncompleteChar=lt;break;default:return void(this.write=ct)}this.charBuffer=new C(6),this.charReceived=0,this.charLength=0}function ct(e){return e.toString(this.encoding)}function ut(e){this.charReceived=e.length%2,this.charLength=this.charReceived?2:0}function lt(e){this.charReceived=e.length%3,this.charLength=this.charReceived?3:0}at.prototype.write=function(e){for(var t="";this.charLength;){var n=e.length>=this.charLength-this.charReceived?this.charLength-this.charReceived:e.length;if(e.copy(this.charBuffer,this.charReceived,0,n),this.charReceived+=n,this.charReceived<this.charLength)return"";if(e=e.slice(n,e.length),!((i=(t=this.charBuffer.slice(0,this.charLength).toString(this.encoding)).charCodeAt(t.length-1))>=55296&&i<=56319)){if(this.charReceived=this.charLength=0,0===e.length)return t;break}this.charLength+=this.surrogateSize,t=""}this.detectIncompleteChar(e);var i,o=e.length;if(this.charLength&&(e.copy(this.charBuffer,0,e.length-this.charReceived,o),o-=this.charReceived),o=(t+=e.toString(this.encoding,0,o)).length-1,(i=t.charCodeAt(o))>=55296&&i<=56319){var s=this.surrogateSize;return this.charLength+=s,this.charReceived+=s,this.charBuffer.copy(this.charBuffer,s,0,s),e.copy(this.charBuffer,0,0,s),t.substring(0,o)}return t},at.prototype.detectIncompleteChar=function(e){for(var t=e.length>=3?3:e.length;t>0;t--){var n=e[e.length-t];if(1==t&&n>>5==6){this.charLength=2;break}if(t<=2&&n>>4==14){this.charLength=3;break}if(t<=3&&n>>3==30){this.charLength=4;break}}this.charReceived=t},at.prototype.end=function(e){var t="";if(e&&e.length&&(t=this.write(e)),this.charReceived){var n=this.charReceived,i=this.charBuffer,o=this.encoding;t+=i.slice(0,n).toString(o)}return t},ht.ReadableState=pt;var dt=function(e){return Xe(qe)&&(qe=""),e=e.toUpperCase(),Be[e]||(new RegExp("\\b"+e+"\\b","i").test(qe)?Be[e]=function(){var t=xe.apply(null,arguments);i("error","%s %d: %s",e,0,t," at uilts/lib-generate-test-usersig-es.min.js:3681")}:Be[e]=function(){}),Be[e]}("stream");function pt(e,t){e=e||{},this.objectMode=!!e.objectMode,t instanceof qt&&(this.objectMode=this.objectMode||!!e.readableObjectMode);var n=e.highWaterMark,i=this.objectMode?16:16384;this.highWaterMark=n||0===n?n:i,this.highWaterMark=~~this.highWaterMark,this.buffer=new st,this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.resumeScheduled=!1,this.defaultEncoding=e.defaultEncoding||"utf8",this.ranOut=!1,this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,e.encoding&&(this.decoder=new at(e.encoding),this.encoding=e.encoding)}function ht(e){if(!(this instanceof ht))return new ht(e);this._readableState=new pt(e,this),this.readable=!0,e&&"function"==typeof e.read&&(this._read=e.read),Se.call(this)}function ft(e,t,n,i,o){var s=function(e,t){var n=null;return se(t)||"string"==typeof t||null==t||e.objectMode||(n=new TypeError("Invalid non-string/buffer chunk")),n}(t,n);if(s)e.emit("error",s);else if(null===n)t.reading=!1,function(e,t){if(!t.ended){if(t.decoder){var n=t.decoder.end();n&&n.length&&(t.buffer.push(n),t.length+=t.objectMode?1:n.length)}t.ended=!0,_t(e)}}(e,t);else if(t.objectMode||n&&n.length>0)if(t.ended&&!o){var r=new Error("stream.push() after EOF");e.emit("error",r)}else if(t.endEmitted&&o){var a=new Error("stream.unshift() after end event");e.emit("error",a)}else{var c;!t.decoder||o||i||(n=t.decoder.write(n),c=!t.objectMode&&0===n.length),o||(t.reading=!1),c||(t.flowing&&0===t.length&&!t.sync?(e.emit("data",n),e.read(0)):(t.length+=t.objectMode?1:n.length,o?t.buffer.unshift(n):t.buffer.push(n),t.needReadable&&_t(e))),function(e,t){t.readingMore||(t.readingMore=!0,Ie(mt,e,t))}(e,t)}else o||(t.reading=!1);return function(e){return!e.ended&&(e.needReadable||e.length<e.highWaterMark||0===e.length)}(t)}Ue(ht,Se),ht.prototype.push=function(e,t){var n=this._readableState;return n.objectMode||"string"!=typeof e||(t=t||n.defaultEncoding)!==n.encoding&&(e=C.from(e,t),t=""),ft(this,n,e,t,!1)},ht.prototype.unshift=function(e){return ft(this,this._readableState,e,"",!0)},ht.prototype.isPaused=function(){return!1===this._readableState.flowing},ht.prototype.setEncoding=function(e){return this._readableState.decoder=new at(e),this._readableState.encoding=e,this};function gt(e,t){return e<=0||0===t.length&&t.ended?0:t.objectMode?1:e!=e?t.flowing&&t.length?t.buffer.head.data.length:t.length:(e>t.highWaterMark&&(t.highWaterMark=function(e){return e>=8388608?e=8388608:(e--,e|=e>>>1,e|=e>>>2,e|=e>>>4,e|=e>>>8,e|=e>>>16,e++),e}(e)),e<=t.length?e:t.ended?t.length:(t.needReadable=!0,0))}function _t(e){var t=e._readableState;t.needReadable=!1,t.emittedReadable||(dt("emitReadable",t.flowing),t.emittedReadable=!0,t.sync?Ie(vt,e):vt(e))}function vt(e){dt("emit readable"),e.emit("readable"),It(e)}function mt(e,t){for(var n=t.length;!t.reading&&!t.flowing&&!t.ended&&t.length<t.highWaterMark&&(dt("maybeReadMore read 0"),e.read(0),n!==t.length);)n=t.length;t.readingMore=!1}function yt(e){dt("readable nexttick read 0"),e.read(0)}function Mt(e,t){t.reading||(dt("resume read 0"),e.read(0)),t.resumeScheduled=!1,t.awaitDrain=0,e.emit("resume"),It(e),t.flowing&&!t.reading&&e.read(0)}function It(e){var t=e._readableState;for(dt("flow",t.flowing);t.flowing&&null!==e.read(););}function Ct(e,t){return 0===t.length?null:(t.objectMode?n=t.buffer.shift():!e||e>=t.length?(n=t.decoder?t.buffer.join(""):1===t.buffer.length?t.buffer.head.data:t.buffer.concat(t.length),t.buffer.clear()):n=function(e,t,n){var i;return e<t.head.data.length?(i=t.head.data.slice(0,e),t.head.data=t.head.data.slice(e)):i=e===t.head.data.length?t.shift():n?function(e,t){var n=t.head,i=1,o=n.data;for(e-=o.length;n=n.next;){var s=n.data,r=e>s.length?s.length:e;if(r===s.length?o+=s:o+=s.slice(0,e),0===(e-=r)){r===s.length?(++i,n.next?t.head=n.next:t.head=t.tail=null):(t.head=n,n.data=s.slice(r));break}++i}return t.length-=i,o}(e,t):function(e,t){var n=C.allocUnsafe(e),i=t.head,o=1;for(i.data.copy(n),e-=i.data.length;i=i.next;){var s=i.data,r=e>s.length?s.length:e;if(s.copy(n,n.length-e,0,r),0===(e-=r)){r===s.length?(++o,i.next?t.head=i.next:t.head=t.tail=null):(t.head=i,i.data=s.slice(r));break}++o}return t.length-=o,n}(e,t),i}(e,t.buffer,t.decoder),n);var n}function Tt(e){var t=e._readableState;if(t.length>0)throw new Error('"endReadable()" called on non-empty stream');t.endEmitted||(t.ended=!0,Ie(kt,t,e))}function kt(e,t){e.endEmitted||0!==e.length||(e.endEmitted=!0,t.readable=!1,t.emit("end"))}function St(e,t){for(var n=0,i=e.length;n<i;n++)if(e[n]===t)return n;return-1}function Et(){}function Dt(e,t,n){this.chunk=e,this.encoding=t,this.callback=n,this.next=null}function wt(e,t){Object.defineProperty(this,"buffer",{get:Fe((function(){return this.getBuffer()}),"_writableState.buffer is deprecated. Use _writableState.getBuffer instead.")}),e=e||{},this.objectMode=!!e.objectMode,t instanceof qt&&(this.objectMode=this.objectMode||!!e.writableObjectMode);var n=e.highWaterMark,i=this.objectMode?16:16384;this.highWaterMark=n||0===n?n:i,this.highWaterMark=~~this.highWaterMark,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1;var o=!1===e.decodeStrings;this.decodeStrings=!o,this.defaultEncoding=e.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(e){!function(e,t){var n=e._writableState,i=n.sync,o=n.writecb;if(function(e){e.writing=!1,e.writecb=null,e.length-=e.writelen,e.writelen=0}(n),t)!function(e,t,n,i,o){--t.pendingcb,n?Ie(o,i):o(i),e._writableState.errorEmitted=!0,e.emit("error",i)}(e,n,i,t,o);else{var s=Ot(n);s||n.corked||n.bufferProcessing||!n.bufferedRequest||Rt(e,n),i?Ie(Lt,e,n,s,o):Lt(e,n,s,o)}}(t,e)},this.writecb=null,this.writelen=0,this.bufferedRequest=null,this.lastBufferedRequest=null,this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1,this.bufferedRequestCount=0,this.corkedRequestsFree=new Ut(this)}function At(e){if(!(this instanceof At||this instanceof qt))return new At(e);this._writableState=new wt(e,this),this.writable=!0,e&&("function"==typeof e.write&&(this._write=e.write),"function"==typeof e.writev&&(this._writev=e.writev)),Se.call(this)}function bt(e,t,n,i,o,s,r){t.writelen=i,t.writecb=r,t.writing=!0,t.sync=!0,n?e._writev(o,t.onwrite):e._write(o,s,t.onwrite),t.sync=!1}function Lt(e,t,n,i){n||function(e,t){0===t.length&&t.needDrain&&(t.needDrain=!1,e.emit("drain"))}(e,t),t.pendingcb--,i(),Pt(e,t)}function Rt(e,t){t.bufferProcessing=!0;var n=t.bufferedRequest;if(e._writev&&n&&n.next){var i=t.bufferedRequestCount,o=new Array(i),s=t.corkedRequestsFree;s.entry=n;for(var r=0;n;)o[r]=n,n=n.next,r+=1;bt(e,t,!0,t.length,o,"",s.finish),t.pendingcb++,t.lastBufferedRequest=null,s.next?(t.corkedRequestsFree=s.next,s.next=null):t.corkedRequestsFree=new Ut(t)}else{for(;n;){var a=n.chunk,c=n.encoding,u=n.callback;if(bt(e,t,!1,t.objectMode?1:a.length,a,c,u),n=n.next,t.writing)break}null===n&&(t.lastBufferedRequest=null)}t.bufferedRequestCount=0,t.bufferedRequest=n,t.bufferProcessing=!1}function Ot(e){return e.ending&&0===e.length&&null===e.bufferedRequest&&!e.finished&&!e.writing}function Nt(e,t){t.prefinished||(t.prefinished=!0,e.emit("prefinish"))}function Pt(e,t){var n=Ot(t);return n&&(0===t.pendingcb?(Nt(e,t),t.finished=!0,e.emit("finish")):Nt(e,t)),n}function Ut(e){var t=this;this.next=null,this.entry=null,this.finish=function(n){var i=t.entry;for(t.entry=null;i;){var o=i.callback;e.pendingcb--,o(n),i=i.next}e.corkedRequestsFree?e.corkedRequestsFree.next=t:e.corkedRequestsFree=t}}ht.prototype.read=function(e){dt("read",e),e=parseInt(e,10);var t=this._readableState,n=e;if(0!==e&&(t.emittedReadable=!1),0===e&&t.needReadable&&(t.length>=t.highWaterMark||t.ended))return dt("read: emitReadable",t.length,t.ended),0===t.length&&t.ended?Tt(this):_t(this),null;if(0===(e=gt(e,t))&&t.ended)return 0===t.length&&Tt(this),null;var i,o=t.needReadable;return dt("need readable",o),(0===t.length||t.length-e<t.highWaterMark)&&dt("length less than watermark",o=!0),t.ended||t.reading?dt("reading or ended",o=!1):o&&(dt("do read"),t.reading=!0,t.sync=!0,0===t.length&&(t.needReadable=!0),this._read(t.highWaterMark),t.sync=!1,t.reading||(e=gt(n,t))),null===(i=e>0?Ct(e,t):null)?(t.needReadable=!0,e=0):t.length-=e,0===t.length&&(t.ended||(t.needReadable=!0),n!==e&&t.ended&&Tt(this)),null!==i&&this.emit("data",i),i},ht.prototype._read=function(e){this.emit("error",new Error("not implemented"))},ht.prototype.pipe=function(e,t){var n=this,i=this._readableState;switch(i.pipesCount){case 0:i.pipes=e;break;case 1:i.pipes=[i.pipes,e];break;default:i.pipes.push(e)}i.pipesCount+=1,dt("pipe count=%d opts=%j",i.pipesCount,t);var o=t&&!1===t.end?u:r;function s(e){dt("onunpipe"),e===n&&u()}function r(){dt("onend"),e.end()}i.endEmitted?Ie(o):n.once("end",o),e.on("unpipe",s);var a=function(e){return function(){var t=e._readableState;dt("pipeOnDrain",t.awaitDrain),t.awaitDrain&&t.awaitDrain--,0===t.awaitDrain&&e.listeners("data").length&&(t.flowing=!0,It(e))}}(n);e.on("drain",a);var c=!1;function u(){dt("cleanup"),e.removeListener("close",h),e.removeListener("finish",f),e.removeListener("drain",a),e.removeListener("error",p),e.removeListener("unpipe",s),n.removeListener("end",r),n.removeListener("end",u),n.removeListener("data",d),c=!0,!i.awaitDrain||e._writableState&&!e._writableState.needDrain||a()}var l=!1;function d(t){dt("ondata"),l=!1,!1!==e.write(t)||l||((1===i.pipesCount&&i.pipes===e||i.pipesCount>1&&-1!==St(i.pipes,e))&&!c&&(dt("false write response, pause",n._readableState.awaitDrain),n._readableState.awaitDrain++,l=!0),n.pause())}function p(t){dt("onerror",t),g(),e.removeListener("error",p),0===("error",e.listeners("error").length)&&e.emit("error",t)}function h(){e.removeListener("finish",f),g()}function f(){dt("onfinish"),e.removeListener("close",h),g()}function g(){dt("unpipe"),n.unpipe(e)}return n.on("data",d),function(e,t,n){if("function"==typeof e.prependListener)return e.prependListener(t,n);e._events&&e._events[t]?Array.isArray(e._events[t])?e._events[t].unshift(n):e._events[t]=[n,e._events[t]]:e.on(t,n)}(e,"error",p),e.once("close",h),e.once("finish",f),e.emit("pipe",n),i.flowing||(dt("pipe resume"),n.resume()),e},ht.prototype.unpipe=function(e){var t=this._readableState;if(0===t.pipesCount)return this;if(1===t.pipesCount)return e&&e!==t.pipes||(e||(e=t.pipes),t.pipes=null,t.pipesCount=0,t.flowing=!1,e&&e.emit("unpipe",this)),this;if(!e){var n=t.pipes,i=t.pipesCount;t.pipes=null,t.pipesCount=0,t.flowing=!1;for(var o=0;o<i;o++)n[o].emit("unpipe",this);return this}var s=St(t.pipes,e);return-1===s||(t.pipes.splice(s,1),t.pipesCount-=1,1===t.pipesCount&&(t.pipes=t.pipes[0]),e.emit("unpipe",this)),this},ht.prototype.on=function(e,t){var n=Se.prototype.on.call(this,e,t);if("data"===e)!1!==this._readableState.flowing&&this.resume();else if("readable"===e){var i=this._readableState;i.endEmitted||i.readableListening||(i.readableListening=i.needReadable=!0,i.emittedReadable=!1,i.reading?i.length&&_t(this):Ie(yt,this))}return n},ht.prototype.addListener=ht.prototype.on,ht.prototype.resume=function(){var e=this._readableState;return e.flowing||(dt("resume"),e.flowing=!0,function(e,t){t.resumeScheduled||(t.resumeScheduled=!0,Ie(Mt,e,t))}(this,e)),this},ht.prototype.pause=function(){return dt("call pause flowing=%j",this._readableState.flowing),!1!==this._readableState.flowing&&(dt("pause"),this._readableState.flowing=!1,this.emit("pause")),this},ht.prototype.wrap=function(e){var t=this._readableState,n=!1,i=this;for(var o in e.on("end",(function(){if(dt("wrapped end"),t.decoder&&!t.ended){var e=t.decoder.end();e&&e.length&&i.push(e)}i.push(null)})),e.on("data",(function(o){dt("wrapped data"),t.decoder&&(o=t.decoder.write(o)),t.objectMode&&null==o||(t.objectMode||o&&o.length)&&(i.push(o)||(n=!0,e.pause()))})),e)void 0===this[o]&&"function"==typeof e[o]&&(this[o]=function(t){return function(){return e[t].apply(e,arguments)}}(o));return function(e,t){for(var n=0,i=e.length;n<i;n++)t(e[n])}(["error","close","destroy","pause","resume"],(function(t){e.on(t,i.emit.bind(i,t))})),i._read=function(t){dt("wrapped _read",t),n&&(n=!1,e.resume())},i},ht._fromList=Ct,At.WritableState=wt,Ue(At,Se),wt.prototype.getBuffer=function(){for(var e=this.bufferedRequest,t=[];e;)t.push(e),e=e.next;return t},At.prototype.pipe=function(){this.emit("error",new Error("Cannot pipe, not readable"))},At.prototype.write=function(e,t,n){var i=this._writableState,o=!1;return"function"==typeof t&&(n=t,t=null),C.isBuffer(e)?t="buffer":t||(t=i.defaultEncoding),"function"!=typeof n&&(n=Et),i.ended?function(e,t){var n=new Error("write after end");e.emit("error",n),Ie(t,n)}(this,n):function(e,t,n,i){var o=!0,s=!1;return null===n?s=new TypeError("May not write null values to stream"):C.isBuffer(n)||"string"==typeof n||void 0===n||t.objectMode||(s=new TypeError("Invalid non-string/buffer chunk")),s&&(e.emit("error",s),Ie(i,s),o=!1),o}(this,i,e,n)&&(i.pendingcb++,o=function(e,t,n,i,o){n=function(e,t,n){return e.objectMode||!1===e.decodeStrings||"string"!=typeof t||(t=C.from(t,n)),t}(t,n,i),C.isBuffer(n)&&(i="buffer");var s=t.objectMode?1:n.length;t.length+=s;var r=t.length<t.highWaterMark;if(r||(t.needDrain=!0),t.writing||t.corked){var a=t.lastBufferedRequest;t.lastBufferedRequest=new Dt(n,i,o),a?a.next=t.lastBufferedRequest:t.bufferedRequest=t.lastBufferedRequest,t.bufferedRequestCount+=1}else bt(e,t,!1,s,n,i,o);return r}(this,i,e,t,n)),o},At.prototype.cork=function(){this._writableState.corked++},At.prototype.uncork=function(){var e=this._writableState;e.corked&&(e.corked--,e.writing||e.corked||e.finished||e.bufferProcessing||!e.bufferedRequest||Rt(this,e))},At.prototype.setDefaultEncoding=function(e){if("string"==typeof e&&(e=e.toLowerCase()),!(["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((e+"").toLowerCase())>-1))throw new TypeError("Unknown encoding: "+e);return this._writableState.defaultEncoding=e,this},At.prototype._write=function(e,t,n){n(new Error("not implemented"))},At.prototype._writev=null,At.prototype.end=function(e,t,n){var i=this._writableState;"function"==typeof e?(n=e,e=null,t=null):"function"==typeof t&&(n=t,t=null),null!=e&&this.write(e,t),i.corked&&(i.corked=1,this.uncork()),i.ending||i.finished||function(e,t,n){t.ending=!0,Pt(e,t),n&&(t.finished?Ie(n):e.once("finish",n)),t.ended=!0,e.writable=!1}(this,i,n)},Ue(qt,ht);for(var Gt=Object.keys(At.prototype),xt=0;xt<Gt.length;xt++){var Ft=Gt[xt];qt.prototype[Ft]||(qt.prototype[Ft]=At.prototype[Ft])}function qt(e){if(!(this instanceof qt))return new qt(e);ht.call(this,e),At.call(this,e),e&&!1===e.readable&&(this.readable=!1),e&&!1===e.writable&&(this.writable=!1),this.allowHalfOpen=!0,e&&!1===e.allowHalfOpen&&(this.allowHalfOpen=!1),this.once("end",Bt)}function Bt(){this.allowHalfOpen||this._writableState.ended||Ie($t,this)}function $t(e){e.end()}function Vt(e){this.afterTransform=function(t,n){return function(e,t,n){var i=e._transformState;i.transforming=!1;var o=i.writecb;if(!o)return e.emit("error",new Error("no writecb in Transform class"));i.writechunk=null,i.writecb=null,null!=n&&e.push(n),o(t);var s=e._readableState;s.reading=!1,(s.needReadable||s.length<s.highWaterMark)&&e._read(s.highWaterMark)}(e,t,n)},this.needTransform=!1,this.transforming=!1,this.writecb=null,this.writechunk=null,this.writeencoding=null}function Ht(e){if(!(this instanceof Ht))return new Ht(e);qt.call(this,e),this._transformState=new Vt(this);var t=this;this._readableState.needReadable=!0,this._readableState.sync=!1,e&&("function"==typeof e.transform&&(this._transform=e.transform),"function"==typeof e.flush&&(this._flush=e.flush)),this.once("prefinish",(function(){"function"==typeof this._flush?this._flush((function(e){Kt(t,e)})):Kt(t)}))}function Kt(e,t){if(t)return e.emit("error",t);var n=e._writableState,i=e._transformState;if(n.length)throw new Error("Calling transform done when ws.length != 0");if(i.transforming)throw new Error("Calling transform done when still transforming");return e.push(null)}function jt(e){if(!(this instanceof jt))return new jt(e);Ht.call(this,e)}function zt(){Se.call(this)}Ue(Ht,qt),Ht.prototype.push=function(e,t){return this._transformState.needTransform=!1,qt.prototype.push.call(this,e,t)},Ht.prototype._transform=function(e,t,n){throw new Error("Not implemented")},Ht.prototype._write=function(e,t,n){var i=this._transformState;if(i.writecb=n,i.writechunk=e,i.writeencoding=t,!i.transforming){var o=this._readableState;(i.needTransform||o.needReadable||o.length<o.highWaterMark)&&this._read(o.highWaterMark)}},Ht.prototype._read=function(e){var t=this._transformState;null!==t.writechunk&&t.writecb&&!t.transforming?(t.transforming=!0,this._transform(t.writechunk,t.writeencoding,t.afterTransform)):t.needTransform=!0},Ue(jt,Ht),jt.prototype._transform=function(e,t,n){n(null,e)},Ue(zt,Se),zt.Readable=ht,zt.Writable=At,zt.Duplex=qt,zt.Transform=Ht,zt.PassThrough=jt,zt.Stream=zt,zt.prototype.pipe=function(e,t){var n=this;function i(t){e.writable&&!1===e.write(t)&&n.pause&&n.pause()}function o(){n.readable&&n.resume&&n.resume()}n.on("data",i),e.on("drain",o),e._isStdio||t&&!1===t.end||(n.on("end",r),n.on("close",a));var s=!1;function r(){s||(s=!0,e.end())}function a(){s||(s=!0,"function"==typeof e.destroy&&e.destroy())}function c(e){if(u(),0===Se.listenerCount(this,"error"))throw e}function u(){n.removeListener("data",i),e.removeListener("drain",o),n.removeListener("end",r),n.removeListener("close",a),n.removeListener("error",c),e.removeListener("error",c),n.removeListener("end",u),n.removeListener("close",u),e.removeListener("close",u)}return n.on("error",c),e.on("error",c),n.on("end",u),n.on("close",u),e.on("close",u),e.emit("pipe",n),e};var Yt={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"};function Wt(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}function Jt(e,t,n,i,o){if(t.subarray&&e.subarray)e.set(t.subarray(n,n+i),o);else for(var s=0;s<i;s++)e[o+s]=t[n+s]}var Xt=Uint8Array,Zt=Uint16Array,Qt=Int32Array;function en(e){for(var t=e.length;--t>=0;)e[t]=0}var tn=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],nn=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],on=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],sn=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],rn=new Array(576);en(rn);var an=new Array(60);en(an);var cn=new Array(512);en(cn);var un=new Array(256);en(un);var ln=new Array(29);en(ln);var dn,pn,hn,fn=new Array(30);function gn(e,t,n,i,o){this.static_tree=e,this.extra_bits=t,this.extra_base=n,this.elems=i,this.max_length=o,this.has_stree=e&&e.length}function _n(e,t){this.dyn_tree=e,this.max_code=0,this.stat_desc=t}function vn(e){return e<256?cn[e]:cn[256+(e>>>7)]}function mn(e,t){e.pending_buf[e.pending++]=255&t,e.pending_buf[e.pending++]=t>>>8&255}function yn(e,t,n){e.bi_valid>16-n?(e.bi_buf|=t<<e.bi_valid&65535,mn(e,e.bi_buf),e.bi_buf=t>>16-e.bi_valid,e.bi_valid+=n-16):(e.bi_buf|=t<<e.bi_valid&65535,e.bi_valid+=n)}function Mn(e,t,n){yn(e,n[2*t],n[2*t+1])}function In(e,t){var n=0;do{n|=1&e,e>>>=1,n<<=1}while(--t>0);return n>>>1}function Cn(e,t,n){var i,o,s=new Array(16),r=0;for(i=1;i<=15;i++)s[i]=r=r+n[i-1]<<1;for(o=0;o<=t;o++){var a=e[2*o+1];0!==a&&(e[2*o]=In(s[a]++,a))}}function Tn(e){var t;for(t=0;t<286;t++)e.dyn_ltree[2*t]=0;for(t=0;t<30;t++)e.dyn_dtree[2*t]=0;for(t=0;t<19;t++)e.bl_tree[2*t]=0;e.dyn_ltree[512]=1,e.opt_len=e.static_len=0,e.last_lit=e.matches=0}function kn(e){e.bi_valid>8?mn(e,e.bi_buf):e.bi_valid>0&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0}function Sn(e,t,n,i){var o=2*t,s=2*n;return e[o]<e[s]||e[o]===e[s]&&i[t]<=i[n]}function En(e,t,n){for(var i=e.heap[n],o=n<<1;o<=e.heap_len&&(o<e.heap_len&&Sn(t,e.heap[o+1],e.heap[o],e.depth)&&o++,!Sn(t,i,e.heap[o],e.depth));)e.heap[n]=e.heap[o],n=o,o<<=1;e.heap[n]=i}function Dn(e,t,n){var i,o,s,r,a=0;if(0!==e.last_lit)do{i=e.pending_buf[e.d_buf+2*a]<<8|e.pending_buf[e.d_buf+2*a+1],o=e.pending_buf[e.l_buf+a],a++,0===i?Mn(e,o,t):(Mn(e,(s=un[o])+256+1,t),0!==(r=tn[s])&&yn(e,o-=ln[s],r),Mn(e,s=vn(--i),n),0!==(r=nn[s])&&yn(e,i-=fn[s],r))}while(a<e.last_lit);Mn(e,256,t)}function wn(e,t){var n,i,o,s=t.dyn_tree,r=t.stat_desc.static_tree,a=t.stat_desc.has_stree,c=t.stat_desc.elems,u=-1;for(e.heap_len=0,e.heap_max=573,n=0;n<c;n++)0!==s[2*n]?(e.heap[++e.heap_len]=u=n,e.depth[n]=0):s[2*n+1]=0;for(;e.heap_len<2;)s[2*(o=e.heap[++e.heap_len]=u<2?++u:0)]=1,e.depth[o]=0,e.opt_len--,a&&(e.static_len-=r[2*o+1]);for(t.max_code=u,n=e.heap_len>>1;n>=1;n--)En(e,s,n);o=c;do{n=e.heap[1],e.heap[1]=e.heap[e.heap_len--],En(e,s,1),i=e.heap[1],e.heap[--e.heap_max]=n,e.heap[--e.heap_max]=i,s[2*o]=s[2*n]+s[2*i],e.depth[o]=(e.depth[n]>=e.depth[i]?e.depth[n]:e.depth[i])+1,s[2*n+1]=s[2*i+1]=o,e.heap[1]=o++,En(e,s,1)}while(e.heap_len>=2);e.heap[--e.heap_max]=e.heap[1],function(e,t){var n,i,o,s,r,a,c=t.dyn_tree,u=t.max_code,l=t.stat_desc.static_tree,d=t.stat_desc.has_stree,p=t.stat_desc.extra_bits,h=t.stat_desc.extra_base,f=t.stat_desc.max_length,g=0;for(s=0;s<=15;s++)e.bl_count[s]=0;for(c[2*e.heap[e.heap_max]+1]=0,n=e.heap_max+1;n<573;n++)(s=c[2*c[2*(i=e.heap[n])+1]+1]+1)>f&&(s=f,g++),c[2*i+1]=s,i>u||(e.bl_count[s]++,r=0,i>=h&&(r=p[i-h]),a=c[2*i],e.opt_len+=a*(s+r),d&&(e.static_len+=a*(l[2*i+1]+r)));if(0!==g){do{for(s=f-1;0===e.bl_count[s];)s--;e.bl_count[s]--,e.bl_count[s+1]+=2,e.bl_count[f]--,g-=2}while(g>0);for(s=f;0!==s;s--)for(i=e.bl_count[s];0!==i;)(o=e.heap[--n])>u||(c[2*o+1]!==s&&(e.opt_len+=(s-c[2*o+1])*c[2*o],c[2*o+1]=s),i--)}}(e,t),Cn(s,u,e.bl_count)}function An(e,t,n){var i,o,s=-1,r=t[1],a=0,c=7,u=4;for(0===r&&(c=138,u=3),t[2*(n+1)+1]=65535,i=0;i<=n;i++)o=r,r=t[2*(i+1)+1],++a<c&&o===r||(a<u?e.bl_tree[2*o]+=a:0!==o?(o!==s&&e.bl_tree[2*o]++,e.bl_tree[32]++):a<=10?e.bl_tree[34]++:e.bl_tree[36]++,a=0,s=o,0===r?(c=138,u=3):o===r?(c=6,u=3):(c=7,u=4))}function bn(e,t,n){var i,o,s=-1,r=t[1],a=0,c=7,u=4;for(0===r&&(c=138,u=3),i=0;i<=n;i++)if(o=r,r=t[2*(i+1)+1],!(++a<c&&o===r)){if(a<u)do{Mn(e,o,e.bl_tree)}while(0!=--a);else 0!==o?(o!==s&&(Mn(e,o,e.bl_tree),a--),Mn(e,16,e.bl_tree),yn(e,a-3,2)):a<=10?(Mn(e,17,e.bl_tree),yn(e,a-3,3)):(Mn(e,18,e.bl_tree),yn(e,a-11,7));a=0,s=o,0===r?(c=138,u=3):o===r?(c=6,u=3):(c=7,u=4)}}en(fn);var Ln=!1;function Rn(e,t,n,i){yn(e,0+(i?1:0),3),function(e,t,n,i){kn(e),mn(e,n),mn(e,~n),Jt(e.pending_buf,e.window,t,n,e.pending),e.pending+=n}(e,t,n)}function On(e,t,n){return e.pending_buf[e.d_buf+2*e.last_lit]=t>>>8&255,e.pending_buf[e.d_buf+2*e.last_lit+1]=255&t,e.pending_buf[e.l_buf+e.last_lit]=255&n,e.last_lit++,0===t?e.dyn_ltree[2*n]++:(e.matches++,t--,e.dyn_ltree[2*(un[n]+256+1)]++,e.dyn_dtree[2*vn(t)]++),e.last_lit===e.lit_bufsize-1}function Nn(e,t,n,i){for(var o=65535&e|0,s=e>>>16&65535|0,r=0;0!==n;){n-=r=n>2e3?2e3:n;do{s=s+(o=o+t[i++]|0)|0}while(--r);o%=65521,s%=65521}return o|s<<16|0}var Pn=function(){for(var e,t=[],n=0;n<256;n++){e=n;for(var i=0;i<8;i++)e=1&e?3988292384^e>>>1:e>>>1;t[n]=e}return t}();function Un(e,t,n,i){var o=Pn,s=i+n;e^=-1;for(var r=i;r<s;r++)e=e>>>8^o[255&(e^t[r])];return-1^e}var Gn,xn=258,Fn=262;function qn(e,t){return e.msg=Yt[t],t}function Bn(e){return(e<<1)-(e>4?9:0)}function $n(e){for(var t=e.length;--t>=0;)e[t]=0}function Vn(e){var t=e.state,n=t.pending;n>e.avail_out&&(n=e.avail_out),0!==n&&(Jt(e.output,t.pending_buf,t.pending_out,n,e.next_out),e.next_out+=n,t.pending_out+=n,e.total_out+=n,e.avail_out-=n,t.pending-=n,0===t.pending&&(t.pending_out=0))}function Hn(e,t){(function(e,t,n,i){var o,s,r=0;e.level>0?(2===e.strm.data_type&&(e.strm.data_type=function(e){var t,n=4093624447;for(t=0;t<=31;t++,n>>>=1)if(1&n&&0!==e.dyn_ltree[2*t])return 0;if(0!==e.dyn_ltree[18]||0!==e.dyn_ltree[20]||0!==e.dyn_ltree[26])return 1;for(t=32;t<256;t++)if(0!==e.dyn_ltree[2*t])return 1;return 0}(e)),wn(e,e.l_desc),wn(e,e.d_desc),r=function(e){var t;for(An(e,e.dyn_ltree,e.l_desc.max_code),An(e,e.dyn_dtree,e.d_desc.max_code),wn(e,e.bl_desc),t=18;t>=3&&0===e.bl_tree[2*sn[t]+1];t--);return e.opt_len+=3*(t+1)+5+5+4,t}(e),o=e.opt_len+3+7>>>3,(s=e.static_len+3+7>>>3)<=o&&(o=s)):o=s=n+5,n+4<=o&&-1!==t?Rn(e,t,n,i):4===e.strategy||s===o?(yn(e,2+(i?1:0),3),Dn(e,rn,an)):(yn(e,4+(i?1:0),3),function(e,t,n,i){var o;for(yn(e,t-257,5),yn(e,n-1,5),yn(e,i-4,4),o=0;o<i;o++)yn(e,e.bl_tree[2*sn[o]+1],3);bn(e,e.dyn_ltree,t-1),bn(e,e.dyn_dtree,n-1)}(e,e.l_desc.max_code+1,e.d_desc.max_code+1,r+1),Dn(e,e.dyn_ltree,e.dyn_dtree)),Tn(e),i&&kn(e)})(e,e.block_start>=0?e.block_start:-1,e.strstart-e.block_start,t),e.block_start=e.strstart,Vn(e.strm)}function Kn(e,t){e.pending_buf[e.pending++]=t}function jn(e,t){e.pending_buf[e.pending++]=t>>>8&255,e.pending_buf[e.pending++]=255&t}function zn(e,t){var n,i,o=e.max_chain_length,s=e.strstart,r=e.prev_length,a=e.nice_match,c=e.strstart>e.w_size-Fn?e.strstart-(e.w_size-Fn):0,u=e.window,l=e.w_mask,d=e.prev,p=e.strstart+xn,h=u[s+r-1],f=u[s+r];e.prev_length>=e.good_match&&(o>>=2),a>e.lookahead&&(a=e.lookahead);do{if(u[(n=t)+r]===f&&u[n+r-1]===h&&u[n]===u[s]&&u[++n]===u[s+1]){s+=2,n++;do{}while(u[++s]===u[++n]&&u[++s]===u[++n]&&u[++s]===u[++n]&&u[++s]===u[++n]&&u[++s]===u[++n]&&u[++s]===u[++n]&&u[++s]===u[++n]&&u[++s]===u[++n]&&s<p);if(i=xn-(p-s),s=p-xn,i>r){if(e.match_start=t,r=i,i>=a)break;h=u[s+r-1],f=u[s+r]}}}while((t=d[t&l])>c&&0!=--o);return r<=e.lookahead?r:e.lookahead}function Yn(e){var t,n,i,o,s,r,a,c,u,l,d=e.w_size;do{if(o=e.window_size-e.lookahead-e.strstart,e.strstart>=d+(d-Fn)){Jt(e.window,e.window,d,d,0),e.match_start-=d,e.strstart-=d,e.block_start-=d,t=n=e.hash_size;do{i=e.head[--t],e.head[t]=i>=d?i-d:0}while(--n);t=n=d;do{i=e.prev[--t],e.prev[t]=i>=d?i-d:0}while(--n);o+=d}if(0===e.strm.avail_in)break;if(r=e.strm,a=e.window,c=e.strstart+e.lookahead,u=o,l=void 0,(l=r.avail_in)>u&&(l=u),n=0===l?0:(r.avail_in-=l,Jt(a,r.input,r.next_in,l,c),1===r.state.wrap?r.adler=Nn(r.adler,a,l,c):2===r.state.wrap&&(r.adler=Un(r.adler,a,l,c)),r.next_in+=l,r.total_in+=l,l),e.lookahead+=n,e.lookahead+e.insert>=3)for(s=e.strstart-e.insert,e.ins_h=e.window[s],e.ins_h=(e.ins_h<<e.hash_shift^e.window[s+1])&e.hash_mask;e.insert&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[s+3-1])&e.hash_mask,e.prev[s&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=s,s++,e.insert--,!(e.lookahead+e.insert<3)););}while(e.lookahead<Fn&&0!==e.strm.avail_in)}function Wn(e,t){for(var n,i;;){if(e.lookahead<Fn){if(Yn(e),e.lookahead<Fn&&0===t)return 1;if(0===e.lookahead)break}if(n=0,e.lookahead>=3&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+3-1])&e.hash_mask,n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),0!==n&&e.strstart-n<=e.w_size-Fn&&(e.match_length=zn(e,n)),e.match_length>=3)if(i=On(e,e.strstart-e.match_start,e.match_length-3),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=3){e.match_length--;do{e.strstart++,e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+3-1])&e.hash_mask,n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart}while(0!=--e.match_length);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+1])&e.hash_mask;else i=On(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(i&&(Hn(e,!1),0===e.strm.avail_out))return 1}return e.insert=e.strstart<2?e.strstart:2,4===t?(Hn(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(Hn(e,!1),0===e.strm.avail_out)?1:2}function Jn(e,t){for(var n,i,o;;){if(e.lookahead<Fn){if(Yn(e),e.lookahead<Fn&&0===t)return 1;if(0===e.lookahead)break}if(n=0,e.lookahead>=3&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+3-1])&e.hash_mask,n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=2,0!==n&&e.prev_length<e.max_lazy_match&&e.strstart-n<=e.w_size-Fn&&(e.match_length=zn(e,n),e.match_length<=5&&(1===e.strategy||3===e.match_length&&e.strstart-e.match_start>4096)&&(e.match_length=2)),e.prev_length>=3&&e.match_length<=e.prev_length){o=e.strstart+e.lookahead-3,i=On(e,e.strstart-1-e.prev_match,e.prev_length-3),e.lookahead-=e.prev_length-1,e.prev_length-=2;do{++e.strstart<=o&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+3-1])&e.hash_mask,n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart)}while(0!=--e.prev_length);if(e.match_available=0,e.match_length=2,e.strstart++,i&&(Hn(e,!1),0===e.strm.avail_out))return 1}else if(e.match_available){if((i=On(e,0,e.window[e.strstart-1]))&&Hn(e,!1),e.strstart++,e.lookahead--,0===e.strm.avail_out)return 1}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(i=On(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<2?e.strstart:2,4===t?(Hn(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(Hn(e,!1),0===e.strm.avail_out)?1:2}function Xn(e,t,n,i,o){this.good_length=e,this.max_lazy=t,this.nice_length=n,this.max_chain=i,this.func=o}function Zn(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=8,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Zt(1146),this.dyn_dtree=new Zt(122),this.bl_tree=new Zt(78),$n(this.dyn_ltree),$n(this.dyn_dtree),$n(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Zt(16),this.heap=new Zt(573),$n(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Zt(573),$n(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function Qn(e){var t,n=function(e){var t;return e&&e.state?(e.total_in=e.total_out=0,e.data_type=2,(t=e.state).pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=t.wrap?42:113,e.adler=2===t.wrap?0:1,t.last_flush=0,function(e){Ln||(function(){var e,t,n,i,o,s=new Array(16);for(n=0,i=0;i<28;i++)for(ln[i]=n,e=0;e<1<<tn[i];e++)un[n++]=i;for(un[n-1]=i,o=0,i=0;i<16;i++)for(fn[i]=o,e=0;e<1<<nn[i];e++)cn[o++]=i;for(o>>=7;i<30;i++)for(fn[i]=o<<7,e=0;e<1<<nn[i]-7;e++)cn[256+o++]=i;for(t=0;t<=15;t++)s[t]=0;for(e=0;e<=143;)rn[2*e+1]=8,e++,s[8]++;for(;e<=255;)rn[2*e+1]=9,e++,s[9]++;for(;e<=279;)rn[2*e+1]=7,e++,s[7]++;for(;e<=287;)rn[2*e+1]=8,e++,s[8]++;for(Cn(rn,287,s),e=0;e<30;e++)an[2*e+1]=5,an[2*e]=In(e,5);dn=new gn(rn,tn,257,286,15),pn=new gn(an,nn,0,30,15),hn=new gn(new Array(0),on,0,19,7)}(),Ln=!0),e.l_desc=new _n(e.dyn_ltree,dn),e.d_desc=new _n(e.dyn_dtree,pn),e.bl_desc=new _n(e.bl_tree,hn),e.bi_buf=0,e.bi_valid=0,Tn(e)}(t),0):qn(e,-2)}(e);return 0===n&&((t=e.state).window_size=2*t.w_size,$n(t.head),t.max_lazy_match=Gn[t.level].max_lazy,t.good_match=Gn[t.level].good_length,t.nice_match=Gn[t.level].nice_length,t.max_chain_length=Gn[t.level].max_chain,t.strstart=0,t.block_start=0,t.lookahead=0,t.insert=0,t.match_length=t.prev_length=2,t.match_available=0,t.ins_h=0),n}function ei(e,t){var n,i,o,s;if(!e||!e.state||t>5||t<0)return e?qn(e,-2):-2;if(i=e.state,!e.output||!e.input&&0!==e.avail_in||666===i.status&&4!==t)return qn(e,0===e.avail_out?-5:-2);if(i.strm=e,n=i.last_flush,i.last_flush=t,42===i.status)if(2===i.wrap)e.adler=0,Kn(i,31),Kn(i,139),Kn(i,8),i.gzhead?(Kn(i,(i.gzhead.text?1:0)+(i.gzhead.hcrc?2:0)+(i.gzhead.extra?4:0)+(i.gzhead.name?8:0)+(i.gzhead.comment?16:0)),Kn(i,255&i.gzhead.time),Kn(i,i.gzhead.time>>8&255),Kn(i,i.gzhead.time>>16&255),Kn(i,i.gzhead.time>>24&255),Kn(i,9===i.level?2:i.strategy>=2||i.level<2?4:0),Kn(i,255&i.gzhead.os),i.gzhead.extra&&i.gzhead.extra.length&&(Kn(i,255&i.gzhead.extra.length),Kn(i,i.gzhead.extra.length>>8&255)),i.gzhead.hcrc&&(e.adler=Un(e.adler,i.pending_buf,i.pending,0)),i.gzindex=0,i.status=69):(Kn(i,0),Kn(i,0),Kn(i,0),Kn(i,0),Kn(i,0),Kn(i,9===i.level?2:i.strategy>=2||i.level<2?4:0),Kn(i,3),i.status=113);else{var r=8+(i.w_bits-8<<4)<<8;r|=(i.strategy>=2||i.level<2?0:i.level<6?1:6===i.level?2:3)<<6,0!==i.strstart&&(r|=32),r+=31-r%31,i.status=113,jn(i,r),0!==i.strstart&&(jn(i,e.adler>>>16),jn(i,65535&e.adler)),e.adler=1}if(69===i.status)if(i.gzhead.extra){for(o=i.pending;i.gzindex<(65535&i.gzhead.extra.length)&&(i.pending!==i.pending_buf_size||(i.gzhead.hcrc&&i.pending>o&&(e.adler=Un(e.adler,i.pending_buf,i.pending-o,o)),Vn(e),o=i.pending,i.pending!==i.pending_buf_size));)Kn(i,255&i.gzhead.extra[i.gzindex]),i.gzindex++;i.gzhead.hcrc&&i.pending>o&&(e.adler=Un(e.adler,i.pending_buf,i.pending-o,o)),i.gzindex===i.gzhead.extra.length&&(i.gzindex=0,i.status=73)}else i.status=73;if(73===i.status)if(i.gzhead.name){o=i.pending;do{if(i.pending===i.pending_buf_size&&(i.gzhead.hcrc&&i.pending>o&&(e.adler=Un(e.adler,i.pending_buf,i.pending-o,o)),Vn(e),o=i.pending,i.pending===i.pending_buf_size)){s=1;break}s=i.gzindex<i.gzhead.name.length?255&i.gzhead.name.charCodeAt(i.gzindex++):0,Kn(i,s)}while(0!==s);i.gzhead.hcrc&&i.pending>o&&(e.adler=Un(e.adler,i.pending_buf,i.pending-o,o)),0===s&&(i.gzindex=0,i.status=91)}else i.status=91;if(91===i.status)if(i.gzhead.comment){o=i.pending;do{if(i.pending===i.pending_buf_size&&(i.gzhead.hcrc&&i.pending>o&&(e.adler=Un(e.adler,i.pending_buf,i.pending-o,o)),Vn(e),o=i.pending,i.pending===i.pending_buf_size)){s=1;break}s=i.gzindex<i.gzhead.comment.length?255&i.gzhead.comment.charCodeAt(i.gzindex++):0,Kn(i,s)}while(0!==s);i.gzhead.hcrc&&i.pending>o&&(e.adler=Un(e.adler,i.pending_buf,i.pending-o,o)),0===s&&(i.status=103)}else i.status=103;if(103===i.status&&(i.gzhead.hcrc?(i.pending+2>i.pending_buf_size&&Vn(e),i.pending+2<=i.pending_buf_size&&(Kn(i,255&e.adler),Kn(i,e.adler>>8&255),e.adler=0,i.status=113)):i.status=113),0!==i.pending){if(Vn(e),0===e.avail_out)return i.last_flush=-1,0}else if(0===e.avail_in&&Bn(t)<=Bn(n)&&4!==t)return qn(e,-5);if(666===i.status&&0!==e.avail_in)return qn(e,-5);if(0!==e.avail_in||0!==i.lookahead||0!==t&&666!==i.status){var a=2===i.strategy?function(e,t){for(var n;;){if(0===e.lookahead&&(Yn(e),0===e.lookahead)){if(0===t)return 1;break}if(e.match_length=0,n=On(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++,n&&(Hn(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,4===t?(Hn(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(Hn(e,!1),0===e.strm.avail_out)?1:2}(i,t):3===i.strategy?function(e,t){for(var n,i,o,s,r=e.window;;){if(e.lookahead<=xn){if(Yn(e),e.lookahead<=xn&&0===t)return 1;if(0===e.lookahead)break}if(e.match_length=0,e.lookahead>=3&&e.strstart>0&&(i=r[o=e.strstart-1])===r[++o]&&i===r[++o]&&i===r[++o]){s=e.strstart+xn;do{}while(i===r[++o]&&i===r[++o]&&i===r[++o]&&i===r[++o]&&i===r[++o]&&i===r[++o]&&i===r[++o]&&i===r[++o]&&o<s);e.match_length=xn-(s-o),e.match_length>e.lookahead&&(e.match_length=e.lookahead)}if(e.match_length>=3?(n=On(e,1,e.match_length-3),e.lookahead-=e.match_length,e.strstart+=e.match_length,e.match_length=0):(n=On(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++),n&&(Hn(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,4===t?(Hn(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(Hn(e,!1),0===e.strm.avail_out)?1:2}(i,t):Gn[i.level].func(i,t);if(3!==a&&4!==a||(i.status=666),1===a||3===a)return 0===e.avail_out&&(i.last_flush=-1),0;if(2===a&&(1===t?function(e){yn(e,2,3),Mn(e,256,rn),function(e){16===e.bi_valid?(mn(e,e.bi_buf),e.bi_buf=0,e.bi_valid=0):e.bi_valid>=8&&(e.pending_buf[e.pending++]=255&e.bi_buf,e.bi_buf>>=8,e.bi_valid-=8)}(e)}(i):5!==t&&(Rn(i,0,0,!1),3===t&&($n(i.head),0===i.lookahead&&(i.strstart=0,i.block_start=0,i.insert=0))),Vn(e),0===e.avail_out))return i.last_flush=-1,0}return 4!==t?0:i.wrap<=0?1:(2===i.wrap?(Kn(i,255&e.adler),Kn(i,e.adler>>8&255),Kn(i,e.adler>>16&255),Kn(i,e.adler>>24&255),Kn(i,255&e.total_in),Kn(i,e.total_in>>8&255),Kn(i,e.total_in>>16&255),Kn(i,e.total_in>>24&255)):(jn(i,e.adler>>>16),jn(i,65535&e.adler)),Vn(e),i.wrap>0&&(i.wrap=-i.wrap),0!==i.pending?0:1)}Gn=[new Xn(0,0,0,0,(function(e,t){var n=65535;for(n>e.pending_buf_size-5&&(n=e.pending_buf_size-5);;){if(e.lookahead<=1){if(Yn(e),0===e.lookahead&&0===t)return 1;if(0===e.lookahead)break}e.strstart+=e.lookahead,e.lookahead=0;var i=e.block_start+n;if((0===e.strstart||e.strstart>=i)&&(e.lookahead=e.strstart-i,e.strstart=i,Hn(e,!1),0===e.strm.avail_out))return 1;if(e.strstart-e.block_start>=e.w_size-Fn&&(Hn(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,4===t?(Hn(e,!0),0===e.strm.avail_out?3:4):(e.strstart>e.block_start&&(Hn(e,!1),e.strm.avail_out),1)})),new Xn(4,4,8,4,Wn),new Xn(4,5,16,8,Wn),new Xn(4,6,32,32,Wn),new Xn(4,4,16,16,Jn),new Xn(8,16,32,32,Jn),new Xn(8,16,128,128,Jn),new Xn(8,32,128,256,Jn),new Xn(32,128,258,1024,Jn),new Xn(32,258,258,4096,Jn)];function ti(e,t){var n,i,o,s,r,a,c,u,l,d,p,h,f,g,_,v,m,y,M,I,C,T,k,S,E;n=e.state,i=e.next_in,S=e.input,o=i+(e.avail_in-5),s=e.next_out,E=e.output,r=s-(t-e.avail_out),a=s+(e.avail_out-257),c=n.dmax,u=n.wsize,l=n.whave,d=n.wnext,p=n.window,h=n.hold,f=n.bits,g=n.lencode,_=n.distcode,v=(1<<n.lenbits)-1,m=(1<<n.distbits)-1;e:do{f<15&&(h+=S[i++]<<f,f+=8,h+=S[i++]<<f,f+=8),y=g[h&v];t:for(;;){if(h>>>=M=y>>>24,f-=M,0===(M=y>>>16&255))E[s++]=65535&y;else{if(!(16&M)){if(0==(64&M)){y=g[(65535&y)+(h&(1<<M)-1)];continue t}if(32&M){n.mode=12;break e}e.msg="invalid literal/length code",n.mode=30;break e}I=65535&y,(M&=15)&&(f<M&&(h+=S[i++]<<f,f+=8),I+=h&(1<<M)-1,h>>>=M,f-=M),f<15&&(h+=S[i++]<<f,f+=8,h+=S[i++]<<f,f+=8),y=_[h&m];n:for(;;){if(h>>>=M=y>>>24,f-=M,!(16&(M=y>>>16&255))){if(0==(64&M)){y=_[(65535&y)+(h&(1<<M)-1)];continue n}e.msg="invalid distance code",n.mode=30;break e}if(C=65535&y,f<(M&=15)&&(h+=S[i++]<<f,(f+=8)<M&&(h+=S[i++]<<f,f+=8)),(C+=h&(1<<M)-1)>c){e.msg="invalid distance too far back",n.mode=30;break e}if(h>>>=M,f-=M,C>(M=s-r)){if((M=C-M)>l&&n.sane){e.msg="invalid distance too far back",n.mode=30;break e}if(T=0,k=p,0===d){if(T+=u-M,M<I){I-=M;do{E[s++]=p[T++]}while(--M);T=s-C,k=E}}else if(d<M){if(T+=u+d-M,(M-=d)<I){I-=M;do{E[s++]=p[T++]}while(--M);if(T=0,d<I){I-=M=d;do{E[s++]=p[T++]}while(--M);T=s-C,k=E}}}else if(T+=d-M,M<I){I-=M;do{E[s++]=p[T++]}while(--M);T=s-C,k=E}for(;I>2;)E[s++]=k[T++],E[s++]=k[T++],E[s++]=k[T++],I-=3;I&&(E[s++]=k[T++],I>1&&(E[s++]=k[T++]))}else{T=s-C;do{E[s++]=E[T++],E[s++]=E[T++],E[s++]=E[T++],I-=3}while(I>2);I&&(E[s++]=E[T++],I>1&&(E[s++]=E[T++]))}break}}break}}while(i<o&&s<a);i-=I=f>>3,h&=(1<<(f-=I<<3))-1,e.next_in=i,e.next_out=s,e.avail_in=i<o?o-i+5:5-(i-o),e.avail_out=s<a?a-s+257:257-(s-a),n.hold=h,n.bits=f}var ni=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],ii=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],oi=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],si=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];function ri(e,t,n,i,o,s,r,a){var c,u,l,d,p,h,f,g,_,v=a.bits,m=0,y=0,M=0,I=0,C=0,T=0,k=0,S=0,E=0,D=0,w=null,A=0,b=new Zt(16),L=new Zt(16),R=null,O=0;for(m=0;m<=15;m++)b[m]=0;for(y=0;y<i;y++)b[t[n+y]]++;for(C=v,I=15;I>=1&&0===b[I];I--);if(C>I&&(C=I),0===I)return o[s++]=20971520,o[s++]=20971520,a.bits=1,0;for(M=1;M<I&&0===b[M];M++);for(C<M&&(C=M),S=1,m=1;m<=15;m++)if(S<<=1,(S-=b[m])<0)return-1;if(S>0&&(0===e||1!==I))return-1;for(L[1]=0,m=1;m<15;m++)L[m+1]=L[m]+b[m];for(y=0;y<i;y++)0!==t[n+y]&&(r[L[t[n+y]]++]=y);if(0===e?(w=R=r,h=19):1===e?(w=ni,A-=257,R=ii,O-=257,h=256):(w=oi,R=si,h=-1),D=0,y=0,m=M,p=s,T=C,k=0,l=-1,d=(E=1<<C)-1,1===e&&E>852||2===e&&E>592)return 1;for(;;){f=m-k,r[y]<h?(g=0,_=r[y]):r[y]>h?(g=R[O+r[y]],_=w[A+r[y]]):(g=96,_=0),c=1<<m-k,M=u=1<<T;do{o[p+(D>>k)+(u-=c)]=f<<24|g<<16|_|0}while(0!==u);for(c=1<<m-1;D&c;)c>>=1;if(0!==c?(D&=c-1,D+=c):D=0,y++,0==--b[m]){if(m===I)break;m=t[n+r[y]]}if(m>C&&(D&d)!==l){for(0===k&&(k=C),p+=M,S=1<<(T=m-k);T+k<I&&!((S-=b[T+k])<=0);)T++,S<<=1;if(E+=1<<T,1===e&&E>852||2===e&&E>592)return 1;o[l=D&d]=C<<24|T<<16|p-s|0}}return 0!==D&&(o[p+D]=m-k<<24|64<<16|0),a.bits=C,0}function ai(e){return(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24)}function ci(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Zt(320),this.work=new Zt(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function ui(e){var t;return e&&e.state?((t=e.state).wsize=0,t.whave=0,t.wnext=0,function(e){var t;return e&&e.state?(t=e.state,e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=1&t.wrap),t.mode=1,t.last=0,t.havedict=0,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new Qt(852),t.distcode=t.distdyn=new Qt(592),t.sane=1,t.back=-1,0):-2}(e)):-2}var li,di,pi=!0;function hi(e){if(pi){var t;for(li=new Qt(512),di=new Qt(32),t=0;t<144;)e.lens[t++]=8;for(;t<256;)e.lens[t++]=9;for(;t<280;)e.lens[t++]=7;for(;t<288;)e.lens[t++]=8;for(ri(1,e.lens,0,288,li,0,e.work,{bits:9}),t=0;t<32;)e.lens[t++]=5;ri(2,e.lens,0,32,di,0,e.work,{bits:5}),pi=!1}e.lencode=li,e.lenbits=9,e.distcode=di,e.distbits=5}var fi;function gi(e){if(e<1||e>7)throw new TypeError("Bad argument");this.mode=e,this.init_done=!1,this.write_in_progress=!1,this.pending_close=!1,this.windowBits=0,this.level=0,this.memLevel=0,this.strategy=0,this.dictionary=null}function _i(e,t){for(var n=0;n<e.length;n++)this[t+n]=e[n]}gi.prototype.init=function(e,t,n,i,o){var s;switch(this.windowBits=e,this.level=t,this.memLevel=n,this.strategy=i,3!==this.mode&&4!==this.mode||(this.windowBits+=16),7===this.mode&&(this.windowBits+=32),5!==this.mode&&6!==this.mode||(this.windowBits=-this.windowBits),this.strm=new Wt,this.mode){case 1:case 3:case 5:s=function(e,t,n,i,o,s){if(!e)return-2;var r=1;if(-1===t&&(t=6),i<0?(r=0,i=-i):i>15&&(r=2,i-=16),o<1||o>9||i<8||i>15||t<0||t>9||s<0||s>4)return qn(e,-2);8===i&&(i=9);var a=new Zn;return e.state=a,a.strm=e,a.wrap=r,a.gzhead=null,a.w_bits=i,a.w_size=1<<a.w_bits,a.w_mask=a.w_size-1,a.hash_bits=o+7,a.hash_size=1<<a.hash_bits,a.hash_mask=a.hash_size-1,a.hash_shift=~~((a.hash_bits+3-1)/3),a.window=new Xt(2*a.w_size),a.head=new Zt(a.hash_size),a.prev=new Zt(a.w_size),a.lit_bufsize=1<<o+6,a.pending_buf_size=4*a.lit_bufsize,a.pending_buf=new Xt(a.pending_buf_size),a.d_buf=1*a.lit_bufsize,a.l_buf=3*a.lit_bufsize,a.level=t,a.strategy=s,a.method=8,Qn(e)}(this.strm,this.level,0,this.windowBits,this.memLevel,this.strategy);break;case 2:case 4:case 6:case 7:s=function(e,t){var n,i;return e?(i=new ci,e.state=i,i.window=null,0!==(n=function(e,t){var n,i;return e&&e.state?(i=e.state,t<0?(n=0,t=-t):(n=1+(t>>4),t<48&&(t&=15)),t&&(t<8||t>15)?-2:(null!==i.window&&i.wbits!==t&&(i.window=null),i.wrap=n,i.wbits=t,ui(e))):-2}(e,t))&&(e.state=null),n):-2}(this.strm,this.windowBits);break;default:throw new Error("Unknown mode "+this.mode)}0===s?(this.write_in_progress=!1,this.init_done=!0):this._error(s)},gi.prototype.params=function(){throw new Error("deflateParams Not supported")},gi.prototype._writeCheck=function(){if(!this.init_done)throw new Error("write before init");if(0===this.mode)throw new Error("already finalized");if(this.write_in_progress)throw new Error("write already in progress");if(this.pending_close)throw new Error("close is pending")},gi.prototype.write=function(e,t,n,i,o,s,r){this._writeCheck(),this.write_in_progress=!0;var a=this;return Ie((function(){a.write_in_progress=!1;var c=a._write(e,t,n,i,o,s,r);a.callback(c[0],c[1]),a.pending_close&&a.close()})),this},gi.prototype.writeSync=function(e,t,n,i,o,s,r){return this._writeCheck(),this._write(e,t,n,i,o,s,r)},gi.prototype._write=function(e,t,n,i,o,s,r){if(this.write_in_progress=!0,0!==e&&1!==e&&2!==e&&3!==e&&4!==e&&5!==e)throw new Error("Invalid flush value");null==t&&(t=new C(0),i=0,n=0),o._set?o.set=o._set:o.set=_i;var a,c=this.strm;switch(c.avail_in=i,c.input=t,c.next_in=n,c.avail_out=r,c.output=o,c.next_out=s,this.mode){case 1:case 3:case 5:a=ei(c,e);break;case 7:case 2:case 4:case 6:a=function(e,t){var n,i,o,s,r,a,c,u,l,d,p,h,f,g,_,v,m,y,M,I,C,T,k,S,E=0,D=new Xt(4),w=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!e||!e.state||!e.output||!e.input&&0!==e.avail_in)return-2;12===(n=e.state).mode&&(n.mode=13),r=e.next_out,o=e.output,c=e.avail_out,s=e.next_in,i=e.input,a=e.avail_in,u=n.hold,l=n.bits,d=a,p=c,T=0;e:for(;;)switch(n.mode){case 1:if(0===n.wrap){n.mode=13;break}for(;l<16;){if(0===a)break e;a--,u+=i[s++]<<l,l+=8}if(2&n.wrap&&35615===u){n.check=0,D[0]=255&u,D[1]=u>>>8&255,n.check=Un(n.check,D,2,0),u=0,l=0,n.mode=2;break}if(n.flags=0,n.head&&(n.head.done=!1),!(1&n.wrap)||(((255&u)<<8)+(u>>8))%31){e.msg="incorrect header check",n.mode=30;break}if(8!==(15&u)){e.msg="unknown compression method",n.mode=30;break}if(l-=4,C=8+(15&(u>>>=4)),0===n.wbits)n.wbits=C;else if(C>n.wbits){e.msg="invalid window size",n.mode=30;break}n.dmax=1<<C,e.adler=n.check=1,n.mode=512&u?10:12,u=0,l=0;break;case 2:for(;l<16;){if(0===a)break e;a--,u+=i[s++]<<l,l+=8}if(n.flags=u,8!==(255&n.flags)){e.msg="unknown compression method",n.mode=30;break}if(57344&n.flags){e.msg="unknown header flags set",n.mode=30;break}n.head&&(n.head.text=u>>8&1),512&n.flags&&(D[0]=255&u,D[1]=u>>>8&255,n.check=Un(n.check,D,2,0)),u=0,l=0,n.mode=3;case 3:for(;l<32;){if(0===a)break e;a--,u+=i[s++]<<l,l+=8}n.head&&(n.head.time=u),512&n.flags&&(D[0]=255&u,D[1]=u>>>8&255,D[2]=u>>>16&255,D[3]=u>>>24&255,n.check=Un(n.check,D,4,0)),u=0,l=0,n.mode=4;case 4:for(;l<16;){if(0===a)break e;a--,u+=i[s++]<<l,l+=8}n.head&&(n.head.xflags=255&u,n.head.os=u>>8),512&n.flags&&(D[0]=255&u,D[1]=u>>>8&255,n.check=Un(n.check,D,2,0)),u=0,l=0,n.mode=5;case 5:if(1024&n.flags){for(;l<16;){if(0===a)break e;a--,u+=i[s++]<<l,l+=8}n.length=u,n.head&&(n.head.extra_len=u),512&n.flags&&(D[0]=255&u,D[1]=u>>>8&255,n.check=Un(n.check,D,2,0)),u=0,l=0}else n.head&&(n.head.extra=null);n.mode=6;case 6:if(1024&n.flags&&((h=n.length)>a&&(h=a),h&&(n.head&&(C=n.head.extra_len-n.length,n.head.extra||(n.head.extra=new Array(n.head.extra_len)),Jt(n.head.extra,i,s,h,C)),512&n.flags&&(n.check=Un(n.check,i,h,s)),a-=h,s+=h,n.length-=h),n.length))break e;n.length=0,n.mode=7;case 7:if(2048&n.flags){if(0===a)break e;h=0;do{C=i[s+h++],n.head&&C&&n.length<65536&&(n.head.name+=String.fromCharCode(C))}while(C&&h<a);if(512&n.flags&&(n.check=Un(n.check,i,h,s)),a-=h,s+=h,C)break e}else n.head&&(n.head.name=null);n.length=0,n.mode=8;case 8:if(4096&n.flags){if(0===a)break e;h=0;do{C=i[s+h++],n.head&&C&&n.length<65536&&(n.head.comment+=String.fromCharCode(C))}while(C&&h<a);if(512&n.flags&&(n.check=Un(n.check,i,h,s)),a-=h,s+=h,C)break e}else n.head&&(n.head.comment=null);n.mode=9;case 9:if(512&n.flags){for(;l<16;){if(0===a)break e;a--,u+=i[s++]<<l,l+=8}if(u!==(65535&n.check)){e.msg="header crc mismatch",n.mode=30;break}u=0,l=0}n.head&&(n.head.hcrc=n.flags>>9&1,n.head.done=!0),e.adler=n.check=0,n.mode=12;break;case 10:for(;l<32;){if(0===a)break e;a--,u+=i[s++]<<l,l+=8}e.adler=n.check=ai(u),u=0,l=0,n.mode=11;case 11:if(0===n.havedict)return e.next_out=r,e.avail_out=c,e.next_in=s,e.avail_in=a,n.hold=u,n.bits=l,2;e.adler=n.check=1,n.mode=12;case 12:if(5===t||6===t)break e;case 13:if(n.last){u>>>=7&l,l-=7&l,n.mode=27;break}for(;l<3;){if(0===a)break e;a--,u+=i[s++]<<l,l+=8}switch(n.last=1&u,l-=1,3&(u>>>=1)){case 0:n.mode=14;break;case 1:if(hi(n),n.mode=20,6===t){u>>>=2,l-=2;break e}break;case 2:n.mode=17;break;case 3:e.msg="invalid block type",n.mode=30}u>>>=2,l-=2;break;case 14:for(u>>>=7&l,l-=7&l;l<32;){if(0===a)break e;a--,u+=i[s++]<<l,l+=8}if((65535&u)!=(u>>>16^65535)){e.msg="invalid stored block lengths",n.mode=30;break}if(n.length=65535&u,u=0,l=0,n.mode=15,6===t)break e;case 15:n.mode=16;case 16:if(h=n.length){if(h>a&&(h=a),h>c&&(h=c),0===h)break e;Jt(o,i,s,h,r),a-=h,s+=h,c-=h,r+=h,n.length-=h;break}n.mode=12;break;case 17:for(;l<14;){if(0===a)break e;a--,u+=i[s++]<<l,l+=8}if(n.nlen=257+(31&u),u>>>=5,l-=5,n.ndist=1+(31&u),u>>>=5,l-=5,n.ncode=4+(15&u),u>>>=4,l-=4,n.nlen>286||n.ndist>30){e.msg="too many length or distance symbols",n.mode=30;break}n.have=0,n.mode=18;case 18:for(;n.have<n.ncode;){for(;l<3;){if(0===a)break e;a--,u+=i[s++]<<l,l+=8}n.lens[w[n.have++]]=7&u,u>>>=3,l-=3}for(;n.have<19;)n.lens[w[n.have++]]=0;if(n.lencode=n.lendyn,n.lenbits=7,k={bits:n.lenbits},T=ri(0,n.lens,0,19,n.lencode,0,n.work,k),n.lenbits=k.bits,T){e.msg="invalid code lengths set",n.mode=30;break}n.have=0,n.mode=19;case 19:for(;n.have<n.nlen+n.ndist;){for(;v=(E=n.lencode[u&(1<<n.lenbits)-1])>>>16&255,m=65535&E,!((_=E>>>24)<=l);){if(0===a)break e;a--,u+=i[s++]<<l,l+=8}if(m<16)u>>>=_,l-=_,n.lens[n.have++]=m;else{if(16===m){for(S=_+2;l<S;){if(0===a)break e;a--,u+=i[s++]<<l,l+=8}if(u>>>=_,l-=_,0===n.have){e.msg="invalid bit length repeat",n.mode=30;break}C=n.lens[n.have-1],h=3+(3&u),u>>>=2,l-=2}else if(17===m){for(S=_+3;l<S;){if(0===a)break e;a--,u+=i[s++]<<l,l+=8}l-=_,C=0,h=3+(7&(u>>>=_)),u>>>=3,l-=3}else{for(S=_+7;l<S;){if(0===a)break e;a--,u+=i[s++]<<l,l+=8}l-=_,C=0,h=11+(127&(u>>>=_)),u>>>=7,l-=7}if(n.have+h>n.nlen+n.ndist){e.msg="invalid bit length repeat",n.mode=30;break}for(;h--;)n.lens[n.have++]=C}}if(30===n.mode)break;if(0===n.lens[256]){e.msg="invalid code -- missing end-of-block",n.mode=30;break}if(n.lenbits=9,k={bits:n.lenbits},T=ri(1,n.lens,0,n.nlen,n.lencode,0,n.work,k),n.lenbits=k.bits,T){e.msg="invalid literal/lengths set",n.mode=30;break}if(n.distbits=6,n.distcode=n.distdyn,k={bits:n.distbits},T=ri(2,n.lens,n.nlen,n.ndist,n.distcode,0,n.work,k),n.distbits=k.bits,T){e.msg="invalid distances set",n.mode=30;break}if(n.mode=20,6===t)break e;case 20:n.mode=21;case 21:if(a>=6&&c>=258){e.next_out=r,e.avail_out=c,e.next_in=s,e.avail_in=a,n.hold=u,n.bits=l,ti(e,p),r=e.next_out,o=e.output,c=e.avail_out,s=e.next_in,i=e.input,a=e.avail_in,u=n.hold,l=n.bits,12===n.mode&&(n.back=-1);break}for(n.back=0;v=(E=n.lencode[u&(1<<n.lenbits)-1])>>>16&255,m=65535&E,!((_=E>>>24)<=l);){if(0===a)break e;a--,u+=i[s++]<<l,l+=8}if(v&&0==(240&v)){for(y=_,M=v,I=m;v=(E=n.lencode[I+((u&(1<<y+M)-1)>>y)])>>>16&255,m=65535&E,!(y+(_=E>>>24)<=l);){if(0===a)break e;a--,u+=i[s++]<<l,l+=8}u>>>=y,l-=y,n.back+=y}if(u>>>=_,l-=_,n.back+=_,n.length=m,0===v){n.mode=26;break}if(32&v){n.back=-1,n.mode=12;break}if(64&v){e.msg="invalid literal/length code",n.mode=30;break}n.extra=15&v,n.mode=22;case 22:if(n.extra){for(S=n.extra;l<S;){if(0===a)break e;a--,u+=i[s++]<<l,l+=8}n.length+=u&(1<<n.extra)-1,u>>>=n.extra,l-=n.extra,n.back+=n.extra}n.was=n.length,n.mode=23;case 23:for(;v=(E=n.distcode[u&(1<<n.distbits)-1])>>>16&255,m=65535&E,!((_=E>>>24)<=l);){if(0===a)break e;a--,u+=i[s++]<<l,l+=8}if(0==(240&v)){for(y=_,M=v,I=m;v=(E=n.distcode[I+((u&(1<<y+M)-1)>>y)])>>>16&255,m=65535&E,!(y+(_=E>>>24)<=l);){if(0===a)break e;a--,u+=i[s++]<<l,l+=8}u>>>=y,l-=y,n.back+=y}if(u>>>=_,l-=_,n.back+=_,64&v){e.msg="invalid distance code",n.mode=30;break}n.offset=m,n.extra=15&v,n.mode=24;case 24:if(n.extra){for(S=n.extra;l<S;){if(0===a)break e;a--,u+=i[s++]<<l,l+=8}n.offset+=u&(1<<n.extra)-1,u>>>=n.extra,l-=n.extra,n.back+=n.extra}if(n.offset>n.dmax){e.msg="invalid distance too far back",n.mode=30;break}n.mode=25;case 25:if(0===c)break e;if(h=p-c,n.offset>h){if((h=n.offset-h)>n.whave&&n.sane){e.msg="invalid distance too far back",n.mode=30;break}h>n.wnext?(h-=n.wnext,f=n.wsize-h):f=n.wnext-h,h>n.length&&(h=n.length),g=n.window}else g=o,f=r-n.offset,h=n.length;h>c&&(h=c),c-=h,n.length-=h;do{o[r++]=g[f++]}while(--h);0===n.length&&(n.mode=21);break;case 26:if(0===c)break e;o[r++]=n.length,c--,n.mode=21;break;case 27:if(n.wrap){for(;l<32;){if(0===a)break e;a--,u|=i[s++]<<l,l+=8}if(p-=c,e.total_out+=p,n.total+=p,p&&(e.adler=n.check=n.flags?Un(n.check,o,p,r-p):Nn(n.check,o,p,r-p)),p=c,(n.flags?u:ai(u))!==n.check){e.msg="incorrect data check",n.mode=30;break}u=0,l=0}n.mode=28;case 28:if(n.wrap&&n.flags){for(;l<32;){if(0===a)break e;a--,u+=i[s++]<<l,l+=8}if(u!==(4294967295&n.total)){e.msg="incorrect length check",n.mode=30;break}u=0,l=0}n.mode=29;case 29:T=1;break e;case 30:T=-3;break e;case 31:return-4;case 32:default:return-2}return e.next_out=r,e.avail_out=c,e.next_in=s,e.avail_in=a,n.hold=u,n.bits=l,(n.wsize||p!==e.avail_out&&n.mode<30&&(n.mode<27||4!==t))&&function(e,t,n,i){var o,s=e.state;null===s.window&&(s.wsize=1<<s.wbits,s.wnext=0,s.whave=0,s.window=new Xt(s.wsize)),i>=s.wsize?(Jt(s.window,t,n-s.wsize,s.wsize,0),s.wnext=0,s.whave=s.wsize):((o=s.wsize-s.wnext)>i&&(o=i),Jt(s.window,t,n-i,o,s.wnext),(i-=o)?(Jt(s.window,t,n-i,i,0),s.wnext=i,s.whave=s.wsize):(s.wnext+=o,s.wnext===s.wsize&&(s.wnext=0),s.whave<s.wsize&&(s.whave+=o)))}(e,e.output,e.next_out,p-e.avail_out),d-=e.avail_in,p-=e.avail_out,e.total_in+=d,e.total_out+=p,n.total+=p,n.wrap&&p&&(e.adler=n.check=n.flags?Un(n.check,o,p,e.next_out-p):Nn(n.check,o,p,e.next_out-p)),e.data_type=n.bits+(n.last?64:0)+(12===n.mode?128:0)+(20===n.mode||15===n.mode?256:0),(0===d&&0===p||4===t)&&0===T&&(T=-5),T}(c,e);break;default:throw new Error("Unknown mode "+this.mode)}return 1!==a&&0!==a&&this._error(a),this.write_in_progress=!1,[c.avail_in,c.avail_out]},gi.prototype.close=function(){this.write_in_progress?this.pending_close=!0:(this.pending_close=!1,1===this.mode||3===this.mode||5===this.mode?function(e){var t;e&&e.state&&(42!==(t=e.state.status)&&69!==t&&73!==t&&91!==t&&103!==t&&113!==t&&666!==t?qn(e,-2):(e.state=null,113===t&&qn(e,-3)))}(this.strm):function(e){if(!e||!e.state)return-2;var t=e.state;t.window&&(t.window=null),e.state=null}(this.strm),this.mode=0)},gi.prototype.reset=function(){switch(this.mode){case 1:case 5:fi=Qn(this.strm);break;case 2:case 6:fi=ui(this.strm)}0!==fi&&this._error(fi)},gi.prototype._error=function(e){this.onerror(Yt[e]+": "+this.strm.msg,e),this.write_in_progress=!1,this.pending_close&&this.close()};var vi=Object.freeze({NONE:0,DEFLATE:1,INFLATE:2,GZIP:3,GUNZIP:4,DEFLATERAW:5,INFLATERAW:6,UNZIP:7,Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8,Zlib:gi}),mi={};Object.keys(vi).forEach((function(e){mi[e]=vi[e]})),mi.Z_MIN_WINDOWBITS=8,mi.Z_MAX_WINDOWBITS=15,mi.Z_DEFAULT_WINDOWBITS=15,mi.Z_MIN_CHUNK=64,mi.Z_MAX_CHUNK=1/0,mi.Z_DEFAULT_CHUNK=16384,mi.Z_MIN_MEMLEVEL=1,mi.Z_MAX_MEMLEVEL=9,mi.Z_DEFAULT_MEMLEVEL=8,mi.Z_MIN_LEVEL=-1,mi.Z_MAX_LEVEL=9,mi.Z_DEFAULT_LEVEL=mi.Z_DEFAULT_COMPRESSION;var yi={Z_OK:mi.Z_OK,Z_STREAM_END:mi.Z_STREAM_END,Z_NEED_DICT:mi.Z_NEED_DICT,Z_ERRNO:mi.Z_ERRNO,Z_STREAM_ERROR:mi.Z_STREAM_ERROR,Z_DATA_ERROR:mi.Z_DATA_ERROR,Z_MEM_ERROR:mi.Z_MEM_ERROR,Z_BUF_ERROR:mi.Z_BUF_ERROR,Z_VERSION_ERROR:mi.Z_VERSION_ERROR};function Mi(e,t,n){var i=[],o=0;function s(){for(var t;null!==(t=e.read());)i.push(t),o+=t.length;e.once("readable",s)}function r(){var t=C.concat(i,o);i=[],n(null,t),e.close()}e.on("error",(function(t){e.removeListener("end",r),e.removeListener("readable",s),n(t)})),e.on("end",r),e.end(t),s()}function Ii(e,t){if("string"==typeof t&&(t=new C(t)),!se(t))throw new TypeError("Not a string or buffer");var n=mi.Z_FINISH;return e._processChunk(t,n)}function Ci(e){if(!(this instanceof Ci))return new Ci(e);Ai.call(this,e,mi.DEFLATE)}function Ti(e){if(!(this instanceof Ti))return new Ti(e);Ai.call(this,e,mi.INFLATE)}function ki(e){if(!(this instanceof ki))return new ki(e);Ai.call(this,e,mi.GZIP)}function Si(e){if(!(this instanceof Si))return new Si(e);Ai.call(this,e,mi.GUNZIP)}function Ei(e){if(!(this instanceof Ei))return new Ei(e);Ai.call(this,e,mi.DEFLATERAW)}function Di(e){if(!(this instanceof Di))return new Di(e);Ai.call(this,e,mi.INFLATERAW)}function wi(e){if(!(this instanceof wi))return new wi(e);Ai.call(this,e,mi.UNZIP)}function Ai(e,t){if(this._opts=e=e||{},this._chunkSize=e.chunkSize||mi.Z_DEFAULT_CHUNK,Ht.call(this,e),e.flush&&e.flush!==mi.Z_NO_FLUSH&&e.flush!==mi.Z_PARTIAL_FLUSH&&e.flush!==mi.Z_SYNC_FLUSH&&e.flush!==mi.Z_FULL_FLUSH&&e.flush!==mi.Z_FINISH&&e.flush!==mi.Z_BLOCK)throw new Error("Invalid flush flag: "+e.flush);if(this._flushFlag=e.flush||mi.Z_NO_FLUSH,e.chunkSize&&(e.chunkSize<mi.Z_MIN_CHUNK||e.chunkSize>mi.Z_MAX_CHUNK))throw new Error("Invalid chunk size: "+e.chunkSize);if(e.windowBits&&(e.windowBits<mi.Z_MIN_WINDOWBITS||e.windowBits>mi.Z_MAX_WINDOWBITS))throw new Error("Invalid windowBits: "+e.windowBits);if(e.level&&(e.level<mi.Z_MIN_LEVEL||e.level>mi.Z_MAX_LEVEL))throw new Error("Invalid compression level: "+e.level);if(e.memLevel&&(e.memLevel<mi.Z_MIN_MEMLEVEL||e.memLevel>mi.Z_MAX_MEMLEVEL))throw new Error("Invalid memLevel: "+e.memLevel);if(e.strategy&&e.strategy!=mi.Z_FILTERED&&e.strategy!=mi.Z_HUFFMAN_ONLY&&e.strategy!=mi.Z_RLE&&e.strategy!=mi.Z_FIXED&&e.strategy!=mi.Z_DEFAULT_STRATEGY)throw new Error("Invalid strategy: "+e.strategy);if(e.dictionary&&!se(e.dictionary))throw new Error("Invalid dictionary: it should be a Buffer instance");this._binding=new mi.Zlib(t);var n=this;this._hadError=!1,this._binding.onerror=function(e,t){n._binding=null,n._hadError=!0;var i=new Error(e);i.errno=t,i.code=mi.codes[t],n.emit("error",i)};var i=mi.Z_DEFAULT_COMPRESSION;"number"==typeof e.level&&(i=e.level);var o=mi.Z_DEFAULT_STRATEGY;"number"==typeof e.strategy&&(o=e.strategy),this._binding.init(e.windowBits||mi.Z_DEFAULT_WINDOWBITS,i,e.memLevel||mi.Z_DEFAULT_MEMLEVEL,o,e.dictionary),this._buffer=new C(this._chunkSize),this._offset=0,this._closed=!1,this._level=i,this._strategy=o,this.once("end",this.close)}Object.keys(yi).forEach((function(e){yi[yi[e]]=e})),Ue(Ai,Ht),Ai.prototype.params=function(e,t,n){if(e<mi.Z_MIN_LEVEL||e>mi.Z_MAX_LEVEL)throw new RangeError("Invalid compression level: "+e);if(t!=mi.Z_FILTERED&&t!=mi.Z_HUFFMAN_ONLY&&t!=mi.Z_RLE&&t!=mi.Z_FIXED&&t!=mi.Z_DEFAULT_STRATEGY)throw new TypeError("Invalid strategy: "+t);if(this._level!==e||this._strategy!==t){var i=this;this.flush(mi.Z_SYNC_FLUSH,(function(){i._binding.params(e,t),i._hadError||(i._level=e,i._strategy=t,n&&n())}))}else Ie(n)},Ai.prototype.reset=function(){return this._binding.reset()},Ai.prototype._flush=function(e){this._transform(new C(0),"",e)},Ai.prototype.flush=function(e,t){var n=this._writableState;if(("function"==typeof e||void 0===e&&!t)&&(t=e,e=mi.Z_FULL_FLUSH),n.ended)t&&Ie(t);else if(n.ending)t&&this.once("end",t);else if(n.needDrain){var i=this;this.once("drain",(function(){i.flush(t)}))}else this._flushFlag=e,this.write(new C(0),"",t)},Ai.prototype.close=function(e){if(e&&Ie(e),!this._closed){this._closed=!0,this._binding.close();var t=this;Ie((function(){t.emit("close")}))}},Ai.prototype._transform=function(e,t,n){var i,o=this._writableState,s=(o.ending||o.ended)&&(!e||o.length===e.length);if(null===!e&&!se(e))return n(new Error("invalid input"));s?i=mi.Z_FINISH:(i=this._flushFlag,e.length>=o.length&&(this._flushFlag=this._opts.flush||mi.Z_NO_FLUSH)),this._processChunk(e,i,n)},Ai.prototype._processChunk=function(e,t,n){var i=e&&e.length,o=this._chunkSize-this._offset,s=0,r=this,a="function"==typeof n;if(!a){var c,u=[],l=0;this.on("error",(function(e){c=e}));do{var d=this._binding.writeSync(t,e,s,i,this._buffer,this._offset,o)}while(!this._hadError&&f(d[0],d[1]));if(this._hadError)throw c;var p=C.concat(u,l);return this.close(),p}var h=this._binding.write(t,e,s,i,this._buffer,this._offset,o);function f(c,d){if(!r._hadError){var p=o-d;if(function(e,t){if(!e)throw new Error("have should not go down")}(p>=0),p>0){var h=r._buffer.slice(r._offset,r._offset+p);r._offset+=p,a?r.push(h):(u.push(h),l+=h.length)}if((0===d||r._offset>=r._chunkSize)&&(o=r._chunkSize,r._offset=0,r._buffer=new C(r._chunkSize)),0===d){if(s+=i-c,i=c,!a)return!0;var g=r._binding.write(t,e,s,i,r._buffer,r._offset,r._chunkSize);return g.callback=f,void(g.buffer=e)}if(!a)return!1;n()}}h.buffer=e,h.callback=f},Ue(Ci,Ai),Ue(Ti,Ai),Ue(ki,Ai),Ue(Si,Ai),Ue(Ei,Ai),Ue(Di,Ai),Ue(wi,Ai);var bi={codes:yi,createDeflate:function(e){return new Ci(e)},createInflate:function(e){return new Ti(e)},createDeflateRaw:function(e){return new Ei(e)},createInflateRaw:function(e){return new Di(e)},createGzip:function(e){return new ki(e)},createGunzip:function(e){return new Si(e)},createUnzip:function(e){return new wi(e)},deflate:function(e,t,n){return"function"==typeof t&&(n=t,t={}),Mi(new Ci(t),e,n)},deflateSync:function(e,t){return Ii(new Ci(t),e)},gzip:function(e,t,n){return"function"==typeof t&&(n=t,t={}),Mi(new ki(t),e,n)},gzipSync:function(e,t){return Ii(new ki(t),e)},deflateRaw:function(e,t,n){return"function"==typeof t&&(n=t,t={}),Mi(new Ei(t),e,n)},deflateRawSync:function(e,t){return Ii(new Ei(t),e)},unzip:function(e,t,n){return"function"==typeof t&&(n=t,t={}),Mi(new wi(t),e,n)},unzipSync:function(e,t){return Ii(new wi(t),e)},inflate:function(e,t,n){return"function"==typeof t&&(n=t,t={}),Mi(new Ti(t),e,n)},inflateSync:function(e,t){return Ii(new Ti(t),e)},gunzip:function(e,t,n){return"function"==typeof t&&(n=t,t={}),Mi(new Si(t),e,n)},gunzipSync:function(e,t){return Ii(new Si(t),e)},inflateRaw:function(e,t,n){return"function"==typeof t&&(n=t,t={}),Mi(new Di(t),e,n)},inflateRawSync:function(e,t){return Ii(new Di(t),e)},Deflate:Ci,Inflate:Ti,Gzip:ki,Gunzip:Si,DeflateRaw:Ei,InflateRaw:Di,Unzip:wi,Zlib:Ai},Li=function(){function e(t,n,i){(0,s.default)(this,e),this.SDKAPPID=t,this.EXPIRETIME=i,this.PRIVATEKEY=n}return(0,r.default)(e,[{key:"genTestUserSig",value:function(e){return this._isNumber(this.SDKAPPID)?this._isString(this.PRIVATEKEY)?this._isString(e)?this._isNumber(this.EXPIRETIME)?(i("log","sdkAppID="+this.SDKAPPID+" key="+this.PRIVATEKEY+" userID="+e+" expire="+this.EXPIRETIME," at uilts/lib-generate-test-usersig-es.min.js:6138"),this.genSigWithUserbuf(e,this.EXPIRETIME,null)):(i("error","expireTime must be a number"," at uilts/lib-generate-test-usersig-es.min.js:6138"),""):(i("error","userID must be a string"," at uilts/lib-generate-test-usersig-es.min.js:6138"),""):(i("error","privateKey must be a string"," at uilts/lib-generate-test-usersig-es.min.js:6138"),""):(i("error","sdkAppID must be a number"," at uilts/lib-generate-test-usersig-es.min.js:6138"),"")}},{key:"newBuffer",value:function(e,t){return C.from?C.from(e,t):new C(e,t)}},{key:"unescape",value:function(e){return e.replace(/_/g,"=").replace(/\-/g,"/").replace(/\*/g,"+")}},{key:"escape",value:function(e){return e.replace(/\+/g,"*").replace(/\//g,"-").replace(/=/g,"_")}},{key:"encode",value:function(e){return this.escape(this.newBuffer(e).toString("base64"))}},{key:"decode",value:function(e){return this.newBuffer(this.unescape(e),"base64")}},{key:"base64encode",value:function(e){return this.newBuffer(e).toString("base64")}},{key:"base64decode",value:function(e){return this.newBuffer(e,"base64").toString()}},{key:"_hmacsha256",value:function(e,t,n,i){var o="TLS.identifier:"+e+"\n";o+="TLS.sdkappid:"+this.SDKAPPID+"\n",o+="TLS.time:"+t+"\n",o+="TLS.expire:"+n+"\n",null!=i&&(o+="TLS.userbuf:"+i+"\n");var s=ue.HmacSHA256(o,this.PRIVATEKEY);return ue.enc.Base64.stringify(s)}},{key:"_utc",value:function(){return Math.round(Date.now()/1e3)}},{key:"_isNumber",value:function(e){return null!==e&&("number"==typeof e&&!isNaN(e-0)||"object"==(0,a.default)(e)&&e.constructor===Number)}},{key:"_isString",value:function(e){return"string"==typeof e}},{key:"genSigWithUserbuf",value:function(e,t,n){var o=this._utc(),s={"TLS.ver":"2.0","TLS.identifier":e,"TLS.sdkappid":this.SDKAPPID,"TLS.time":o,"TLS.expire":t},r="";if(null!=n){var a=this.base64encode(n);s["TLS.userbuf"]=a,r=this._hmacsha256(e,o,t,a)}else r=this._hmacsha256(e,o,t,null);s["TLS.sig"]=r;var c=JSON.stringify(s),u=bi.deflateSync(this.newBuffer(c)).toString("base64"),l=this.escape(u);return i("log","ret="+l," at uilts/lib-generate-test-usersig-es.min.js:6208"),l}},{key:"validate",value:function(e){var t=this.decode(e),n=bi.inflateSync(t);i("log","validate ret="+n," at uilts/lib-generate-test-usersig-es.min.js:6214")}}]),e}();t.default=Li}).call(this,n("c8ba"),n("0de9")["default"])},"62e4":function(e,t){e.exports=function(e){return e.webpackPolyfill||(e.deprecate=function(){},e.paths=[],e.children||(e.children=[]),Object.defineProperty(e,"loaded",{enumerable:!0,get:function(){return e.l}}),Object.defineProperty(e,"id",{enumerable:!0,get:function(){return e.i}}),e.webpackPolyfill=1),e}},6613:function(e,t,n){var i=n("5a43");e.exports=function(e,t){if(e){if("string"===typeof e)return i(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?i(e,t):void 0}},e.exports.__esModule=!0,e.exports["default"]=e.exports},"683a":function(e,t,n){if("undefined"===typeof Promise||Promise.prototype.finally||(Promise.prototype.finally=function(e){var t=this.constructor;return this.then((function(n){return t.resolve(e()).then((function(){return n}))}),(function(n){return t.resolve(e()).then((function(){throw n}))}))}),"undefined"!==typeof uni&&uni&&uni.requireGlobal){var i=uni.requireGlobal();ArrayBuffer=i.ArrayBuffer,Int8Array=i.Int8Array,Uint8Array=i.Uint8Array,Uint8ClampedArray=i.Uint8ClampedArray,Int16Array=i.Int16Array,Uint16Array=i.Uint16Array,Int32Array=i.Int32Array,Uint32Array=i.Uint32Array,Float32Array=i.Float32Array,Float64Array=i.Float64Array,BigInt64Array=i.BigInt64Array,BigUint64Array=i.BigUint64Array}uni.restoreGlobal&&uni.restoreGlobal(weex,plus,setTimeout,clearTimeout,setInterval,clearInterval),__definePage("pages/login/login",(function(){return Vue.extend(n("a174").default)})),__definePage("pages/index/index",(function(){return Vue.extend(n("4438").default)})),__definePage("pages/contacts/contact",(function(){return Vue.extend(n("9de8").default)})),__definePage("pages/user/userpage",(function(){return Vue.extend(n("32c1").default)})),__definePage("pages/sign/sign",(function(){return Vue.extend(n("3a0f").default)})),__definePage("pages/contacts/friendInform",(function(){return Vue.extend(n("bc7d").default)})),__definePage("pages/test",(function(){return Vue.extend(n("6c75").default)})),__definePage("pages/search/search",(function(){return Vue.extend(n("ad8f").default)})),__definePage("pages/user/userdetail",(function(){return Vue.extend(n("b82f").default)})),__definePage("pages/message/message",(function(){return Vue.extend(n("fca7").default)})),__definePage("pages/group/group",(function(){return Vue.extend(n("b951").default)})),__definePage("pages/groupDatail/groupDatail",(function(){return Vue.extend(n("fcd2").default)}))},"6a3f":function(e,t,n){"use strict";n.r(t);var i=n("fe67"),o=n.n(i);for(var s in i)["default"].indexOf(s)<0&&function(e){n.d(t,e,(function(){return i[e]}))}(s);t["default"]=o.a},"6b38":function(e,t,n){"use strict";n.r(t);var i=n("d86e"),o=n.n(i);for(var s in i)["default"].indexOf(s)<0&&function(e){n.d(t,e,(function(){return i[e]}))}(s);t["default"]=o.a},"6b3a":function(e,t,n){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n={name:"Login",data:function(){return{look:!0,flag:!0,warning:!1,user:"",password:"",token:""}},mounted:function(){},onLoad:function(e){e.user?(this.user=e.user,uni.showToast({title:"\u6ce8\u518c\u6210\u529f\u8bf7\u767b\u5f55",icon:"none",duration:2e3})):e.name&&(this.user=e.name,uni.showToast({title:"\u767b\u5f55\u8fc7\u671f\u8bf7\u91cd\u65b0\u767b\u5f55",icon:"none",duration:2e3}))},methods:{toSignUp:function(){uni.navigateTo({url:"../sign/sign"})},changeLook:function(){this.look?(this.flag=!1,this.look=!this.look):(this.flag=!0,this.look=!this.look)},Login:function(){var t=this;this.password&&this.user&&uni.request({url:this.serverUrl+"/loginin/login",data:{data:this.user,password:this.password},method:"POST",success:function(n){var i=n.data.code;if(200==i){t.warning=!1;var o=n.data.back;e("log","\u767b\u5f55\u6210\u529f"," at pages/login/login.vue:106");try{uni.setStorageSync("user",{id:o.id,name:o.name,imgUrl:o.imgUrl,token:o.token})}catch(s){e("log","\u6570\u636e\u5b58\u50a8\u51fa\u9519"," at pages/login/login.vue:116")}uni.reLaunch({url:"../index/index"})}else 500==i?uni.showToast({title:"\u670d\u52a1\u5668\u51fa\u9519\u5566\uff01",icon:"none",duration:1500}):400==i&&(t.warning=!0,t.password="")}})}}};t.default=n}).call(this,n("0de9")["default"])},"6b58":function(e,t,n){var i=n("7037")["default"],o=n("3c96");e.exports=function(e,t){if(t&&("object"===i(t)||"function"===typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return o(e)},e.exports.__esModule=!0,e.exports["default"]=e.exports},"6c75":function(e,t,n){"use strict";n.r(t);var i=n("ac6e"),o=n("37c0");for(var s in o)["default"].indexOf(s)<0&&function(e){n.d(t,e,(function(){return o[e]}))}(s);var r=n("f0c5"),a=Object(r["a"])(o["default"],i["b"],i["c"],!1,null,null,null,!1,i["a"],void 0);t["default"]=a.exports},7037:function(e,t){function n(t){return e.exports=n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e.exports.__esModule=!0,e.exports["default"]=e.exports,n(t)}e.exports=n,e.exports.__esModule=!0,e.exports["default"]=e.exports},"730c":function(e,t){e.exports="/static/images/index/shuaxin.png"},7573:function(e,t,n){"use strict";n.d(t,"b",(function(){return i})),n.d(t,"c",(function(){return o})),n.d(t,"a",(function(){}));var i=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("view",{staticClass:e._$s(0,"sc","box"),attrs:{_i:0}},[i("view",{staticClass:e._$s(1,"sc","top-bar"),attrs:{_i:1}},[i("image",{staticClass:e._$s(2,"sc","image"),attrs:{src:e._$s(2,"a-src",n("7b54")),_i:2},on:{click:e.goBack}}),i("view",{staticClass:e._$s(3,"sc","title"),attrs:{_i:3}})]),i("view",{staticClass:e._$s(4,"sc","main"),attrs:{_i:4}},e._l(e._$s(5,"f",{forItems:e.requester}),(function(t,n,o,s){return i("view",{key:e._$s(5,"f",{forIndex:o,key:n}),staticClass:e._$s("5-"+s,"sc","user"),attrs:{_i:"5-"+s}},[i("view",{staticClass:e._$s("6-"+s,"sc","submit"),attrs:{_i:"6-"+s}},[i("view",{staticClass:e._$s("7-"+s,"sc","reject"),attrs:{_i:"7-"+s},on:{click:function(n){return e.rejectFriend(t.id)}}}),i("image",{staticClass:e._$s("8-"+s,"sc","head"),attrs:{src:e._$s("8-"+s,"a-src",t.imgUrl),_i:"8-"+s}}),i("view",{staticClass:e._$s("9-"+s,"sc","argee"),attrs:{_i:"9-"+s},on:{click:function(n){return e.resolveFriend(t.id)}}})]),i("view",{staticClass:e._$s("10-"+s,"sc","content"),attrs:{_i:"10-"+s}},[i("view",{staticClass:e._$s("11-"+s,"sc","name"),attrs:{_i:"11-"+s}},[e._v(e._$s("11-"+s,"t0-0",e._s(t.name)))]),i("view",{staticClass:e._$s("12-"+s,"sc","date"),attrs:{_i:"12-"+s}},[e._v(e._$s("12-"+s,"t0-0",e._s(e.changeTime(t.lastTime))))])]),i("view",{staticClass:e._$s("13-"+s,"sc","notice"),attrs:{_i:"13-"+s}},[i("text"),e._v(e._$s("13-"+s,"t1-0",e._s(t.message)))])])})),0)])},o=[]},"75c6":function(e,t,n){"use strict";n.r(t);var i=n("c931"),o=n.n(i);for(var s in i)["default"].indexOf(s)<0&&function(e){n.d(t,e,(function(){return i[e]}))}(s);t["default"]=o.a},"761b":function(e,t){e.exports="/static/images/index/xiao.png"},"76e1":function(e,t,n){"use strict";n.r(t);var i=n("a970"),o=n("23c1");for(var s in o)["default"].indexOf(s)<0&&function(e){n.d(t,e,(function(){return o[e]}))}(s);var r=n("f0c5"),a=Object(r["a"])(o["default"],i["b"],i["c"],!1,null,"33c93b00",null,!1,i["a"],void 0);t["default"]=a.exports},"76f3":function(e,t,n){"use strict";n.r(t);var i=n("d613"),o=n("a763");for(var s in o)["default"].indexOf(s)<0&&function(e){n.d(t,e,(function(){return o[e]}))}(s);var r=n("f0c5"),a=Object(r["a"])(o["default"],i["b"],i["c"],!1,null,null,null,!1,i["a"],void 0);t["default"]=a.exports},"7b13":function(e,t,n){"use strict";n.d(t,"b",(function(){return i})),n.d(t,"c",(function(){return o})),n.d(t,"a",(function(){}));var i=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("view",{staticClass:e._$s(0,"sc","content"),attrs:{_i:0}},[i("view",{staticClass:e._$s(1,"sc","top-bar"),attrs:{_i:1}},[i("view",{staticClass:e._$s(2,"sc","search"),attrs:{_i:2}},[i("image",{staticClass:e._$s(3,"sc","search-image"),attrs:{src:e._$s(3,"a-src",n("306a")),_i:3}}),i("input",{staticClass:e._$s(4,"sc","search-input"),attrs:{_i:4},on:{input:e.search}})]),i("view",{staticClass:e._$s(5,"sc","remove"),attrs:{_i:5}},[i("span",{attrs:{_i:6},on:{click:e.goBack}})])]),i("view",{staticClass:e._$s(7,"sc","main"),attrs:{_i:7}},[i("view",{staticClass:e._$s(8,"sc","search-user"),attrs:{_i:8}},[i("view",{staticClass:e._$s(9,"sc","title"),attrs:{_i:9}}),e._l(e._$s(10,"f",{forItems:e.userArr}),(function(t,n,o,s){return i("view",{key:e._$s(10,"f",{forIndex:o,key:t.id}),staticClass:e._$s("10-"+s,"sc","list"),attrs:{_i:"10-"+s}},[i("navigator",{staticClass:e._$s("11-"+s,"sc","image"),attrs:{url:e._$s("11-"+s,"a-url","../user/userpage?id="+t._id),_i:"11-"+s}},[i("image",{staticClass:e._$s("12-"+s,"sc","image"),attrs:{src:e._$s("12-"+s,"a-src",t.imgUrl),_i:"12-"+s}})]),i("view",{staticClass:e._$s("13-"+s,"sc","detail"),attrs:{_i:"13-"+s}},[i("view",{staticClass:e._$s("14-"+s,"sc","name"),attrs:{_i:"14-"+s},domProps:{innerHTML:e._s(e._$s("14-"+s,"v-html",t.name))}}),i("view",{staticClass:e._$s("15-"+s,"sc","email"),attrs:{_i:"15-"+s},domProps:{innerHTML:e._s(e._$s("15-"+s,"v-html",t.email))}})]),i("view",{staticClass:e._$s("16-"+s,"sc","right"),attrs:{_i:"16-"+s}},[e._$s("17-"+s,"i",0==t.tip)?i("view",{staticClass:e._$s("17-"+s,"sc","send"),attrs:{_i:"17-"+s},on:{click:function(n){return e.toMessage(t,0)}}}):e._e(),e._$s("18-"+s,"i",1==t.tip)?i("view",{staticClass:e._$s("18-"+s,"sc","apply"),attrs:{_i:"18-"+s},on:{click:function(n){return e.addFrined(t._id)}}}):e._e()])])}))],2),i("view",{staticClass:e._$s(19,"sc","search-group"),attrs:{_i:19}},[i("view",{staticClass:e._$s(20,"sc","title"),attrs:{_i:20}}),e._l(e._$s(21,"f",{forItems:e.groupArr}),(function(t,n,o,s){return i("view",{key:e._$s(21,"f",{forIndex:o,key:t.id}),staticClass:e._$s("21-"+s,"sc","list"),attrs:{_i:"21-"+s}},[i("image",{staticClass:e._$s("22-"+s,"sc","image"),attrs:{src:e._$s("22-"+s,"a-src",t.imgUrl),_i:"22-"+s}}),i("view",{staticClass:e._$s("23-"+s,"sc","detail"),attrs:{_i:"23-"+s}},[i("view",{staticClass:e._$s("24-"+s,"sc","name"),attrs:{_i:"24-"+s},domProps:{innerHTML:e._s(e._$s("24-"+s,"v-html",t.name))}})]),i("view",{staticClass:e._$s("25-"+s,"sc","right"),attrs:{_i:"25-"+s}},[e._$s("26-"+s,"i",0==t.tip)?i("view",{staticClass:e._$s("26-"+s,"sc","send"),attrs:{_i:"26-"+s},on:{click:function(n){return e.toMessage(t,1)}}}):e._e(),e._$s("27-"+s,"i",1==t.tip)?i("view",{staticClass:e._$s("27-"+s,"sc","apply"),attrs:{_i:"27-"+s},on:{click:function(n){return e.addGroup(t)}}}):e._e()])])}))],2)]),i("view",{staticClass:e._$s(28,"sc","modify"),style:e._$s(28,"s",{bottom:-e.modifyHeight+"px"}),attrs:{animation:e._$s(28,"a-animation",e.animationData),_i:28}},[i("view",{staticClass:e._$s(29,"sc","modify-header"),attrs:{_i:29}},[i("view",{staticClass:e._$s(30,"sc","close"),attrs:{_i:30},on:{click:function(t){return e.modify()}}}),i("view",{staticClass:e._$s(31,"sc","title"),attrs:{_i:31}}),i("view",{staticClass:e._$s(32,"sc","define"),attrs:{_i:32},on:{click:e.addSubmit}})]),i("view",{staticClass:e._$s(33,"sc","modify-main"),attrs:{_i:33}},[i("textarea",{directives:[{name:"model",rawName:"v-model",value:e.msg,expression:"msg"}],staticClass:e._$s(34,"sc","modify-content"),attrs:{_i:34},domProps:{value:e._$s(34,"v-model",e.msg)},on:{input:function(t){t.target.composing||(e.msg=t.target.value)}}})])])])},o=[]},"7b54":function(e,t){e.exports="/static/images/index/goback.png"},"7cd2":function(e,t,n){"use strict";var i=n("4ea4"),o=i(n("6025"));e.exports={genTestUserSig:function(e){var t=new o.default(1400813211,"7cfb3ecf410574441d2becb61b7497c117c2a068234f4d9e7104bfa688187e37",604800),n=t.genTestUserSig(e);return{sdkAppID:1400813211,userSig:n}}}},"7d2d":function(e,t,n){"use strict";var i=n("4ea4"),o=i(n("9523"));n("683a");var s=i(n("0edd")),r=i(n("8bbf")),a=i(n("c374"));function c(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}r.default.config.productionTip=!1,r.default.prototype.socket=(0,a.default)("http://192.168.84.33:8082",{query:{},transports:["websocket","polling"],timeout:5e3}),r.default.prototype.serverUrl="http://192.168.84.33:3000",s.default.mpType="app";var u=new r.default(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?c(Object(n),!0).forEach((function(t){(0,o.default)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):c(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},s.default));u.$mount()},"7d2f":function(e,t){e.exports="/static/images/index/slected.png"},"7ef0":function(e,t,n){"use strict";(function(e){var i=n("4ea4");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o=i(n("9b0e")),s=(i(n("d602")),{data:function(){return{tabs:[{id:1,name:"\u597d\u53cb\u5217\u8868"},{id:2,name:"\u7fa4\u804a\u5217\u8868"}],currentTab:0,tabCurrent:"tabNum1",Friend:[],Group:[],swiperDateList:[{id:1,content:[]},{id:2,content:[]}],Height:0,requesterNum:0,uid:"",token:""}},onLoad:function(){this.getStorage(),this.getFriends(),this.getGroup(),this.Friends(),setTimeout((function(){e("log","start pulldown"," at pages/contacts/contact.vue:85")}),1e3),uni.startPullDownRefresh()},onPullDownRefresh:function(){e("log","refresh"," at pages/contacts/contact.vue:90"),setTimeout((function(){uni.stopPullDownRefresh()}),1e3)},methods:{swichMenu:function(e){this.currentTab=e,this.tabCurrent="tabNum"+e},swiperChange:function(e){var t=e.detail.current;this.swichMenu(t)},Friends:function(){var t=this;uni.request({url:this.serverUrl+"/home/getFriend",data:{uid:this.uid,state:0,token:this.token},method:"POST",success:function(n){var i=n.data.code;if(200==i){for(var o=n.data.result,s=0;s<o.length;s++)o[s].imgUrl=t.serverUrl+o[s].imgUrl,void 0!=o[s].nickname&&(o[s].name=o[s].nickname);t.Friend=o,t.swiperDateList[0].content=t.Friend,t.Height=60*t.Friend.length+350,e("log",t.Friend," at pages/contacts/contact.vue:128")}else 500==i?uni.showToast({title:"\u670d\u52a1\u5668\u51fa\u9519\u5566\uff01",icon:"none",duration:2e3}):300==i&&uni.navigateTo({url:"../login/login?name="+t.name})}})},getGroup:function(){var t=this;uni.request({url:this.serverUrl+"/home/getGroups",data:{uid:this.uid,token:this.token},method:"POST",success:function(n){var i=n.data.code;if(200==i){var o=n.data.result;if(t.isOne=!1,0==o.length)t.isOne=!0;else if(o.length>0){for(var s=0;s<o.length;s++)o[s].imgUrl=t.serverUrl+o[s].imgUrl,t.Group.push(o[s]);t.swiperDateList[1].content=t.Group,t.Height=60*t.Group.length+350,e("log",t.Group," at pages/contacts/contact.vue:168")}}else 500==i?uni.showToast({title:"\u7fa4\u804a\u670d\u52a1\u5668\u51fa\u9519\u5566\uff01",icon:"none",duration:2e3}):300==i&&uni.navigateTo({url:"../login/login?name="+t.name})}})},getStorage:function(){try{var e=uni.getStorageSync("user");e?(this.uid=e.id,this.token=e.token):uni.navigateTo({url:"../login/login"})}catch(t){}},getFriends:function(){var t=this;e("log",1," at pages/contacts/contact.vue:202"),uni.request({url:this.serverUrl+"/home/getFriend",data:{uid:this.uid,state:1,token:this.token},method:"POST",success:function(n){var i=n.data.code;if(200==i){var o=n.data.result;t.requesterNum=o.length,e("log",o," at pages/contacts/contact.vue:216")}else 500==i?uni.showToast({title:"\u670d\u52a1\u5668\u51fa\u9519\u5566\uff01",icon:"none",duration:2e3}):300==i&&uni.navigateTo({url:"../login/login?name="+t.name})}})}},components:{Header:o.default}});t.default=s}).call(this,n("0de9")["default"])},8128:function(e,t){e.exports="/static/images/index/eyesclose.png"},"85f2":function(e,t){e.exports="/static/images/index/more.png"},8962:function(e,t,n){var i=n("9f70");function o(){return"undefined"!==typeof Reflect&&Reflect.get?(e.exports=o=Reflect.get.bind(),e.exports.__esModule=!0,e.exports["default"]=e.exports):(e.exports=o=function(e,t,n){var o=i(e,t);if(o){var s=Object.getOwnPropertyDescriptor(o,t);return s.get?s.get.call(arguments.length<3?e:n):s.value}},e.exports.__esModule=!0,e.exports["default"]=e.exports),o.apply(this,arguments)}e.exports=o,e.exports.__esModule=!0,e.exports["default"]=e.exports},"8bbf":function(e,t){e.exports=Vue},"8dbc":function(e,t){e.exports="/static/images/index/loaction.png"},9523:function(e,t,n){var i=n("a395");e.exports=function(e,t,n){return t=i(t),t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e},e.exports.__esModule=!0,e.exports["default"]=e.exports},"970b":function(e,t){e.exports=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},e.exports.__esModule=!0,e.exports["default"]=e.exports},"99cd":function(module,exports,__webpack_require__){"use strict";(function(__f__){var _interopRequireDefault=__webpack_require__("4ea4");Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _data=_interopRequireDefault(__webpack_require__("d602")),_search=_interopRequireDefault(__webpack_require__("3ba1")),_myFun=_interopRequireDefault(__webpack_require__("df93")),_default={name:"Search",data:function(){return{userArr:[],groupArr:[],uid:"",imgUrl:"",token:"",name:"",animationData:{},isModfiy:!1,modifyHeight:"",msg:"",fid:""}},mounted:function(){},onLoad:function(){this.getStorage()},onReady:function(){this.getElementStyle()},methods:{toMessage:function(e,t){uni.navigateTo({url:"../message/message?id="+e._id+"&name="+e.uname+"&imgUrl="+e.imgUrl+"&type="+t})},getStorage:function(){try{var e=uni.getStorageSync("user");e?(this.uid=e.id,this.imgUrl=this.serverUrl+e.imgUrl,this.name=e.name,this.token=e.token):uni.navigateTo({url:"../login/login"})}catch(t){}},search:_myFun.default.debounce((function(e){this.userArr=[];var t=e.detail.value;t.length>0&&(this.searchUser(t),this.searchGroup(t))}),500),searchUser:function searchUser(e){var _this=this;uni.request({url:this.serverUrl+"/search/searchUser",data:{data:e,token:this.token},method:"POST",success:function success(data){var code=data.data.code;if(200==code)for(var arr=data.data.result,exp=eval("/"+e+"/g"),i=0;i<arr.length;i++)-1==arr[i].name.search(e)&&-1==arr[i].email.search(e)||(arr[i].imgUrl=_this.serverUrl+arr[i].imgUrl,arr[i].uname=arr[i].name,arr[i].name=arr[i].name.replace(exp,"<span style='color:rgba(87,153,255,1)'>"+e+"</span>"),arr[i].email=arr[i].email.replace(exp,"<span style='color:rgba(87,153,255,1)'>"+e+"</span>"),_this.userArr.push(arr[i]),_this.isFriend(arr[i]));else 500==code?uni.showToast({title:"\u670d\u52a1\u5668\u51fa\u9519\u5566\uff01",icon:"none",duration:2e3}):300==code&&uni.navigateTo({url:"../login/login?name="+_this.name})}})},isFriend:function(e){var t=this,n=0;e._id==this.uid?(n=2,e.tip=n):(uni.request({url:this.serverUrl+"/search/matchFriend",data:{uid:this.uid,fid:e._id,token:this.token},method:"POST",success:function(i){var o=i.data.code;200==o?(n=0,e.tip=n):400==o?(n=1,e.tip=n,t.$forceUpdate()):500==o?uni.showToast({title:"\u670d\u52a1\u5668\u51fa\u9519\u5566\uff01",icon:"none",duration:2e3}):300==o&&uni.navigateTo({url:"../login/login?name="+t.name})}}),e.tip=n)},searchGroup:function searchGroup(e){var _this3=this;uni.request({url:this.serverUrl+"/search/searchGroup",data:{data:e,token:this.token},method:"POST",success:function success(data){var code=data.data.code;if(200==code){for(var arr=data.data.result,exp=eval("/"+e+"/g"),i=0;i<arr.length;i++)-1==arr[i].name.search(e)&&-1==arr[i].email.search(e)||(arr[i].imgUrl=_this3.serverUrl+arr[i].imgUrl,arr[i].uname=arr[i].name,arr[i].name=arr[i].name.replace(exp,"<span style='color:rgba(87,153,255,1)'>"+e+"</span>"),_this3.groupArr.push(arr[i]),_this3.isGroup(arr[i]));__f__("log",_this3.groupArr," at pages/search/search.vue:256")}else 500==code?uni.showToast({title:"\u670d\u52a1\u5668\u51fa\u9519\u5566\uff01",icon:"none",duration:2e3}):300==code&&uni.navigateTo({url:"../login/login?name="+_this3.name})}})},isGroup:function(e){var t=this,n=0;uni.request({url:this.serverUrl+"/search/matchGroup",data:{uid:this.uid,gid:e._id,token:this.token},method:"POST",success:function(i){var o=i.data.code;200==o?(n=0,e.tip=n):400==o?(n=1,e.tip=n,t.$forceUpdate()):500==o?uni.showToast({title:"\u670d\u52a1\u5668\u51fa\u9519\u5566\uff01",icon:"none",duration:2e3}):300==o&&uni.navigateTo({url:"../login/login?name="+t.name})}}),e.tip=n},getElementStyle:function(){var e=this,t=uni.createSelectorQuery().in(this);t.select(".modify").boundingClientRect((function(t){e.modifyHeight=t.height})).exec()},modify:function(){this.isModfiy=!this.isModfiy;var e=uni.createAnimation({duration:1e3,timingFunction:"ease"});this.isModfiy?e.bottom(0).step():e.bottom(-this.modifyHeight).step(),this.animationData=e.export()},addFrined:function(e){this.fid=e,this.msg=this.name+"\u8bf7\u6c42\u6dfb\u52a0\u597d\u53cb~",this.modify()},addSubmit:function(){var e=this;this.msg.length>0&&(this.modify(),uni.request({url:this.serverUrl+"/friend/request",data:{uid:this.uid,fid:this.fid,msg:this.msg,token:this.token},method:"POST",success:function(t){var n=t.data.code;200==n?__f__("log","\u7533\u8bf7\u6210\u529f"," at pages/search/search.vue:357"):500==n?uni.showToast({title:"\u670d\u52a1\u5668\u51fa\u9519\u5566\uff01",icon:"none",duration:2e3}):300==n&&uni.navigateTo({url:"../login/login?name="+e.name})}}))},addGroup:function(e){var t=this,n=[this.uid];uni.request({url:this.serverUrl+"/group/insertGroup",data:{gid:e._id,user:n,token:this.token},method:"POST",success:function(n){var i=n.data.code;200==i?uni.navigateTo({url:"../message/message?id="+e._id+"&name="+e.uname+"&imgUrl="+e.imgUrl+"&type=1"}):500==i?uni.showToast({title:"\u670d\u52a1\u5668\u51fa\u9519\u5566\uff01",icon:"none",duration:2e3}):300==i&&uni.navigateTo({url:"../login/login?name="+t.name})}})},goBack:function(){uni.reLaunch({url:".index/index"})}}};exports.default=_default}).call(this,__webpack_require__("0de9")["default"])},"9b0e":function(e,t,n){"use strict";n.r(t);var i=n("d2ac"),o=n("e036");for(var s in o)["default"].indexOf(s)<0&&function(e){n.d(t,e,(function(){return o[e]}))}(s);var r=n("f0c5"),a=Object(r["a"])(o["default"],i["b"],i["c"],!1,null,null,null,!1,i["a"],void 0);t["default"]=a.exports},"9b3f":function(e,t,n){"use strict";n.d(t,"b",(function(){return i})),n.d(t,"c",(function(){return o})),n.d(t,"a",(function(){}));var i=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("view",{staticClass:e._$s(0,"sc","box"),attrs:{_i:0}},[i("view",{staticClass:e._$s(1,"sc","top-bar"),attrs:{_i:1}},[i("image",{staticClass:e._$s(2,"sc","image"),attrs:{src:e._$s(2,"a-src",n("7b54")),_i:2},on:{click:e.goBack}}),i("view",{staticClass:e._$s(3,"sc","title"),attrs:{_i:3}},[e._v(e._$s(3,"t0-0",e._s(e.fname)))]),e._$s(4,"i",1==e.type)?i("image",{staticClass:e._$s(4,"sc","group-head"),attrs:{src:e._$s(4,"a-src",e.fimgUrl),_i:4},on:{click:e.toGroupDetail}}):e._e(),e._$s(5,"i",0==e.type)?i("view",{staticClass:e._$s(5,"sc","group-head"),attrs:{_i:5}}):e._e()]),i("scroll-view",{staticClass:e._$s(6,"sc","message"),attrs:{"scroll-into-view":e._$s(6,"a-scroll-into-view",e.srcollToView),_i:6},on:{scrolltoupper:e.nextPage}},[i("view",{staticClass:e._$s(7,"sc","message-main"),style:e._$s(7,"s",{paddingBottom:e.inputHeight+"px"}),attrs:{_i:7}},[e._$s(8,"i",!e.isLoading)?i("view",{staticClass:e._$s(8,"sc","loading"),attrs:{_i:8}},[i("image",{staticClass:e._$s(9,"sc","loading-image"),attrs:{src:e._$s(9,"a-src",n("c665")),animation:e._$s(9,"a-animation",e.animationData),_i:9}})]):e._e(),e._l(e._$s(10,"f",{forItems:e.Message}),(function(t,o,s,r){return i("view",{key:e._$s(10,"f",{forIndex:s,key:o}),staticClass:e._$s("10-"+r,"sc","message-item"),attrs:{id:e._$s("10-"+r,"a-id","msg"+t.id),_i:"10-"+r}},[e._$s("11-"+r,"i",""!=t.time)?i("view",{staticClass:e._$s("11-"+r,"sc","message-time"),attrs:{_i:"11-"+r}},[e._v(e._$s("11-"+r,"t0-0",e._s(e.changeTime(t.time))))]):e._e(),e._$s("12-"+r,"i",t.fromId!=e.uid)?i("view",{staticClass:e._$s("12-"+r,"sc","message-content message-send"),attrs:{_i:"12-"+r}},[i("image",{staticClass:e._$s("13-"+r,"sc","image"),attrs:{src:e._$s("13-"+r,"a-src",t.imgUrl),_i:"13-"+r},on:{click:function(n){return e.touser(t.fromId)}}}),e._$s("14-"+r,"i",0==t.types)?i("view",{staticClass:e._$s("14-"+r,"sc","message-news"),attrs:{_i:"14-"+r}},[i("view",{staticClass:e._$s("15-"+r,"sc","message-text"),attrs:{_i:"15-"+r}},[e._v(e._$s("15-"+r,"t0-0",e._s(t.message)))])]):e._e(),e._$s("16-"+r,"i",1==t.types)?i("view",{staticClass:e._$s("16-"+r,"sc","message-news"),attrs:{_i:"16-"+r}},[i("image",{staticClass:e._$s("17-"+r,"sc","message-image"),attrs:{src:e._$s("17-"+r,"a-src",t.message),_i:"17-"+r},on:{click:function(n){return e.previewImg(t.message)}}})]):e._e(),e._$s("18-"+r,"i",2==t.types)?i("view",{staticClass:e._$s("18-"+r,"sc","message-news"),style:e._$s("18-"+r,"s",{width:4*t.message.time+"px"}),attrs:{_i:"18-"+r},on:{click:function(n){return e.playVoice(t.message.voice)}}},[i("view",{staticClass:e._$s("19-"+r,"sc","message-text voice"),attrs:{_i:"19-"+r}},[e._v(e._$s("19-"+r,"t0-0",e._s(t.message.time))),i("image",{staticClass:e._$s("20-"+r,"sc","voice-image"),attrs:{src:e._$s("20-"+r,"a-src",n("f2a2")),_i:"20-"+r}})])]):e._e(),e._$s("21-"+r,"i",3==t.types)?i("view",{staticClass:e._$s("21-"+r,"sc","message-news"),attrs:{_i:"21-"+r}},[i("view",{staticClass:e._$s("22-"+r,"sc","message-text location"),attrs:{_i:"22-"+r},on:{click:function(n){return e.openLocation(t.message)}}},[i("view",{staticClass:e._$s("23-"+r,"sc","location-name"),attrs:{_i:"23-"+r}},[e._v(e._$s("23-"+r,"t0-0",e._s(t.message.name)))]),i("view",{staticClass:e._$s("24-"+r,"sc","location-address"),attrs:{_i:"24-"+r}},[e._v(e._$s("24-"+r,"t0-0",e._s(t.message.address)))]),i("image",{staticClass:e._$s("25-"+r,"sc","map"),attrs:{src:e._$s("25-"+r,"a-src",n("8dbc")),_i:"25-"+r}})])]):e._e()]):e._e(),e._$s("26-"+r,"i",t.fromId==e.uid)?i("view",{staticClass:e._$s("26-"+r,"sc","message-content message-receive"),attrs:{_i:"26-"+r}},[i("image",{staticClass:e._$s("27-"+r,"sc","image"),attrs:{src:e._$s("27-"+r,"a-src",t.imgUrl),_i:"27-"+r}}),e._$s("28-"+r,"i",0==t.types)?i("view",{staticClass:e._$s("28-"+r,"sc","message-news"),attrs:{_i:"28-"+r}},[i("view",{staticClass:e._$s("29-"+r,"sc","message-text"),attrs:{_i:"29-"+r}},[e._v(e._$s("29-"+r,"t0-0",e._s(t.message)))])]):e._e(),e._$s("30-"+r,"i",1==t.types)?i("view",{staticClass:e._$s("30-"+r,"sc","message-news"),attrs:{_i:"30-"+r}},[i("image",{staticClass:e._$s("31-"+r,"sc","message-image"),attrs:{src:e._$s("31-"+r,"a-src",t.message),_i:"31-"+r},on:{click:function(n){return e.previewImg(t.message)}}})]):e._e(),e._$s("32-"+r,"i",2==t.types)?i("view",{staticClass:e._$s("32-"+r,"sc","message-news"),attrs:{_i:"32-"+r},on:{click:function(n){return e.playVoice(t.message.voice)}}},[i("view",{staticClass:e._$s("33-"+r,"sc","message-text voice"),attrs:{_i:"33-"+r}},[e._v(e._$s("33-"+r,"t0-0",e._s(t.message.time))),i("image",{staticClass:e._$s("34-"+r,"sc","voice-image"),attrs:{src:e._$s("34-"+r,"a-src",n("20f3")),_i:"34-"+r}})])]):e._e(),e._$s("35-"+r,"i",3==t.types)?i("view",{staticClass:e._$s("35-"+r,"sc","message-news"),attrs:{_i:"35-"+r}},[i("view",{staticClass:e._$s("36-"+r,"sc","message-text location"),attrs:{_i:"36-"+r},on:{click:function(n){return e.openLocation(t.message)}}},[i("view",{staticClass:e._$s("37-"+r,"sc","location-name"),attrs:{_i:"37-"+r}},[e._v(e._$s("37-"+r,"t0-0",e._s(t.message.name)))]),i("view",{staticClass:e._$s("38-"+r,"sc","location-address"),attrs:{_i:"38-"+r}},[e._v(e._$s("38-"+r,"t0-0",e._s(t.message.address)))]),i("image",{staticClass:e._$s("39-"+r,"sc","map"),attrs:{src:e._$s("39-"+r,"a-src",n("8dbc")),_i:"39-"+r}})])]):e._e()]):e._e()])}))],2),i("view",{staticClass:e._$s(40,"sc","submit"),attrs:{_i:40}}),i("view",{staticClass:e._$s(41,"sc","submit"),attrs:{_i:41}})]),i("Submit",{attrs:{fid:e.fid,fname:e.fname,fimgUrl:e.fimgUrl,type:e.type,_i:42},on:{InputMessage:e.InputMessage,Height:e.Height}})],1)},o=[]},"9b42":function(e,t){e.exports=function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var i,o,s,r,a=[],c=!0,u=!1;try{if(s=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;c=!1}else for(;!(c=(i=s.call(n)).done)&&(a.push(i.value),a.length!==t);c=!0);}catch(l){u=!0,o=l}finally{try{if(!c&&null!=n["return"]&&(r=n["return"](),Object(r)!==r))return}finally{if(u)throw o}}return a}},e.exports.__esModule=!0,e.exports["default"]=e.exports},"9be0":function(e,t){e.exports="/static/images/index/delete.png"},"9dcf":function(e,t,n){"use strict";n.r(t);var i=n("4882"),o=n.n(i);for(var s in i)["default"].indexOf(s)<0&&function(e){n.d(t,e,(function(){return i[e]}))}(s);t["default"]=o.a},"9de8":function(e,t,n){"use strict";n.r(t);var i=n("1587"),o=n("cd7d");for(var s in o)["default"].indexOf(s)<0&&function(e){n.d(t,e,(function(){return o[e]}))}(s);var r=n("f0c5"),a=Object(r["a"])(o["default"],i["b"],i["c"],!1,null,null,null,!1,i["a"],void 0);t["default"]=a.exports},"9f70":function(e,t,n){var i=n("36c6");e.exports=function(e,t){while(!Object.prototype.hasOwnProperty.call(e,t))if(e=i(e),null===e)break;return e},e.exports.__esModule=!0,e.exports["default"]=e.exports},"9fc5":function(e,t,n){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n={name:"image-cropper",props:{cropWidth:{type:Number,default:200},cropHeight:{type:Number,default:200},cropFixed:{type:Boolean,default:!1},iszoom:{type:Boolean,default:!1},src:{type:String},showResetBtn:{type:Boolean,default:!0},showRotateBtn:{type:Boolean,default:!0},proportion:{type:Number,default:0}},data:function(){var e=uni.getSystemInfoSync(),t=e.pixelRatio;return{show:!1,scale:1,rotate:0,cropW:0,cropH:0,cropOldW:0,cropOldH:0,sysInfo:e,pixelRatio:t,imageRealWidth:0,imageRealHeight:0,cropOffsertX:0,cropOffsertY:0,startX:0,startY:0,border:5,x:0,y:0,startL:0,oldScale:1,scaling:!1}},watch:{src:function(e){e.length>0&&this.init()},show:function(e){}},computed:{containerTop:function(){return 0},containerHeight:function(){return this.windowHeight-48},windowWidth:function(){return this.sysInfo.windowWidth},windowHeight:function(){return this.sysInfo.windowHeight},imageRatio:function(){return this.imageRealHeight>0?this.imageRealWidth/this.imageRealHeight:0},imageWidth:function(){return this.imageRatio>=1?this.windowWidth:this.windowWidth*this.imageRatio},imageHeight:function(){return this.imageRatio>=1?this.windowWidth/this.imageRatio:this.windowWidth}},methods:{moveHandle:function(){},rotateHandler:function(){3==this.rotate?this.rotate=0:++this.rotate},init:function(){this.rotate=0,this.scale=1,this.cropW=this.cropWidth,this.cropH=this.cropHeight,uni.showLoading({title:"\u56fe\u7247\u52a0\u8f7d\u4e2d..."}),this.loadImage(this.src).then((function(e){uni.hideLoading()})).catch((function(e){uni.hideLoading(),uni.showModal({title:"\u6807\u9898",content:"\u56fe\u7247\u52a0\u8f7d\u5931\u8d25"})}))},loadImage:function(e){var t=this;return new Promise((function(n,i){uni.getImageInfo({src:e,success:function(e){t.imageRealWidth=e.width,t.imageRealHeight=e.height,t.cropOffsertX=t.windowWidth/2-t.cropW/2,t.cropOffsertY=t.windowHeight/2-t.cropH/2,t.show=!0,t.$nextTick((function(){t.x=t.windowWidth/2-t.imageWidth/2,t.y=t.containerHeight/2-t.imageHeight/2})),n(e)},fail:function(e){t.show=!1,i(e)}})})).catch((function(e){}))},cancel:function(){this.show=!1,this.$emit("cancel")},confirm:function(t){uni.showLoading({title:"\u88c1\u526a\u4e2d..."}),this.iszoom?(this.pixelRatio=1,e("log","this is fixed"," at components/ling-imgcropper/ling-imgcropper.vue:248")):0!=this.proportion&&(this.proportion=this.pixelRatio);var n=this,i=uni.createCanvasContext("myCanvas",n),o=n.pixelRatio,s=n.src,r=n.imageWidth*n.scale,a=n.imageHeight*n.scale,c=n.rotate,u=n.cropOffsertX-n.x-(n.imageWidth-r)/2,l=n.cropOffsertY-n.y-(n.imageHeight-a)/2;switch(i.setFillStyle("white"),i.fillRect(0,0,r,a),i.save(),i.rotate(90*c*Math.PI/180),c){case 1:u+=(a-r)/2,l-=(a-r)/2,i.drawImage(s,-l,u,r,-a);break;case 2:i.drawImage(s,u,l,-r,-a);break;case 3:u+=(a-r)/2,l-=(a-r)/2,i.drawImage(s,l,-u,-r,a);break;default:i.drawImage(s,-u,-l,r,a);break}i.restore(),i.draw(!1,(function(){uni.canvasToTempFilePath({canvasId:"myCanvas",destWidth:n.cropW*o,destHeight:n.cropH*o,success:function(i){uni.hideLoading(),t.detail.tempFilePath=i.tempFilePath,e("log"," at components/ling-imgcropper/ling-imgcropper.vue:334"),n.show=!1,n.$emit("confirm",t)},fail:function(e){uni.hideLoading(),uni.showModal({title:"\u63d0\u793a",content:"\u88c1\u526a\u5931\u8d25"})}},n)}))},imgTouchStart:function(e){if(e.touches.length>=2){this.oldScale=this.scale,this.scaling=!0;var t=e.touches[0].pageX-e.touches[1].pageX,n=e.touches[0].pageY-e.touches[1].pageY,i=Math.sqrt(Math.pow(t,2)+Math.pow(n,2));this.startL=Math.max(t,n,i)}else 1==e.touches.length&&(this.scaling=!0,this.startX=e.touches[0].pageX-this.x,this.startY=e.touches[0].pageY-this.y)},imgMoveing:function(t){if(this.scaling&&t.touches.length>=2){var n=this.oldScale;e("log","\u53cc\u6307"," at components/ling-imgcropper/ling-imgcropper.vue:375");var i=t.touches[0].pageX-t.touches[1].pageX,o=t.touches[0].pageY-t.touches[1].pageY,s=Math.sqrt(Math.pow(i,2)+Math.pow(o,2)),r=Math.max(i,o,s),a=r-this.startL,c=1;c=c/this.imageWidth>c/this.imageHeight?c/this.imageHeight:c/this.imageWidth,c=c>.1?.1:c;var u=c*a;a>0?n+=Math.abs(u):a<0&&n>Math.abs(u)&&(n-=Math.abs(u)),this.scale=n}else if(this.scaling&&1==t.touches.length){var l=t.touches[0].pageX-this.startX,d=t.touches[0].pageY-this.startY;e("log","\u5355\u6307"," at components/ling-imgcropper/ling-imgcropper.vue:413"),this.x=l,this.y=d}},imgMoveEnd:function(){this.scaling&&(this.scaling=!1)},touchStart:function(e){this.scaling||(this.startX=e.touches[0].pageX-this.cropOffsertX,this.startY=e.touches[0].pageY-this.cropOffsertY,this.cropOldW=this.cropW,this.cropOldH=this.cropH)},cropMoveing:function(e){if(!this.scaling){var t=this._cropX(e.touches[0].pageX-this.startX),n=this._cropY(e.touches[0].pageY-this.startY);this.cropOffsertX=t,this.cropOffsertY=n}},dragMove:function(e,t){if(this.cropFixed)return!1;var n=e.touches[0].pageX-this.startX,i=e.touches[0].pageY-this.startY;switch(t){case"left-top":this._cropMoveLeft(n),this._cropMoveTop(i);break;case"middle-top":this._cropMoveTop(i);break;case"right-top":this._cropMoveTop(i),this._cropMoveRight(n);break;case"middle-right":this._cropMoveRight(n);break;case"right-bottom":this._cropMoveRight(n),this._cropMoveBottom(i);break;case"middle-bottom":this._cropMoveBottom(i);break;case"left-bottom":this._cropMoveBottom(i),this._cropMoveLeft(n);break;case"middle-left":this._cropMoveLeft(n);break;default:break}},_cropMoveTop:function(e){var t=this._cropY(e);this.cropH+=this.cropOffsertY-t,this.cropOffsertY=t},_cropMoveRight:function(e){if(this.cropOldW+e>=this.windowWidth-this.border)return!1;this.cropW=this.cropOldW+(e-this.cropOffsertX)},_cropMoveBottom:function(e){if(this.cropOldH+e>=this.windowHeight-this.containerTop-this.border)return!1;this.cropH=this.cropOldH+(e-this.cropOffsertY)},_cropMoveLeft:function(e){var t=this._cropY(e);this.cropW+=this.cropOffsertX-t,this.cropOffsertX=t},_cropX:function(e){return e<=this.border?this.border:e+this.cropW>=this.windowWidth-this.border?this.windowWidth-this.cropW-this.border:e},_cropY:function(e){return e<=this.border?this.border:e+this.cropH>=this.windowHeight-this.containerTop-this.border?this.windowHeight-this.cropH-this.containerTop-this.border:e}}};t.default=n}).call(this,n("0de9")["default"])},"9ffb":function(e,t,n){"use strict";n.d(t,"b",(function(){return i})),n.d(t,"c",(function(){return o})),n.d(t,"a",(function(){}));var i=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("view",{staticClass:e._$s(0,"sc","login"),attrs:{_i:0}},[i("view",{staticClass:e._$s(1,"sc","login-img"),attrs:{_i:1}},[i("image",{attrs:{src:e._$s(2,"a-src",n("586b")),_i:2}})]),i("view",{staticClass:e._$s(3,"sc","login-forms"),attrs:{_i:3}},[i("form",{staticClass:e._$s(4,"sc","login-register"),attrs:{id:"login-in",_i:4}},[i("view",{staticClass:e._$s(5,"sc","login-title"),attrs:{_i:5}}),i("view",{staticClass:e._$s(6,"sc","login-box"),attrs:{_i:6}},[i("image",{staticClass:e._$s(7,"sc","login-icon"),attrs:{src:e._$s(7,"a-src",n("39e5")),_i:7}}),i("input",{directives:[{name:"model",rawName:"v-model",value:e.user,expression:"user"}],staticClass:e._$s(8,"sc","login-input"),attrs:{_i:8},domProps:{value:e._$s(8,"v-model",e.user)},on:{input:function(t){t.target.composing||(e.user=t.target.value)}}})]),i("view",{staticClass:e._$s(9,"sc","login-box"),attrs:{_i:9}},[i("image",{staticClass:e._$s(10,"sc","login-icon"),attrs:{src:e._$s(10,"a-src",n("256d")),_i:10}}),i("input",{directives:[{name:"model",rawName:"v-model",value:e.password,expression:"password"}],staticClass:e._$s(11,"sc","login-input"),attrs:{password:e._$s(11,"a-password",e.flag),_i:11},domProps:{value:e._$s(11,"v-model",e.password)},on:{input:function(t){t.target.composing||(e.password=t.target.value)}}}),e._$s(12,"i",e.look)?i("image",{staticClass:e._$s(12,"sc","login-icon"),attrs:{src:e._$s(12,"a-src",n("8128")),_i:12},on:{click:e.changeLook}}):i("image",{staticClass:e._$s(13,"sc","login-icon"),attrs:{src:e._$s(13,"a-src",n("1552")),_i:13},on:{click:e.changeLook}})]),e._$s(14,"i",e.warning)?i("text",{staticClass:e._$s(14,"sc","login-warning"),attrs:{_i:14}}):e._e(),i("text",{staticClass:e._$s(15,"sc","login-forgot"),attrs:{_i:15}}),i("button",{staticClass:e._$s(16,"sc","login-button"),attrs:{_i:16},on:{click:e.Login}}),i("view",[i("text",{staticClass:e._$s(18,"sc","login-account"),attrs:{_i:18}}),i("text",{staticClass:e._$s(19,"sc","login-signin"),attrs:{_i:19},on:{click:e.toSignUp}})])])])])},o=[]},a091:function(e,t,n){"use strict";(function(e){var i=n("4ea4");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;i(n("d602"));var o=i(n("52ef")),s=i(n("47dd")),r={name:"Message",components:{Submit:s.default},data:function(){return{Message:[],imgMsg:[],oldTime:0,voiceTime:0,srcollToView:"",inputHeight:"50",animationData:{},nowPage:0,PageSize:10,loading:"",isLoading:!0,type:"",fid:"",fname:"",fimgUrl:"",uid:"",uname:"",uimgUrl:"",token:""}},onLoad:function(e){this.fid=e.id,this.fname=e.name,this.fimgUrl=e.imgUrl,this.type=e.type,this.getStorage(),this.getMessage(),this.getGroupMsg(),this.receiveSocketMsg(),this.GroupSocketMsg()},methods:{goBack:function(){this.socket.emit("leaveChat",this.uid,this.fid),uni.navigateBack({delta:1})},toGroupDetail:function(){uni.navigateTo({url:"../groupDatail/groupDatail?gid="+this.fid+"&gimg="+this.fimgUrl})},touser:function(e){uni.navigateTo({url:"../user/userpage?id="+e})},getStorage:function(){try{var e=uni.getStorageSync("user");e?(this.uid=e.id,this.uname=e.name,this.uimgUrl=this.serverUrl+e.imgUrl,this.token=e.token):uni.navigateTo({url:"../login/login"})}catch(t){}},changeTime:function(e){return o.default.dateTime_Msg(e)},nextPage:function(){if(e("log",this.nowPage," at pages/message/message.vue:175"),this.nowPage>0){this.isLoading=!1;var t=uni.createAnimation({duration:1e3,timingFunction:"step-start"});this.animation=t;var n=1;this.loading=setInterval(function(){t.rotate(30*n).step(),this.animationData=t.export(),n++,n>40&&(e("log","\u89e6\u53d1"," at pages/message/message.vue:190"),this.getMessage(),this.getGroupMsg())}.bind(this),100)}},getMessage:function(){var t=this;0==this.type&&uni.request({url:this.serverUrl+"/chat/getMsg",data:{uid:this.uid,fid:this.fid,nowPage:this.nowPage,pageSize:this.PageSize,token:this.token},method:"POST",success:function(n){var i=n.data.code;if(200==i){var s=n.data.result;10==s.length?t.nowPage++:(t.nowPage=-1,e("log","\u89e6\u53d1\u7ed3\u675f"+t.nowPage," at pages/message/message.vue:219")),s.reverse();var r=s[0].time;s[0].imgUrl=t.serverUrl+s[0].imgUrl;var a=[];if(s.length>0){for(var c=1;c<s.length;c++){if(s[c].imgUrl=t.serverUrl+s[c].imgUrl,c<s.length-1){var u=o.default.spaceTime(r,s[c].time);u&&(r=u),s[c].time=u}0==t.nowPage&&s[c].time>t.oldTime&&(t.oldTime=s[c].time),1==s[c].types&&(s[c].message=t.serverUrl+s[c].message,a.push(s[c].message)),3==s[c].types&&(s[c].message=JSON.parse(s[c].message)),2==s[c].types&&(s[c].message=JSON.parse(s[c].message))}t.Message=s.concat(t.Message),t.imgMsg=a.concat(t.imgMsg),t.$nextTick((function(){this.srcollToView="msg"+this.Message[s.length-1].id})),clearInterval(t.loading),t.isLoading=!0}}500==i?uni.showToast({title:"\u670d\u52a1\u5668\u51fa\u9519\u5566\uff01",icon:"none",duration:2e3}):300==i&&uni.navigateTo({url:"../login/login?name="+t.name})}})},getGroupMsg:function(){var e=this;1==this.type&&uni.request({url:this.serverUrl+"/group/getGroupMsg",data:{gid:this.fid,nowPage:this.nowPage,pageSize:this.PageSize,token:this.token},method:"POST",success:function(t){var n=t.data.code;if(200==n){var i=t.data.result;i.reverse();var s=i[0].time;i[0].imgUrl=e.serverUrl+i[0].imgUrl;var r=[];if(i.length>0){for(var a=1;a<i.length;a++){if(i[a].imgUrl=e.serverUrl+i[a].imgUrl,a<i.length-1){var c=o.default.spaceTime(s,i[a].time);c&&(s=c),i[a].time=c}0==e.nowPage&&i[a].time>e.oldTime&&(e.oldTime=i[a].time),1==i[a].types&&(i[a].message=e.serverUrl+i[a].message,r.push(i[a].message)),3==i[a].types&&(i[a].message=JSON.parse(i[a].message)),2==i[a].types&&(i[a].message=JSON.parse(i[a].message))}e.Message=i.concat(e.Message),e.imgMsg=r.concat(e.imgMsg),10==i.length?e.nowPage++:e.nowPage=-1,e.$nextTick((function(){this.srcollToView="msg"+this.Message[i.length-1].id})),clearInterval(e.loading),e.isLoading=!0}}500==n?uni.showToast({title:"\u670d\u52a1\u5668\u51fa\u9519\u5566\uff01",icon:"none",duration:2e3}):300==n&&uni.navigateTo({url:"../login/login?name="+e.name})}})},previewImg:function(t){e("log",t," at pages/message/message.vue:382"),uni.previewImage({current:t,urls:this.imgMsg,longPressActions:{itemList:["\u53d1\u9001\u7ed9\u670b\u53cb","\u4fdd\u5b58\u56fe\u7247","\u6536\u85cf"],success:function(t){e("log","\u9009\u4e2d\u4e86\u7b2c"+(t.tapIndex+1)+"\u4e2a\u6309\u94ae,\u7b2c"+(t.index+1)+"\u5f20\u56fe\u7247"," at pages/message/message.vue:389")},fail:function(t){e("log",t.errMsg," at pages/message/message.vue:393")}}})},playVoice:function(e){var t=uni.createInnerAudioContext();t.src=e,t.play()},covers:function(e){var t=[{latitude:e.latitude,longitude:e.longitude,iconPath:"../../static/images/index/\u5b9a\u4f4d(2).png"}];return t},openLocation:function(t){uni.openLocation({name:t.name,latitude:t.latitude,longitude:t.longitude,address:t.address,success:function(){e("log","success"," at pages/message/message.vue:420")}})},receiveMsg:function(t,n,i,s){var r=this;if(0==t.types||3==t.types)this.sendSocket(t);else if(1==t.types){this.imgMsg.push(t.message);var a=o.default.dateTime_Thour(new Date);uni.uploadFile({url:this.serverUrl+"/files/upload",filePath:t.message,name:"file",formData:{url:a,name:(new Date).getTime()+this.uid},success:function(e){var t={message:e.data,types:1};r.sendSocket(t)}})}if(2==t.types){var c=o.default.dateTime_Thour(new Date);uni.uploadFile({url:this.serverUrl+"/files/upload",filePath:t.message.voice,name:"file",formData:{url:c,name:(new Date).getTime()+this.uid},success:function(e){var n={message:{voice:e.data,time:t.message.time},types:t.types},i=JSON.stringify(n.message),o={message:i,types:2};r.sendSocket(o)}})}var u=this.Message.length,l=new Date,d=o.default.spaceTime(this.oldTime,l);d&&(this.oldTime=d),l=d,3==t.types&&(t.message=JSON.parse(t.message),e("log","\u8fd8\u539f\u5730\u56fe"+t.message," at pages/message/message.vue:492"));var p={fromId:n,imgUrl:i,time:l,message:t.message,types:t.types,id:u};this.Message.push(p),e("log",this.Message," at pages/message/message.vue:504"),this.$nextTick((function(){this.srcollToView="msg"+u}))},sendSocket:function(e){0==this.type?this.socket.emit("msg",e,this.uid,this.fid):this.socket.emit("groupMsg",e,this.uid,this.fid,this.uname,this.uimgUrl)},receiveSocketMsg:function(){var e=this;this.socket.on("msgs",(function(t,n,i){if(n==e.fid&&0==i){var s=e.Message.length,r=new Date,a=o.default.spaceTime(e.oldTime,r);a&&(e.oldTime=a),r=a,1==t.types&&(t.message=e.serverUrl+t.message),2==t.types&&(t.message.voice=e.serverUrl+t.message.voice);var c={fromId:n,imgUrl:e.fimgUrl,time:r,message:t.message,types:t.types,id:s};e.Message.push(c),1==t.types&&e.imgMsg.push(t.message),e.$nextTick((function(){this.srcollToView="msg"+s}))}}))},GroupSocketMsg:function(){var t=this;this.socket.on("groupMsg",(function(n,i,s,r,a,c){if(s==t.fid&&0==c){var u=t.Message.length,l=new Date,d=o.default.spaceTime(t.oldTime,l);d&&(t.oldTime=d),l=d,1==n.types&&(n.message=t.serverUrl+n.message),2==n.types&&(n.message.voice=t.serverUrl+n.message.voice);var p={fromId:s,imgUrl:a,time:l,message:n.message,types:n.types,id:u};t.Message.push(p),e("log",t.Message," at pages/message/message.vue:588"),1==n.types&&t.imgMsg.push(n.message),t.$nextTick((function(){this.srcollToView="msg"+u}))}}))},InputMessage:function(e){this.receiveMsg(e,this.uid,this.uimgUrl,0)},Height:function(e){this.inputHeight=e,this.goButtom()},goButtom:function(){this.srcollToView="",this.$nextTick((function(){var e=this.Message.length-1;this.srcollToView="msg"+this.Message[e].id}))}}};t.default=r}).call(this,n("0de9")["default"])},a174:function(e,t,n){"use strict";n.r(t);var i=n("9ffb"),o=n("c081");for(var s in o)["default"].indexOf(s)<0&&function(e){n.d(t,e,(function(){return o[e]}))}(s);var r=n("f0c5"),a=Object(r["a"])(o["default"],i["b"],i["c"],!1,null,null,null,!1,i["a"],void 0);t["default"]=a.exports},a336:function(e,t,n){"use strict";n.d(t,"b",(function(){return i})),n.d(t,"c",(function(){return o})),n.d(t,"a",(function(){}));var i=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("view",{staticClass:e._$s(0,"sc","box"),attrs:{_i:0}},[i("view",{staticClass:e._$s(1,"sc","submit"),attrs:{_i:1}},[i("view",{staticClass:e._$s(2,"sc","video-image"),attrs:{_i:2},on:{click:e.recordSubmit}},[i("image",{directives:[{name:"show",rawName:"v-show",value:e._$s(3,"v-show",!e.isRcord),expression:"_$s(3,'v-show',!isRcord)"}],attrs:{src:e._$s(3,"a-src",n("07e4")),_i:3}}),i("image",{directives:[{name:"show",rawName:"v-show",value:e._$s(4,"v-show",e.isRcord),expression:"_$s(4,'v-show',isRcord)"}],attrs:{src:e._$s(4,"a-src",n("3065")),_i:4}})]),i("textarea",{directives:[{name:"show",rawName:"v-show",value:e._$s(5,"v-show",!e.isRcord),expression:"_$s(5,'v-show',!isRcord)"},{name:"model",rawName:"v-model",value:e.message,expression:"message"}],staticClass:e._$s(5,"sc","submit-text"),attrs:{_i:5},domProps:{value:e._$s(5,"v-model",e.message)},on:{input:[function(t){t.target.composing||(e.message=t.target.value)},e.inputSubmit],focus:e.Focus}}),i("view",{directives:[{name:"show",rawName:"v-show",value:e._$s(6,"v-show",e.isRcord),expression:"_$s(6,'v-show',isRcord)"}],staticClass:e._$s(6,"sc","submit-record"),attrs:{_i:6},on:{touchstart:e.touchstart,touchend:e.touchend,touchmove:e.touchmove}}),i("view",{staticClass:e._$s(7,"sc","emoji-image"),attrs:{_i:7},on:{click:e.emojiSubmit}},[i("image",{attrs:{src:e._$s(8,"a-src",n("761b")),_i:8}})]),i("view",{staticClass:e._$s(9,"sc","more-image"),attrs:{_i:9},on:{click:e.moreSubmit}},[i("image",{attrs:{src:e._$s(10,"a-src",n("29e4")),_i:10}})])]),i("view",{directives:[{name:"show",rawName:"v-show",value:e._$s(11,"v-show",e.isEmogji),expression:"_$s(11,'v-show',isEmogji)"}],staticClass:e._$s(11,"sc","emoji"),attrs:{_i:11}},[i("view",{staticClass:e._$s(12,"sc","emoji-submit"),attrs:{_i:12}},[i("view",{staticClass:e._$s(13,"sc","send"),attrs:{_i:13},on:{click:e.EmojiSend}}),i("view",{staticClass:e._$s(14,"sc","remove"),attrs:{_i:14},on:{click:e.EmojiBack}})]),i("Emoji",{attrs:{_i:15},on:{SendEmoji:e.Emoji}})],1),i("view",{directives:[{name:"show",rawName:"v-show",value:e._$s(16,"v-show",e.isMore),expression:"_$s(16,'v-show',isMore)"}],staticClass:e._$s(16,"sc","more"),attrs:{_i:16}},[i("view",{staticClass:e._$s(17,"sc","more-list"),attrs:{_i:17},on:{click:function(t){return e.sendImg("ablum")}}},[i("image",{attrs:{src:e._$s(18,"a-src",n("fd70")),_i:18}}),i("view",{staticClass:e._$s(19,"sc","moer-list-title"),attrs:{_i:19}})]),i("view",{staticClass:e._$s(20,"sc","more-list"),attrs:{_i:20},on:{click:function(t){return e.sendImg("camera")}}},[i("image",{attrs:{src:e._$s(21,"a-src",n("fadf")),_i:21}}),i("view",{staticClass:e._$s(22,"sc","moer-list-title"),attrs:{_i:22}})]),i("view",{staticClass:e._$s(23,"sc","more-list"),attrs:{_i:23},on:{click:e.getLocation}},[i("image",{attrs:{src:e._$s(24,"a-src",n("52a5")),_i:24}}),i("view",{staticClass:e._$s(25,"sc","moer-list-title"),attrs:{_i:25}})]),i("view",{staticClass:e._$s(26,"sc","more-list"),attrs:{_i:26},on:{click:e.playSubmit}},[i("image",{attrs:{src:e._$s(27,"a-src",n("2715")),_i:27}}),i("view",{staticClass:e._$s(28,"sc","moer-list-title"),attrs:{_i:28}})]),i("view",{staticClass:e._$s(29,"sc","more-list"),attrs:{_i:29},on:{click:e.voiceSubmit}},[i("image",{attrs:{src:e._$s(30,"a-src",n("fed8")),_i:30}}),i("view",{staticClass:e._$s(31,"sc","moer-list-title"),attrs:{_i:31}})])]),i("view",{directives:[{name:"show",rawName:"v-show",value:e._$s(32,"v-show",e.isVoice),expression:"_$s(32,'v-show',isVoice)"}],staticClass:e._$s(32,"sc","voice-button"),attrs:{_i:32}},[i("view",{staticClass:e._$s(33,"sc","voice-length"),attrs:{_i:33}},[i("view",{staticClass:e._$s(34,"sc","voice-time"),style:e._$s(34,"s",{width:e.voiceLength/.6+"%"}),attrs:{_i:34}},[e._v(e._$s(34,"t0-0",e._s(e.voiceLength)))]),i("view",{staticClass:e._$s(35,"sc","voice-delete"),attrs:{_i:35}})])])])},o=[]},a395:function(e,t,n){var i=n("7037")["default"],o=n("e50d");e.exports=function(e){var t=o(e,"string");return"symbol"===i(t)?t:String(t)},e.exports.__esModule=!0,e.exports["default"]=e.exports},a763:function(e,t,n){"use strict";n.r(t);var i=n("194b"),o=n.n(i);for(var s in i)["default"].indexOf(s)<0&&function(e){n.d(t,e,(function(){return i[e]}))}(s);t["default"]=o.a},a970:function(e,t,n){"use strict";n.d(t,"b",(function(){return i})),n.d(t,"c",(function(){return o})),n.d(t,"a",(function(){}));var i=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("view",{directives:[{name:"show",rawName:"v-show",value:e._$s(0,"v-show",e.show),expression:"_$s(0,'v-show',show)"}],ref:"cropper",staticClass:e._$s(0,"sc","vue-cropper"),style:e._$s(0,"s",{top:e.containerTop+"px"}),attrs:{_i:0},on:{touchmove:function(e){e.stopPropagation(),e.preventDefault()}}},[n("view",{staticClass:e._$s(1,"sc","cropper-box"),attrs:{_i:1}},[n("view",{staticClass:e._$s(2,"sc","cropper-box-canvas"),style:e._$s(2,"s",{width:e.imageWidth+"px",height:e.imageHeight+"px",transform:"scale("+e.scale+","+e.scale+") translate3d("+e.x/e.scale+"px,"+e.y/e.scale+"px,0)rotateZ("+90*e.rotate+"deg)"}),attrs:{_i:2},on:{touchstart:function(t){return t.stopPropagation(),t.preventDefault(),e.imgTouchStart(t)},touchmove:function(t){return t.stopPropagation(),t.preventDefault(),e.imgMoveing(t)},touchend:function(t){return t.stopPropagation(),t.preventDefault(),e.imgMoveEnd(t)}}},[n("image",{ref:"cropperImg",staticClass:e._$s(3,"sc","uni-image"),attrs:{src:e._$s(3,"a-src",e.src),_i:3}})])]),n("view",{staticClass:e._$s(4,"sc","cropper-drag-box cropper-modal cropper-move pointer-events"),attrs:{_i:4}}),n("view",{staticClass:e._$s(5,"sc","cropper-crop-box"),class:e._$s(5,"c",{"pointer-events":e.cropFixed}),style:e._$s(5,"s",{width:e.cropW+"px",height:e.cropH+"px",transform:"translate3d("+e.cropOffsertX+"px,"+e.cropOffsertY+"px,0)"}),attrs:{_i:5}},[n("view",{staticClass:e._$s(6,"sc","cropper-view-box"),attrs:{_i:6}},[n("image",{style:e._$s(7,"s",{width:e.imageWidth+"px",height:e.imageHeight+"px",transform:"scale("+e.scale+","+e.scale+") translate3d("+(e.x-e.cropOffsertX)/e.scale+"px,"+(e.y-e.cropOffsertY)/e.scale+"px,0)rotateZ("+90*e.rotate+"deg)"}),attrs:{src:e._$s(7,"a-src",e.src),_i:7}})]),e._$s(8,"i",!e.cropFixed)?n("view",{staticClass:e._$s(8,"sc","cropper-face cropper-move"),attrs:{_i:8},on:{touchstart:function(t){return t.stopPropagation(),t.preventDefault(),e.touchStart(t)},touchmove:function(t){return t.stopPropagation(),t.preventDefault(),e.cropMoveing(t)}}}):e._e(),n("view",{staticClass:e._$s(9,"sc","crop-line line-w"),attrs:{_i:9}}),n("view",{staticClass:e._$s(10,"sc","crop-line line-a"),attrs:{_i:10}}),n("view",{staticClass:e._$s(11,"sc","crop-line line-s"),attrs:{_i:11}}),n("view",{staticClass:e._$s(12,"sc","crop-line line-d"),attrs:{_i:12}}),e._$s(13,"i",!e.cropFixed)?[n("view",{staticClass:e._$s(14,"sc","crop-point point-lt"),attrs:{_i:14},on:{touchstart:function(t){return t.stopPropagation(),t.preventDefault(),e.touchStart(t)},touchmove:function(t){return t.stopPropagation(),t.preventDefault(),e.dragMove(t,"left-top")}}}),n("view",{staticClass:e._$s(15,"sc","crop-point point-mt"),attrs:{_i:15},on:{touchstart:function(t){return t.stopPropagation(),t.preventDefault(),e.touchStart(t)},touchmove:function(t){return t.stopPropagation(),t.preventDefault(),e.dragMove(t,"middle-top")}}}),n("view",{staticClass:e._$s(16,"sc","crop-point point-rt"),attrs:{_i:16},on:{touchstart:function(t){return t.stopPropagation(),t.preventDefault(),e.touchStart(t)},touchmove:function(t){return t.stopPropagation(),t.preventDefault(),e.dragMove(t,"right-top")}}}),n("view",{staticClass:e._$s(17,"sc","crop-point point-ml"),attrs:{_i:17},on:{touchstart:function(t){return t.stopPropagation(),t.preventDefault(),e.touchStart(t)},touchmove:function(t){return t.stopPropagation(),t.preventDefault(),e.dragMove(t,"middle-left")}}}),n("view",{staticClass:e._$s(18,"sc","crop-point point-mr"),attrs:{_i:18},on:{touchstart:function(t){return t.stopPropagation(),t.preventDefault(),e.touchStart(t)},touchmove:function(t){return t.stopPropagation(),t.preventDefault(),e.dragMove(t,"middle-right")}}}),n("view",{staticClass:e._$s(19,"sc","crop-point point-lb"),attrs:{_i:19},on:{touchstart:function(t){return t.stopPropagation(),t.preventDefault(),e.touchStart(t)},touchmove:function(t){return t.stopPropagation(),t.preventDefault(),e.dragMove(t,"left-bottom")}}}),n("view",{staticClass:e._$s(20,"sc","crop-point point-mb"),attrs:{_i:20},on:{touchstart:function(t){return t.stopPropagation(),t.preventDefault(),e.touchStart(t)},touchmove:function(t){return t.stopPropagation(),t.preventDefault(),e.dragMove(t,"middle-bottom")}}}),n("view",{staticClass:e._$s(21,"sc","crop-point point-rb"),attrs:{_i:21},on:{touchstart:function(t){return t.stopPropagation(),t.preventDefault(),e.touchStart(t)},touchmove:function(t){return t.stopPropagation(),t.preventDefault(),e.dragMove(t,"right-bottom")}}})]:e._e()],2),n("canvas",{staticClass:e._$s(22,"sc","cropper-canvas"),style:e._$s(22,"s",{width:e.cropW+"px",height:e.cropH+"px"}),attrs:{id:"myCanvas",_i:22}}),n("view",{staticClass:e._$s(23,"sc","btn-group"),attrs:{_i:23}},[n("view",{directives:[{name:"show",rawName:"v-show",value:e._$s(24,"v-show",e.showResetBtn),expression:"_$s(24,'v-show',showResetBtn)"}],staticClass:e._$s(24,"sc","btn-item reset-btn"),attrs:{_i:24},on:{click:e.init}}),n("view",{directives:[{name:"show",rawName:"v-show",value:e._$s(25,"v-show",e.showRotateBtn),expression:"_$s(25,'v-show',showRotateBtn)"}],staticClass:e._$s(25,"sc","btn-item rotate-btn"),attrs:{_i:25},on:{click:e.rotateHandler}})]),n("view",{staticClass:e._$s(26,"sc","uni-info__ft"),attrs:{_i:26}},[n("view",{staticClass:e._$s(27,"sc","uni-modal__btn uni-modal__btn_default"),attrs:{_i:27},on:{click:e.cancel}}),n("view",{staticClass:e._$s(28,"sc","uni-modal__btn uni-modal__btn_primary"),attrs:{_i:28},on:{click:e.confirm}})])])},o=[]},ab83:function(e,t,n){"use strict";n.r(t);var i=n("5ab8"),o=n.n(i);for(var s in i)["default"].indexOf(s)<0&&function(e){n.d(t,e,(function(){return i[e]}))}(s);t["default"]=o.a},ac05:function(e,t,n){"use strict";(function(e){var i=n("4ea4");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;i(n("d602"));var o=i(n("76e1")),s=i(n("52ef")),r={data:function(){return{UserID:"",uid:"",uname:"",token:"",gid:"",gimg:"",gname:"",time:"",notice:"",nickname:"",groupMember:[],newMember:[],newUser:[],autoplay:!1,top:0,modifyHeight:"",animationData:{},animationData2:{},tempFilePath:"",cropFilePath:"../../static/images/index/\u9ed8\u8ba4\u5934\u50cf.jpeg",image:"",isAdd:!1,title:"",data:"\u4fee\u6539\u7684\u5185\u5bb9",isModfiy:!1,oldData:"",modifyTitle:"",selectedNum:0}},components:{ImageCropper:o.default},onLoad:function(e){this.getStorage(),this.gid=e.gid,this.gimg=e.gimg,this.getGroupMeb(),this.getGroupDetail(),this.getNickname(),this.getFriends()},onReady:function(){this.getElementStyle(),this.getModify()},methods:{goBack:function(){uni.reLaunch({url:"../index/index"})},changeSwiper:function(e){this.autoplay=!this.autoplay},getElementStyle:function(){var e=this,t=uni.createSelectorQuery().in(this);t.select(".main-inner").boundingClientRect((function(t){e.top=t.top})).exec()},addAnimation:function(){var e=uni.createAnimation({duration:800,timingFunction:"linear"});this.animation=e,this.top<50?e.opacity(1).step():e.opacity(0).step(),this.animationData=e.export()},onPageScroll:function(){this.getElementStyle(),this.addAnimation()},selectFriend:function(e){this.newMember[e].selected?(this.newMember[e].selected=!1,this.selectedNum--):(this.newMember[e].selected=!0,this.selectedNum++)},upload:function(){var e=this;uni.chooseImage({count:1,sizeType:["original","compressed"],sourceType:["album"],success:function(t){e.tempFilePath=t.tempFilePaths.shift()}})},confirm:function(t){var n=this;this.tempFilePath="",this.cropFilePath=t.detail.tempFilePath,this.image=t.detail.tempFilePath,uni.uploadFile({url:this.serverUrl+"/files/upload",filePath:this.cropFilePath,name:"file",fileType:this.image,formData:{url:"group",name:this.gid,token:this.token},success:function(e){var t=e.data;n.gimg=t;var i=getCurrentPages(),o=i[i.length-1];uni.reLaunch({url:o.$page.fullPath}),n.update(n.gimg,"imgUrl")},fail:function(t){e("log","this is errormes "+t.message," at pages/groupDatail/groupDatail.vue:288")}})},cancel:function(){e("log","canceled"," at pages/groupDatail/groupDatail.vue:293"),this.tempFilePath=""},getStorage:function(){try{var t=uni.getStorageSync("user");t?(this.uid=t.id,this.uname=t.name,this.token=t.token,e("log",this.uname," at pages/groupDatail/groupDatail.vue:304")):uni.navigateTo({url:"../login/login"})}catch(n){}},changeTime:function(e){return s.default.dateTime_Three(e)},getGroupDetail:function(){var e=this;uni.request({url:this.serverUrl+"/group/getGroupDetail",data:{gid:this.gid,token:this.token},method:"POST",success:function(t){var n=t.data.code;if(200==n){var i=t.data.result;i.imgUrl=e.serverUrl+i.imgUrl,e.cropFilePath=i.imgUrl,e.gname=i.name,e.time=i.time,e.UserID=i.userID,void 0==i.notice&&(i.notice="\u8fd8\u6ca1\u6709\u7fa4\u7b80\u4ecb~~"),e.notice=i.notice,e.gimg=i.imgUrl}else 500==n?uni.showToast({title:"\u7fa4\u804a\u670d\u52a1\u5668\u51fa\u9519\u5566\uff01",icon:"none",duration:2e3}):300==n&&uni.navigateTo({url:"../login/login?name="+e.name})}})},getNickname:function(){var e=this;uni.request({url:this.serverUrl+"/group/getGroupNickname",data:{uid:this.uid,gid:this.gid,token:this.token},method:"POST",success:function(t){var n=t.data.code;if(200==n){var i=t.data.result;void 0==i.name?e.nickname=e.uname:e.nickname=i.name}else 500==n?uni.showToast({title:"\u7fa4\u804a\u670d\u52a1\u5668\u51fa\u9519\u5566\uff01",icon:"none",duration:2e3}):300==n&&uni.navigateTo({url:"../login/login?name="+e.name})}})},changeNickname:function(t){var n=this;this.data.length>0&&this.data!=this.oldData&&uni.request({url:this.serverUrl+"/group/nicknameChange",data:{uid:this.uid,gid:this.gid,nickname:t,token:this.token},method:"POST",success:function(t){var i=t.data.code;if(200==i){t.data.result;e("log","\u4fee\u6539\u6635\u79f0"," at pages/groupDatail/groupDatail.vue:407")}else 500==i?uni.showToast({title:"\u7fa4\u804a\u670d\u52a1\u5668\u51fa\u9519\u5566\uff01",icon:"none",duration:2e3}):300==i&&uni.navigateTo({url:"../login/login?name="+n.name})}})},getGroupMeb:function(){var e=this;uni.request({url:this.serverUrl+"/group/getGroupMeb",data:{gid:this.gid,token:this.token},method:"POST",success:function(t){var n=t.data.code;if(200==n)for(var i=t.data.result,o=0;o<i.length;o++)i[o].imgUrl=e.serverUrl+i[o].imgUrl,e.groupMember.push(i[o]);else 500==n?uni.showToast({title:"\u7fa4\u804a\u670d\u52a1\u5668\u51fa\u9519\u5566\uff01",icon:"none",duration:2e3}):300==n&&uni.navigateTo({url:"../login/login?name="+e.name})}})},getModify:function(){var e=this,t=uni.createSelectorQuery().in(this);t.select(".modify").boundingClientRect((function(t){e.modifyHeight=t.height})).exec()},modify:function(e,t,n,i){this.oldData=n,this.data=n,this.title=e,this.modifyTitle=t,this.isModfiy=!this.isModfiy,this.isAdd=i;var o=uni.createAnimation({duration:1e3,timingFunction:"ease"});this.isModfiy?o.bottom(0).step():o.bottom(-this.modifyHeight).step(),this.animationData2=o.export()},modifySubmit:function(){this.data.length>0&&this.data!=this.oldData&&("name"==this.title?(this.gname=this.data,this.update(this.gname,"name")):"notice"==this.title?(this.notice=this.data,this.update(this.notice,"notice")):(this.nickname=this.data,this.changeNickname(this.nickname))),this.modify()},update:function(t,n){var i=this;uni.request({url:this.serverUrl+"/group/updateGroup",data:{uid:this.uid,gid:this.gid,type:n,data:t,token:this.token},method:"POST",success:function(t){var n=t.data.code;if(200==n){t.data.result;e("log","\u6210\u529f"," at pages/groupDatail/groupDatail.vue:517")}else 500==n?uni.showToast({title:"\u7fa4\u804a\u670d\u52a1\u5668\u51fa\u9519\u5566\uff01",icon:"none",duration:2e3}):300==n&&uni.navigateTo({url:"../login/login?name="+i.name})}})},getFriends:function(){var e=this;uni.request({url:this.serverUrl+"/home/getFriend",data:{uid:this.uid,state:0,token:this.token},method:"POST",success:function(t){var n=t.data.code;if(200==n)for(var i=t.data.result,o=0;o<i.length;o++)i[o].imgUrl=e.serverUrl+i[o].imgUrl,i[o].selected=!1,e.getNewMember(i[o]);else 500==n?uni.showToast({title:"\u670d\u52a1\u5668\u51fa\u9519\u5566\uff01",icon:"none",duration:2e3}):300==n&&uni.navigateTo({url:"../login/login?name="+e.name})}})},getNewMember:function(e){var t=this,n=0;uni.request({url:this.serverUrl+"/search/matchGroup",data:{uid:e.id,gid:this.gid,token:this.token},method:"POST",success:function(i){var o=i.data.code;200==o?(n=0,e.tip=n):400==o?(n=1,e.tip=n,t.newMember.push(e)):500==o?uni.showToast({title:"\u670d\u52a1\u5668\u51fa\u9519\u5566\uff01",icon:"none",duration:2e3}):300==o&&uni.navigateTo({url:"../login/login?name="+t.name})}})},addMember:function(){var t=this;if(this.selectedNum){for(var n=0;n<this.newMember.length;n++)this.newMember[n].selected&&this.newUser.push(this.newMember[n].id);uni.request({url:this.serverUrl+"/group/insertGroup",data:{gid:this.gid,user:this.newUser,token:this.token},method:"POST",success:function(n){var i=n.data.code;if(200==i){var o=getCurrentPages(),s=o[o.length-1];uni.navigateTo({url:s.$page.fullPath}),e("log","\u6dfb\u52a0\u65b0\u6210\u5458\u6210\u529f"," at pages/groupDatail/groupDatail.vue:629")}else 500==i?uni.showToast({title:"\u670d\u52a1\u5668\u51fa\u9519\u5566\uff01",icon:"none",duration:2e3}):300==i&&uni.navigateTo({url:"../login/login?name="+t.name})}})}this.modify()},deleteGroupMeb:function(t){var n=this;this.UserID!==t&&uni.showModal({title:"\u63d0\u793a",content:"\u786e\u8ba4\u5220\u9664\u5417?",success:function(i){uni.request({url:n.serverUrl+"/group/deleteGroup",data:{gid:n.gid,uid:t,token:n.token},method:"POST",success:function(t){var i=t.data.code;if(200==i){var o=getCurrentPages(),s=o[o.length-1];e("log",s.$page.fullPath," at pages/groupDatail/groupDatail.vue:668"),uni.navigateTo({url:s.$page.fullPath})}else 500==i?uni.showToast({title:"\u670d\u52a1\u5668\u51fa\u9519\u5566\uff01",icon:"none",duration:2e3}):300==i&&uni.navigateTo({url:"../login/login?name="+n.name})}})}})},leaveGroup:function(){var e=this;uni.showModal({title:"\u63d0\u793a",content:"\u786e\u8ba4\u9000\u51fa\u7fa4\u804a\u5417?",success:function(t){uni.request({url:e.serverUrl+"/group/deleteGroup",data:{gid:e.gid,uid:e.uid,token:e.token},method:"POST",success:function(t){var n=t.data.code;200==n?uni.reLaunch({url:"../index/index"}):500==n?uni.showToast({title:"\u670d\u52a1\u5668\u51fa\u9519\u5566\uff01",icon:"none",duration:2e3}):300==n&&uni.navigateTo({url:"../login/login?name="+e.name})}})}})},deleteGroup:function(){var e=this;uni.showModal({title:"\u63d0\u793a",content:"\u786e\u8ba4\u5220\u9664\u7fa4\u804a\u5417?",success:function(t){uni.request({url:e.serverUrl+"/group/deleteGroups",data:{gid:e.gid,token:e.token},method:"POST",success:function(t){var n=t.data.code;200==n?uni.reLaunch({url:"../index/index"}):500==n?uni.showToast({title:"\u670d\u52a1\u5668\u51fa\u9519\u5566\uff01",icon:"none",duration:2e3}):300==n&&uni.navigateTo({url:"../login/login?name="+e.name})}})}})}}};t.default=r}).call(this,n("0de9")["default"])},ac6e:function(e,t,n){"use strict";n.d(t,"b",(function(){return i})),n.d(t,"c",(function(){return o})),n.d(t,"a",(function(){}));var i=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("view",[n("view",{staticClass:e._$s(1,"sc","test"),attrs:{_i:1},on:{click:e.upload}}),e._l(e._$s(2,"f",{forItems:e.img}),(function(t,i,o,s){return n("image",{key:e._$s(2,"f",{forIndex:o,key:i}),attrs:{src:e._$s("2-"+s,"a-src",t),_i:"2-"+s}})}))],2)},o=[]},ad8f:function(e,t,n){"use strict";n.r(t);var i=n("f3ed"),o=n("510e");for(var s in o)["default"].indexOf(s)<0&&function(e){n.d(t,e,(function(){return o[e]}))}(s);var r=n("f0c5"),a=Object(r["a"])(o["default"],i["b"],i["c"],!1,null,null,null,!1,i["a"],void 0);t["default"]=a.exports},b45f:function(e,t){e.exports="/static/images/index/noone.png"},b5d1:function(e,t,n){"use strict";(function(i,o,s){var r,a,c=n("7037");!function(i,o){"object"==c(t)&&"undefined"!=typeof e?e.exports=o():(r=o,a="function"===typeof r?r.call(t,n,t,e):r,void 0===a||(e.exports=a))}(0,(function(){function e(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function t(t){for(var n=1;n<arguments.length;n++){var i=null!=arguments[n]?arguments[n]:{};n%2?e(Object(i),!0).forEach((function(e){l(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):e(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}function n(e){return(n="function"==typeof Symbol&&"symbol"==c(Symbol.iterator)?function(e){return c(e)}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":c(e)})(e)}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function u(e,t,n){return t&&a(e.prototype,t),n&&a(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function l(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function d(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&h(e,t)}function p(e){return(p=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function h(e,t){return(h=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function f(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function g(e,t,n){return(g=f()?Reflect.construct:function(e,t,n){var i=[null];i.push.apply(i,t);var o=new(Function.bind.apply(e,i));return n&&h(o,n.prototype),o}).apply(null,arguments)}function _(e){var t="function"==typeof Map?new Map:void 0;return(_=function(e){if(null===e||(n=e,-1===Function.toString.call(n).indexOf("[native code]")))return e;var n;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,i)}function i(){return g(e,arguments,p(this).constructor)}return i.prototype=Object.create(e.prototype,{constructor:{value:i,enumerable:!1,writable:!0,configurable:!0}}),h(i,e)})(e)}function v(e,t){if(null==e)return{};var n,i,o=function(e,t){if(null==e)return{};var n,i,o={},s=Object.keys(e);for(i=0;i<s.length;i++)n=s[i],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(i=0;i<s.length;i++)n=s[i],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}function m(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function y(e,t){if(t&&("object"==c(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return m(e)}function M(e){var t=f();return function(){var n,i=p(e);if(t){var o=p(this).constructor;n=Reflect.construct(i,arguments,o)}else n=i.apply(this,arguments);return y(this,n)}}function I(e,t){return T(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var i,o,s=[],r=!0,a=!1;try{for(n=n.call(e);!(r=(i=n.next()).done)&&(s.push(i.value),!t||s.length!==t);r=!0);}catch(p){a=!0,o=p}finally{try{r||null==n.return||n.return()}finally{if(a)throw o}}return s}}(e,t)||S(e,t)||D()}function C(e){return function(e){if(Array.isArray(e))return E(e)}(e)||k(e)||S(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function T(e){if(Array.isArray(e))return e}function k(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function S(e,t){if(e){if("string"==typeof e)return E(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?E(e,t):void 0}}function E(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}function D(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function w(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=S(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0,o=function(){};return{s:o,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s,r=!0,a=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return r=e.done,e},e:function(e){a=!0,s=e},f:function(){try{r||null==n.return||n.return()}finally{if(a)throw s}}}}var A={SDK_READY:"sdkStateReady",SDK_NOT_READY:"sdkStateNotReady",SDK_DESTROY:"sdkDestroy",MESSAGE_RECEIVED:"onMessageReceived",MESSAGE_MODIFIED:"onMessageModified",MESSAGE_REVOKED:"onMessageRevoked",MESSAGE_READ_BY_PEER:"onMessageReadByPeer",MESSAGE_READ_RECEIPT_RECEIVED:"onMessageReadReceiptReceived",MESSAGE_EXTENSIONS_UPDATED:"onMessageExtensionsUpdated",MESSAGE_EXTENSIONS_DELETED:"onMessageExtensionsDeleted",CONVERSATION_LIST_UPDATED:"onConversationListUpdated",TOTAL_UNREAD_MESSAGE_COUNT_UPDATED:"onTotalUnreadMessageCountUpdated",CONVERSATION_GROUP_LIST_UPDATED:"onConversationGroupListUpdated",CONVERSATION_IN_GROUP_UPDATED:"onConversationInGroupUpdated",GROUP_LIST_UPDATED:"onGroupListUpdated",GROUP_SYSTEM_NOTICE_RECEIVED:"receiveGroupSystemNotice",GROUP_ATTRIBUTES_UPDATED:"groupAttributesUpdated",GROUP_COUNTER_UPDATED:"onGroupCounterUpdated",TOPIC_CREATED:"onTopicCreated",TOPIC_DELETED:"onTopicDeleted",TOPIC_UPDATED:"onTopicUpdated",PROFILE_UPDATED:"onProfileUpdated",USER_STATUS_UPDATED:"onUserStatusUpdated",BLACKLIST_UPDATED:"blacklistUpdated",FRIEND_LIST_UPDATED:"onFriendListUpdated",FRIEND_GROUP_LIST_UPDATED:"onFriendGroupListUpdated",FRIEND_APPLICATION_LIST_UPDATED:"onFriendApplicationListUpdated",KICKED_OUT:"kickedOut",ERROR:"error",NET_STATE_CHANGE:"netStateChange",SDK_RELOAD:"sdkReload"},b={MSG_TEXT:"TIMTextElem",MSG_IMAGE:"TIMImageElem",MSG_SOUND:"TIMSoundElem",MSG_AUDIO:"TIMSoundElem",MSG_FILE:"TIMFileElem",MSG_FACE:"TIMFaceElem",MSG_VIDEO:"TIMVideoFileElem",MSG_GEO:"TIMLocationElem",MSG_LOCATION:"TIMLocationElem",MSG_GRP_TIP:"TIMGroupTipElem",MSG_GRP_SYS_NOTICE:"TIMGroupSystemNoticeElem",MSG_CUSTOM:"TIMCustomElem",MSG_MERGER:"TIMRelayElem",MSG_PRIORITY_HIGH:"High",MSG_PRIORITY_NORMAL:"Normal",MSG_PRIORITY_LOW:"Low",MSG_PRIORITY_LOWEST:"Lowest",CONV_C2C:"C2C",CONV_GROUP:"GROUP",CONV_TOPIC:"TOPIC",CONV_SYSTEM:"@TIM#SYSTEM",CONV_AT_ME:1,CONV_AT_ALL:2,CONV_AT_ALL_AT_ME:3,CONV_MARK_TYPE_STAR:1,CONV_MARK_TYPE_UNREAD:2,CONV_MARK_TYPE_FOLD:4,CONV_MARK_TYPE_HIDE:8,GRP_PRIVATE:"Private",GRP_WORK:"Private",GRP_PUBLIC:"Public",GRP_CHATROOM:"ChatRoom",GRP_MEETING:"ChatRoom",GRP_AVCHATROOM:"AVChatRoom",GRP_COMMUNITY:"Community",GRP_MBR_ROLE_OWNER:"Owner",GRP_MBR_ROLE_ADMIN:"Admin",GRP_MBR_ROLE_MEMBER:"Member",GRP_MBR_ROLE_CUSTOM:"Custom",GRP_TIP_MBR_JOIN:1,GRP_TIP_MBR_QUIT:2,GRP_TIP_MBR_KICKED_OUT:3,GRP_TIP_MBR_SET_ADMIN:4,GRP_TIP_MBR_CANCELED_ADMIN:5,GRP_TIP_GRP_PROFILE_UPDATED:6,GRP_TIP_MBR_PROFILE_UPDATED:7,GRP_TIP_BAN_AVCHATROOM_MEMBER:10,GRP_TIP_UNBAN_AVCHATROOM_MEMBER:11,MSG_REMIND_ACPT_AND_NOTE:"AcceptAndNotify",MSG_REMIND_ACPT_NOT_NOTE:"AcceptNotNotify",MSG_REMIND_DISCARD:"Discard",GENDER_UNKNOWN:"Gender_Type_Unknown",GENDER_FEMALE:"Gender_Type_Female",GENDER_MALE:"Gender_Type_Male",KICKED_OUT_MULT_ACCOUNT:"multipleAccount",KICKED_OUT_MULT_DEVICE:"multipleDevice",KICKED_OUT_USERSIG_EXPIRED:"userSigExpired",KICKED_OUT_REST_API:"REST_API_Kick",ALLOW_TYPE_ALLOW_ANY:"AllowType_Type_AllowAny",ALLOW_TYPE_NEED_CONFIRM:"AllowType_Type_NeedConfirm",ALLOW_TYPE_DENY_ANY:"AllowType_Type_DenyAny",FORBID_TYPE_NONE:"AdminForbid_Type_None",FORBID_TYPE_SEND_OUT:"AdminForbid_Type_SendOut",JOIN_OPTIONS_FREE_ACCESS:"FreeAccess",JOIN_OPTIONS_NEED_PERMISSION:"NeedPermission",JOIN_OPTIONS_DISABLE_APPLY:"DisableApply",JOIN_STATUS_SUCCESS:"JoinedSuccess",JOIN_STATUS_ALREADY_IN_GROUP:"AlreadyInGroup",JOIN_STATUS_WAIT_APPROVAL:"WaitAdminApproval",INVITE_OPTIONS_DISABLE_INVITE:"DisableInvite",INVITE_OPTIONS_NEED_PERMISSION:"NeedPermission",INVITE_OPTIONS_FREE_ACCESS:"FreeAccess",GRP_PROFILE_OWNER_ID:"ownerID",GRP_PROFILE_CREATE_TIME:"createTime",GRP_PROFILE_LAST_INFO_TIME:"lastInfoTime",GRP_PROFILE_MEMBER_NUM:"memberNum",GRP_PROFILE_MAX_MEMBER_NUM:"maxMemberNum",GRP_PROFILE_JOIN_OPTION:"joinOption",GRP_PROFILE_INVITE_OPTION:"inviteOption",GRP_PROFILE_INTRODUCTION:"introduction",GRP_PROFILE_NOTIFICATION:"notification",GRP_PROFILE_MUTE_ALL_MBRS:"muteAllMembers",SNS_ADD_TYPE_SINGLE:"Add_Type_Single",SNS_ADD_TYPE_BOTH:"Add_Type_Both",SNS_DELETE_TYPE_SINGLE:"Delete_Type_Single",SNS_DELETE_TYPE_BOTH:"Delete_Type_Both",SNS_APPLICATION_TYPE_BOTH:"Pendency_Type_Both",SNS_APPLICATION_SENT_TO_ME:"Pendency_Type_ComeIn",SNS_APPLICATION_SENT_BY_ME:"Pendency_Type_SendOut",SNS_APPLICATION_AGREE:"Response_Action_Agree",SNS_APPLICATION_AGREE_AND_ADD:"Response_Action_AgreeAndAdd",SNS_CHECK_TYPE_BOTH:"CheckResult_Type_Both",SNS_CHECK_TYPE_SINGLE:"CheckResult_Type_Single",SNS_TYPE_NO_RELATION:"CheckResult_Type_NoRelation",SNS_TYPE_A_WITH_B:"CheckResult_Type_AWithB",SNS_TYPE_B_WITH_A:"CheckResult_Type_BWithA",SNS_TYPE_BOTH_WAY:"CheckResult_Type_BothWay",NET_STATE_CONNECTED:"connected",NET_STATE_CONNECTING:"connecting",NET_STATE_DISCONNECTED:"disconnected",MSG_AT_ALL:"__kImSDK_MesssageAtALL__",READ_ALL_C2C_MSG:"readAllC2CMessage",READ_ALL_GROUP_MSG:"readAllGroupMessage",READ_ALL_MSG:"readAllMessage",USER_STATUS_UNKNOWN:0,USER_STATUS_ONLINE:1,USER_STATUS_OFFLINE:2,USER_STATUS_UNLOGINED:3},L=function(){function e(){r(this,e),this.cache=[],this.options=null}return u(e,[{key:"use",value:function(e){if("function"!=typeof e)throw"middleware must be a function";return this.cache.push(e),this}},{key:"next",value:function(e){if(this.middlewares&&this.middlewares.length>0)return this.middlewares.shift().call(this,this.options,this.next.bind(this))}},{key:"run",value:function(e){return this.middlewares=this.cache.map((function(e){return e})),this.options=e,this.next()}}]),e}(),R=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;r(this,e),this.high=t,this.low=n}return u(e,[{key:"equal",value:function(e){return null!==e&&this.low===e.low&&this.high===e.high}},{key:"toString",value:function(){var e=Number(this.high).toString(16),t=Number(this.low).toString(16);if(t.length<8)for(var n=8-t.length;n;)t="0"+t,n--;return e+t}}]),e}(),O={TEST:{CHINA:{DEFAULT:"wss://wss-dev.tim.qq.com"},OVERSEA:{DEFAULT:"wss://wss-dev.tim.qq.com"},SINGAPORE:{DEFAULT:"wss://wsssgp-dev.im.qcloud.com"},KOREA:{DEFAULT:"wss://wsskr-dev.im.qcloud.com"},GERMANY:{DEFAULT:"wss://wssger-dev.im.qcloud.com"},IND:{DEFAULT:"wss://wssind-dev.im.qcloud.com"},JPN:{DEFAULT:"wss://wssjpn-dev.im.qcloud.com"},USA:{DEFAULT:"wss://wssusa-dev.im.qcloud.com"}},PRODUCTION:{CHINA:{DEFAULT:"wss://wss.im.qcloud.com",BACKUP:"wss://wss.tim.qq.com",STAT:"https://events.im.qcloud.com",ANYCAST:"wss://162.14.13.203"},OVERSEA:{DEFAULT:"wss://wss.im.qcloud.com",BACKUP:"wss://wss.my-imcloud.com",STAT:"https://api.my-imcloud.com"},SINGAPORE:{DEFAULT:"wss://wsssgp.im.qcloud.com",BACKUP:"wss://wsssgp.my-imcloud.com",STAT:"https://apisgp.my-imcloud.com"},KOREA:{DEFAULT:"wss://wsskr.im.qcloud.com",BACKUP:"wss://wsskr.my-imcloud.com",STAT:"https://apikr.my-imcloud.com"},GERMANY:{DEFAULT:"wss://wssger.im.qcloud.com",BACKUP:"wss://wssger.my-imcloud.com",STAT:"https://apiger.my-imcloud.com"},IND:{DEFAULT:"wss://wssind.my-imcloud.com",BACKUP:"wss://wssind.im.qcloud.com",STAT:"https://apiind.my-imcloud.com"},JPN:{DEFAULT:"wss://wssjpn.im.qcloud.com",BACKUP:"wss://wssjpn.my-imcloud.com",STAT:"https://apijpn.my-imcloud.com"},USA:{DEFAULT:"wss://wssusa.im.qcloud.com",BACKUP:"wss://wssusa.my-imcloud.com",STAT:"https://apiusa.my-imcloud.com"}}},N={ANDROID:2,IOS:3,MAC:4,WEB:7,WX_MP:8,QQ_MP:9,TT_MP:10,BAIDU_MP:11,ALI_MP:12,IPAD:13,UNI_NATIVE_APP:15},P="1.7.3",U=537048168,G="CHINA",x={HOST:{CURRENT:{DEFAULT:"wss://wss.im.qcloud.com",STAT:"https://events.im.qcloud.com"},setCurrent:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:G;this.CURRENT=O.PRODUCTION[e]}},NAME:{OPEN_IM:"openim",OPEN_IM_MSG_EXT:"openim_msg_ext_http_svc",GROUP:"group_open_http_svc",GROUP_AVCHATROOM:"group_open_avchatroom_http_svc",GROUP_COMMUNITY:"million_group_open_http_svc",GROUP_ATTR:"group_open_attr_http_svc",FRIEND:"sns",PROFILE:"profile",RECENT_CONTACT:"recentcontact",PIC:"openpic",BIG_GROUP_NO_AUTH:"group_open_http_noauth_svc",BIG_GROUP_LONG_POLLING:"group_open_long_polling_http_svc",BIG_GROUP_LONG_POLLING_NO_AUTH:"group_open_long_polling_http_noauth_svc",IM_OPEN_STAT:"imopenstat",WEB_IM:"webim",IM_COS_SIGN:"im_cos_sign_svr",CUSTOM_UPLOAD:"im_cos_msg",HEARTBEAT:"heartbeat",IM_OPEN_PUSH:"im_open_push",IM_OPEN_STATUS:"im_open_status",IM_LONG_MESSAGE:"im_long_msg",IM_CONFIG_MANAGER:"im_sdk_config_mgr",STAT_SERVICE:"StatSvc",OVERLOAD_PUSH:"OverLoadPush",IM_MSG_AUDIT_MGR:"im_msg_audit_mgr",TUIROOM_SVR:"tui_room_svr",IM_OPEN_TRANSLATE:"im_open_translate"},CMD:{LOGIN:"wslogin",LOGOUT_LONG_POLL:"longpollinglogout",LOGOUT:"wslogout",HELLO:"wshello",STAT_BACKGROUND:"ws_stat_background",STAT_FOREGROUND:"ws_stat_foreground",SET_TOKEN:"ws_stat_settoken",PORTRAIT_GET:"portrait_get_all",PORTRAIT_SET:"portrait_set",GET_LONG_POLL_ID:"getlongpollingid",LONG_POLL:"longpolling",AVCHATROOM_LONG_POLL:"get_msg",ADD_FRIEND:"friend_add",UPDATE_FRIEND:"friend_update",GET_FRIEND_LIST:"friend_get",GET_FRIEND_PROFILE:"friend_get_specified",DELETE_FRIEND:"friend_delete",CHECK_FRIEND:"friend_check",GET_FRIEND_GROUP_LIST:"group_get",RESPOND_FRIEND_APPLICATION:"friend_response",GET_FRIEND_APPLICATION_LIST:"pendency_get",DELETE_FRIEND_APPLICATION:"pendency_delete",REPORT_FRIEND_APPLICATION:"pendency_report",GET_GROUP_APPLICATION:"get_pendency",CREATE_FRIEND_GROUP:"group_add",DELETE_FRIEND_GROUP:"group_delete",UPDATE_FRIEND_GROUP:"group_update",GET_BLACKLIST:"black_list_get",ADD_BLACKLIST:"black_list_add",DELETE_BLACKLIST:"black_list_delete",CREATE_GROUP:"create_group",GET_JOINED_GROUPS:"get_joined_group_list",SET_GROUP_ATTRIBUTES:"set_group_attr",MODIFY_GROUP_ATTRIBUTES:"modify_group_attr",DELETE_GROUP_ATTRIBUTES:"delete_group_attr",CLEAR_GROUP_ATTRIBUTES:"clear_group_attr",GET_GROUP_ATTRIBUTES:"get_group_attr",SEND_MESSAGE:"sendmsg",REVOKE_C2C_MESSAGE:"msgwithdraw",DELETE_C2C_MESSAGE:"delete_c2c_msg_ramble",MODIFY_C2C_MESSAGE:"modify_c2c_msg",MODIFY_C2C_MESSAGE_EXTENSIONS:"set_key_values",GET_C2C_MESSAGE_EXTENSIONS:"get_key_values",SEND_GROUP_MESSAGE:"send_group_msg",REVOKE_GROUP_MESSAGE:"group_msg_recall",DELETE_GROUP_MESSAGE:"delete_group_ramble_msg_by_seq",MODIFY_GROUP_MESSAGE:"modify_group_msg",MODIFY_GROUP_MESSAGE_EXTENSIONS:"group_set_key_values",GET_GROUP_MESSAGE_EXTENSIONS:"group_get_key_values",GET_GROUP_INFO:"get_group_self_member_info",GET_GROUP_MEMBER_INFO:"get_specified_group_member_info",GET_GROUP_MEMBER_LIST:"get_group_member_info",GET_AVCHATROOM_MEMBER_LIST:"get_members",MARK_AVCHATROOM_MEMBER_INFO:"modify_user_info",QUIT_GROUP:"quit_group",CHANGE_GROUP_OWNER:"change_group_owner",DESTROY_GROUP:"destroy_group",ADD_GROUP_MEMBER:"add_group_member",DELETE_GROUP_MEMBER:"delete_group_member",BAN_AVCHATROOM_MEMBER:"ban_group_member",SEARCH_GROUP_BY_ID:"get_group_public_info",APPLY_JOIN_GROUP:"apply_join_group",HANDLE_APPLY_JOIN_GROUP:"handle_apply_join_group",HANDLE_INVITE_JOIN_GROUP:"handle_invite_join_permission_group",HANDLE_GROUP_INVITATION:"handle_invite_join_group",MODIFY_GROUP_INFO:"modify_group_base_info",MODIFY_GROUP_MEMBER_INFO:"modify_group_member_info",DELETE_GROUP_SYSTEM_MESSAGE:"deletemsg",DELETE_GROUP_AT_TIPS:"deletemsg",GET_GROUP_NOTIFY:"get_group_notify",GET_CONVERSATION_LIST:"get",PAGING_GET_CONVERSATION_LIST:"page_get",DELETE_CONVERSATION:"batch_delete",CLEAR_HISTORY_MESSAGE:"clear_msg",PIN_CONVERSATION:"top",SET_CONVERSATION_CUSTOM_DATA:"mark_contact",MARK_CONVERSATION:"mark_contact",CREATE_CONVERSATION_GROUP:"create_contact_group",DELETE_CONVERSATION_GROUP:"del_contact_group",UPDATE_CONVERSATION_GROUP:"update_contact_group",GET_CONVERSATION_GROUP_LIST:"get_contact_group",GET_MESSAGES:"getmsg",GET_C2C_ROAM_MESSAGES:"getroammsg",SET_C2C_PEER_MUTE_NOTIFICATIONS:"set_c2c_peer_mute_notifications",GET_C2C_PEER_MUTE_NOTIFICATIONS:"get_c2c_peer_mute_notifications",GET_GROUP_ROAM_MESSAGES:"group_msg_get",GET_READ_RECEIPT:"get_group_msg_receipt",GET_READ_RECEIPT_DETAIL:"get_group_msg_receipt_detail",SEND_READ_RECEIPT:"group_msg_receipt",SEND_C2C_READ_RECEIPT:"c2c_msg_read_receipt",SET_C2C_MESSAGE_READ:"msgreaded",GET_PEER_READ_TIME:"get_peer_read_time",SET_GROUP_MESSAGE_READ:"msg_read_report",FILE_READ_AND_WRITE_AUTHKEY:"authkey",FILE_UPLOAD:"pic_up",COS_SIGN:"cos",COS_PRE_SIG:"pre_sig",VIDEO_COVER:"video_cover",TIM_WEB_REPORT_V2:"tim_web_report_v2",BIG_DATA_HALLWAY_AUTH_KEY:"authkey",GET_ONLINE_MEMBER_NUM:"get_online_member_num",ALIVE:"alive",MESSAGE_PUSH:"msg_push",MULTI_MESSAGE_PUSH:"multi_msg_push_ws",MESSAGE_PUSH_ACK:"ws_msg_push_ack",STATUS_FORCE_OFFLINE:"stat_forceoffline",DOWNLOAD_MERGER_MESSAGE:"get_relay_json_msg",UPLOAD_MERGER_MESSAGE:"save_relay_json_msg",FETCH_CLOUD_CONTROL_CONFIG:"fetch_config",PUSHED_CLOUD_CONTROL_CONFIG:"push_configv2",FETCH_COMMERCIAL_CONFIG:"fetch_imsdk_purchase_bitsv2",PUSHED_COMMERCIAL_CONFIG:"push_imsdk_purchase_bitsv2",KICK_OTHER:"KickOther",OVERLOAD_NOTIFY:"notify2",SET_ALL_MESSAGE_READ:"read_all_unread_msg",CREATE_TOPIC:"create_topic",DELETE_TOPIC:"destroy_topic",UPDATE_TOPIC_PROFILE:"modify_topic",GET_TOPIC_LIST:"get_topic",SET_SELF_STATUS:"ws_set_custom_status",GET_USER_STATUS:"ws_get_user_status",SUBSCRIBE_USER_STATUS:"ws_status_subscribe",UNSUBSCRIBE_USER_STATUS:"ws_status_unsubscribe",GET_RPOFANITY_LIST:"get_local_words",TRANSLATE_TEXT:"ws_batch_trans_text",UPDATE_GROUP_COUNTER:"update_group_counter",GET_GROUP_COUNTER:"get_group_counter"},CHANNEL:{SOCKET:1,XHR:2,AUTO:0},NAME_VERSION:{openim:"v4",group_open_http_svc:"v4",sns:"v4",profile:"v4",recentcontact:"v4",openpic:"v4",group_open_http_noauth_svc:"v4",group_open_long_polling_http_svc:"v4",group_open_long_polling_http_noauth_svc:"v4",imopenstat:"v4",im_cos_sign_svr:"v4",im_cos_msg:"v4",webim:"v4",im_open_push:"v4",im_open_status:"v4"}},F={SEARCH_MSG:new R(0,Math.pow(2,0)).toString(),SEARCH_GRP_SNS:new R(0,Math.pow(2,1)).toString(),AVCHATROOM_HISTORY_MSG:new R(0,Math.pow(2,2)).toString(),GRP_COMMUNITY:new R(0,Math.pow(2,3)).toString(),MSG_TO_SPECIFIED_GRP_MBR:new R(0,Math.pow(2,4)).toString(),AVCHATROOM_MBR_LIST:new R(0,Math.pow(2,6)).toString(),USER_STATUS:new R(0,Math.pow(2,7)).toString(),CONV_MARK:new R(0,Math.pow(2,9)).toString(),CONV_GROUP:new R(0,Math.pow(2,10)).toString(),AVCHATROOM_BAN_MBR:new R(0,Math.pow(2,11)).toString(),MSG_EXT:new R(0,Math.pow(2,13)).toString(),GRP_COUNTER:new R(0,Math.pow(2,15)).toString()},q="group_profile";x.HOST.setCurrent(G);var B="undefined"!=typeof i&&"function"==typeof i.getSystemInfoSync&&Boolean(i.getSystemInfoSync().fontSizeSetting),$="undefined"!=typeof qq&&"function"==typeof qq.getSystemInfoSync&&Boolean(qq.getSystemInfoSync().fontSizeSetting),V="undefined"!=typeof tt&&"function"==typeof tt.getSystemInfoSync&&Boolean(tt.getSystemInfoSync().fontSizeSetting),H="undefined"!=typeof swan&&"function"==typeof swan.getSystemInfoSync&&Boolean(swan.getSystemInfoSync().fontSizeSetting),K="undefined"!=typeof my&&"function"==typeof my.getSystemInfoSync&&Boolean(my.getSystemInfoSync().fontSizeSetting),j="undefined"!=typeof jd&&"function"==typeof jd.getSystemInfoSync,z="undefined"!=typeof uni&&"undefined"==typeof window&&"function"==typeof uni.requireNativePlugin,Y="undefined"!=typeof uni,W=B||$||V||H||K||z||j,J=("undefined"!=typeof uni||"undefined"!=typeof window)&&!W,X=$?qq:V?tt:H?swan:K?my:B?i:z?uni:j?jd:{},Z=J&&window&&window.navigator&&window.navigator.userAgent||"",Q=/(micromessenger|webbrowser)/i.test(Z),ee=/AppleWebKit\/([\d.]+)/i.exec(Z);ee&&parseFloat(ee.pop());var te,ne,ie=(te="WEB",Q?te="WEB":$?te="QQ_MP":V?te="TT_MP":H?te="BAIDU_MP":K?te="ALI_MP":B?te="WX_MP":z&&(te="UNI_NATIVE_APP"),N[te]),oe=/iPad/i.test(Z),se=/iPhone/i.test(Z)&&!oe,re=/iPod/i.test(Z),ae=se||oe||re,ce=(ne=Z.match(/OS (\d+)_/i))&&ne[1]?ne[1]:null,ue=/Android/i.test(Z),le=function(){var e=Z.match(/Android (\d+)(?:\.(\d+))?(?:\.(\d+))*/i);if(!e)return null;var t=e[1]&&parseFloat(e[1]),n=e[2]&&parseFloat(e[2]);return t&&n?parseFloat(e[1]+"."+e[2]):t||null}();!function(){var e=Z.match(/Chrome\/(\d+)/);e&&e[1]&&parseFloat(e[1])}();var de=/MSIE/.test(Z)||Z.indexOf("Trident")>-1&&Z.indexOf("rv:11.0")>-1,pe=function(){var e=/MSIE\s(\d+)\.\d/.exec(Z),t=e&&parseFloat(e[1]);return!t&&/Trident\/7.0/i.test(Z)&&/rv:11.0/.test(Z)&&(t=11),t}();!function(){var e=Z.match(/TBS\/(\d+)/i);e&&e[1]&&e[1]}();var he,fe,ge=/Windows/i.test(Z),_e=/MAC OS X/i.test(Z),ve=J&&"undefined"!=typeof Worker&&!de,me=ue||ae,ye=J&&void 0!==window.tencent_cloud_im_csig_flutter_for_web_25F_cy;he="undefined"!=typeof console?console:"undefined"!=typeof o&&o.console?o.console:"undefined"!=typeof window&&window.console?window.console:{};for(var Me=function(){},Ie=["assert","clear","count","debug","dir","dirxml","error","group","groupCollapsed","groupEnd","info","log","profile","profileEnd","table","time","timeEnd","timeStamp","trace","warn"],Ce=Ie.length;Ce--;)fe=Ie[Ce],console[fe]||(he[fe]=Me);var Te=he,ke=0,Se=function(){return(new Date).getTime()+ke},Ee=function(){ke=0},De=function(){return Math.floor(Se()/1e3)},we=0;function Ae(){return Ot()?"%c TIM %c":"TIM"}function be(){var e,t=((e=new Date).setTime(Se()),e);return t.toLocaleTimeString("en-US",{hour12:!1})+"."+function(e){var t;switch(e.toString().length){case 1:t="00"+e;break;case 2:t="0"+e;break;default:t=e}return t}(t.getMilliseconds())}var Le={arguments2String:function(e){var t="";if(1===e.length)t=e[0];else for(var n=0,i=e.length;n<i;n++)We(e[n])?Xe(e[n])?t+=nt(e[n]):t+=JSON.stringify(e[n]):t+=e[n],t+=" ";return t},_exec:function(e,t){Ot()?Te[e](Ae(),"background:#0abf5b; padding:1px; border-radius:3px; color: #fff","background:transparent",be(),t):Te[e]("".concat(Ae()," ").concat(be()," ").concat(t))},d:function(){if(we<=-1){var e=this.arguments2String(arguments);this._exec("debug",e)}},l:function(){if(we<=0){var e=this.arguments2String(arguments);this._exec("log",e)}},log:function(){if(we<=0){var e=this.arguments2String(arguments);this._exec("log",e)}},i:function(){if(we<=1){var e=this.arguments2String(arguments);this._exec("info",e)}},w:function(){if(we<=2){var e=this.arguments2String(arguments);this._exec("warn",e)}},e:function(){if(we<=3){var e=this.arguments2String(arguments);this._exec("error",e)}},setLevel:function(e){e<4&&this._exec("log","set level from "+we+" to "+e),we=e},getLevel:function(){return we}},Re={JPG:1,JPEG:1,GIF:2,PNG:3,BMP:4,UNKNOWN:255},Oe={NICK:"Tag_Profile_IM_Nick",GENDER:"Tag_Profile_IM_Gender",BIRTHDAY:"Tag_Profile_IM_BirthDay",LOCATION:"Tag_Profile_IM_Location",SELFSIGNATURE:"Tag_Profile_IM_SelfSignature",ALLOWTYPE:"Tag_Profile_IM_AllowType",LANGUAGE:"Tag_Profile_IM_Language",AVATAR:"Tag_Profile_IM_Image",MESSAGESETTINGS:"Tag_Profile_IM_MsgSettings",ADMINFORBIDTYPE:"Tag_Profile_IM_AdminForbidType",LEVEL:"Tag_Profile_IM_Level",ROLE:"Tag_Profile_IM_Role"},Ne={UNKNOWN:"Gender_Type_Unknown",FEMALE:"Gender_Type_Female",MALE:"Gender_Type_Male"},Pe={NONE:"AdminForbid_Type_None",SEND_OUT:"AdminForbid_Type_SendOut"},Ue={NEED_CONFIRM:"AllowType_Type_NeedConfirm",ALLOW_ANY:"AllowType_Type_AllowAny",DENY_ANY:"AllowType_Type_DenyAny"},Ge="JoinedSuccess",xe="WaitAdminApproval",Fe="@TOPIC#_",qe=["url"],Be=function(e){return"map"===Ze(e)},$e=function(e){return"file"===Ze(e)},Ve=function(e){return null!==e&&("number"==typeof e&&!isNaN(e-0)||"object"===n(e)&&e.constructor===Number)},He=function(e){return"string"==typeof e},Ke=function(e){return null!==e&&"object"===n(e)},je=function(e){if("object"!==n(e)||null===e)return!1;var t=Object.getPrototypeOf(e);if(null===t)return!0;for(var i=t;null!==Object.getPrototypeOf(i);)i=Object.getPrototypeOf(i);return t===i},ze=function(e){return"function"==typeof Array.isArray?Array.isArray(e):"array"===Ze(e)},Ye=function(e){return void 0===e},We=function(e){return ze(e)||Ke(e)},Je=function(e){return"function"==typeof e},Xe=function(e){return e instanceof Error},Ze=function(e){return Object.prototype.toString.call(e).match(/^\[object (.*)\]$/)[1].toLowerCase()},Qe=function(e){if("string"!=typeof e)return!1;var t=e[0];return!/[^a-zA-Z0-9]/.test(t)};Date.now||(Date.now=function(){return(new Date).getTime()});var et=function e(t,n,i,o){if(!We(t)||!We(n))return 0;for(var s,r=0,a=Object.keys(n),c=0,u=a.length;c<u;c++)if(s=a[c],!(Ye(n[s])||i&&i.includes(s)))if(We(t[s])&&We(n[s]))r+=e(t[s],n[s],i,o);else{if(o&&o.includes(n[s]))continue;t[s]!==n[s]&&(t[s]=n[s],r+=1)}return r},nt=function(e){return JSON.stringify(e,["message","code"])},it=function(e){if(0===e.length)return 0;for(var t=0,n=0,i="undefined"!=typeof document&&void 0!==document.characterSet?document.characterSet:"UTF-8";void 0!==e[t];)n+=e[t++].charCodeAt[t]<=255?1:!1===i?3:2;return n},ot=function(e){var t=e||99999999;return Math.round(Math.random()*t)},st="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ",rt=st.length,at=function(e,t){for(var n in e)if(e[n]===t)return!0;return!1},ct={},ut=function(e){return-1===e.indexOf("http://")||-1===e.indexOf("https://")?"https://"+e:e.replace(/https|http/,"https")},lt=function e(t){if(0===Object.getOwnPropertyNames(t).length)return Object.create(null);var i=Array.isArray(t)?[]:Object.create(null),o="";for(var s in t)null!==t[s]?void 0!==t[s]?(o=n(t[s]),["string","number","function","boolean"].indexOf(o)>=0?i[s]=t[s]:i[s]=e(t[s])):i[s]=void 0:i[s]=null;return i};function dt(e,t){if(!ze(e)||!ze(t))return!1;var n=!1;return t.forEach((function(t){var i=t.key,o=t.value,s=e.find((function(e){return e.key===i}));s?s.value!==o&&(s.value=o,n=!0):(e.push({key:i,value:o}),n=!0)})),n}var pt=function(e){return e===b.GRP_AVCHATROOM},ht=function(e){var t=e.type,n=e.groupID;return t===b.GRP_COMMUNITY||"".concat(n).startsWith("@TGS#_")&&!"".concat(n).includes(Fe)},ft=function(e){return"".concat(e).startsWith("@TGS#_")&&"".concat(e).includes(Fe)},gt=function(e){return He(e)&&e.slice(0,3)===b.CONV_C2C},_t=function(e){return He(e)&&e.slice(0,5)===b.CONV_GROUP},vt=function(e){return He(e)&&e===b.CONV_SYSTEM};function mt(e,t){var n={};return Object.keys(e).forEach((function(i){n[i]=t(e[i],i)})),n}function yt(e){return W?new Promise((function(t,n){X.getImageInfo({src:e,success:function(e){t({width:e.width,height:e.height})},fail:function(){t({width:0,height:0})}})})):de&&9===pe?Promise.resolve({width:0,height:0}):new Promise((function(t,n){var i=new Image;i.onload=function(){t({width:this.width,height:this.height}),i=null},i.onerror=function(){t({width:0,height:0}),i=null},i.src=e}))}function Mt(){function e(){return(65536*(1+Math.random())|0).toString(16).substring(1)}return"".concat(e()+e()).concat(e()).concat(e()).concat(e()).concat(e()).concat(e()).concat(e())}function It(){var e="unknown";if(_e&&(e="mac"),ge&&(e="windows"),ae&&(e="ios"),ue&&(e="android"),W)try{var t=X.getSystemInfoSync().platform;void 0!==t&&(e=t)}catch(n){}return e}function Ct(e,t){e=e.split("."),t=t.split(".");for(var n=Math.max(e.length,t.length);e.length<n;)e.push("0");for(;t.length<n;)t.push("0");for(var i=0;i<n;i++){var o=parseInt(e[i]),s=parseInt(t[i]);if(o>s)return 1;if(o<s)return-1}return 0}function Tt(e){var t=e.originUrl,n=void 0===t?void 0:t,i=e.originWidth,o=e.originHeight,s=e.min,r=void 0===s?198:s,a=parseInt(i),c=parseInt(o),u={url:void 0,width:0,height:0};if((a<=c?a:c)<=r)u.url=n,u.width=a,u.height=c;else{c<=a?(u.width=Math.ceil(a*r/c),u.height=r):(u.width=r,u.height=Math.ceil(c*r/a));var l=n&&n.indexOf("?")>-1?"".concat(n,"&"):"".concat(n,"?");u.url="".concat(l,198===r?"imageView2/3/w/198/h/198":"imageView2/3/w/720/h/720")}return Ye(n)?(u.url,v(u,qe)):u}function kt(e){var t=e[2];e[2]=e[1],e[1]=t;for(var n=0;n<e.length;n++)e[n].setType(n)}function St(e){var t=e.servcmd;return t.slice(t.indexOf(".")+1)}function Et(e,t){return Math.round(Number(e)*Math.pow(10,t))/Math.pow(10,t)}function Dt(e,t){return e.includes(t)}function wt(e,t){return e.includes(t)}function At(e){return e.split(Fe)[0]}var bt=function(e,t,n){if(Ye(t))return"";switch(e){case b.MSG_TEXT:return t.text;case b.MSG_IMAGE:return n?"[Image]":"[\u56fe\u7247]";case b.MSG_LOCATION:return n?"[Location]":"[\u4f4d\u7f6e]";case b.MSG_AUDIO:return n?"[Voice]":"[\u8bed\u97f3]";case b.MSG_VIDEO:return n?"[Video]":"[\u89c6\u9891]";case b.MSG_FILE:return n?"[File]":"[\u6587\u4ef6]";case b.MSG_CUSTOM:return n?"[Custom Messages]":"[\u81ea\u5b9a\u4e49\u6d88\u606f]";case b.MSG_GRP_TIP:return n?"[Group Notification]":"[\u7fa4\u63d0\u793a\u6d88\u606f]";case b.MSG_GRP_SYS_NOTICE:return n?"[Group System Message]":"[\u7fa4\u7cfb\u7edf\u901a\u77e5]";case b.MSG_FACE:return n?"[Animated Sticker]":"[\u52a8\u753b\u8868\u60c5]";case b.MSG_MERGER:return n?"[Chat Record]":"[\u804a\u5929\u8bb0\u5f55]";default:return""}};function Lt(e){return e===b.MSG_TEXT||e===b.MSG_CUSTOM||e===b.MSG_LOCATION||e===b.MSG_FACE}function Rt(e){var t=[];if(!He(e))return t;var n=e.length;if(0===n)return t;for(var i=n-1;i>=0;i--)"1"===e[i]&&t.push(Math.pow(2,n-i-1));return t}function Ot(){return!de&&!W}function Nt(e){return"the length of userIDList cannot exceed ".concat(e)}function Pt(e,t){if(e){var n=e;return t&&(e.startsWith("http://")?n=e.replace(/^http:\/\/[^/]+/,t):e.startsWith("https://")&&(n=e.replace(/^https:\/\/[^/]+/,t))),n}}var Ut=Object.prototype.hasOwnProperty;function Gt(e){if(null==e)return!0;if("boolean"==typeof e)return!1;if("number"==typeof e)return 0===e;if("string"==typeof e)return 0===e.length;if("function"==typeof e)return 0===e.length;if(Array.isArray(e))return 0===e.length;if(e instanceof Error)return""===e.message;if(je(e)){for(var t in e)if(Ut.call(e,t))return!1;return!0}return!(!Be(e)&&(n=e,"set"!==Ze(n))&&!$e(e))&&0===e.size;var n}function xt(e,t,n){if(void 0===t)return!0;var i=!0;if(je(t))Object.keys(t).forEach((function(o){var s=1===e.length?e[0][o]:void 0;i=!!Ft(s,t[o],n,o)&&i}));else if(ze(t))for(var o=0;o<t.length;o++)i=!!Ft(e[o],t[o],n,t[o].name)&&i;if(i)return i;throw new Error("Params validate failed.")}function Ft(e,t,n,i){if(void 0===t)return!0;var o=!0;if(t.required&&Gt(e)&&(Le.e("[".concat(n,'] Missing required params: "').concat(i,'".')),o=!1),!Gt(e)){var s=Ze(e),r=t.type.toLowerCase();s!==r&&("asyncfunction"===s&&"function"===r||(Le.e("[".concat(n,'] Invalid params: type check failed for "').concat(i,'".Expected ').concat(t.type,".")),o=!1))}return t.validator&&!t.validator(e)&&(Le.e("[".concat(n,"] Invalid params: custom validator check failed for params.")),o=!1),o}var qt,Bt={UNSEND:"unSend",SUCCESS:"success",FAIL:"fail"},$t={NOT_START:"notStart",PENDING:"pending",RESOLVED:"resolved",REJECTED:"rejected"},Vt=function(e){if(!e)return!1;if(gt(e)||_t(e)||vt(e))return!0;var t=_n("InvalidConversationID",e);return t&&Le.w(t),!1},Ht=function(e){""!==e.desc&&""!==_n("API_REFER")&&Le.w("[".concat(e.api,"] | ").concat(e.param," | ").concat(e.desc,", ").concat(_n("API_REFER")).concat(e.api))},Kt=function(){return _n("StringRequiredLog")},jt=function(e){return _n("NonEmptyStringRequiredLog",e)},zt=function(){return _n("NumberRequiredLog")},Yt=function(){return _n("UndefinedNotAllowedLog")},Wt=function(){return _n("FileRequiredLog")},Jt=function(){return _n("FunctionRequiredLog")},Xt=function(){return _n("ArrayRequiredLog")},Zt=function(){return _n("NonEmptyArrayLog")},Qt=function(){return _n("CallbackMissingLog")},en=function(){return _n("PositiveIntegerRequiredLog")},tn=function(e,t){return _n("StringNotLongerThanLog",e,t)},nn=function(e,t){return _n("NumberLessThanLog",e,t)},on=function(e){return _n("KeyValueStringRequiredLog",e)},sn=function(){return _n("PlainObjectRequiredLog")},rn=function(){return _n("NonEmptyContentRequiredLog")},an=function(){return _n("FileNotSelectedLog")},cn=function(){return _n("MessageInstanceRequiredLog")},un=function(){return _n("NonAnonymousFunctionLog")},ln=function(){return _n("MessageExtensionNotAvailableLog")},dn={type:"String",required:!0},pn={type:"Array",required:!0},hn={type:"Object",required:!0},fn={type:"Boolean",required:!0},gn={type:"number",required:!0},_n=null,vn={hookGetAPITips:function(e){_n=e},login:{userID:dn,userSig:dn},addToBlacklist:{userIDList:pn},removeFromBlacklist:{userIDList:pn},on:[{name:"eventName",type:"String",validator:function(e){return"string"==typeof e&&0!==e.length||(Ht({api:"on",param:"eventName",desc:jt("eventName")}),!1)}},{name:"handler",type:"Function",validator:function(e){return"function"!=typeof e?(Ht({api:"on",param:"handler",desc:Jt()}),!1):(""===e.name&&Ht({api:"on",param:"handler",desc:un()}),!0)}}],once:[{name:"eventName",type:"String",validator:function(e){return"string"==typeof e&&0!==e.length||(Ht({api:"once",param:"eventName",desc:jt("eventName")}),!1)}},{name:"handler",type:"Function",validator:function(e){return"function"!=typeof e?(Ht({api:"once",param:"handler",desc:Jt()}),!1):(""===e.name&&Ht({api:"once",param:"handler",desc:un()}),!0)}}],off:[{name:"eventName",type:"String",validator:function(e){return"string"==typeof e&&0!==e.length||(Ht({api:"off",param:"eventName",desc:jt("eventName")}),!1)}},{name:"handler",type:"Function",validator:function(e){return"function"!=typeof e?(Ht({api:"off",param:"handler",desc:Jt()}),!1):(""===e.name&&Ht({api:"off",param:"handler",desc:un()}),!0)}}],sendMessage:[t({name:"message"},hn)],setMessageExtensions:[t(t({name:"message"},hn),{},{validator:function(e){return e.status===Bt.SUCCESS&&!0===e.isSupportExtension||(Ht({api:"setMessageExtensions",param:"message",desc:ln()}),!1)}}),t({name:"extensions"},pn)],getMessageExtensions:[t(t({name:"message"},hn),{},{validator:function(e){return e.status===Bt.SUCCESS&&!0===e.isSupportExtension||(Ht({api:"getMessageExtensions",param:"message",desc:ln()}),!1)}})],deleteMessageExtensions:[t(t({name:"message"},hn),{},{validator:function(e){return e.status===Bt.SUCCESS&&!0===e.isSupportExtension||(Ht({api:"deleteMessageExtensions",param:"message",desc:ln()}),!1)}})],getMessageList:{conversationID:t(t({},dn),{},{validator:function(e){return Vt(e)}}),nextReqMessageID:{type:"String"},count:{type:"Number",validator:function(e){return!(!Ye(e)&&!/^[1-9][0-9]*$/.test(e))||(Ht({api:"getMessageList",param:"count",desc:en()}),!1)}}},getMessageListHopping:{conversationID:t(t({},dn),{},{validator:function(e){return Vt(e)}}),sequence:{type:"Number"},time:{type:"Number"},direction:{type:"Number",validator:function(e){return!(!Ye(e)&&0!==e&&1!==e)||(Ht({api:"getMessageListHopping",param:"direction",desc:_n("0Or1RequiredLog")}),!1)}},count:{type:"Number",validator:function(e){return!(!Ye(e)&&!/^[1-9][0-9]*$/.test(e))||(Ht({api:"getMessageListHopping",param:"count",desc:en}),!1)}}},setMessageRead:{conversationID:t(t({},dn),{},{validator:function(e){return Vt(e)}})},setAllMessageRead:{scope:{type:"String",required:!1,validator:function(e){return!e||-1!==[b.READ_ALL_C2C_MSG,b.READ_ALL_GROUP_MSG,b.READ_ALL_MSG].indexOf(e)||(Ht({api:"setAllMessageRead",param:"scope",desc:"TIM.TYPES.READ_ALL_C2C_MSG or TIM.TYPES.READ_ALL_GROUP_MSG or TIM.TYPES.READ_ALL_MSG required"}),!1)}}},getConversationProfile:[t(t({name:"conversationID"},dn),{},{validator:function(e){return Vt(e)}})],clearHistoryMessage:[t(t({name:"conversationID"},dn),{},{validator:function(e){return Vt(e)}})],pinConversation:{conversationID:t(t({},dn),{},{validator:function(e){return Vt(e)}}),isPinned:t({},fn)},setConversationCustomData:{conversationIDList:t({},pn),customData:{type:"String",validator:function(e){return He(e)?!(e.length>256)||(Ht({api:"setConversationCustomData",param:"customData",desc:tn("customData",256)}),!1):(Ht({api:"setConversationCustomData",param:"customData",desc:Kt()}),!1)}}},markConversation:{conversationIDList:t({},pn),markType:{type:"number",validator:function(e){return Ve(e)?e<=0?(Ht({api:"markConversation",param:"markType",desc:("markType",0,_n("NumberGreaterThanLog","markType",0))}),!1):!(e>=Math.pow(2,64))||(Ht({api:"markConversation",param:"markType",desc:nn("markType","Math.pow(2,64)")}),!1):(Ht({api:"markConversation",param:"markType",desc:zt()}),!1)}},enableMark:t({},fn)},createConversationGroup:{conversationIDList:t({},pn),groupName:t(t({},dn),{},{validator:function(e){return!!e&&(!(e.length>32)||(Ht({api:"createConversationGroup",param:"groupName",desc:tn("groupName",32)}),!1))}})},deleteConversationGroup:[t({name:"groupName"},dn)],renameConversationGroup:{oldName:t({},dn),newName:t(t({},dn),{},{validator:function(e){return!!e&&(!(e.length>32)||(Ht({api:"renameConversationGroup",param:"newName",desc:tn("newName",32)}),!1))}})},addConversationsToGroup:{conversationIDList:t({},pn),groupName:t({},dn)},deleteConversationsFromGroup:{conversationIDList:t({},pn),groupName:t({},dn)},getGroupList:{groupProfileFilter:{type:"Array"}},getGroupProfile:{groupID:dn,groupCustomFieldFilter:{type:"Array"},memberCustomFieldFilter:{type:"Array"}},getGroupProfileAdvance:{groupIDList:pn},createGroup:{name:dn},joinGroup:{groupID:dn,type:{type:"String"},applyMessage:{type:"String"}},quitGroup:[t({name:"groupID"},dn)],handleApplication:{message:hn,handleAction:dn,handleMessage:{type:"String"}},changeGroupOwner:{groupID:dn,newOwnerID:dn},updateGroupProfile:{groupID:dn,muteAllMembers:{type:"Boolean"}},dismissGroup:[t({name:"groupID"},dn)],searchGroupByID:[t({name:"groupID"},dn)],initGroupAttributes:{groupID:dn,groupAttributes:t(t({},hn),{},{validator:function(e){var t=!0;return Object.keys(e).forEach((function(n){if(!He(e[n]))return Ht({api:"initGroupAttributes",param:"groupAttributes",desc:on("value")}),t=!1})),t}})},setGroupAttributes:{groupID:dn,groupAttributes:t(t({},hn),{},{validator:function(e){var t=!0;return Object.keys(e).forEach((function(n){if(!He(e[n]))return Ht({api:"setGroupAttributes",param:"groupAttributes",desc:on("value")}),t=!1})),t}})},deleteGroupAttributes:{groupID:dn,keyList:{type:"Array",validator:function(e){if(Ye(e)||!ze(e))return Ht({api:"deleteGroupAttributes",param:"keyList",desc:Xt()}),!1;if(!Gt(e)){var t=!0;return e.forEach((function(e){if(!He(e))return Ht({api:"deleteGroupAttributes",param:"keyList",desc:_n("StringArrayRequiredLog")}),t=!1})),t}return!0}}},getGroupAttributes:{groupID:dn,keyList:{type:"Array",validator:function(e){if(Ye(e)||!ze(e))return Ht({api:"getGroupAttributes",param:"keyList",desc:Xt()}),!1;if(!Gt(e)){var t=!0;return e.forEach((function(e){if(!He(e))return Ht({api:"getGroupAttributes",param:"keyList",desc:on("key")}),t=!1})),t}return!0}}},setGroupCounters:{groupID:dn,counters:hn},increaseGroupCounter:{groupID:dn,key:dn,value:gn},decreaseGroupCounter:{groupID:dn,key:dn,value:gn},getGroupCounters:{groupID:dn},getGroupMemberList:{groupID:dn,count:{type:"Number"}},getGroupMemberProfile:{groupID:dn,userIDList:pn,memberCustomFieldFilter:{type:"Array"}},addGroupMember:{groupID:dn,userIDList:pn},setGroupMemberRole:{groupID:dn,userID:dn,role:dn},setGroupMemberMuteTime:{groupID:dn,userID:dn,muteTime:{type:"Number",validator:function(e){return e>=0}}},setGroupMemberNameCard:{groupID:dn,userID:{type:"String"},nameCard:{type:"String",validator:function(e){return He(e)?(e.length,!0):(Ht({api:"setGroupMemberNameCard",param:"nameCard",desc:Kt()}),!1)}}},setGroupMemberCustomField:{groupID:dn,userID:{type:"String"},memberCustomField:pn},deleteGroupMember:{groupID:dn},markGroupMemberList:{groupID:dn,markType:{type:"number",validator:function(e){return Ve(e)?!(e<1e3)||(Ht({api:"markGroupMemberList",param:"markType",desc:("markType",1e3,_n("NumberGreaterOrEqualLog","markType",1e3))}),!1):(Ht({api:"markGroupMemberList",param:"markType",desc:zt()}),!1)}},userIDList:t({},pn),enableMark:t({},fn)},createTextMessage:{to:dn,conversationType:dn,payload:t(t({},hn),{},{validator:function(e){return je(e)?He(e.text)?0!==e.text.length||(Ht({api:"createTextMessage",param:"payload.text",desc:rn()}),!1):(Ht({api:"createTextMessage",param:"payload.text",desc:Kt()}),!1):(Ht({api:"createTextMessage",param:"payload",desc:sn()}),!1)}})},createTextAtMessage:{to:dn,conversationType:dn,payload:t(t({},hn),{},{validator:function(e){return je(e)?He(e.text)?0===e.text.length?(Ht({api:"createTextAtMessage",param:"payload.text",desc:rn()}),!1):!(e.atUserList&&!ze(e.atUserList))||(Ht({api:"createTextAtMessage",param:"payload.atUserList",desc:Xt()}),!1):(Ht({api:"createTextAtMessage",param:"payload.text",desc:Kt()}),!1):(Ht({api:"createTextAtMessage",param:"payload",desc:sn()}),!1)}})},createCustomMessage:{to:dn,conversationType:dn,payload:t(t({},hn),{},{validator:function(e){return je(e)?e.data&&!He(e.data)?(Ht({api:"createCustomMessage",param:"payload.data",desc:Kt()}),!1):e.description&&!He(e.description)?(Ht({api:"createCustomMessage",param:"payload.description",desc:Kt()}),!1):!(e.extension&&!He(e.extension))||(Ht({api:"createCustomMessage",param:"payload.extension",desc:Kt()}),!1):(Ht({api:"createCustomMessage",param:"payload",desc:sn()}),!1)}})},createImageMessage:{to:dn,conversationType:dn,payload:t(t({},hn),{},{validator:function(e){if(!je(e))return Ht({api:"createImageMessage",param:"payload",desc:sn()}),!1;if(Ye(e.file))return Ht({api:"createImageMessage",param:"payload.file",desc:Yt()}),!1;if(J){if(!(e.file instanceof HTMLInputElement||$e(e.file)))return je(e.file)&&"undefined"!=typeof uni?0!==e.file.tempFilePaths.length&&0!==e.file.tempFiles.length||(Ht({api:"createImageMessage",param:"payload.file",desc:an()}),!1):(Ht({api:"createImageMessage",param:"payload.file",desc:Wt()}),!1);if(e.file instanceof HTMLInputElement&&0===e.file.files.length)return Ht({api:"createImageMessage",param:"payload.file",desc:an()}),!1}return!0},onProgress:{type:"Function",required:!1,validator:function(e){return Ye(e)&&Ht({api:"createImageMessage",param:"onProgress",desc:Qt()}),!0}}})},createAudioMessage:{to:dn,conversationType:dn,payload:t(t({},hn),{},{validator:function(e){return!!je(e)||(Ht({api:"createAudioMessage",param:"payload",desc:sn()}),!1)}}),onProgress:{type:"Function",required:!1,validator:function(e){return Ye(e)&&Ht({api:"createAudioMessage",param:"onProgress",desc:Qt()}),!0}}},createVideoMessage:{to:dn,conversationType:dn,payload:t(t({},hn),{},{validator:function(e){if(!je(e))return Ht({api:"createVideoMessage",param:"payload",desc:sn()}),!1;if(Ye(e.file))return Ht({api:"createVideoMessage",param:"payload.file",desc:Yt()}),!1;if(J){if(!(e.file instanceof HTMLInputElement||$e(e.file)))return je(e.file)&&"undefined"!=typeof uni?!!$e(e.file.tempFile)||(Ht({api:"createVideoMessage",param:"payload.file",desc:an()}),!1):(Ht({api:"createVideoMessage",param:"payload.file",desc:Wt()}),!1);if(e.file instanceof HTMLInputElement&&0===e.file.files.length)return Ht({api:"createVideoMessage",param:"payload.file",desc:an()}),!1}return!0}}),onProgress:{type:"Function",required:!1,validator:function(e){return Ye(e)&&Ht({api:"createVideoMessage",param:"onProgress",desc:Qt()}),!0}}},createFaceMessage:{to:dn,conversationType:dn,payload:t(t({},hn),{},{validator:function(e){return je(e)?Ve(e.index)?!!He(e.data)||(Ht({api:"createFaceMessage",param:"payload.data",desc:Kt()}),!1):(Ht({api:"createFaceMessage",param:"payload.index",desc:zt()}),!1):(Ht({api:"createFaceMessage",param:"payload",desc:sn()}),!1)}})},createFileMessage:{to:dn,conversationType:dn,payload:t(t({},hn),{},{validator:function(e){if(!je(e))return Ht({api:"createFileMessage",param:"payload",desc:sn()}),!1;if(Ye(e.file))return Ht({api:"createFileMessage",param:"payload.file",desc:Yt()}),!1;if(J){if(!(e.file instanceof HTMLInputElement||$e(e.file)))return je(e.file)&&"undefined"!=typeof uni?0!==e.file.tempFilePaths.length&&0!==e.file.tempFiles.length||(Ht({api:"createFileMessage",param:"payload.file",desc:an()}),!1):(Ht({api:"createFileMessage",param:"payload.file",desc:Wt()}),!1);if(e.file instanceof HTMLInputElement&&0===e.file.files.length)return Ht({api:"createFileMessage",param:"payload.file",desc:an()}),!1}return!0}}),onProgress:{type:"Function",required:!1,validator:function(e){return Ye(e)&&Ht({api:"createFileMessage",param:"onProgress",desc:Qt()}),!0}}},createLocationMessage:{to:dn,conversationType:dn,payload:t(t({},hn),{},{validator:function(e){return je(e)?He(e.description)?Ve(e.longitude)?!!Ve(e.latitude)||(Ht({api:"createLocationMessage",param:"payload.latitude",desc:zt()}),!1):(Ht({api:"createLocationMessage",param:"payload.longitude",desc:zt()}),!1):(Ht({api:"createLocationMessage",param:"payload.description",desc:Kt()}),!1):(Ht({api:"createLocationMessage",param:"payload",desc:sn()}),!1)}})},createMergerMessage:{to:dn,conversationType:dn,payload:t(t({},hn),{},{validator:function(e){if(Gt(e.messageList))return Ht({api:"createMergerMessage",param:"payload.messageList",desc:Zt()}),!1;if(Gt(e.compatibleText))return Ht({api:"createMergerMessage",param:"payload.compatibleText",desc:jt("compatibleText")}),!1;var t=!1;return e.messageList.forEach((function(e){e.status===Bt.FAIL&&(t=!0)})),!t||(Ht({api:"createMergerMessage",param:"payload.messageList",desc:_n("MergeFailedMessageLog")}),!1)}})},revokeMessage:[t(t({name:"message"},hn),{},{validator:function(e){return Gt(e)?(Ht({api:"revokeMessage",param:"message",desc:cn()}),!1):e.conversationType===b.CONV_SYSTEM?(Ht({api:"revokeMessage",param:"message",desc:_n("MessageCanBeRevokedDesc")}),!1):!0!==e.isRevoked||(Ht({api:"revokeMessage",param:"message",desc:_n("MessageRevokedLog")}),!1)}})],deleteMessage:[t(t({name:"messageList"},pn),{},{validator:function(e){return!Gt(e)||(Ht({api:"deleteMessage",param:"messageList",desc:Zt()}),!1)}})],translateText:{sourceTextList:pn,sourceLanguage:dn,targetLanguage:dn},modifyMessage:[t(t({name:"message"},hn),{},{validator:function(e){return Gt(e)?(Ht({api:"modifyMessage",param:"message",desc:cn()}),!1):e.conversationType===b.CONV_SYSTEM?(Ht({api:"modifyMessage",param:"message",desc:_n("MessageCanBeModifiedLog")}),!1):!0!==e._onlineOnlyFlag||(Ht({api:"modifyMessage",param:"message",desc:_n("OnlineMessageNotSupportLog")}),!1)}})],getUserProfile:{userIDList:{type:"Array",validator:function(e){return ze(e)?(0===e.length&&Ht({api:"getUserProfile",param:"userIDList",desc:Zt()}),!0):(Ht({api:"getUserProfile",param:"userIDList",desc:Xt()}),!1)}}},updateMyProfile:{profileCustomField:{type:"Array",validator:function(e){return!!Ye(e)||!!ze(e)||(Ht({api:"updateMyProfile",param:"profileCustomField",desc:Xt()}),!1)}}},setSelfStatus:{customStatus:{type:"String",validator:function(e){return!!He(e)||(Ht({api:"setSelfStatus",param:"customStatus",desc:Kt()}),!1)}}},getUserStatus:{userIDList:{type:"Array",validator:function(e){return ze(e)?0!==e.length||(Ht({api:"getUserStatus",param:"userIDList",desc:Zt()}),!1):(Ht({api:"getUserStatus",param:"userIDList",desc:Xt()}),!1)}}},subscribeUserStatus:{userIDList:{type:"Array",validator:function(e){return ze(e)?0!==e.length||(Ht({api:"subscribeUserStatus",param:"userIDList",desc:Zt()}),!1):(Ht({api:"subscribeUserStatus",param:"userIDList",desc:Xt()}),!1)}}},unsubscribeUserStatus:{userIDList:{type:"Array",validator:function(e){return!e||!!ze(e)||(Ht({api:"subscribeUserStatus",param:"userIDList",desc:Xt()}),!1)}}},addFriend:{to:dn,source:{type:"String",required:!0,validator:function(e){return!!e&&(e.startsWith("AddSource_Type_")?!(e.replace("AddSource_Type_","").length>8)||(Ht({api:"addFriend",param:"source",desc:tn("keyword",8)}),!1):(Ht({api:"addFriend",param:"source",desc:_n("SourcePrefixLog")}),!1))}},remark:{type:"String",required:!1,validator:function(e){return!(He(e)&&e.length>96)||(Ht({api:"addFriend",param:"remark",desc:tn("remark",96)}),!1)}}},deleteFriend:{userIDList:pn},checkFriend:{userIDList:pn},getFriendProfile:{userIDList:pn},updateFriend:{userID:dn,remark:{type:"String",required:!1,validator:function(e){return!(He(e)&&e.length>96)||(Ht({api:"updateFriend",param:"remark",desc:tn("remark",96)}),!1)}},friendCustomField:{type:"Array",required:!1,validator:function(e){if(e){if(!ze(e))return Ht({api:"updateFriend",param:"friendCustomField",desc:Xt()}),!1;var t=!0;return e.forEach((function(e){return He(e.key)&&-1!==e.key.indexOf("Tag_SNS_Custom")?He(e.value)?e.key.replace("Tag_SNS_Custom_","").length>8?(Ht({api:"updateFriend",param:"friendCustomField",desc:tn("keyword",8)}),t=!1):void 0:(Ht({api:"updateFriend",param:"friendCustomField",desc:on("value")}),t=!1):(Ht({api:"updateFriend",param:"friendCustomField",desc:_n("FriendCustomFieldPrefixLog")}),t=!1)})),t}return!0}}},acceptFriendApplication:{userID:dn},refuseFriendApplication:{userID:dn},deleteFriendApplication:{userID:dn},createFriendGroup:{name:dn},deleteFriendGroup:{name:dn},addToFriendGroup:{name:dn,userIDList:pn},removeFromFriendGroup:{name:dn,userIDList:pn},renameFriendGroup:{oldName:dn,newName:dn},sendMessageReadReceipt:[{name:"messageList",type:"Array",validator:function(e){return ze(e)?0!==e.length||(Ht({api:"sendMessageReadReceipt",param:"messageList",desc:Zt()}),!1):(Ht({api:"sendMessageReadReceipt",param:"messageList",desc:Xt()}),!1)}}],getMessageReadReceiptList:[{name:"messageList",type:"Array",validator:function(e){return ze(e)?0!==e.length||(Ht({api:"getMessageReadReceiptList",param:"messageList",desc:Zt()}),!1):(Ht({api:"getMessageReadReceiptList",param:"messageList",desc:Xt()}),!1)}}],createTopicInCommunity:{groupID:dn,topicName:dn},deleteTopicFromCommunity:{groupID:dn,topicIDList:{type:"Array",validator:function(e){return!e||!!ze(e)||(Ht({api:"deleteTopicFromCommunity",param:"topicIDList",desc:Xt()}),!1)}}},updateTopicProfile:{groupID:dn,topicID:dn},getTopicList:{groupID:dn,topicIDList:{type:"Array",validator:function(e){return!e||!!ze(e)||(Ht({api:"getTopicList",param:"topicIDList",desc:Xt()}),!1)}}}},mn={login:1,logout:1,on:1,once:1,off:1,setLogLevel:1,registerPlugin:1,destroy:1,createTextMessage:1,createTextAtMessage:1,createImageMessage:1,createAudioMessage:1,createVideoMessage:1,createCustomMessage:1,createFaceMessage:1,createFileMessage:1,createLocationMessage:1,createMergerMessage:1,downloadMergerMessage:1,createForwardMessage:1,sendMessage:1,resendMessage:1,revokeMessage:1,deleteMessage:1,translateText:1,modifyMessage:1,sendMessageReadReceipt:1,getGroupMessageReadMemberList:1,getMessageReadReceiptList:1,setMessageExtensions:1,getMessageExtensions:1,deleteMessageExtensions:1,getMessageList:1,findMessage:1,getMessageListHopping:1,setMessageRead:1,setAllMessageRead:1,getConversationList:1,getConversationProfile:1,deleteConversation:1,pinConversation:1,getTotalUnreadMessageCount:1,setConversationCustomData:1,markConversation:1,createConversationGroup:1,getConversationGroupList:1,deleteConversationGroup:1,renameConversationGroup:1,addConversationsToGroup:1,deleteConversationsFromGroup:1,clearHistoryMessage:1,getGroupList:1,getGroupProfile:1,createGroup:1,joinGroup:1,updateGroupProfile:1,quitGroup:1,dismissGroup:1,changeGroupOwner:1,searchGroupByID:1,setMessageRemindType:1,getGroupApplicationList:1,handleGroupApplication:1,initGroupAttributes:1,setGroupAttributes:1,deleteGroupAttributes:1,getGroupAttributes:1,setGroupCounters:1,increaseGroupCounter:1,decreaseGroupCounter:1,getGroupCounters:1,getJoinedCommunityList:1,createTopicInCommunity:1,deleteTopicFromCommunity:1,updateTopicProfile:1,getTopicList:1,getGroupMemberProfile:1,getGroupMemberList:1,addGroupMember:1,deleteGroupMember:1,setGroupMemberNameCard:1,setGroupMemberMuteTime:1,setGroupMemberRole:1,setGroupMemberCustomField:1,getGroupOnlineMemberCount:1,markGroupMemberList:1,getMyProfile:1,getUserProfile:1,updateMyProfile:1,setSelfStatus:1,getUserStatus:1,subscribeUserStatus:1,unsubscribeUserStatus:1,getBlacklist:1,addToBlacklist:1,removeFromBlacklist:1,getFriendList:1,addFriend:1,deleteFriend:1,checkFriend:1,updateFriend:1,getFriendProfile:1,getFriendApplicationList:1,refuseFriendApplication:1,deleteFriendApplication:1,acceptFriendApplication:1,setFriendApplicationRead:1,getFriendGroupList:1,createFriendGroup:1,renameFriendGroup:1,deleteFriendGroup:1,addToFriendGroup:1,removeFromFriendGroup:1,callExperimentalAPI:1},yn=function(){function e(t){r(this,e),this._m=t,this._n=""}return u(e,[{key:"isLoggedIn",value:function(){return this._m.getModule(12).isLoggedIn()}},{key:"isOversea",value:function(){return this._m.getModule(12).isOversea()}},{key:"isPrivateNetWork",value:function(){return this._m.getModule(12).isPrivateNetWork()}},{key:"getFileDownloadProxy",value:function(){return this._m.getModule(12).getFileDownloadProxy()}},{key:"getMyUserID",value:function(){return this._m.getModule(12).getUserID()}},{key:"getMyTinyID",value:function(){return this._m.getModule(12).getTinyID()}},{key:"getSDKAppID",value:function(){return this._m.getModule(12).getSDKAppID()}},{key:"isIntl",value:function(){return this._m.getModule(12).isIntl()}},{key:"isDevMode",value:function(){return this._m.getModule(12).isDevMode()}},{key:"getModule",value:function(e){return this._m.getModule(e)}},{key:"getPlatform",value:function(){return ie}},{key:"getNetworkType",value:function(){return this._m.getModule(15).getNetworkType()}},{key:"probeNetwork",value:function(e){return this._m.getModule(15).probe(e)}},{key:"getCloudConfig",value:function(e){return this._m.getModule(23).getCloudConfig(e)}},{key:"emitOuterEvent",value:function(e,t){this._m.getOuterEmitterInstance().emit(e,t)}},{key:"emitInnerEvent",value:function(e,t){this._m.getInnerEmitterInstance().emit(e,t)}},{key:"getInnerEmitterInstance",value:function(){return this._m.getInnerEmitterInstance()}},{key:"generateTjgID",value:function(e){return this._m.getModule(12).getTinyID()+"-"+e.random}},{key:"filterModifiedMessage",value:function(e){if(!Gt(e)){var t=e.filter((function(e){return!0===e.isModified}));t.length>0&&this.emitOuterEvent(A.MESSAGE_MODIFIED,t)}}},{key:"filterUnmodifiedMessage",value:function(e){return Gt(e)?[]:e.filter((function(e){return!1===e.isModified}))}},{key:"request",value:function(e){return this._m.getModule(20).request(e)}},{key:"canIUse",value:function(e){return this._m.getModule(27).canIUse(e)}},{key:"getErrorMessage",value:function(e,t,n){return this._m.getErrorMessage(e,t,n)}},{key:"outputWarning",value:function(e,t,n){var i=this.getErrorMessage(e,t,n);i&&Le.w(i)}}]),e}(),Mn="wslogin",In="wslogout",Cn="wshello",Tn="authkey",kn="sendmsg",Sn="send_group_msg",En="portrait_get_all",Dn="portrait_set",wn="black_list_get",An="black_list_add",bn="black_list_delete",Ln="msgwithdraw",Rn="msgreaded",On="set_c2c_peer_mute_notifications",Nn="get_c2c_peer_mute_notifications",Pn="getroammsg",Un="get_peer_read_time",Gn="delete_c2c_msg_ramble",xn="modify_c2c_msg",Fn="set_key_values",qn="get_key_values",Bn="page_get",$n="batch_delete",Vn="clear_msg",Hn="deletemsg",Kn="set_conv_custom_data",jn="mark_contact",zn="create_contact_group",Yn="del_contact_group",Wn="update_contact_group",Jn="add_conv_to_group",Xn="del_conv_from_group",Zn="get_contact_group",Qn="get_joined_group_list",ei="get_group_self_member_info",ti="create_group",ni="destroy_group",ii="modify_group_base_info",oi="apply_join_group",si="apply_join_group_noauth",ri="quit_group",ai="get_group_public_info",ci="change_group_owner",ui="handle_apply_join_group",li="handle_invite_join_permission_group",di="handle_invite_join_group",pi="group_msg_recall",hi="msg_read_report",fi="read_all_unread_msg",gi="group_msg_get",_i="get_group_msg_receipt",vi="group_msg_receipt",mi="c2c_msg_read_receipt",yi="get_group_msg_receipt_detail",Mi="get_pendency",Ii="deletemsg",Ci="get_msg",Ti="get_msg_noauth",ki="get_online_member_num",Si="delete_group_ramble_msg_by_seq",Ei="modify_group_msg",Di="set_group_attr",wi="modify_group_attr",Ai="delete_group_attr",bi="clear_group_attr",Li="get_group_attr",Ri="group_set_key_values",Oi="group_get_key_values",Ni="get_group_notify",Pi="update_group_counter",Ui="get_group_counter",Gi="get_group_member_info",xi="get_members",Fi="get_specified_group_member_info",qi="add_group_member",Bi="delete_group_member",$i="ban_group_member",Vi="modify_group_member_info",Hi="modify_user_info",Ki="pre_sig",ji="video_cover",zi="tim_web_report_v2",Yi="ws_msg_push_ack",Wi="save_relay_json_msg",Ji="get_relay_json_msg",Xi="fetch_config",Zi="fetch_imsdk_purchase_bitsv2",Qi="create_topic",eo="destroy_topic",to="modify_topic",no="get_topic",io="ws_set_custom_status",oo="ws_get_user_status",so="ws_status_subscribe",ro="ws_status_unsubscribe",ao="ws_stat_background",co="ws_stat_foreground",uo="ws_stat_settoken",lo="get_local_words",po="ws_batch_trans_text",ho={NO_SDKAPPID:2e3,NO_ACCOUNT_TYPE:2001,NO_IDENTIFIER:2002,NO_USERSIG:2003,NO_TINYID:2022,NO_A2KEY:2023,USER_NOT_LOGGED_IN:2024,REPEAT_LOGIN:2025,COS_UNDETECTED:2040,COS_GET_SIG_FAIL:2041,MESSAGE_SEND_FAIL:2100,MESSAGE_SEND_FAIL_NOT_IN_AVCHATROOM:2101,MESSAGE_SEND_NEED_MESSAGE_INSTANCE:2105,MESSAGE_SEND_INVALID_CONVERSATION_TYPE:2106,MESSAGE_FILE_IS_EMPTY:2108,MESSAGE_ONPROGRESS_FUNCTION_ERROR:2109,MESSAGE_REVOKE_FAIL:2110,MESSAGE_DELETE_FAIL:2111,MESSAGE_UNREAD_ALL_FAIL:2112,READ_RECEIPT_MESSAGE_LIST_EMPTY:2114,MESSAGE_SEND_GROUP_WITH_TOPIC_FAIL:2115,CANNOT_DELETE_GROUP_SYSTEM_NOTICE:2116,TRANSLATE_TEXT_FAIL:2117,MESSAGE_IMAGE_SELECT_FILE_FIRST:2251,MESSAGE_IMAGE_TYPES_LIMIT:2252,MESSAGE_IMAGE_SIZE_LIMIT:2253,MESSAGE_AUDIO_UPLOAD_FAIL:2300,MESSAGE_AUDIO_SIZE_LIMIT:2301,MESSAGE_VIDEO_UPLOAD_FAIL:2350,MESSAGE_VIDEO_SIZE_LIMIT:2351,MESSAGE_VIDEO_TYPES_LIMIT:2352,MESSAGE_FILE_UPLOAD_FAIL:2400,MESSAGE_FILE_SELECT_FILE_FIRST:2401,MESSAGE_FILE_SIZE_LIMIT:2402,MESSAGE_FILE_URL_IS_EMPTY:2403,MESSAGE_MERGER_TYPE_INVALID:2450,MESSAGE_MERGER_KEY_INVALID:2451,MESSAGE_MERGER_DOWNLOAD_FAIL:2452,MESSAGE_FORWARD_TYPE_INVALID:2453,MESSAGE_MODIFY_CONFLICT:2480,MESSAGE_MODIFY_DISABLED_IN_AVCHATROOM:2481,CONVERSATION_NOT_FOUND:2500,USER_OR_GROUP_NOT_FOUND:2501,CONVERSATION_UN_RECORDED_TYPE:2502,INVALID_CONVERSATION_ID:2503,ILLEGAL_GROUP_TYPE:2600,CANNOT_JOIN_WORK:2601,ILLEGAL_GROUP_ID:2602,CANNOT_FIND_GROUP:2603,CANNOT_CHANGE_OWNER_IN_AVCHATROOM:2620,CANNOT_CHANGE_OWNER_TO_SELF:2621,CANNOT_DISMISS_WORK:2622,MEMBER_NOT_IN_GROUP:2623,JOIN_GROUP_FAIL:2660,CANNOT_ADD_MEMBER_IN_AVCHATROOM:2661,CANNOT_JOIN_NON_AVCHATROOM_WITHOUT_LOGIN:2662,NOT_OWNER:2681,CANNOT_SET_MEMBER_ROLE_IN_WORK_AND_AVCHATROOM:2682,INVALID_MEMBER_ROLE:2683,CANNOT_SET_SELF_MEMBER_ROLE:2684,CANNOT_MUTE_SELF:2685,BAN_DURATION_INVALID:2686,NOT_MY_FRIEND:2700,ALREADY_MY_FRIEND:2701,FRIEND_GROUP_EXISTED:2710,FRIEND_GROUP_NOT_EXIST:2711,FRIEND_APPLICATION_NOT_EXIST:2716,UPDATE_PROFILE_INVALID_PARAM:2721,UPDATE_PROFILE_NO_KEY:2722,CANNOT_ADD_SELF_TO_BLACKLIST:2742,NETWORK_ERROR:2800,NETWORK_TIMEOUT:2801,NO_NETWORK:2805,UNCAUGHT_ERROR:2903,INVALID_OPERATION:2905,OVER_FREQUENCY_LIMIT:2996,CANNOT_FIND_PROTOCOL:2997,CANNOT_FIND_MODULE:2998,SDK_IS_NOT_READY:2999,LOGGING_IN:3e3,LOGIN_FAILED:3001,KICKED_OUT_MULT_DEVICE:3002,KICKED_OUT_MULT_ACCOUNT:3003,KICKED_OUT_USERSIG_EXPIRED:3004,LOGGED_OUT:3005,KICKED_OUT_REST_API:3006,ILLEGAL_TOPIC_ID:3021,CANNOT_USE_COMMERCIAL_ABILITY:3122,PROFANITY_FOUND:3123,MESSAGE_A2KEY_EXPIRED:20002,ACCOUNT_A2KEY_EXPIRED:70001,HELLO_ANSWER_KICKED_OUT:1002,OPEN_SERVICE_OVERLOAD_ERROR:60022},fo="networkRTT",go="messageE2EDelay",_o="sendMessageC2C",vo="sendMessageGroup",mo="sendMessageGroupAV",yo="sendMessageRichMedia",Mo="cosUpload",Io="messageReceivedGroup",Co="messageReceivedGroupAVPush",To="messageReceivedGroupAVPull",ko=(l(qt={},fo,2),l(qt,go,3),l(qt,_o,4),l(qt,vo,5),l(qt,mo,6),l(qt,yo,7),l(qt,Io,8),l(qt,Co,9),l(qt,To,10),l(qt,Mo,11),qt),So={info:4,warning:5,error:6},Eo={wifi:1,"2g":2,"3g":3,"4g":4,"5g":5,unknown:6,none:7,online:8},Do={login:4},wo=function(){function e(t){r(this,e),this._n="SSOLogData",this.eventType=Do[t]||0,this.timestamp=0,this.networkType=8,this.code=0,this.message="",this.moreMessage="",this.extension=t,this.costTime=0,this.duplicate=!1,this.level=4,this.uiPlatform=void 0,this._sentFlag=!1,this._startts=Se()}return u(e,[{key:"updateTimeStamp",value:function(){this.timestamp=Se()}},{key:"start",value:function(e){return this._startts=e,this}},{key:"end",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this._sentFlag){var n=Se();0===this.costTime&&(this.costTime=n-this._startts),this.setMoreMessage("startts:".concat(this._startts," endts:").concat(n)),t?(this._sentFlag=!0,this._eventStatModule&&this._eventStatModule.pushIn(this)):setTimeout((function(){e._sentFlag=!0,e._eventStatModule&&e._eventStatModule.pushIn(e)}),0)}}},{key:"setError",value:function(e,t,n){if(!(e instanceof Error))return Le.w("".concat(this._n,".setError value not instanceof Error, please check!")),this;if(this._sentFlag)return this;if(this.setNetworkType(n),t)e.code&&this.setCode(e.code),e.message&&this.setMoreMessage(e.message);else{var i=ho.NO_NETWORK;this.setCode(i)}return this.setLevel("error"),this}},{key:"setCode",value:function(e){return Ye(e)||this._sentFlag||("ECONNABORTED"===e&&(this.code=103),Ve(e)?this.code=e:Le.w("".concat(this._n,".setCode value not a number, please check!"),e,n(e))),this}},{key:"setMessage",value:function(e){return Ye(e)||this._sentFlag||(Ve(e)&&(this.message=e.toString()),He(e)&&(this.message=e)),this}},{key:"setCostTime",value:function(e){return this.costTime=e,this}},{key:"setLevel",value:function(e){return Ye(e)||this._sentFlag||(this.level=So[e]),this}},{key:"setMoreMessage",value:function(e){return Gt(this.moreMessage)?this.moreMessage="".concat(e):this.moreMessage+=" ".concat(e),this}},{key:"setNetworkType",value:function(e){if(Ye(e))Le.w("".concat(this._n,".setNetworkType value is undefined, please check!"));else{var t=Eo[e.toLowerCase()];Ye(t)||(this.networkType=t)}return this}},{key:"getStartTs",value:function(){return this._startts}},{key:"setUIPlatform",value:function(e){this.uiPlatform=e}}],[{key:"bindEventStatModule",value:function(t){e.prototype._eventStatModule=t}}]),e}(),Ao=function(){function e(t){r(this,e),this.type=b.MSG_TEXT,this.content={text:t.text||""}}return u(e,[{key:"setText",value:function(e){this.content.text=e}},{key:"sendable",value:function(){return 0!==this.content.text.length}}]),e}(),bo=function(){function e(t,n){r(this,e),this._imageMemoryURL="",this._fileDownloadProxy=n,W?this.createImageDataASURLInWXMiniApp(t.file):this.createImageDataASURLInWeb(t.file),this._initImageInfoModel(),this.type=b.MSG_IMAGE,this._percent=0,this.content={imageFormat:t.imageFormat||Re.UNKNOWN,uuid:t.uuid,imageInfoArray:[]},this.initImageInfoArray(t.imageInfoArray),this._autoFixUrl()}return u(e,[{key:"_initImageInfoModel",value:function(){var e=this;this._ImageInfoModel=function(t){this.instanceID=ot(9999999),this.sizeType=t.type||0,this.type=0,this.size=t.size||0,this.width=t.width||0,this.height=t.height||0,this.imageUrl=t.url||"",this.url=Pt(t.url||e._imageMemoryURL,e._fileDownloadProxy)},this._ImageInfoModel.prototype={setSizeType:function(e){this.sizeType=e},setType:function(e){this.type=e},setImageUrl:function(e){e&&(this.imageUrl=e)},getImageUrl:function(){return this.imageUrl}}}},{key:"initImageInfoArray",value:function(e){for(var t=0,n=null,i=null;t<=2;)i=Ye(e)||Ye(e[t])?{type:0,size:0,width:0,height:0,url:""}:e[t],(n=new this._ImageInfoModel(i)).setSizeType(t+1),n.setType(t),this.addImageInfo(n),t++;this.updateAccessSideImageInfoArray()}},{key:"updateImageInfoArray",value:function(e){for(var t,n=this.content.imageInfoArray.length,i=0;i<n;i++)t=this.content.imageInfoArray[i],e[i].size&&(t.size=e[i].size),e[i].url&&t.setImageUrl(e[i].url),e[i].width&&(t.width=e[i].width),e[i].height&&(t.height=e[i].height)}},{key:"_autoFixUrl",value:function(){for(var e=this.content.imageInfoArray.length,t="",n="",i=["http","https"],o=null,s=0;s<e;s++)this.content.imageInfoArray[s].url&&""!==(o=this.content.imageInfoArray[s]).imageUrl&&(n=o.imageUrl.slice(0,o.imageUrl.indexOf("://")+1),t=o.imageUrl.slice(o.imageUrl.indexOf("://")+1),i.indexOf(n)<0&&(n="https:"),this.content.imageInfoArray[s].setImageUrl([n,t].join("")))}},{key:"updatePercent",value:function(e){this._percent=e,this._percent>1&&(this._percent=1)}},{key:"updateImageFormat",value:function(e){this.content.imageFormat=Re[e.toUpperCase()]||Re.UNKNOWN}},{key:"createImageDataASURLInWeb",value:function(e){void 0!==e&&e.files.length>0&&(this._imageMemoryURL=window.URL.createObjectURL(e.files[0]))}},{key:"createImageDataASURLInWXMiniApp",value:function(e){e&&e.url&&(this._imageMemoryURL=e.url)}},{key:"replaceImageInfo",value:function(e,t){this.content.imageInfoArray[t]instanceof this._ImageInfoModel||(this.content.imageInfoArray[t]=e)}},{key:"addImageInfo",value:function(e){this.content.imageInfoArray.length>=3||this.content.imageInfoArray.push(e)}},{key:"updateAccessSideImageInfoArray",value:function(){var e=this.content.imageInfoArray,t=e[0],n=t.width,i=void 0===n?0:n,o=t.height,s=void 0===o?0:o;0!==i&&0!==s&&(kt(e),Object.assign(e[2],Tt({originWidth:i,originHeight:s,min:720})))}},{key:"sendable",value:function(){return 0!==this.content.imageInfoArray.length&&""!==this.content.imageInfoArray[0].imageUrl&&0!==this.content.imageInfoArray[0].size}}]),e}(),Lo=function(){function e(t){r(this,e),this.type=b.MSG_FACE,this.content=t||null}return u(e,[{key:"sendable",value:function(){return null!==this.content}}]),e}(),Ro=function(){function e(t,n){r(this,e),this.type=b.MSG_AUDIO,this._percent=0,this.content={downloadFlag:2,second:t.second,size:t.size,url:Pt(t.url,n),remoteAudioUrl:t.url||"",uuid:t.uuid}}return u(e,[{key:"updatePercent",value:function(e){this._percent=e,this._percent>1&&(this._percent=1)}},{key:"updateAudioUrl",value:function(e){this.content.remoteAudioUrl=e}},{key:"sendable",value:function(){return""!==this.content.remoteAudioUrl}}]),e}(),Oo={from:!0,groupID:!0,groupName:!0,to:!0},No=function(){function e(t){r(this,e),this.type=b.MSG_GRP_TIP,this.content={},this._initContent(t)}return u(e,[{key:"_initContent",value:function(e){var t=this;Object.keys(e).forEach((function(n){switch(n){case"remarkInfo":break;case"groupProfile":t.content.groupProfile={},t._initGroupProfile(e[n]);break;case"operatorInfo":break;case"memberInfoList":case"msgMemberInfo":t._updateMemberList(e[n]);break;case"memberExtraInfo":case"onlineMemberInfo":break;case"memberNum":t.content[n]=e[n],t.content.memberCount=e[n];break;case"newGroupProfile":t.content.newGroupProfile={},t._initNewGroupProfile(e[n]);break;default:t.content[n]=e[n]}})),this.content.userIDList||(this.content.userIDList=[this.content.operatorID])}},{key:"_initGroupProfile",value:function(e){for(var t=Object.keys(e),n=0;n<t.length;n++){var i=t[n];Oo[i]&&(this.content.groupProfile[i]=e[i])}}},{key:"_updateMemberList",value:function(e){Gt(this.content.memberList)?this.content.memberList=e:this.content.memberList.forEach((function(t){e.forEach((function(e){t.userID===e.userID&&Object.assign(t,e)}))}))}},{key:"_initNewGroupProfile",value:function(e){for(var t=Object.keys(e),n=0;n<t.length;n++){var i=t[n];this.content.newGroupProfile[i]="muteAllMembers"!==i?e[i]:1===e[i]}}}]),e}(),Po={from:!0,groupID:!0,groupName:!0,to:!0},Uo=function(){function e(t){r(this,e),this.type=b.MSG_GRP_SYS_NOTICE,this.content={},this._initContent(t)}return u(e,[{key:"_initContent",value:function(e){var t=this;Object.keys(e).forEach((function(n){switch(n){case"memberInfoList":break;case"remarkInfo":t.content.handleMessage=e[n];break;case"groupProfile":t.content.groupProfile={},t._initGroupProfile(e[n]);break;default:t.content[n]=e[n]}}))}},{key:"_initGroupProfile",value:function(e){for(var t=Object.keys(e),n=0;n<t.length;n++){var i=t[n];Po[i]&&("groupName"===i?this.content.groupProfile.name=e[i]:this.content.groupProfile[i]=e[i])}}}]),e}(),Go=function(){function e(t,n){r(this,e),this.type=b.MSG_FILE,this._percent=0;var i=this._getFileInfo(t);this.content={downloadFlag:2,fileUrl:Pt(t.url,n)||"",uuid:t.uuid,fileName:i.name||"",fileSize:i.size||0}}return u(e,[{key:"_getFileInfo",value:function(e){if(!Ye(e.fileName)&&!Ye(e.fileSize))return{size:e.fileSize,name:e.fileName};var t=e.file.files[0];if(z){if(t.path&&-1!==t.path.indexOf(".")){var n=t.path.slice(t.path.lastIndexOf(".")+1).toLowerCase();t.type=n,t.name||(t.name="".concat(ot(999999),".").concat(n))}t.name||(t.type="",t.name=t.path.slice(t.path.lastIndexOf("/")+1).toLowerCase()),t.suffix&&(t.type=t.suffix),t.url||(t.url=t.path)}return{size:t.size,name:t.name}}},{key:"updatePercent",value:function(e){this._percent=e,this._percent>1&&(this._percent=1)}},{key:"updateFileUrl",value:function(e){this.content.fileUrl=e}},{key:"sendable",value:function(){return""!==this.content.fileUrl&&""!==this.content.fileName&&0!==this.content.fileSize}}]),e}(),xo=function(){function e(t){r(this,e),this.type=b.MSG_CUSTOM,this.content={data:t.data||"",description:t.description||"",extension:t.extension||""}}return u(e,[{key:"setData",value:function(e){return this.content.data=e,this}},{key:"setDescription",value:function(e){return this.content.description=e,this}},{key:"setExtension",value:function(e){return this.content.extension=e,this}},{key:"sendable",value:function(){return 0!==this.content.data.length||0!==this.content.description.length||0!==this.content.extension.length}}]),e}(),Fo=function(){function e(t,n){r(this,e),this.type=b.MSG_VIDEO,this._percent=0,this.content={remoteVideoUrl:t.remoteVideoUrl||t.videoUrl||"",videoFormat:t.videoFormat,videoSecond:parseInt(t.videoSecond,10),videoSize:t.videoSize,videoUrl:Pt(t.videoUrl,n),videoDownloadFlag:2,videoUUID:t.videoUUID,thumbUUID:t.thumbUUID,thumbFormat:t.thumbFormat,thumbWidth:t.thumbWidth,snapshotWidth:t.thumbWidth,thumbHeight:t.thumbHeight,snapshotHeight:t.thumbHeight,thumbSize:t.thumbSize,snapshotSize:t.thumbSize,thumbDownloadFlag:2,thumbUrl:Pt(t.thumbUrl,n),snapshotUrl:Pt(t.thumbUrl,n)}}return u(e,[{key:"updatePercent",value:function(e){this._percent=e,this._percent>1&&(this._percent=1)}},{key:"updateVideoUrl",value:function(e){e&&(this.content.remoteVideoUrl=e)}},{key:"updateSnapshotInfo",value:function(e){var t=e.snapshotUrl,n=e.snapshotWidth,i=e.snapshotHeight;Gt(t)||(this.content.thumbUrl=this.content.snapshotUrl=t),Gt(n)||(this.content.thumbWidth=this.content.snapshotWidth=Number(n)),Gt(i)||(this.content.thumbHeight=this.content.snapshotHeight=Number(i))}},{key:"sendable",value:function(){return""!==this.content.remoteVideoUrl}}]),e}(),qo=function(){function e(t){r(this,e),this.type=b.MSG_LOCATION;var n=t.description,i=t.longitude,o=t.latitude;this.content={description:n,longitude:i,latitude:o}}return u(e,[{key:"sendable",value:function(){return!0}}]),e}(),Bo=function(){function e(t,n){if(r(this,e),this.from=t.from,this.messageSender=t.from,this.time=t.time,this.messageSequence=t.sequence,this.clientSequence=t.clientSequence||t.sequence,this.messageRandom=t.random,this.cloudCustomData=t.cloudCustomData||"",this.clientTime=t.clientTime||void 0,t.ID)this.ID=t.ID||"",this.nick=t.nick||"",this.avatar=t.avatar||"",this.messageBody=[{type:t.type,payload:t.payload}],t.conversationType.startsWith(b.CONV_C2C)?this.receiverUserID=t.to:t.conversationType.startsWith(b.CONV_GROUP)&&(this.receiverGroupID=t.to),this.messageReceiver=t.to;else{this.nick=t.nick||"",this.avatar=t.avatar||"",this.messageBody=[];var i=t.elements[0].type,o=t.elements[0].content;this._patchRichMediaPayload(i,o),this._updateRichMediaDownloadUrl(i,o,n),i===b.MSG_MERGER?this.messageBody.push({type:i,payload:new $o(o).content}):this.messageBody.push({type:i,payload:o}),t.groupID&&(this.receiverGroupID=t.groupID,this.messageReceiver=t.groupID),t.to&&(this.receiverUserID=t.to,this.messageReceiver=t.to),this.ID="".concat(t.tinyID,"-").concat(t.clientTime,"-").concat(t.random)}}return u(e,[{key:"_patchRichMediaPayload",value:function(e,t){e===b.MSG_IMAGE?t.imageInfoArray.forEach((function(e){!e.imageUrl&&e.url&&(e.imageUrl=e.url,e.sizeType=e.type,1===e.type?e.type=0:3===e.type&&(e.type=1))})):e===b.MSG_VIDEO?!t.remoteVideoUrl&&t.videoUrl&&(t.remoteVideoUrl=t.videoUrl):e===b.MSG_AUDIO?!t.remoteAudioUrl&&t.url&&(t.remoteAudioUrl=t.url):e===b.MSG_FILE&&!t.fileUrl&&t.url&&(t.fileUrl=t.url,t.url=void 0)}},{key:"_updateRichMediaDownloadUrl",value:function(e,t,n){n&&(e===b.MSG_IMAGE?t.imageInfoArray.forEach((function(e){e.url=Pt(e.url,n)})):e===b.MSG_VIDEO?(t.videoUrl=Pt(t.videoUrl,n),t.snapshotUrl=Pt(t.thumbUrl,n),t.snapshotHeight=t.thumbHeight,t.snapshotWidth=t.thumbWidth):e===b.MSG_AUDIO?t.url=Pt(t.url,n):e===b.MSG_FILE&&(t.fileUrl=Pt(t.fileUrl,n)))}}]),e}(),$o=function(){function e(t,n){if(r(this,e),this.type=b.MSG_MERGER,this.content={downloadKey:"",pbDownloadKey:"",messageList:[],title:"",abstractList:[],compatibleText:"",version:0,layersOverLimit:!1},t.downloadKey){var i=t.downloadKey,o=t.pbDownloadKey,s=t.title,a=t.abstractList,c=t.compatibleText,u=t.version;this.content.downloadKey=i,this.content.pbDownloadKey=o,this.content.title=s,this.content.abstractList=a,this.content.compatibleText=c,this.content.version=u||0}else if(Gt(t.messageList))1===t.layersOverLimit&&(this.content.layersOverLimit=!0);else{var l=t.messageList,d=t.title,p=t.abstractList,h=t.compatibleText,f=t.version,g=[];l.forEach((function(e){if(!Gt(e)){var t=new Bo(e,n);g.push(t)}})),this.content.messageList=g,this.content.title=d,this.content.abstractList=p,this.content.compatibleText=h,this.content.version=f||0}}return u(e,[{key:"sendable",value:function(){return!Gt(this.content.messageList)||!Gt(this.content.downloadKey)}}]),e}(),Vo={1:b.MSG_PRIORITY_HIGH,2:b.MSG_PRIORITY_NORMAL,3:b.MSG_PRIORITY_LOW,4:b.MSG_PRIORITY_LOWEST},Ho=function(){function e(t){r(this,e),this.ID="",this.conversationID=t.conversationID||null,this.conversationType=t.conversationType||b.CONV_C2C,this.conversationSubType=t.conversationSubType,this.time=t.time||Math.ceil(Date.now()/1e3),this.sequence=t.sequence||0,this.clientSequence=t.clientSequence||t.sequence||0,this.random=t.random||0===t.random?t.random:ot(),this.priority=this._computePriority(t.priority),this.nick=t.nick||"",this.avatar=t.avatar||"",this.isPeerRead=!1,this.nameCard="",this._elements=[],this.isPlaceMessage=t.isPlaceMessage||0,this.isRevoked=2===t.isPlaceMessage||8===t.msgFlagBits,this.from=t.from||null,this.to=t.to||null,this.flow="",this.isSystemMessage=t.isSystemMessage||!1,this.protocol=t.protocol||"JSON",this.isResend=!1,this.isRead=!1,this.status=t.status||Bt.SUCCESS,this._onlineOnlyFlag=!1,this._groupAtInfoList=[],this._relayFlag=!1,this.atUserList=[],this.cloudCustomData=t.cloudCustomData||"",this.isDeleted=!1,this.isModified=!1,this._isExcludedFromUnreadCount=!(!t.messageControlInfo||1!==t.messageControlInfo.excludedFromUnreadCount),this._isExcludedFromLastMessage=!(!t.messageControlInfo||1!==t.messageControlInfo.excludedFromLastMessage),this.clientTime=t.clientTime||De()||0,this.senderTinyID=t.senderTinyID||t.tinyID||"",this.readReceiptInfo=t.readReceiptInfo||{readCount:void 0,unreadCount:void 0,isPeerRead:void 0},this.needReadReceipt=!0===t.needReadReceipt||1===t.needReadReceipt,this.version=t.messageVersion||0,this.isBroadcastMessage=t.isBroadcastMessage||!1,this._receiverList=t.receiverList||void 0,this.isSupportExtension=!0===t.isSupportExtension||1===t.isSupportExtension,this.revoker=t.revokerInfo&&t.revokerInfo.revoker||null,this.reInitialize(t.currentUser),this.extractGroupInfo(t.groupProfile||null),this.handleGroupAtInfo(t),this.initC2CReadReceiptInfo(t.readReceiptSentByPeer)}return u(e,[{key:"elements",get:function(){return this._elements}},{key:"getElements",value:function(){return this._elements}},{key:"extractGroupInfo",value:function(e){if(null!==e){He(e.nick)&&(this.nick=e.nick),He(e.avatar)&&(this.avatar=e.avatar);var t=e.messageFromAccountExtraInformation;je(t)&&He(t.nameCard)&&(this.nameCard=t.nameCard)}}},{key:"handleGroupAtInfo",value:function(e){var t=this;e.payload&&e.payload.atUserList&&e.payload.atUserList.forEach((function(e){e!==b.MSG_AT_ALL?(t._groupAtInfoList.push({groupAtAllFlag:0,groupAtUserID:e}),t.atUserList.push(e)):(t._groupAtInfoList.push({groupAtAllFlag:1}),t.atUserList.push(b.MSG_AT_ALL))})),ze(e.groupAtInfo)&&e.groupAtInfo.forEach((function(e){0===e.groupAtAllFlag?t.atUserList.push(e.groupAtUserID):1===e.groupAtAllFlag&&t.atUserList.push(b.MSG_AT_ALL)}))}},{key:"getGroupAtInfoList",value:function(){return this._groupAtInfoList}},{key:"_initProxy",value:function(){this._elements[0]&&(this.payload=this._elements[0].content,this.type=this._elements[0].type)}},{key:"reInitialize",value:function(e){e&&(this.status=this.from?Bt.SUCCESS:Bt.UNSEND,!this.from&&(this.from=e)),this._initFlow(e),this._initSequence(e),this._concatConversationID(e),this.generateMessageID()}},{key:"isSendable",value:function(){return 0!==this._elements.length&&"function"==typeof this._elements[0].sendable&&this._elements[0].sendable()}},{key:"_initTo",value:function(e){this.conversationType===b.CONV_GROUP&&(this.to=e.groupID)}},{key:"_initSequence",value:function(e){0===this.clientSequence&&e&&(this.clientSequence=function(e){if(!e)return!1;if(void 0===ct[e]){var t=new Date,n="3".concat(t.getHours()).slice(-2),i="0".concat(t.getMinutes()).slice(-2),o="0".concat(t.getSeconds()).slice(-2);ct[e]=parseInt([n,i,o,"0001"].join("")),n=null,i=null,o=null,Le.l("autoIncrementIndex start index:".concat(ct[e]))}return ct[e]++}(e)),0===this.sequence&&this.conversationType===b.CONV_C2C&&(this.sequence=this.clientSequence)}},{key:"generateMessageID",value:function(){this.from===b.CONV_SYSTEM&&(this.senderTinyID="144115198244471703"),this.ID="".concat(this.senderTinyID,"-").concat(this.clientTime,"-").concat(this.random)}},{key:"_initFlow",value:function(e){""!==e&&(e===this.from?(this.flow="out",this.isRead=!0):this.flow="in")}},{key:"_concatConversationID",value:function(e){var t=this.to,n="",i=this.conversationType;i!==b.CONV_SYSTEM?(n=i===b.CONV_C2C?e===this.from?t:this.from:this.to,this.conversationID=n?"".concat(i).concat(n):null):this.conversationID=b.CONV_SYSTEM}},{key:"isElement",value:function(e){return e instanceof Ao||e instanceof bo||e instanceof Lo||e instanceof Ro||e instanceof Go||e instanceof Fo||e instanceof No||e instanceof Uo||e instanceof xo||e instanceof qo||e instanceof $o}},{key:"setElement",value:function(e,t){var n=this;if(this.isElement(e))return this._elements=[e],void this._initProxy();var i=function(e){if(e.type&&e.content)switch(e.type){case b.MSG_TEXT:n.setTextElement(e.content);break;case b.MSG_IMAGE:n.setImageElement(e.content,t);break;case b.MSG_AUDIO:n.setAudioElement(e.content,t);break;case b.MSG_FILE:n.setFileElement(e.content,t);break;case b.MSG_VIDEO:n.setVideoElement(e.content,t);break;case b.MSG_CUSTOM:n.setCustomElement(e.content);break;case b.MSG_LOCATION:n.setLocationElement(e.content);break;case b.MSG_GRP_TIP:n.setGroupTipElement(e.content);break;case b.MSG_GRP_SYS_NOTICE:n.setGroupSystemNoticeElement(e.content);break;case b.MSG_FACE:n.setFaceElement(e.content);break;case b.MSG_MERGER:n.setMergerElement(e.content,t)}};if(ze(e))for(var o=0;o<e.length;o++)i(e[o]);else i(e);this._initProxy()}},{key:"clearElement",value:function(){this._elements.length=0}},{key:"setTextElement",value:function(e){var t="string"==typeof e?e:e.text,n=new Ao({text:t});this._elements.push(n)}},{key:"setImageElement",value:function(e,t){var n=new bo(e,t);this._elements.push(n)}},{key:"setAudioElement",value:function(e,t){var n=new Ro(e,t);this._elements.push(n)}},{key:"setFileElement",value:function(e,t){var n=new Go(e,t);this._elements.push(n)}},{key:"setVideoElement",value:function(e,t){var n=new Fo(e,t);this._elements.push(n)}},{key:"setLocationElement",value:function(e){var t=new qo(e);this._elements.push(t)}},{key:"setCustomElement",value:function(e){var t=new xo(e);this._elements.push(t)}},{key:"setGroupTipElement",value:function(e){var t={},n=e.operationType;if(Gt(e.memberInfoList)?e.operatorInfo&&(t=e.operatorInfo):n!==b.GRP_TIP_MBR_JOIN&&n!==b.GRP_TIP_MBR_KICKED_OUT&&n!==b.GRP_TIP_MBR_SET_ADMIN&&n!==b.GRP_TIP_MBR_CANCELED_ADMIN||(t=e.memberInfoList[0]),!Gt(e.memberExtraInfo)){var i=e.memberExtraInfo.reason;e.msgMemberInfo.forEach((function(e){e.reason=i}))}var o=t,s=o.nick,r=o.avatar;He(s)&&(this.nick=s),He(r)&&(this.avatar=r);var a=new No(e);this._elements.push(a)}},{key:"setGroupSystemNoticeElement",value:function(e){var t=new Uo(e);this._elements.push(t)}},{key:"setFaceElement",value:function(e){var t=new Lo(e);this._elements.push(t)}},{key:"setMergerElement",value:function(e,t){var n=new $o(e,t);this._elements.push(n)}},{key:"setIsRead",value:function(e){this.isRead=e}},{key:"setRelayFlag",value:function(e){this._relayFlag=e}},{key:"getRelayFlag",value:function(){return this._relayFlag}},{key:"_computePriority",value:function(e){if(Ye(e))return b.MSG_PRIORITY_NORMAL;if(He(e)&&-1!==Object.values(Vo).indexOf(e))return e;if(Ve(e)){var t=""+e;if(-1!==Object.keys(Vo).indexOf(t))return Vo[t]}return b.MSG_PRIORITY_NORMAL}},{key:"setNickAndAvatar",value:function(e){var t=e.nick,n=e.avatar;He(t)&&(this.nick=t),He(n)&&(this.avatar=n)}},{key:"setNameCard",value:function(e){He(e)&&(this.nameCard=e)}},{key:"initC2CReadReceiptInfo",value:function(e){this.conversationType===b.CONV_C2C&&!0===this.needReadReceipt&&(this.readReceiptInfo.isPeerRead=1===e)}}]),e}(),Ko=function(e){return{code:0,data:e||{}}},jo=function(e){d(n,e);var t=M(n);function n(e){var i;r(this,n),i=t.call(this);var o=e.code,s=e.message,a=e.data;return i.code=o,i.message=s||i._getErrorMessage(i.code),i.data=a||{},i}return u(n)}(_(Error)),zo=null,Yo=function(e){return Promise.resolve(Ko(e))},Wo=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(e instanceof jo)return t&&null!==zo&&zo.emit(A.ERROR,e),Promise.reject(e);if(e instanceof Error){var n=new jo({code:ho.UNCAUGHT_ERROR});return t&&null!==zo&&zo.emit(A.ERROR,n),Promise.reject(n)}if(!Ye(e)&&!Ye(e.code)){var i=new jo(e);return t&&null!==zo&&zo.emit(A.ERROR,i),Promise.reject(i)}},Jo=function(e){d(i,e);var n=M(i);function i(e){var t;return r(this,i),(t=n.call(this,e))._n="C2CModule",t._messageFromUnreadDBMap=new Map,t._signalingFromUnreadDBList=[],t}return u(i,[{key:"onNewC2CMessage",value:function(e){var t=e.dataList,n=e.isInstantMessage,i=e.C2CRemainingUnreadList,o=e.C2CPairUnreadList;Le.d("".concat(this._n,".onNewC2CMessage count:").concat(t.length," isInstantMessage:").concat(n));var s=this._newC2CMessageStoredAndSummary({dataList:t,C2CRemainingUnreadList:i,C2CPairUnreadList:o,isInstantMessage:n}),r=s.conversationOptionsList,a=s.messageList,c=s.isUnreadC2CMessage;this.filterModifiedMessage(a),r.length>0&&this.getModule(11).onNewMessage({conversationOptionsList:r,isInstantMessage:n,isUnreadC2CMessage:c});var u=this.filterUnmodifiedMessage(a);n&&u.length>0&&this.emitOuterEvent(A.MESSAGE_RECEIVED,u),a.length=0}},{key:"_newC2CMessageStoredAndSummary",value:function(e){for(var t=e.dataList,n=e.C2CRemainingUnreadList,i=e.C2CPairUnreadList,o=e.isInstantMessage,s=null,r=[],a=[],c={},u=this.getModule(16),l=this.getModule(26),d=!1,p=this.getModule(11),h=this.getFileDownloadProxy(),f=0,g=t.length;f<g;f++)if(this._isSignaling(t[f]))this._signalingFromUnreadDBList.push(t[f].eventArray[0].c2CNotifyMsgArray[0]);else{var _=t[f];_.currentUser=this.getMyUserID(),_.conversationType=b.CONV_C2C,_.isSystemMessage=!!_.isSystemMessage,(Ye(_.nick)||Ye(_.avatar))&&(d=!0,Le.d("".concat(this._n,"._newC2CMessageStoredAndSummary nick or avatar missing!"))),s=new Ho(_),_.elements=u.parseElements(_.elements,_.from),s.setElement(_.elements,h),s.setNickAndAvatar({nick:_.nick,avatar:_.avatar});var v=s.conversationID;if(o){if(1===this._messageFromUnreadDBMap.get(s.ID))continue;var m=!1;if(s.from!==this.getMyUserID()){var y=p.getLatestMessageSentByPeer(v);if(y){var M=y.nick,I=y.avatar;d?s.setNickAndAvatar({nick:M,avatar:I}):M===s.nick&&I===s.avatar||(m=!0)}}else{var C=p.getLatestMessageSentByMe(v);if(C){var T=C.nick,k=C.avatar;T===s.nick&&k===s.avatar||p.modifyMessageSentByMe({conversationID:v,latestNick:s.nick,latestAvatar:s.avatar})}}var S=1===t[f].isModified;if(p.isMessageSentByCurrentInstance(s)?s.isModified=S:S=!1,0===_.msgLifeTime)s._onlineOnlyFlag=!0,p.isMessageSentByCurrentInstance(s)||a.push(s);else{if(!p.pushIntoMessageList(a,s,S))continue;m&&(p.modifyMessageSentByPeer({conversationID:v,latestNick:s.nick,latestAvatar:s.avatar}),p.updateUserProfileSpecifiedKey({conversationID:v,nick:s.nick,avatar:s.avatar}))}o&&s.clientTime>0&&l.addMessageDelay(s.clientTime)}else this._messageFromUnreadDBMap.set(s.ID,1);if(0!==_.msgLifeTime){if(!1===s._onlineOnlyFlag){var E=p.getLastMessageTime(v);if(Ve(E)&&s.time<E)continue;if(Ye(c[v])){var D=0;"in"===s.flow&&(s._isExcludedFromUnreadCount||(D=1)),c[v]=r.push({conversationID:v,unreadCount:D,type:s.conversationType,subType:s.conversationSubType,lastMessage:s._isExcludedFromLastMessage?"":s})-1}else{var w=c[v];r[w].type=s.conversationType,r[w].subType=s.conversationSubType,r[w].lastMessage=s._isExcludedFromLastMessage?"":s,"in"===s.flow&&(s._isExcludedFromUnreadCount||r[w].unreadCount++)}}}else s._onlineOnlyFlag=!0}this._handleSignalingFromUnreadDB();var A=!1;if(ze(i))for(var L=function(e,t){if(i[e].unreadCount>0){A=!0;var n=r.find((function(t){return t.conversationID==="C2C".concat(i[e].from)}));n?n.unreadCount=i[e].unreadCount:r.push({conversationID:"C2C".concat(i[e].from),unreadCount:i[e].unreadCount,type:b.CONV_C2C})}},R=0,O=i.length;R<O;R++)L(R);if(ze(n))for(var N=function(e,t){r.find((function(t){return t.conversationID==="C2C".concat(n[e].from)}))||r.push({conversationID:"C2C".concat(n[e].from),type:b.CONV_C2C,lastMsgTime:n[e].lastMsgTime})},P=0,U=n.length;P<U;P++)N(P);return{conversationOptionsList:r,messageList:a,isUnreadC2CMessage:A}}},{key:"_isSignaling",value:function(e){var t=e.eventArray;return!(!ze(t)||10!==t[0].event)}},{key:"_handleSignalingFromUnreadDB",value:function(){var e=this._signalingFromUnreadDBList.length;if(Le.l("".concat(this._n,"._handleSignalingFromUnreadDB signalingCount:").concat(e)),0!==e){var t=[];this._signalingFromUnreadDBList.forEach((function(e){e.hasOwnProperty("c2cMessageRevokedNotify")&&t.push(e)})),this.onC2CMessageRevoked({dataList:t}),this._signalingFromUnreadDBList.length=0,t.length=0}}},{key:"onC2CMessageRevoked",value:function(e){var t=this,n=this.getModule(11),i=[],o=null,s=!0;e.dataList.forEach((function(e){if(e.c2cMessageRevokedNotify){var r=e.c2cMessageRevokedNotify.revokedInfos;Ye(r)||r.forEach((function(e){var r=t.getMyUserID()===e.from?"".concat(b.CONV_C2C).concat(e.to):"".concat(b.CONV_C2C).concat(e.from);o=n.revoke(r,e.sequence,e.random);var a=e.revokerInfo&&e.revokerInfo.revoker;if(o)o.revoker||(o.revoker=a,i.push(o));else{var c={conversationID:r,sequence:e.sequence,time:e.time,revoker:a};n.isLastMessageRevoked(c)&&(i.push(c),s=!1)}}))}})),0!==i.length&&(n.onMessageRevoked(i),!0===s&&(Le.l("".concat(this._n,".onC2CMessageRevoked count:").concat(i.length)),this.emitOuterEvent(A.MESSAGE_REVOKED,i)))}},{key:"onC2CMessageReadReceipt",value:function(e){var t=this;e.dataList.forEach((function(e){if(!Gt(e.c2cMessageReadReceipt)){var n=e.c2cMessageReadReceipt.to;e.c2cMessageReadReceipt.uinPairReadArray.forEach((function(e){var i=e.peerReadTime;Le.d("".concat(t._n,"._onC2CMessageReadReceipt to:").concat(n," peerReadTime:").concat(i));var o="".concat(b.CONV_C2C).concat(n),s=t.getModule(11);s.recordPeerReadTime(o,i),s.updateMessageIsPeerReadProperty(o,i)}))}}))}},{key:"onC2CMessageReadNotice",value:function(e){var t=this;e.dataList.forEach((function(e){if(!Gt(e.c2cMessageReadNotice)){var n=t.getModule(11);e.c2cMessageReadNotice.uinPairReadArray.forEach((function(e){var i=e.from,o=e.peerReadTime;Le.d("".concat(t._n,".onC2CMessageReadNotice from:").concat(i," lastReadTime:").concat(o));var s="".concat(b.CONV_C2C).concat(i);n.updateIsReadAfterReadReport({conversationID:s,lastMessageTime:o}),n.updateUnreadCount(s)}))}}))}},{key:"onC2CMessageModified",value:function(e){Le.d("".concat(this._n,".onC2CMessageModified options:"),JSON.stringify(e));var n=this.getModule(11);e.dataList.forEach((function(e){n.onMessageModified(t(t({},e),{},{conversationType:b.CONV_C2C}))}))}},{key:"onReadReceiptList",value:function(e){Le.d("".concat(this._n,".onReadReceiptList options:"),JSON.stringify(e));var t=e.dataList,n=t.userID,i=t.readReceiptList;this.getModule(11).updateReadReceiptInfo({userID:n,readReceiptList:i})}},{key:"sendMessage",value:function(e,t){var n=this._createC2CMessagePack(e,t);return this.request(n)}},{key:"_createC2CMessagePack",value:function(e,t){var n=null;t&&(t.offlinePushInfo&&(n=t.offlinePushInfo),!0===t.onlineUserOnly&&(n?n.disablePush=!0:n={disablePush:!0}));var i="";He(e.cloudCustomData)&&e.cloudCustomData.length>0&&(i=e.cloudCustomData);var o=[];if(je(t)&&je(t.messageControlInfo)){var s=t.messageControlInfo,r=s.excludedFromUnreadCount,a=s.excludedFromLastMessage,c=s.excludedFromContentModeration;!0===r&&o.push("NoUnread"),!0===a&&o.push("NoLastMsg"),!0===c&&o.push("NoMsgCheck")}var u=this.isOnlineMessage(e,t)?0:void 0;return{protocolName:kn,tjgID:this.generateTjgID(e),requestData:{fromAccount:this.getMyUserID(),toAccount:e.to,msgBody:e.getElements(),cloudCustomData:i,msgSeq:e.sequence,msgRandom:e.random,msgLifeTime:u,nick:e.nick,avatar:e.avatar,offlinePushInfo:n?{pushFlag:!0===n.disablePush?1:0,title:n.title||"",desc:n.description||"",ext:n.extension||"",apnsInfo:{badgeMode:!0===n.ignoreIOSBadge?1:0,isVoipPush:this._isVoipPush(n)},androidInfo:{OPPOChannelID:n.androidOPPOChannelID||""}}:void 0,messageControlInfo:0!==u?o:void 0,clientTime:e.clientTime,needReadReceipt:!0===e.needReadReceipt?1:0,isSupportExtension:!0===e.isSupportExtension?1:0}}}},{key:"_isVoipPush",value:function(e){var t=void 0;return Ye(e.disableVoipPush)||(t=!1===e.disableVoipPush?1:0),t}},{key:"isOnlineMessage",value:function(e,t){return!(!t||!0!==t.onlineUserOnly)}},{key:"revokeMessage",value:function(e){return this.request({protocolName:Ln,requestData:{msgInfo:{fromAccount:e.from,toAccount:e.to,msgSeq:e.sequence,msgRandom:e.random,msgTimeStamp:e.time}}})}},{key:"deleteMessage",value:function(e){var t=e.to,n=e.keyList;return Le.l("".concat(this._n,".deleteMessage toAccount:").concat(t," count:").concat(n.length)),this.request({protocolName:Gn,requestData:{fromAccount:this.getMyUserID(),to:t,keyList:n}})}},{key:"modifyRemoteMessage",value:function(e){var t=e.from,n=e.to,i=e.version,o=void 0===i?0:i,s=e.sequence,r=e.random,a=e.time,c=e.payload,u=e.type,l=e.cloudCustomData,d=void 0;return Lt(u)&&(d=[]).push({type:u,content:c}),this.request({protocolName:xn,requestData:{from:t,to:n,version:o,sequence:s,random:r,time:a,elements:d,cloudCustomData:l}})}},{key:"setMessageRead",value:function(e){var t=this,n=e.conversationID,i=e.lastMessageTime,o="".concat(this._n,".setMessageRead");Le.l("".concat(o," conversationID:").concat(n," lastMessageTime:").concat(i)),Ve(i)||this.outputWarning("DoNotModifyLastTime");var s=new wo("setC2CMessageRead");return s.setMessage("conversationID:".concat(n," lastMessageTime:").concat(i)),this.request({protocolName:Rn,requestData:{C2CMsgReaded:{cookie:"",C2CMsgReadedItem:[{toAccount:n.replace("C2C",""),lastMessageTime:i,receipt:1}]}}}).then((function(){s.setNetworkType(t.getNetworkType()).end(),Le.l("".concat(o," ok"));var e=t.getModule(11);return e.updateIsReadAfterReadReport({conversationID:n,lastMessageTime:i}),e.updateUnreadCount(n),Ko()})).catch((function(e){return t.probeNetwork().then((function(t){var n=I(t,2),i=n[0],o=n[1];s.setError(e,i,o).end()})),Le.l("".concat(o," failed. error:"),e),Wo(e)}))}},{key:"getRoamingMessage",value:function(e){var t=this,n="".concat(this._n,".getRoamingMessage"),i=e.peerAccount,o=e.conversationID,s=e.count,r=e.lastMessageTime,a=e.messageKey,c="peerAccount:".concat(i," count:").concat(s||15," lastMessageTime:").concat(r||0," messageKey:").concat(a);Le.l("".concat(n," ").concat(c));var u=new wo("getC2CRoamingMessages");return this.request({protocolName:Pn,requestData:{peerAccount:i,count:s||15,lastMessageTime:r||0,messageKey:a}}).then((function(e){var i=e.data,s=i.complete,r=i.messageList,a=i.messageKey,l=i.lastMessageTime;Ye(r)?Le.l("".concat(n," ok. complete:").concat(s," but messageList is undefined!")):Le.l("".concat(n," ok. complete:").concat(s," count:").concat(r.length)),u.setNetworkType(t.getNetworkType()).setMessage("".concat(c," complete:").concat(s," length:").concat(r.length)).end();var d=t.getModule(11);1===s&&d.setCompleted(o);var p=d.onRoamingMessage(r,o);d.modifyMessageList(o),d.updateIsRead(o),d.updateRoamingMessageKeyAndTime(o,a,l);var h=d.getPeerReadTime(o);if(Le.l("".concat(n," update isPeerRead property. conversationID:").concat(o," peerReadTime:").concat(h)),h)d.updateMessageIsPeerReadProperty(o,h);else{var f=o.replace(b.CONV_C2C,"");t.getRemotePeerReadTime([f]).then((function(){d.updateMessageIsPeerReadProperty(o,d.getPeerReadTime(o))}))}var g="";if(p.length>0)g=p[0].ID;else{var _=d.getLocalOldestMessage(o);_&&(g=_.ID)}return Le.l("".concat(n," nextReqID:").concat(g," stored message count:").concat(p.length)),{nextReqID:g,storedMessageList:p}})).catch((function(e){return t.probeNetwork().then((function(t){var n=I(t,2),i=n[0],o=n[1];u.setMessage(c).setError(e,i,o).end()})),Le.w("".concat(n," failed. error:"),e),Wo(e)}))}},{key:"getRoamingMessagesHopping",value:function(e){var t=this,n="".concat(this._n,".getRoamingMessagesHopping"),i=e.peerAccount,o=e.time,s=void 0===o?0:o,r=e.count,a=e.direction,c="".concat(b.CONV_C2C).concat(i),u="peerAccount:".concat(i," count:").concat(r," time:").concat(s," direction:").concat(a);Le.l("".concat(n," ").concat(u));var l=new wo("getC2CRoamingMessagesHopping");return this.request({protocolName:Pn,requestData:{peerAccount:i,count:r+1,lastMessageTime:s,direction:a}}).then((function(e){var i=e.data,o=i.complete,s=i.messageList,r=void 0===s?[]:s,d=i.lastMessageTime;Le.l("".concat(n," ok. complete:").concat(o," count:").concat(r.length)),l.setNetworkType(t.getNetworkType()).setMessage("".concat(u," complete:").concat(o," length:").concat(r.length)).end(),1!==o&&(1===a?r.pop():r.shift());var p=t.getModule(11).onRoamingMessage(r,c,!1);t._modifyMessageList(c,p);var h=t._computeResult({complete:o,lastMessageTime:d,resultList:p});return Ko(h)})).catch((function(e){return t.probeNetwork().then((function(t){var n=I(t,2),i=n[0],o=n[1];l.setMessage(u).setError(e,i,o).end()})),Le.w("".concat(n," failed. error:"),e),Wo(e)}))}},{key:"_computeResult",value:function(e){var t=e.complete,n=void 0===t?0:t,i=e.lastMessageTime,o=e.resultList,s={messageList:C(void 0===o?[]:o),isCompleted:!1,nextMessageTime:""};return 1===n?(s.isCompleted=!0,s):(s.nextMessageTime=i,s)}},{key:"_modifyMessageList",value:function(e,t){var n=this.getModule(11).getLocalConversation(e);if(n)for(var i=n.userProfile.nick,o=n.userProfile.avatar,s=this.getModule(4).getNickAndAvatarByUserID(this.getMyUserID()),r=s.nick,a=s.avatar,c=t.length-1;c>=0;c--){var u=t[c];"in"===u.flow&&(u.nick!==i&&u.setNickAndAvatar({nick:i}),u.avatar!==o&&u.setNickAndAvatar({avatar:o})),"out"===u.flow&&(u.nick!==r&&u.setNickAndAvatar({nick:r}),u.avatar!==a&&u.setNickAndAvatar({avatar:a}))}}},{key:"getRemotePeerReadTime",value:function(e){var t=this,n="".concat(this._n,".getRemotePeerReadTime");if(Gt(e))return Le.w("".concat(n," userIDList is empty!")),Promise.resolve();var i=new wo("getPeerReadTime");return Le.l("".concat(n," userIDList:").concat(e)),this.request({protocolName:Un,requestData:{userIDList:e}}).then((function(o){var s=o.data.peerReadTimeList;Le.l("".concat(n," ok. peerReadTimeList:").concat(s));for(var r="",a=t.getModule(11),c=0;c<e.length;c++)r+="".concat(e[c],"-").concat(s[c]," "),s[c]>0&&a.recordPeerReadTime("C2C".concat(e[c]),s[c]);i.setNetworkType(t.getNetworkType()).setMessage(r).end()})).catch((function(e){t.probeNetwork().then((function(t){var n=I(t,2),o=n[0],s=n[1];i.setError(e,o,s).end()})),Le.w("".concat(n," failed. error:"),e)}))}},{key:"sendReadReceipt",value:function(e){var t=this,n=e[0].conversationID.replace(b.CONV_C2C,""),i=new wo("sendC2CReadReceipt");i.setMessage("peerAccount:".concat(n));var o=this.getMyUserID(),s=e.filter((function(e){return e.from!==o&&!0===e.needReadReceipt})).map((function(e){return{fromAccount:e.from,toAccount:e.to,sequence:e.sequence,random:e.random,time:e.time,clientTime:e.clientTime}}));if(0===s.length)return Wo({code:ho.READ_RECEIPT_MESSAGE_LIST_EMPTY});var r="".concat(this._n,".sendReadReceipt");return Le.l("".concat(r,". peerAccount:").concat(n," messageInfoList length:").concat(s.length)),this.request({protocolName:mi,requestData:{peerAccount:n,messageInfoList:s}}).then((function(e){return i.end(),Le.l("".concat(r," ok")),Ko()})).catch((function(e){return t.probeNetwork().then((function(t){var n=I(t,2),o=n[0],s=n[1];i.setError(e,o,s).end()})),Le.w("".concat(r," failed. error:"),e),Wo(e)}))}},{key:"getReadReceiptList",value:function(e){var t="".concat(this._n,".getReadReceiptList"),n=this.getMyUserID(),i=e.filter((function(e){return e.from===n&&!0===e.needReadReceipt}));return Le.l("".concat(t," userID:").concat(n," messageList length:").concat(i.length)),Yo({messageList:i})}},{key:"getMessageExtensions",value:function(e,t){return Le.l("".concat(this._n,".getMessageExtensions startSequence:").concat(t)),this.request({protocolName:qn,requestData:{from:e.from,to:e.to,messageKey:this._getMessageKey(e),startSequence:t}})}},{key:"modifyMessageExtensions",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;return Le.l("".concat(this._n,".modifyMessageExtensions operateType:").concat(n)),this.request({protocolName:Fn,requestData:{from:e.from,to:e.to,messageKey:this._getMessageKey(e),extensionList:t,operateType:n}})}},{key:"_getMessageKey",value:function(e){var t=e.clientSequence,n=e.random,i=e.time;return"".concat(t,"_").concat(n,"_").concat(i)}},{key:"reset",value:function(){Le.l("".concat(this._n,".reset")),this._messageFromUnreadDBMap.clear(),this._signalingFromUnreadDBList.length=0}}]),i}(yn),Xo=function(){function e(){r(this,e),this.list=new Map,this._n="MessageListHandler",this._latestMessageSentByPeerMap=new Map,this._latestMessageSentByMeMap=new Map}return u(e,[{key:"getLocalOldestMessageByConversationID",value:function(e){if(!e)return null;if(!this.list.has(e))return null;var t=this.list.get(e).values();return t?t.next().value:null}},{key:"pushIn",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=e.conversationID,i=!0;this.list.has(n)||this.list.set(n,new Map);var o=this._getUniqueIDOfMessage(e),s=this.list.get(n).has(o);if(s){var r=this.list.get(n).get(o);if(!t||!0===r.isModified)return!1}return this.list.get(n).set(o,e),this._setLatestMessageSentByPeer(n,e),this._setLatestMessageSentByMe(n,e),i}},{key:"unshift",value:function(e,t){var n;if(ze(e)?e.length>0&&(n=e[0].conversationID,this._unshiftMultipleMessages(e,t)):(n=e.conversationID,this._unshiftSingleMessage(e,t)),n&&n.startsWith(b.CONV_C2C)){var i=Array.from(this.list.get(n).values()),o=i.length;if(0===o)return;for(var s=o-1;s>=0;s--)if("out"===i[s].flow){this._setLatestMessageSentByMe(n,i[s]);break}for(var r=o-1;r>=0;r--)if("in"===i[r].flow){this._setLatestMessageSentByPeer(n,i[r]);break}}}},{key:"_unshiftSingleMessage",value:function(e,t){var n=e.conversationID,i=this._getUniqueIDOfMessage(e);if(!this.list.has(n))return this.list.set(n,new Map),this.list.get(n).set(i,e),void t.push(e);var o=this.list.get(n),s=Array.from(o);o.has(i)||(s.unshift([i,e]),this.list.set(n,new Map(s)),t.push(e))}},{key:"_unshiftMultipleMessages",value:function(e,t){for(var n=e.length,i=[],o=e[0].conversationID,s=this.list.get(o),r=this.list.has(o)?Array.from(s):[],a=0;a<n;a++){var c=this._getUniqueIDOfMessage(e[a]);s&&s.has(c)||(i.push([c,e[a]]),t.push(e[a]))}this.list.set(o,new Map(i.concat(r)))}},{key:"remove",value:function(e){var t=e.conversationID,n=this._getUniqueIDOfMessage(e);this.list.has(t)&&this.list.get(t).delete(n)}},{key:"revoke",value:function(e,t,n){if(Le.d("revoke message",e,t,n),this.list.has(e)){var i,o=w(this.list.get(e));try{for(o.s();!(i=o.n()).done;){var s=I(i.value,2)[1];if(s.sequence===t&&(Ye(n)||s.random===n))return s.isRevoked||(s.isRevoked=!0),s}}catch(l){o.e(l)}finally{o.f()}}return null}},{key:"removeByConversationID",value:function(e){this.list.has(e)&&(this.list.delete(e),this._latestMessageSentByPeerMap.delete(e),this._latestMessageSentByMeMap.delete(e))}},{key:"findMessage",value:function(e){var t,n=null,i=w(this.list);try{for(i.s();!(t=i.n()).done;)for(var o=C(I(t.value,2)[1].values()),s=o.length,r=0;r<s;r++)if(o[r].ID===e){n=o[r];break}}catch(d){i.e(d)}finally{i.f()}return n}},{key:"updateMessageIsPeerReadProperty",value:function(e,t){var n=[];if(this.list.has(e)){var i,o=w(this.list.get(e));try{for(o.s();!(i=o.n()).done;){var s=I(i.value,2)[1];s.time<=t&&!s.isPeerRead&&"out"===s.flow&&(s.isPeerRead=!0,n.push(s))}}catch(l){o.e(l)}finally{o.f()}Le.l("".concat(this._n,".updateMessageIsPeerReadProperty conversationID:").concat(e," peerReadTime:").concat(t," count:").concat(n.length))}return n}},{key:"updateMessageIsModifiedProperty",value:function(e){var t=e.conversationID;if(this.list.has(t)){var n=this._getUniqueIDOfMessage(e),i=this.list.get(t).get(n);i&&(i.isModified=!0)}}},{key:"hasLocalMessageList",value:function(e){return this.list.has(e)}},{key:"getLocalMessageList",value:function(e){return this.hasLocalMessageList(e)?C(this.list.get(e).values()):[]}},{key:"hasLocalMessage",value:function(e,t){for(var n=!1,i=this.getLocalMessageList(e),o=i.length,s=0;s<o;s++)i[s].ID===t&&(n=!0);return n}},{key:"getLocalMessage",value:function(e,t){for(var n=null,i=this.getLocalMessageList(e),o=i.length,s=0;s<o;s++)if(i[s].ID===t){n=i[s];break}return n}},{key:"getLocalLastMessage",value:function(e){var t=this.getLocalMessageList(e);return t[t.length-1]}},{key:"getLocalOldestMessage",value:function(e){return this.getLocalMessageList(e)[0]}},{key:"_setLatestMessageSentByPeer",value:function(e,t){e.startsWith(b.CONV_C2C)&&"in"===t.flow&&this._latestMessageSentByPeerMap.set(e,t)}},{key:"_setLatestMessageSentByMe",value:function(e,t){e.startsWith(b.CONV_C2C)&&"out"===t.flow&&this._latestMessageSentByMeMap.set(e,t)}},{key:"getLatestMessageSentByPeer",value:function(e){return this._latestMessageSentByPeerMap.get(e)}},{key:"getLatestMessageSentByMe",value:function(e){return this._latestMessageSentByMeMap.get(e)}},{key:"modifyMessageSentByPeer",value:function(e){var t=e.conversationID,n=e.latestNick,i=e.latestAvatar,o=this.list.get(t);if(!Gt(o)){var s=Array.from(o.values()),r=s.length;if(0!==r){for(var a=null,c=0,u=!1,l=r-1;l>=0;l--)"in"===s[l].flow&&((a=s[l]).nick!==n&&(a.setNickAndAvatar({nick:n}),u=!0),a.avatar!==i&&(a.setNickAndAvatar({avatar:i}),u=!0),u&&(c+=1));Le.l("".concat(this._n,".modifyMessageSentByPeer conversationID:").concat(t," count:").concat(c))}}}},{key:"modifyMessageSentByMe",value:function(e){var t=e.conversationID,n=e.latestNick,i=e.latestAvatar,o=this.list.get(t);if(!Gt(o)){var s=Array.from(o.values()),r=s.length;if(0!==r){for(var a=null,c=0,u=!1,l=r-1;l>=0;l--)"out"===s[l].flow&&((a=s[l]).nick!==n&&(a.setNickAndAvatar({nick:n}),u=!0),a.avatar!==i&&(a.setNickAndAvatar({avatar:i}),u=!0),u&&(c+=1));Le.l("".concat(this._n,".modifyMessageSentByMe conversationID:").concat(t," count:").concat(c))}}}},{key:"getTopicConversationIDList",value:function(e){return C(this.list.keys()).filter((function(t){return t.startsWith("".concat(b.CONV_GROUP).concat(e))}))}},{key:"traversal",value:function(){if(0!==this.list.size&&-1===Le.getLevel()){console.group("conversationID-messageCount");var e,t=w(this.list);try{for(t.s();!(e=t.n()).done;){var n=I(e.value,2),i=n[0],o=n[1];s("log","".concat(i,"-").concat(o.size)," at node_modules/tim-wx-sdk/tim-wx.js:1")}}catch(u){t.e(u)}finally{t.f()}console.groupEnd()}}},{key:"onMessageModified",value:function(e,t){if(!this.list.has(e))return{isUpdated:!1,message:null};var n=this._getUniqueIDOfMessage(t),i=this.list.get(e).has(n);if(Le.d("".concat(this._n,".onMessageModified conversationID:").concat(e," uniqueID:").concat(n," has:").concat(i)),i){var o=this.list.get(e).get(n),s=t.messageVersion,r=t.elements,a=t.cloudCustomData;return o.version<s?(o.version=s,o._elements=JSON.parse(JSON.stringify(r)),o.payload=JSON.parse(JSON.stringify(r[0].content)),o.type=r[0].type,o.cloudCustomData=a,o.isModified=!0,{isUpdated:!0,message:o}):{isUpdated:!1,message:o}}return{isUpdated:!1,message:null}}},{key:"_getUniqueIDOfMessage",value:function(e){var t=e.from,n=e.to,i=e.random,o=e.sequence,s=e.time;return"".concat(t,"-").concat(n,"-").concat(i,"-").concat(o,"-").concat(s)}},{key:"reset",value:function(){this.list.clear(),this._latestMessageSentByPeerMap.clear(),this._latestMessageSentByMeMap.clear()}}]),e}(),Zo="_a2KeyAndTinyIDUpdated",Qo="_cloudConfigUpdated",es="_profileUpdated";function ts(e){this.mixin(e)}ts.mixin=function(e){var t=e.prototype||e;t._isReady=!1,t.ready=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(e)return this._isReady?void(t?e.call(this):setTimeout(e,1)):(this._readyQueue=this._readyQueue||[],void this._readyQueue.push(e))},t.triggerReady=function(){var e=this;this._isReady=!0,setTimeout((function(){var t=e._readyQueue;e._readyQueue=[],t&&t.length>0&&t.forEach((function(e){e.call(this)}),e)}),1)},t.resetReady=function(){this._isReady=!1,this._readyQueue=[]},t.isReady=function(){return this._isReady}};var ns=["jpg","jpeg","gif","png","bmp","image","webp"],is=["mp4","quicktime","mov"],os=function(){function e(t){var n=this;r(this,e),Gt(t)||(this.userID=t.userID||"",this.nick=t.nick||"",this.gender=t.gender||"",this.birthday=t.birthday||0,this.location=t.location||"",this.selfSignature=t.selfSignature||"",this.allowType=t.allowType||b.ALLOW_TYPE_ALLOW_ANY,this.language=t.language||0,this.avatar=t.avatar||"",this.messageSettings=t.messageSettings||0,this.adminForbidType=t.adminForbidType||b.FORBID_TYPE_NONE,this.level=t.level||0,this.role=t.role||0,this.lastUpdatedTime=0,this.profileCustomField=[],Gt(t.profileCustomField)||t.profileCustomField.forEach((function(e){n.profileCustomField.push({key:e.key,value:e.value})})))}return u(e,[{key:"validate",value:function(e){var t=!0,n="";if(Gt(e))return{valid:!1,tips:"empty options"};if(e.profileCustomField)for(var i=e.profileCustomField.length,o=null,s=0;s<i;s++){if(o=e.profileCustomField[s],!He(o.key)||-1===o.key.indexOf("Tag_Profile_Custom"))return{valid:!1,tips:"The prefix of keys of the custom profile key-value pairs (which is profileCustomField) must be Tag_Profile_Custom"};if(!He(o.value))return{valid:!1,tips:"The type of values of the custom profile key-value pairs (which is profileCustomField) must be String"}}for(var r in e)if(Object.prototype.hasOwnProperty.call(e,r)){if("profileCustomField"===r)continue;if(Gt(e[r])&&!He(e[r])&&!Ve(e[r])){n="key:"+r+", invalid value:"+e[r],t=!1;continue}switch(r){case"nick":He(e[r])||(n="nick must be a string",t=!1),it(e[r])>500&&(n="nick name limited: must less than or equal to ".concat(500," bytes, current size: ").concat(it(e[r])," bytes"),t=!1);break;case"gender":at(Ne,e.gender)||(n="key:gender, invalid value:"+e.gender,t=!1);break;case"birthday":Ve(e.birthday)||(n="birthday must be a number",t=!1);break;case"location":He(e.location)||(n="location must be a string",t=!1);break;case"selfSignature":He(e.selfSignature)||(n="selfSignature must be a string",t=!1);break;case"allowType":at(Ue,e.allowType)||(n="key:allowType, invalid value:"+e.allowType,t=!1);break;case"language":Ve(e.language)||(n="language must be a number",t=!1);break;case"avatar":He(e.avatar)||(n="avatar must be a string",t=!1);break;case"messageSettings":0!==e.messageSettings&&1!==e.messageSettings&&(n="messageSettings must be 0 or 1",t=!1);break;case"adminForbidType":at(Pe,e.adminForbidType)||(n="key:adminForbidType, invalid value:"+e.adminForbidType,t=!1);break;case"level":Ve(e.level)||(n="level must be a number",t=!1);break;case"role":Ve(e.role)||(n="role must be a number",t=!1);break;default:n="unknown key:"+r+"  "+e[r],t=!1}}return{valid:t,tips:n}}}]),e}(),ss=u((function e(t){r(this,e),this.value=t,this.next=null})),rs=function(){function e(t){r(this,e),this.MAX_LENGTH=t,this.pTail=null,this.pNodeToDel=null,this.map=new Map}return u(e,[{key:"set",value:function(e){var t=new ss(e);if(this.map.size<this.MAX_LENGTH)null===this.pTail?(this.pTail=t,this.pNodeToDel=t):(this.pTail.next=t,this.pTail=t),this.map.set(e,1);else{var n=this.pNodeToDel;this.pNodeToDel=this.pNodeToDel.next,this.map.delete(n.value),n.next=null,n=null,this.pTail.next=t,this.pTail=t,this.map.set(e,1)}}},{key:"has",value:function(e){return this.map.has(e)}},{key:"delete",value:function(e){this.has(e)&&this.map.delete(e)}},{key:"tail",value:function(){return this.pTail}},{key:"size",value:function(){return this.map.size}},{key:"data",value:function(){return Array.from(this.map.keys())}},{key:"reset",value:function(){for(var e;null!==this.pNodeToDel;)e=this.pNodeToDel,this.pNodeToDel=this.pNodeToDel.next,e.next=null,e=null;this.pTail=null,this.map.clear()}}]),e}(),as=["groupID","name","avatar","type","introduction","notification","ownerID","selfInfo","createTime","infoSequence","lastInfoTime","lastMessage","nextMessageSeq","memberNum","maxMemberNum","memberList","joinOption","groupCustomField","muteAllMembers","isSupportTopic","inviteOption","_lastRevokedTime"],cs=function(){function e(t){r(this,e),this.groupID="",this.name="",this.avatar="",this.type="",this.introduction="",this.notification="",this.ownerID="",this.createTime="",this.infoSequence="",this.lastInfoTime="",this.selfInfo={messageRemindType:"",joinTime:"",nameCard:"",role:"",userID:"",memberCustomField:void 0,readedSequence:0,excludedUnreadSequenceList:void 0},this.lastMessage={lastTime:"",lastSequence:"",fromAccount:"",messageForShow:""},this.nextMessageSeq="",this.memberNum="",this.memberCount="",this.maxMemberNum="",this.maxMemberCount="",this.joinOption="",this.inviteOption="",this.groupCustomField=[],this.muteAllMembers=!1,this.isSupportTopic=!1,this._lastRevokedTime=0,this._initGroup(t)}return u(e,[{key:"memberNum",get:function(){return this.memberCount},set:function(e){}},{key:"maxMemberNum",get:function(){return this.maxMemberCount},set:function(e){}},{key:"_initGroup",value:function(e){for(var t in e)as.indexOf(t)<0||("selfInfo"!==t?("memberNum"===t&&(this.memberCount=e[t]),"maxMemberNum"===t&&(this.maxMemberCount=e[t]),"isSupportTopic"!==t?this[t]=e[t]:this.isSupportTopic=1===e[t]):this.updateSelfInfo(e[t]))}},{key:"updateGroup",value:function(e){var t=this;e.appid=void 0,e.grossTopicNextMsgSeq=void 0,e.selfInfo&&(e.selfInfo.grossTopicReadSeq=void 0);var n=JSON.parse(JSON.stringify(e));n.lastMsgTime&&(this.lastMessage.lastTime=n.lastMsgTime),Ye(n.muteAllMembers)||("On"===n.muteAllMembers?n.muteAllMembers=!0:n.muteAllMembers=!1),n.groupCustomField&&dt(this.groupCustomField,n.groupCustomField),Ye(n.memberNum)||(this.memberCount=n.memberNum),Ye(n.maxMemberNum)||(this.maxMemberCount=n.maxMemberNum),Ye(n.isSupportTopic)||(this.isSupportTopic=Ve(n.isSupportTopic)?1===n.isSupportTopic:n.isSupportTopic),et(this,n,["members","errorCode","lastMsgTime","groupCustomField","memberNum","maxMemberNum","isSupportTopic"]),ze(n.members)&&n.members.length>0&&n.members.forEach((function(e){e.userID===t.selfInfo.userID&&et(t.selfInfo,e,["sequence"])}))}},{key:"updateSelfInfo",value:function(e){var n={nameCard:e.nameCard,joinTime:e.joinTime,role:e.role,messageRemindType:e.messageRemindType,readedSequence:e.readedSequence,excludedUnreadSequenceList:e.excludedUnreadSequenceList};et(this.selfInfo,t({},n),[],["",null,void 0,0,NaN])}},{key:"setSelfNameCard",value:function(e){this.selfInfo.nameCard=e}}]),e}(),us=function(e,n){return Ye(e)?{lastTime:0,lastSequence:0,fromAccount:0,messageForShow:"",payload:null,type:"",isRevoked:!1,cloudCustomData:"",onlineOnlyFlag:!1,nick:"",nameCard:"",version:0,isPeerRead:!1,revoker:null}:e instanceof Ho?{lastTime:e.time||0,lastSequence:e.sequence||0,fromAccount:e.from||"",messageForShow:bt(e.type,e.payload,n),payload:e.payload||null,type:e.type||null,isRevoked:e.isRevoked||!1,cloudCustomData:e.cloudCustomData||"",onlineOnlyFlag:e._onlineOnlyFlag||!1,nick:e.nick||"",nameCard:e.nameCard||"",version:e.version||0,isPeerRead:e.isPeerRead||!1,revoker:e.revoker||null}:t(t({},e),{},{messageForShow:bt(e.type,e.payload,n)})},ls=function(){function e(t,n){r(this,e),this.conversationID=t.conversationID||"",this.unreadCount=t.unreadCount||0,this.type=t.type||"",this.lastMessage=us(t.lastMessage,n),t.lastMsgTime&&(this.lastMessage.lastTime=t.lastMsgTime),this._isInfoCompleted=!1,this.peerReadTime=t.peerReadTime||0,this.groupAtInfoList=[],this.remark="",this.isPinned=t.isPinned||!1,this.messageRemindType="",this.markList=t.markList||[],this.customData=t.customData||"",this.conversationGroupList=t.conversationGroupList||[],this._initProfile(t)}return u(e,[{key:"toAccount",get:function(){return this.conversationID.startsWith(b.CONV_C2C)?this.conversationID.replace(b.CONV_C2C,""):this.conversationID.startsWith(b.CONV_GROUP)?this.conversationID.replace(b.CONV_GROUP,""):""}},{key:"subType",get:function(){return this.groupProfile?this.groupProfile.type:""}},{key:"_initProfile",value:function(e){var t=this;Object.keys(e).forEach((function(n){switch(n){case"userProfile":t.userProfile=e.userProfile;break;case"groupProfile":t.groupProfile=e.groupProfile}})),Ye(this.userProfile)&&this.type===b.CONV_C2C?this.userProfile=new os({userID:e.conversationID.replace("C2C","")}):Ye(this.groupProfile)&&this.type===b.CONV_GROUP&&(this.groupProfile=new cs({groupID:e.conversationID.replace("GROUP","")}))}},{key:"updateUnreadCount",value:function(e){var t=e.nextUnreadCount,n=e.isFromGetConversations,i=e.isUnreadC2CMessage;Ye(t)||(pt(this.subType)?this.unreadCount=0:n&&this.type===b.CONV_GROUP||n&&this.type===b.CONV_TOPIC||i&&this.type===b.CONV_C2C?this.unreadCount=t:this.unreadCount=this.unreadCount+t)}},{key:"updateLastMessage",value:function(e){this.lastMessage=us(e)}},{key:"updateGroupAtInfoList",value:function(e){if(!this._isNeedMergeGroupAtInfo(e)){var t,n=(T(t=e.groupAtType)||k(t)||S(t)||D()).slice(0);-1!==n.indexOf(b.CONV_AT_ME)&&-1!==n.indexOf(b.CONV_AT_ALL)&&(n=[b.CONV_AT_ALL_AT_ME]);var i={from:e.from,groupID:e.groupID,topicID:e.topicID,messageSequence:e.sequence,atTypeArray:n,__random:e.__random,__sequence:e.__sequence};this.groupAtInfoList.push(i)}}},{key:"_isNeedMergeGroupAtInfo",value:function(e){var t=e.groupID,n=e.sequence;if(!ht({groupID:t}))return!1;var i=!1;return this.groupAtInfoList.forEach((function(t){t.messageSequence===n&&(t.atTypeArray.indexOf(b.CONV_AT_ME)>-1&&e.groupAtType.indexOf(b.CONV_AT_ALL)>-1&&(t.atTypeArray=[b.CONV_AT_ALL_AT_ME]),t.atTypeArray.indexOf(b.CONV_AT_ALL)>-1&&e.groupAtType.indexOf(b.CONV_AT_ME)>-1&&(t.atTypeArray=[b.CONV_AT_ALL_AT_ME],t.__random=e.__random,t.__sequence=e.__sequence),i=!0)})),i}},{key:"clearGroupAtInfoList",value:function(){this.groupAtInfoList.length=0}},{key:"reduceUnreadCount",value:function(){return this.unreadCount>=1&&(this.unreadCount-=1,!0)}},{key:"isLastMessageRevoked",value:function(e){var t=e.sequence,n=e.time;return this.type===b.CONV_C2C&&t===this.lastMessage.lastSequence&&n===this.lastMessage.lastTime||this.type===b.CONV_GROUP&&t===this.lastMessage.lastSequence}},{key:"setLastMessageRevoked",value:function(e){this.lastMessage.isRevoked=e}},{key:"setLastMessageRevoker",value:function(e){this.lastMessage.revoker=e}}]),e}(),ds=function(){function e(t){r(this,e),this._conversationModule=t,this._n="MessageRemindHandler",this._updateSequence=0}return u(e,[{key:"getC2CMessageRemindType",value:function(){var e=this,t="".concat(this._n,".getC2CMessageRemindType");return this._conversationModule.request({protocolName:Nn,updateSequence:this._updateSequence}).then((function(n){Le.l("".concat(t," ok"));var i=n.data,o=i.updateSequence,s=i.muteFlagList;e._updateSequence=o,e._patchC2CMessageRemindType(s)})).catch((function(e){Le.e("".concat(t," failed. error:"),e)}))}},{key:"_patchC2CMessageRemindType",value:function(e){var t=this,n=0,i="";ze(e)&&e.length>0&&e.forEach((function(e){var o=e.userID,s=e.muteFlag;0===s?i=b.MSG_REMIND_ACPT_AND_NOTE:1===s?i=b.MSG_REMIND_DISCARD:2===s&&(i=b.MSG_REMIND_ACPT_NOT_NOTE),!0===t._conversationModule.patchMessageRemindType({ID:o,isC2CConversation:!0,messageRemindType:i})&&(n+=1)})),Le.l("".concat(this._n,"._patchC2CMessageRemindType count:").concat(n))}},{key:"set",value:function(e){return e.groupID?this._setGroupMessageRemindType(e):ze(e.userIDList)?this._setC2CMessageRemindType(e):void 0}},{key:"_setGroupMessageRemindType",value:function(e){var t=this,n="".concat(this._n,"._setGroupMessageRemindType"),i=e.groupID,o=e.messageRemindType,s="groupID:".concat(i," messageRemindType:").concat(o),r=new wo("setMessageRemindType");return r.setMessage(s),this._getModule(9).modifyGroupMemberInfo({groupID:i,messageRemindType:o,userID:this._conversationModule.getMyUserID()}).then((function(){r.setNetworkType(t._conversationModule.getNetworkType()).end(),Le.l("".concat(n," ok. ").concat(s));var i=t.onGroupMessageRemindTypeUpdated(e);return t._conversationModule.emitTotalUnreadMessageCountUpdate(),Ko(i)})).catch((function(e){return t._conversationModule.probeNetwork().then((function(t){var n=I(t,2),i=n[0],o=n[1];r.setError(e,i,o).end()})),Le.e("".concat(n," failed. error:"),e),Wo(e)}))}},{key:"onGroupMessageRemindTypeUpdated",value:function(e){var t=e.groupID,n=e.messageRemindType,i=this._getModule(7).getLocalGroupProfile(t);if(i&&(i.selfInfo.messageRemindType=n),ft(t)){var o=t,s=At(o),r=this._getModule(10).getLocalTopic(s,o);return r&&(r.updateSelfInfo({messageRemindType:n}),this._conversationModule.emitOuterEvent(A.TOPIC_UPDATED,{groupID:s,topic:r})),{topic:r}}return this._conversationModule.patchMessageRemindType({ID:t,isC2CConversation:!1,messageRemindType:n})&&this._emitConversationUpdate(),{group:i}}},{key:"_setC2CMessageRemindType",value:function(e){var t=this,n="".concat(this._n,"._setC2CMessageRemindType"),i=e.userIDList,o=e.messageRemindType,s=i.slice(0,30),r=0;o===b.MSG_REMIND_DISCARD?r=1:o===b.MSG_REMIND_ACPT_NOT_NOTE&&(r=2);var a="userIDList:".concat(s," messageRemindType:").concat(o),c=new wo("setMessageRemindType");return c.setMessage(a),this._conversationModule.request({protocolName:On,requestData:{userIDList:s,muteFlag:r}}).then((function(e){c.setNetworkType(t._conversationModule.getNetworkType()).end();var i=e.data,r=i.updateSequence,a=i.errorList;t._updateSequence=r;var u=[],l=[];ze(a)&&a.forEach((function(e){u.push(e.userID),l.push({userID:e.userID,code:e.errorCode})}));var d=s.filter((function(e){return-1===u.indexOf(e)}));Le.l("".concat(n," ok. successUserIDList:").concat(d," failureUserIDList:").concat(JSON.stringify(l)));var p=0;return d.forEach((function(e){t._conversationModule.patchMessageRemindType({ID:e,isC2CConversation:!0,messageRemindType:o})&&(p+=1)})),p>=1&&t._emitConversationUpdate(),s.length=u.length=0,t._conversationModule.emitTotalUnreadMessageCountUpdate(),Yo({successUserIDList:d.map((function(e){return{userID:e}})),failureUserIDList:l})})).catch((function(e){return t._conversationModule.probeNetwork().then((function(t){var n=I(t,2),i=n[0],o=n[1];c.setError(e,i,o).end()})),Le.e("".concat(n," failed. error:"),e),Wo(e)}))}},{key:"_getModule",value:function(e){return this._conversationModule.getModule(e)}},{key:"_emitConversationUpdate",value:function(){this._conversationModule.emitConversationUpdate(!0,!1)}},{key:"setUpdateSequence",value:function(e){this._updateSequence=e}},{key:"reset",value:function(){Le.l("".concat(this._n,".reset")),this._updateSequence=0}}]),e}(),ps=function(){function e(t){r(this,e),this._conversationModule=t,this._n="ConvGroupHandler",this._convGroupMap=new Map,this._startIndex=0,this._pagingStatus=$t.NOT_START}return u(e,[{key:"setConvCustomData",value:function(e){var t=this,n="".concat(this._n,".").concat("setConvCustomData"),i=e.conversationIDList,o=e.customData;Le.l("".concat(n," options:"),e);var s=new wo("setConvCustomData");s.setMessage(JSON.stringify(e));var r={fromAccount:this._getMyUserID(),itemList:[]},a=[],c=[];return i.forEach((function(e){if(!t._hasLocalConversation(e))return t._onConversationNotFound(c,e),!0;if(!gt(e)&&!_t(e))return t._onConversationIDInvalid(c,e),!0;var n={operationType:2,contactItem:void 0,customMark:o};gt(e)?n.contactItem={type:1,toAccount:e.replace(b.CONV_C2C,"")}:_t(e)&&(n.contactItem={type:2,groupID:e.replace(b.CONV_GROUP,"")}),r.itemList.push(n)})),c.length===i.length?Yo({successConversationIDList:a,failureConversationIDList:c}):this._conversationModule.request({protocolName:Kn,requestData:r}).then((function(e){s.setNetworkType(t._conversationModule.getNetworkType()).end(),Le.l("".concat(n," ok"));var i=e.data.resultItem;if(ze(i)){var r,u,l=!1;i.forEach((function(e){r=t._concatConversationID(e.contactItem),0===e.resultCode?(a.push(r),(u=t._getLocalConversation(r))&&u.customData!==o&&(u.customData=o,l=!0)):c.push({conversationID:r,code:e.resultCode,message:e.resultInfo})})),!0===l&&t._emitConversationUpdate()}return Ko({successConversationIDList:a,failureConversationIDList:c})})).catch((function(e){return t._conversationModule.probeNetwork().then((function(t){var n=I(t,2),i=n[0],o=n[1];s.setError(e,i,o).end()})),Le.e("".concat(n," failed. error:"),e),Wo(e)}))}},{key:"markConversation",value:function(e){var t=this;if(!this._conversationModule.canIUse(F.CONV_MARK))return Wo({code:ho.CANNOT_USE_COMMERCIAL_ABILITY});var n="".concat(this._n,".").concat("markConversation"),i=e.conversationIDList,o=e.markType,s=e.enableMark;Le.l("".concat(n," options:"),e);var r=new wo("markConversation");r.setMessage(JSON.stringify(e));var a=void 0,c=void 0,u=this._getFlagBit(o);!0===s?c=[u]:a=[u];var l={fromAccount:this._getMyUserID(),itemList:[]},d=[],p=[];return i.forEach((function(e){if(!t._hasLocalConversation(e))return t._onConversationNotFound(p,e),!0;if(!gt(e)&&!_t(e))return t._onConversationIDInvalid(p,e),!0;var n={operationType:1,contactItem:void 0,clearMark:a,setMark:c};gt(e)?n.contactItem={type:1,toAccount:e.replace(b.CONV_C2C,"")}:_t(e)&&(n.contactItem={type:2,groupID:e.replace(b.CONV_GROUP,"")}),l.itemList.push(n)})),p.length===i.length?Yo({successConversationIDList:d,failureConversationIDList:p}):this._conversationModule.request({protocolName:jn,requestData:l}).then((function(e){r.setNetworkType(t._conversationModule.getNetworkType()).end(),Le.l("".concat(n," ok"));var i=e.data.resultItem;if(ze(i)){var a,c,u=!1;i.forEach((function(e){if(a=t._concatConversationID(e.contactItem),0===e.resultCode){if(d.push(a),c=t._getLocalConversation(a)){var n=c.markList.indexOf(o);!0===s?-1===n&&(c.markList.push(o),u=!0):-1!==n&&(c.markList.splice(n,1),u=!0)}}else p.push({conversationID:a,code:e.resultCode,message:e.resultInfo})})),!0===u&&t._emitConversationUpdate()}return Ko({successConversationIDList:d,failureConversationIDList:p})})).catch((function(e){return t._conversationModule.probeNetwork().then((function(t){var n=I(t,2),i=n[0],o=n[1];r.setError(e,i,o).end()})),Le.e("".concat(n," failed. error:"),e),Wo(e)}))}},{key:"getLocalConvGroupList",value:function(){var e=this;return Le.l("".concat(this._n,".getLocalConvGroupList pagingStatus:").concat(this._pagingStatus)),this._pagingStatus===$t.REJECTED?this.getRemoteConvGroupList().then((function(){return Ko(C(e._convGroupMap.values()))})):Yo(C(this._convGroupMap.values()))}},{key:"getRemoteConvGroupList",value:function(){var e=this,t="".concat(this._n,".getRemoteConvGroupList");return this._pagingStatus=$t.PENDING,this._conversationModule.request({protocolName:Zn,requestData:{fromAccount:this._getMyUserID(),startIndex:this._startIndex,startTime:De()}}).then((function(n){var i,o,s=n.data,r=s.completeFlag,a=s.contactItem,c=s.nextStartIndex,u=void 0===c?0:c,l=s.groupItem;if(e._startIndex=u,Le.l("".concat(t," completeFlag:").concat(r," nextStartIndex:").concat(u)),ze(l)&&l.forEach((function(t){var n=t.convGroupID,i=t.groupName;e._convGroupMap.set(n,i)})),ze(a)&&a.forEach((function(t){var n=t.standardMark,s=t.customData,r=t.convGroupIDList;if(i=e._concatConversationID(t),(o=e._getLocalConversation(i))&&(o.markList=Rt(n),o.customData=s||"",ze(r))){var a=[];r.forEach((function(t){e._convGroupMap.has(t)&&a.push(e._convGroupMap.get(t))})),o.conversationGroupList=[].concat(a),a.length=0}})),0===r)return e.getRemoteConvGroupList();1===r&&(e._pagingStatus=$t.RESOLVED,e._emitConversationUpdate(),e._emitConvGroupListUpdate())})).catch((function(n){e._pagingStatus=$t.REJECTED,Le.w("".concat(t," failed. error:"),n)}))}},{key:"createConvGroup",value:function(e){var t=this;if(!this._conversationModule.canIUse(F.CONV_GROUP))return Wo({code:ho.CANNOT_USE_COMMERCIAL_ABILITY});var n="".concat(this._n,".").concat("createConvGroup");Le.l("".concat(n," options:"),e);var i=new wo("createConvGroup");i.setMessage(JSON.stringify(e));var o=e.groupName,s=e.conversationIDList,r={fromAccount:this._getMyUserID(),itemList:[{groupName:o,contactItem:[]}]},a=[],c=[];return s.forEach((function(e){return t._hasLocalConversation(e)?gt(e)||_t(e)?void(gt(e)?r.itemList[0].contactItem.push({type:1,toAccount:e.replace(b.CONV_C2C,"")}):_t(e)&&r.itemList[0].contactItem.push({type:2,groupID:e.replace(b.CONV_GROUP,"")})):(t._onConversationIDInvalid(c,e),!0):(t._onConversationNotFound(c,e),!0)})),c.length===s.length?Yo({successConversationIDList:a,failureConversationIDList:c}):this._conversationModule.request({protocolName:zn,requestData:r}).then((function(e){i.setNetworkType(t._conversationModule.getNetworkType()).end(),Le.l("".concat(n," ok"));var s=e.data.groupResultItem[0],r=s.groupItem,u=s.resultItem;if(je(r)&&(t._convGroupMap.set(r.convGroupID,r.groupName),t._emitConvGroupListUpdate()),ze(u)){var l,d,p=!1;u.forEach((function(e){l=t._concatConversationID(e.contactItem),0===e.resultCode?(a.push(l),(d=t._getLocalConversation(l))&&-1===d.conversationGroupList.indexOf(o)&&(d.conversationGroupList.push(o),p=!0)):c.push({conversationID:l,code:e.resultCode,message:e.resultInfo})})),!0===p&&(t._emitConversationUpdate(),t._emitConvGroupListUpdate())}return Ko({successConversationIDList:a,failureConversationIDList:c})})).catch((function(e){return t._conversationModule.probeNetwork().then((function(t){var n=I(t,2),o=n[0],s=n[1];i.setError(e,o,s).end()})),Le.e("".concat(n," failed. error:"),e),Wo(e)}))}},{key:"deleteConvGroup",value:function(e){var t=this;if(!this._conversationModule.canIUse(F.CONV_GROUP))return Wo({code:ho.CANNOT_USE_COMMERCIAL_ABILITY});var n="".concat(this._n,".").concat("deleteConvGroup");Le.l("".concat(n," groupName:").concat(e));var i=new wo("deleteConvGroup");return i.setMessage(e),this._conversationModule.request({protocolName:Yn,requestData:{fromAccount:this._getMyUserID(),groupName:[e]}}).then((function(o){i.setNetworkType(t._conversationModule.getNetworkType()).end(),Le.l("".concat(n," ok"));var s=o.data.groupItem;if(ze(s)){var r=!1;s.forEach((function(e){t._convGroupMap.has(e.convGroupID)&&(t._convGroupMap.delete(e.convGroupID),r=!0)})),!0===r&&t._emitConvGroupListUpdate()}t._eraseFromConversationGroupList([e])})).catch((function(e){return t._conversationModule.probeNetwork().then((function(t){var n=I(t,2),o=n[0],s=n[1];i.setError(e,o,s).end()})),Le.e("".concat(n," failed. error:"),e),Wo(e)}))}},{key:"renameConvGroup",value:function(e){var t=this;if(!this._conversationModule.canIUse(F.CONV_GROUP))return Wo({code:ho.CANNOT_USE_COMMERCIAL_ABILITY});var n="".concat(this._n,".").concat("renameConvGroup");Le.l("".concat(n," options:"),e);var i=new wo("renameConvGroup");i.setMessage(JSON.stringify(e));var o=e.oldName,s=e.newName;return this._conversationModule.request({protocolName:Wn,requestData:{fromAccount:this._getMyUserID(),updateType:1,updateGroup:{updateGroupType:1,oldName:o,newName:s}}}).then((function(e){i.setNetworkType(t._conversationModule.getNetworkType()).end(),Le.l("".concat(n," ok"));var r=e.data.updateGroupResult.convGroupID;t._convGroupMap.set(r,s),t._emitConvGroupListUpdate();var a,c,u=t._conversationModule.getLocalConversationList(),l=!1;u.forEach((function(e){a=e.conversationGroupList,-1!==(c=a.indexOf(o))&&(a.splice(c,1,s),l=!0)})),!0===l&&t._emitConversationUpdate()})).catch((function(e){return t._conversationModule.probeNetwork().then((function(t){var n=I(t,2),o=n[0],s=n[1];i.setError(e,o,s).end()})),Le.e("".concat(n," failed. error:"),e),Wo(e)}))}},{key:"addConvsToGroup",value:function(e){var t=this;if(!this._conversationModule.canIUse(F.CONV_GROUP))return Wo({code:ho.CANNOT_USE_COMMERCIAL_ABILITY});var n="".concat(this._n,".").concat("addConvsToGroup");Le.l("".concat(n," options:"),e);var i=new wo("addConvsToGroup");i.setMessage(JSON.stringify(e));var o=e.conversationIDList,s=e.groupName,r={fromAccount:this._getMyUserID(),updateType:1,updateGroup:{updateGroupType:2,groupName:s,updateItem:[]}},a=[],c=[];return o.forEach((function(e){return t._hasLocalConversation(e)?gt(e)||_t(e)?void(gt(e)?r.updateGroup.updateItem.push({operationType:1,contactItem:{type:1,toAccount:e.replace(b.CONV_C2C,"")}}):_t(e)&&r.updateGroup.updateItem.push({operationType:1,contactItem:{type:2,groupID:e.replace(b.CONV_GROUP,"")}})):(t._onConversationIDInvalid(c,e),!0):(t._onConversationNotFound(c,e),!0)})),c.length===o.length?Yo({successConversationIDList:a,failureConversationIDList:c}):this._conversationModule.request({protocolName:Jn,requestData:r}).then((function(e){i.setNetworkType(t._conversationModule.getNetworkType()).end(),Le.l("".concat(n," ok"));var o=e.data.updateGroupResult.contactResultItem;if(ze(o)){var r,u,l=!1;o.forEach((function(e){r=t._concatConversationID(e.contactItem),0===e.resultCode?(u=t._getLocalConversation(r))&&-1===u.conversationGroupList.indexOf(s)&&(u.conversationGroupList.push(s),a.push(r),l=!0):c.push({conversationID:r,code:e.resultCode,message:e.resultInfo})})),!0===l&&(t._emitConversationUpdate(),t._emitConvInGroupUpdate(s))}return Ko({successConversationIDList:a,failureConversationIDList:c})})).catch((function(e){return t._conversationModule.probeNetwork().then((function(t){var n=I(t,2),o=n[0],s=n[1];i.setError(e,o,s).end()})),Le.e("".concat(n," failed. error:"),e),Wo(e)}))}},{key:"deleteConvsFromGroup",value:function(e){var t=this;if(!this._conversationModule.canIUse(F.CONV_GROUP))return Wo({code:ho.CANNOT_USE_COMMERCIAL_ABILITY});var n="".concat(this._n,".").concat("deleteConvsFromGroup");Le.l("".concat(n," options:"),e);var i=new wo("deleteConvsFromGroup");i.setMessage(JSON.stringify(e));var o=e.conversationIDList,s=e.groupName,r={fromAccount:this._getMyUserID(),updateType:1,updateGroup:{updateGroupType:2,groupName:s,updateItem:[]}},a=[],c=[];return o.forEach((function(e){return t._hasLocalConversation(e)?gt(e)||_t(e)?void(gt(e)?r.updateGroup.updateItem.push({operationType:2,contactItem:{type:1,toAccount:e.replace(b.CONV_C2C,"")}}):_t(e)&&r.updateGroup.updateItem.push({operationType:2,contactItem:{type:2,groupID:e.replace(b.CONV_GROUP,"")}})):(t._onConversationIDInvalid(c,e),!0):(t._onConversationNotFound(c,e),!0)})),c.length===o.length?Yo({successConversationIDList:a,failureConversationIDList:c}):this._conversationModule.request({protocolName:Xn,requestData:r}).then((function(e){i.setNetworkType(t._conversationModule.getNetworkType()).end(),Le.l("".concat(n," ok"));var o=e.data.updateGroupResult.contactResultItem;if(ze(o)){var r,u,l=!1;o.forEach((function(e){if(r=t._concatConversationID(e.contactItem),0===e.resultCode){if(u=t._getLocalConversation(r)){var n=u.conversationGroupList.indexOf(s);-1!==n&&(u.conversationGroupList.splice(n,1),a.push(r),l=!0)}}else c.push({conversationID:r,code:e.resultCode,message:e.resultInfo})})),!0===l&&(t._emitConversationUpdate(),t._emitConvInGroupUpdate(s))}return Ko({successConversationIDList:a,failureConversationIDList:c})})).catch((function(e){return t._conversationModule.probeNetwork().then((function(t){var n=I(t,2),o=n[0],s=n[1];i.setError(e,o,s).end()})),Le.e("".concat(n," failed. error:"),e),Wo(e)}))}},{key:"onConvMarkUpdated",value:function(e){var t=this;if(!Gt(e)){var n,i;Le.d("".concat(this._n,".onConvMarkUpdated markItemList:"),e);var o=!1;e.forEach((function(e){var s=e.recentContactItem,r=e.optType,a=e.standardMark,c=e.customMark;if(n=t._concatConversationID(s),i=t._getLocalConversation(n))if(1===r){var u=Rt(a);!0!==function(e,t){if(e===t)return!0;if(!e||!t)return!1;if(e.length!==t.length)return!1;for(var n=0,i=e.length;n<i;n++)if(e[n]!==t[n])return!1;return!0}(i.markList,u)&&(i.markList=u,o=!0)}else 2===r&&i.customData!==c&&void 0!==c&&(i.customData=c,o=!0)})),!0===o&&this._emitConversationUpdate()}}},{key:"onConvGroupCreated",value:function(e){var t=this;Le.d("".concat(this._n,".onConvGroupCreated resultList:"),e);var n=!1,i=!1;ze(e)&&(e.forEach((function(e){var o=e.msgGroupItem,s=o.groupID,r=o.groupName;t._convGroupMap.get(s)!==r&&(t._convGroupMap.set(s,r),i=!0);var a,c,u=e.msgRecentContactItem;ze(u)&&u.forEach((function(e){a=t._concatConversationID(e),(c=t._getLocalConversation(a))&&-1===c.conversationGroupList.indexOf(r)&&(c.conversationGroupList.push(r),n=!0)}))})),!0===n&&this._emitConversationUpdate(),!0===i&&this._emitConvGroupListUpdate())}},{key:"onConvGroupDeleted",value:function(e){var t=this;Le.d("".concat(this._n,".onConvGroupDeleted groupItemList:"),e);var n=[];if(ze(e)){var i=!1;e.forEach((function(e){var o=e.groupID,s=e.groupName;t._convGroupMap.has(o)&&(t._convGroupMap.delete(o),i=!0,n.push(s))})),!0===i&&this._emitConvGroupListUpdate()}this._eraseFromConversationGroupList(n)}},{key:"_eraseFromConversationGroupList",value:function(e){Gt(e)||(this._conversationModule.getLocalConversationList().forEach((function(t){t.conversationGroupList=t.conversationGroupList.filter((function(t){return!e.includes(t)}))})),this._emitConversationUpdate())}},{key:"onConvGroupNameUpdated",value:function(e){Le.d("".concat(this._n,".onConvGroupNameUpdated options:"),e);var t=e.groupID,n=e.groupName,i=e.oldGroupName;if(this._convGroupMap.get(t)!==n){this._convGroupMap.set(t,n),this._emitConvGroupListUpdate();var o,s,r=this._conversationModule.getLocalConversationList(),a=!1;r.forEach((function(e){o=e.conversationGroupList,-1!==(s=o.indexOf(i))&&(o.splice(s,1,n),a=!0)})),!0===a&&this._emitConversationUpdate()}}},{key:"onConvInGroupUpdated",value:function(e){var t=this;Le.d("".concat(this._n,".onConvInGroupUpdated options:"),e);var n=e.oldGroupName,i=e.recentContactUpdateGroupItem;if(ze(i)){var o,s,r,a=!1;i.forEach((function(e){var i=e.contactOptType,c=e.recentContactItem;o=t._concatConversationID(c),(s=t._getLocalConversation(o))&&(r=s.conversationGroupList.indexOf(n),1===i?-1===r&&(s.conversationGroupList.push(n),a=!0):2===i&&-1!==r&&(s.conversationGroupList.splice(r,1),a=!0))})),!0===a&&(this._emitConversationUpdate(),this._emitConvInGroupUpdate(n))}}},{key:"onConvAddedToOrDeletedFromGroup",value:function(e){var t=this;Le.d("".concat(this._n,".onConvAddedToOrDeletedFromGroup options:"),e);var n=e.msgRecentContactItem,i=e.msgRecentContactUpdateContactItem,o=this._concatConversationID(n),s=this._getLocalConversation(o);if(s&&ze(i)){var r,a=!1;i.forEach((function(e){var n=e.groupOptType,i=e.recentContactGroupItem.groupName;r=s.conversationGroupList.indexOf(i),1===n?-1===r&&(s.conversationGroupList.push(i),a=!0):2===n&&-1!==r&&(s.conversationGroupList.splice(r,1),a=!0),!0===a&&t._emitConvInGroupUpdate(i)})),!0===a&&this._emitConversationUpdate()}}},{key:"onConvGroupListSynced",value:function(e){var t=this;ze(e)&&0!==e.length&&(Le.l("".concat(this._n,".onConvGroupListSynced groupItemList:"),e),e.forEach((function(e){t._convGroupMap.set(e.convGroupID,e.groupName)})))}},{key:"getConvGroupListByID",value:function(e){var t=this;if(!Gt(e)){var n=[];return e.forEach((function(e){t._convGroupMap.has(e)&&n.push(t._convGroupMap.get(e))})),n}}},{key:"_onConversationNotFound",value:function(e,t){e.push({conversationID:t,code:ho.CONVERSATION_NOT_FOUND,message:this._conversationModule.getErrorMessage(ho.CONVERSATION_NOT_FOUND)})}},{key:"_onConversationIDInvalid",value:function(e,t){e.push({conversationID:t,code:ho.INVALID_CONVERSATION_ID,message:this._conversationModule.getErrorMessage(ho.INVALID_CONVERSATION_ID)})}},{key:"_getFlagBit",value:function(e){for(var t=e.toString(2),n=t.length,i=n-1;i>=0;i--)if("1"===t[i])return n-i-1}},{key:"_concatConversationID",value:function(e){var t,n=e.type,i=e.to,o=e.groupID,s=e.userID;return 1===n?Ye(s)?Ye(i)||(t="".concat(b.CONV_C2C).concat(i)):t="".concat(b.CONV_C2C).concat(s):2===n&&(t="".concat(b.CONV_GROUP).concat(o)),t}},{key:"_getMyUserID",value:function(){return this._conversationModule.getMyUserID()}},{key:"_insertConversationGroup",value:function(e,t){var n=this._getLocalConversation(e);if(n){var i=n.conversationGroupList;-1===i.indexOf(t)&&i.push(t)}}},{key:"_getLocalConversation",value:function(e){return this._conversationModule.getLocalConversation(e)}},{key:"_hasLocalConversation",value:function(e){return this._conversationModule.hasLocalConversation(e)}},{key:"_emitConversationUpdate",value:function(){this._conversationModule.emitConversationUpdate(!0,!1)}},{key:"_emitConvGroupListUpdate",value:function(){this._conversationModule.emitOuterEvent(A.CONVERSATION_GROUP_LIST_UPDATED,C(this._convGroupMap.values()))}},{key:"_emitConvInGroupUpdate",value:function(e){var t={groupName:e,conversationList:[]},n=this._conversationModule.getLocalConversationList();t.conversationList=n.filter((function(t){return t.conversationGroupList.includes(e)})),this._conversationModule.emitOuterEvent(A.CONVERSATION_IN_GROUP_UPDATED,t)}},{key:"reset",value:function(){Le.l("".concat(this._n,".reset")),this._convGroupMap.clear(),this._startIndex=0,this._pagingStatus=$t.NOT_START}}]),e}(),hs=function(e){d(i,e);var n=M(i);function i(e){var t;return r(this,i),(t=n.call(this,e))._n="ConversationModule",ts.mixin(m(t)),t._messageListHandler=new Xo,t._messageRemindHandler=new ds(m(t)),t._convGroupHandler=new ps(m(t)),t.singlyLinkedList=new rs(100),t._pagingStatus=$t.NOT_START,t._pagingTimeStamp=0,t._pagingStartIndex=0,t._pagingPinnedTimeStamp=0,t._pagingPinnedStartIndex=0,t._pagingConvIDMap=new Map,t._convIDFromUnreadDBMap=new Map,t._conversationMap=new Map,t._tmpGroupList=[],t._tmpGroupAtTipsList=[],t._peerReadTimeMap=new Map,t._completedMap=new Map,t._roamingMessageKeyAndTimeMap=new Map,t._roamingMessageSequenceMap=new Map,t._remoteGroupReadSequenceMap=new Map,t._convTotalUnreadCount=0,t._initListeners(),t}return u(i,[{key:"_initListeners",value:function(){var e=this.getInnerEmitterInstance();e.on(Zo,this._initLocalConversationList,this),e.on(es,this._onProfileUpdated,this)}},{key:"onCheckTimer",value:function(e){e%60==0&&this._messageListHandler.traversal()}},{key:"_initLocalConversationList",value:function(){var e=this,t=new wo("_initLocalConversationList");Le.l("".concat(this._n,".").concat("_initLocalConversationList"));var n="",i=this._getStorageConversationList(),o=this.isIntl();if(i){for(var s=i.length,r=0;r<s;r++){var a=i[r];if(a){if(a.conversationID==="".concat(b.CONV_C2C,"@TLS#ERROR")||a.conversationID==="".concat(b.CONV_C2C,"@TLS#NOT_FOUND"))continue;if(a.groupProfile){var c=a.groupProfile.type;if(pt(c))continue}}this._conversationMap.set(i[r].conversationID,new ls(i[r],o))}this.emitConversationUpdate(!0,!1),n="count:".concat(s)}else n="count:0";t.setNetworkType(this.getNetworkType()).setMessage(n).end(),this.getModule(6)||this.triggerReady(),this.ready((function(){e._tmpGroupList.length>0&&(e.updateConversationGroupProfile(e._tmpGroupList),e._tmpGroupList.length=0)})),this.syncConversationList()}},{key:"onMessageSent",value:function(e){this._onSendOrReceiveMessage({conversationOptionsList:e.conversationOptionsList,isInstantMessage:!0})}},{key:"onNewMessage",value:function(e){this._onSendOrReceiveMessage(e)}},{key:"_onSendOrReceiveMessage",value:function(e){var t=this,n=e.conversationOptionsList,i=e.isInstantMessage,o=void 0===i||i,s=e.isUnreadC2CMessage,r=void 0!==s&&s,a=e.updateUnreadCount,c=void 0===a||a;this._isReady?0!==n.length&&(this._getC2CPeerReadTime(n),this._updateLocalConversationList({conversationOptionsList:n,isInstantMessage:o,isUnreadC2CMessage:r,isFromGetConversations:!1,updateUnreadCount:c}),o||(this._convIDFromUnreadDBMap=new Map([].concat(C(this._convIDFromUnreadDBMap),C(n.map((function(e){return[e.conversationID,1]}))))),this._diffAndDeleteConversation()),this._setStorageConversationList(),n.filter((function(e){return e.type===b.CONV_TOPIC})).length>0||this.emitConversationUpdate()):this.ready((function(){t._onSendOrReceiveMessage(e)}))}},{key:"updateConversationGroupProfile",value:function(e){var t=this;if(!ze(e)||0!==e.length)if(0!==this._conversationMap.size){var n=!1;e.forEach((function(e){var i="GROUP".concat(e.groupID);if(t._conversationMap.has(i)){n=!0;var o=t._conversationMap.get(i);o.groupProfile=JSON.parse(JSON.stringify(e)),o.lastMessage.lastSequence<e.nextMessageSeq&&(o.lastMessage.lastSequence=e.nextMessageSeq-1),o.subType||(o.subType=e.type)}})),n&&this.emitConversationUpdate(!0,!1)}else this._tmpGroupList=e}},{key:"_updateConversationUserProfile",value:function(e){var t=this;e.data.forEach((function(e){var n="C2C".concat(e.userID);t._conversationMap.has(n)&&(t._conversationMap.get(n).userProfile=e)})),this.emitConversationUpdate(!0,!1)}},{key:"onMessageRevoked",value:function(e){var t=this;if(0!==e.length){var n=null,i=!1,o=[];e.forEach((function(e){(n=t._conversationMap.get(e.conversationID))&&(n.type===b.CONV_TOPIC?o.push(e):(n.reduceUnreadCount()&&(i=!0),n.isLastMessageRevoked({sequence:e.sequence,time:e.time})&&(n.setLastMessageRevoked(!0),n.setLastMessageRevoker(e.revoker),i=!0)))})),this.getModule(10).onMessageRevoked(o),i&&(this.emitConversationUpdate(!0,!1),this.emitTotalUnreadMessageCountUpdate())}}},{key:"isLastMessageRevoked",value:function(e){var t=!1,n=e.conversationID,i=e.sequence,o=e.time,s=this._conversationMap.get(n);return s&&(t=s.type===b.CONV_TOPIC?this.getModule(10).isLastMessageRevoked({topicID:n.replace(b.CONV_GROUP,""),sequence:i}):s.isLastMessageRevoked({sequence:i,time:o})),Le.l("".concat(this._n,".isLastMessageRevoked options:").concat(JSON.stringify(e)," ret:").concat(t)),t}},{key:"onMessageDeleted",value:function(e){var t=this;if(0!==e.length){var n=null;e.forEach((function(e){(n=t._messageListHandler.getLocalMessage(e.conversationID,e.ID))&&(n.isDeleted=!0),e!==n&&(e.isDeleted=!0)}));for(var i=e[0].conversationID,o=this._messageListHandler.getLocalMessageList(i),s={},r=o.length-1;r>=0;r--)if(!o[r].isDeleted){s=o[r];break}var a=this._conversationMap.get(i);if(a){var c=!1;a.lastMessage.lastSequence===s.sequence&&a.lastMessage.lastTime===s.time||(Gt(s)&&(s=void 0),a.updateLastMessage(s),a.type!==b.CONV_TOPIC&&(c=!0),Le.l("".concat(this._n,".onMessageDeleted. update conversationID:").concat(i," with lastMessage:"),a.lastMessage)),i.startsWith(b.CONV_C2C)&&this.updateUnreadCount(i),c&&this.emitConversationUpdate(!0,!1)}}}},{key:"onMessageModified",value:function(e){var t=e.conversationType,n=e.from,i=e.to,o=e.time,s=e.sequence,r=e.elements,a=e.cloudCustomData,c=e.messageVersion,u=this.getMyUserID(),l="".concat(t).concat(i);i===u&&t===b.CONV_C2C&&(l="".concat(t).concat(n));var d=this._messageListHandler.onMessageModified(l,e),p=d.isUpdated,h=d.message;!0===p&&this.emitOuterEvent(A.MESSAGE_MODIFIED,[h]);var f=this._isTopicConversation(l);if(Le.l("".concat(this._n,".onMessageModified isUpdated:").concat(p," isTopicMessage:").concat(f," from:").concat(n," to:").concat(i)),f)this.getModule(10).onMessageModified(e);else{var g=this._conversationMap.get(l);if(g){var _=g.lastMessage;Le.d("".concat(this._n.onMessageModified," lastMessage:"),JSON.stringify(_),"options:",JSON.stringify(e)),_&&_.lastTime===o&&_.lastSequence===s&&_.version!==c&&(_.type=r[0].type,_.payload=r[0].content,_.messageForShow=bt(_.type,_.payload,this.isIntl()),_.cloudCustomData=a,_.version=c,this.emitConversationUpdate(!0,!1))}}return h}},{key:"onNewGroupAtTips",value:function(e){var n=this,i=e.dataList,o=null;i.forEach((function(e){e.groupAtTips?o=e.groupAtTips:e.elements?o=t(t({},e.elements),{},{sync:!0}):e.groupAtType&&(o=t(t({},e),{},{sync:!0})),o.__random=e.random,o.__sequence=e.clientSequence,n._tmpGroupAtTipsList.push(o)})),Le.d("".concat(this._n,".onNewGroupAtTips isReady:").concat(this._isReady),this._tmpGroupAtTipsList),this._isReady&&this._handleGroupAtTipsList()}},{key:"_handleGroupAtTipsList",value:function(){var e=this;if(0!==this._tmpGroupAtTipsList.length){var t=!1;this._tmpGroupAtTipsList.forEach((function(n){var i=n.groupID,o=n.from,s=n.topicID,r=void 0===s?void 0:s,a=n.sync,c=void 0!==a&&a;if(o!==e.getMyUserID())if(Ye(r)){var u=e._conversationMap.get("".concat(b.CONV_GROUP).concat(i));u&&(u.updateGroupAtInfoList(n),t=!0)}else{var l=e._conversationMap.get("".concat(b.CONV_GROUP).concat(r));if(l){l.updateGroupAtInfoList(n);var d=e.getModule(10),p=l.groupAtInfoList;d.onConversationProxy({topicID:r,groupAtInfoList:p})}Gt(l)&&c&&(e.updateTopicConversation([{conversationID:"".concat(b.CONV_GROUP).concat(r),type:b.CONV_TOPIC}]),e._conversationMap.get("".concat(b.CONV_GROUP).concat(r)).updateGroupAtInfoList(n))}})),t&&this.emitConversationUpdate(!0,!1),this._tmpGroupAtTipsList.length=0}}},{key:"_getC2CPeerReadTime",value:function(e){var t=this,n=[];if(e.forEach((function(e){t._conversationMap.has(e.conversationID)||e.type!==b.CONV_C2C||n.push(e.conversationID.replace(b.CONV_C2C,""))})),n.length>0){Le.d("".concat(this._n,"._getC2CPeerReadTime userIDList:").concat(n));var i=this.getModule(6);i&&i.getRemotePeerReadTime(n)}}},{key:"_getStorageConversationList",value:function(){return this.getModule(13).getItem("conversationMap")}},{key:"_setStorageConversationList",value:function(){var e=this.getLocalConversationList().filter((function(e){return e.type===b.CONV_C2C||e.type===b.CONV_GROUP&&e.lastMessage.type!==b.MSG_GRP_TIP})).slice(0,20).map((function(e){return{conversationID:e.conversationID,type:e.type,subType:e.subType,lastMessage:e.lastMessage,groupProfile:e.groupProfile,userProfile:e.userProfile}}));this.getModule(13).setItem("conversationMap",e)}},{key:"emitConversationUpdate",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=this.getLocalConversationList();if(t){var i=this.getModule(7);i&&i.updateGroupLastMessage(n)}e&&this.emitOuterEvent(A.CONVERSATION_LIST_UPDATED)}},{key:"getLocalConversationList",value:function(){return C(this._conversationMap.values()).filter((function(e){return e.type!==b.CONV_TOPIC}))}},{key:"getLocalConversation",value:function(e){return this._conversationMap.get(e)}},{key:"hasLocalConversation",value:function(e){return this._conversationMap.has(e)}},{key:"getLocalOldestMessage",value:function(e){return this._messageListHandler.getLocalOldestMessage(e)}},{key:"syncConversationList",value:function(){var e=this,t=new wo("syncConversationList");return this._pagingStatus===$t.NOT_START&&this._conversationMap.clear(),this._pagingGetConversationList().then((function(n){return e._pagingStatus=$t.RESOLVED,e._diffAndDeleteConversation(),e.emitConversationUpdate(!0,!1),e._setStorageConversationList(),e._handleC2CPeerReadTime(),e._patchConversationProperties(),t.setMessage(e._conversationMap.size).setNetworkType(e.getNetworkType()).end(),n})).catch((function(n){return e._pagingStatus=$t.REJECTED,t.setMessage(e._pagingTimeStamp),e.probeNetwork().then((function(e){var i=I(e,2),o=i[0],s=i[1];t.setError(n,o,s).end()})),Wo(n)}))}},{key:"_diffAndDeleteConversation",value:function(){var e=this;if(this._isSyncCompleted()){var t=[];this._conversationMap.forEach((function(n,i){!e._pagingConvIDMap.has(i)&&e._convIDFromUnreadDBMap.has(i)&&(e._conversationMap.delete(i),t.push(i))})),Le.l("".concat(this._n,"._diffAndDeleteConversation list:").concat(t))}}},{key:"_patchConversationProperties",value:function(){var e=this,t=Date.now(),n=this.checkAndPatchRemark(),i=this._messageRemindHandler.getC2CMessageRemindType(),o=this.getModule(7).getGroupList();Promise.all([n,i,o]).then((function(){var n=Date.now()-t;Le.l("".concat(e._n,"._patchConversationProperties ok. cost ").concat(n," ms")),e.emitConversationUpdate(!0,!1),e.emitTotalUnreadMessageCountUpdate()}))}},{key:"_pagingGetConversationList",value:function(){var e=this,t="".concat(this._n,"._pagingGetConversationList");return Le.l("".concat(t," timeStamp:").concat(this._pagingTimeStamp," startIndex:").concat(this._pagingStartIndex)+" pinnedTimeStamp:".concat(this._pagingPinnedTimeStamp," pinnedStartIndex:").concat(this._pagingPinnedStartIndex)),this._pagingStatus=$t.PENDING,this.request({protocolName:Bn,requestData:{fromAccount:this.getMyUserID(),timeStamp:this._pagingTimeStamp,startIndex:this._pagingStartIndex,pinnedTimeStamp:this._pagingPinnedTimeStamp,pinnedStartIndex:this._pagingPinnedStartIndex,orderType:1}}).then((function(n){var i=n.data,o=i.completeFlag,s=i.conversations,r=void 0===s?[]:s,a=i.timeStamp,c=i.startIndex,u=i.pinnedTimeStamp,l=i.pinnedStartIndex,d=i.groupItem;if(Le.l("".concat(t," ok. completeFlag:").concat(o," count:").concat(r.length," isReady:").concat(e._isReady)),e._convGroupHandler.onConvGroupListSynced(d),r.length>0){var p=e._getConversationOptions(r);e._pagingConvIDMap=new Map([].concat(C(e._pagingConvIDMap),C(p.map((function(e){return[e.conversationID,1]}))))),e._updateLocalConversationList({conversationOptionsList:p,isFromGetConversations:!0}),e.isLoggedIn()&&e.emitConversationUpdate()}if(!e._isReady){if(!e.isLoggedIn())return Yo();e.triggerReady()}return e._pagingTimeStamp=a,e._pagingStartIndex=c,e._pagingPinnedTimeStamp=u,e._pagingPinnedStartIndex=l,1!==o?e._pagingGetConversationList():(e._handleGroupAtTipsList(),e._convGroupHandler.getRemoteConvGroupList(),Yo())})).catch((function(n){throw e.isLoggedIn()&&(e._isReady||(Le.w("".concat(t," failed. error:"),n),e.triggerReady())),n}))}},{key:"_updateLocalConversationList",value:function(e){var t,n=e.isFromGetConversations,i=e.isInstantMessage,o=Date.now();t=this._getTmpConversationListMapping(e),this._conversationMap=new Map(this._sortConversationList([].concat(C(t.toBeUpdatedConversationList),C(this._conversationMap)))),n||(this._updateUserOrGroupProfile(t.newConversationList),i&&this.emitTotalUnreadMessageCountUpdate()),Le.d("".concat(this._n,"._updateLocalConversationList cost ").concat(Date.now()-o," ms"))}},{key:"_getTmpConversationListMapping",value:function(e){for(var t=e.conversationOptionsList,n=e.isFromGetConversations,i=e.isInstantMessage,o=e.isUnreadC2CMessage,s=void 0!==o&&o,r=e.updateUnreadCount,a=[],c=[],u=this.getModule(7),l=this.getModule(8),d=this.isIntl(),p=0,h=t.length;p<h;p++){var f=new ls(t[p],d),g=f.conversationID;if(g!=="".concat(b.CONV_C2C,"@TLS#ERROR")&&g!=="".concat(b.CONV_C2C,"@TLS#NOT_FOUND"))if(this._conversationMap.has(g)){var _=this._conversationMap.get(g),v=["unreadCount","allowType","adminForbidType","payload","isPinned"];!1===i&&v.push("lastMessage");var m=t[p].lastMessage,y=!Ye(m);y||t[p].type===b.CONV_TOPIC||this._onLastMessageNotExist(t[p]),Ye(i)&&y&&null===_.lastMessage.payload&&(_.lastMessage.payload=m.payload),Gt(_.lastMessage.revoker)||(_.lastMessage.revoker=null),et(_,f,v,[null,void 0,"",0,NaN]),!0===r&&_.updateUnreadCount({nextUnreadCount:f.unreadCount,isFromGetConversations:n,isUnreadC2CMessage:s}),i&&y&&(m.payload&&(_.lastMessage.payload=m.payload),_.type===b.CONV_GROUP&&(_.lastMessage.nameCard=m.nameCard,_.lastMessage.nick=m.nick)),y&&_.lastMessage.cloudCustomData!==m.cloudCustomData&&(_.lastMessage.cloudCustomData=m.cloudCustomData||""),this._conversationMap.delete(g),a.push([g,_])}else{if(f.type===b.CONV_GROUP&&u){var M=f.groupProfile.groupID,I=u.getLocalGroupProfile(M);I&&(f.groupProfile=I,!0===r&&f.updateUnreadCount({nextUnreadCount:0}))}else if(f.type===b.CONV_C2C){var C=g.replace(b.CONV_C2C,"");l&&l.isMyFriend(C)&&(f.remark=l.getFriendRemark(C))}c.push(f),a.push([g,f])}}var T=this.getModule(10);return a.forEach((function(e){if(e[1].type===b.CONV_TOPIC){var t=e[1],n=t.conversationID,i=t.unreadCount,o=t.groupAtInfoList;T.onConversationProxy({topicID:n.replace(b.CONV_GROUP,""),unreadCount:i,groupAtInfoList:Gt(o)?void 0:o})}})),{toBeUpdatedConversationList:a,newConversationList:c}}},{key:"_onLastMessageNotExist",value:function(e){new wo("lastMessageNotExist").setMessage("".concat(JSON.stringify(e))).setNetworkType(this.getNetworkType()).end()}},{key:"_sortConversationList",value:function(e){var t=[],n=[],i=[],o=[];return e.forEach((function(e){!0===e[1].isPinned?Gt(e[1].lastMessage.lastTime)?n.push(e):t.push(e):Gt(e[1].lastMessage.lastTime)?o.push(e):i.push(e)})),t.sort((function(e,t){return t[1].lastMessage.lastTime-e[1].lastMessage.lastTime})).concat(n).concat(i.sort((function(e,t){return t[1].lastMessage.lastTime-e[1].lastMessage.lastTime}))).concat(o)}},{key:"_sortConversationListAndEmitEvent",value:function(){this._conversationMap=new Map(this._sortConversationList(C(this._conversationMap))),this.emitConversationUpdate(!0,!1)}},{key:"_updateUserOrGroupProfile",value:function(e){var t=this;if(0!==e.length){var n=[],i=[],o=this.getModule(4),s=this.getModule(7);e.forEach((function(e){if(e.type===b.CONV_C2C)n.push(e.toAccount);else if(e.type===b.CONV_GROUP){var t=e.toAccount;s.hasLocalGroup(t)?e.groupProfile=s.getLocalGroupProfile(t):i.push(t)}})),Le.l("".concat(this._n,"._updateUserOrGroupProfile c2cUserIDList:").concat(n," groupIDList:").concat(i)),n.length>0&&o.getUserProfile({userIDList:n}).then((function(e){var n=e.data;ze(n)?n.forEach((function(e){t._doUpdateUserProfile("C2C".concat(e.userID),e)})):t._doUpdateUserProfile("C2C".concat(n.userID),n)})),i.length>0&&s.getGroupProfileAdvance({groupIDList:i,responseFilter:{groupBaseInfoFilter:["Type","Name","FaceUrl"]}}).then((function(e){e.data.successGroupList.forEach((function(e){var n="GROUP".concat(e.groupID);if(t._conversationMap.has(n)){var i=t._conversationMap.get(n);et(i.groupProfile,e,[],[null,void 0,"",0,NaN]),!i.subType&&e.type&&(i.subType=e.type)}}))}))}}},{key:"_doUpdateUserProfile",value:function(e,t){this.hasLocalConversation(e)&&(this.getLocalConversation(e).userProfile=t)}},{key:"_getConversationOptions",value:function(e){var n=this,i=[],o=e.filter((function(e){var t=e.type,n=e.userID;return 1===t&&"@TLS#NOT_FOUND"!==n&&"@TLS#ERROR"!==n||2===t})),s=this.getMyUserID(),r=o.map((function(e){if(Ye(e.lastMsg)&&(e.lastMsg={elements:[]}),1===e.type){var o={userID:e.userID,nick:e.peerNick,avatar:e.peerAvatar};return i.push(o),{conversationID:"C2C".concat(e.userID),type:"C2C",lastMessage:{lastTime:e.time,lastSequence:e.sequence,fromAccount:e.lastC2CMsgFromAccount,messageForShow:e.messageShow,type:e.lastMsg.elements[0]?e.lastMsg.elements[0].type:null,payload:e.lastMsg.elements[0]?n._amendLayersOverLimitProperty(e.lastMsg.elements[0].content):null,cloudCustomData:e.lastMsg.cloudCustomData||"",isRevoked:8===e.lastMessageFlag,onlineOnlyFlag:!1,nick:"",nameCard:"",version:0,isPeerRead:e.lastC2CMsgFromAccount===s&&e.time<=e.c2cPeerReadTime,revoker:e.lastMsg.revokerInfo?e.lastMsg.revokerInfo.revoker:null},userProfile:new os(o),peerReadTime:e.c2cPeerReadTime,isPinned:1===e.isPinned,messageRemindType:"",customData:e.customMark||"",markList:Rt(e.standardMark),conversationGroupList:n._convGroupHandler.getConvGroupListByID(e.contactGroupId)}}return{conversationID:"GROUP".concat(e.groupID),type:"GROUP",lastMessage:t(t({lastTime:e.time,lastSequence:e.sequence,fromAccount:e.msgGroupFromAccount,messageForShow:e.messageShow},n._patchTypeAndPayload(e)),{},{cloudCustomData:e.lastMsg.cloudCustomData||"",isRevoked:2===e.lastMessageFlag,onlineOnlyFlag:!1,nick:e.senderNick||"",nameCard:e.senderNameCard||"",revoker:e.lastMsg.revokerInfo?e.lastMsg.revokerInfo.revoker:null}),groupProfile:new cs({groupID:e.groupID,name:e.groupNick,avatar:e.groupImage}),unreadCount:e.unreadCount,peerReadTime:0,isPinned:1===e.isPinned,messageRemindType:"",version:0,customData:e.customMark||"",markList:Rt(e.standardMark),conversationGroupList:n._convGroupHandler.getConvGroupListByID(e.contactGroupId)}}));return i.length>0&&this.getModule(4).onConversationsProfileUpdated(i),r}},{key:"_patchTypeAndPayload",value:function(e){var n=e.lastMsg,i=n.event,o=void 0===i?void 0:i,s=n.elements,r=void 0===s?[]:s,a=n.groupTips,c=void 0===a?{}:a;if(!Ye(o)&&!Gt(c)){var u=new Ho(c);u.setElement({type:b.MSG_GRP_TIP,content:t(t({},c.elements),{},{groupProfile:c.groupProfile})});var l=JSON.parse(JSON.stringify(u.payload));return u=null,{type:b.MSG_GRP_TIP,payload:l}}return{type:r[0]?r[0].type:null,payload:r[0]?this._amendLayersOverLimitProperty(r[0].content):null}}},{key:"_amendLayersOverLimitProperty",value:function(e){var t=e.layersOverLimit;return 0===t?e.layersOverLimit=!1:1===t&&(e.layersOverLimit=!0),e}},{key:"getLocalMessageList",value:function(e){return this._messageListHandler.getLocalMessageList(e)}},{key:"deleteLocalMessage",value:function(e){e instanceof Ho&&this._messageListHandler.remove(e)}},{key:"onConversationDeleted",value:function(e){if(ze(e)){var t=e.map((function(e){var t=e.type,n=e.userID,i=e.groupID;return 1===t?"".concat(b.CONV_C2C).concat(n):2===t?"".concat(b.CONV_GROUP).concat(i):void 0}));Le.l("".concat(this._n,".onConversationDeleted conversationIDList:").concat(t)),this.deleteLocalConversationList(t)}}},{key:"onConversationPinned",value:function(e){var t=this;if(ze(e)){var n=!1;e.forEach((function(e){var i,o=e.type,s=e.userID,r=e.groupID;1===o?i=t.getLocalConversation("".concat(b.CONV_C2C).concat(s)):2===o&&(i=t.getLocalConversation("".concat(b.CONV_GROUP).concat(r))),i&&(Le.l("".concat(t._n,".onConversationPinned conversationID:").concat(i.conversationID," isPinned:").concat(i.isPinned)),i.isPinned||(i.isPinned=!0,n=!0))})),n&&this._sortConversationListAndEmitEvent()}}},{key:"onConversationUnpinned",value:function(e){var t=this;if(ze(e)){var n=!1;e.forEach((function(e){var i,o=e.type,s=e.userID,r=e.groupID;1===o?i=t.getLocalConversation("".concat(b.CONV_C2C).concat(s)):2===o&&(i=t.getLocalConversation("".concat(b.CONV_GROUP).concat(r))),i&&(Le.l("".concat(t._n,".onConversationUnpinned conversationID:").concat(i.conversationID," isPinned:").concat(i.isPinned)),i.isPinned&&(i.isPinned=!1,n=!0))})),n&&this._sortConversationListAndEmitEvent()}}},{key:"getMessageList",value:function(e){var t=this,n=e.conversationID,i=e.nextReqMessageID,o=e.count,s="".concat(this._n,".getMessageList"),r=this.getLocalConversation(n),a="";if(r&&r.groupProfile&&(a=r.groupProfile.type),pt(a))return Le.l("".concat(s," not available in avchatroom. conversationID:").concat(n)),Yo({messageList:[],nextReqMessageID:"",isCompleted:!0});(Ye(o)||o>15)&&(o=15),!i&&this._isNotInCommunity(n)&&(this._messageListHandler.removeByConversationID(n),this._completedMap.delete(n),this._roamingMessageSequenceMap.delete(n));var c=this._computeRemainingCount({conversationID:n,nextReqMessageID:i}),u=this._completedMap.has(n);if(Le.l("".concat(s," conversationID:").concat(n," nextReqMessageID:").concat(i)+" remainingCount:".concat(c," count:").concat(o," isCompleted:").concat(u)),this._needGetHistory({conversationID:n,remainingCount:c,count:o}))return this.getHistoryMessages({conversationID:n,nextReqMessageID:i,count:20}).then((function(e){var i=e.nextReqID,o=e.storedMessageList,r=t._completedMap.has(n),a=o;c>0&&(a=t._messageListHandler.getLocalMessageList(n).slice(0,o.length+c));var u={nextReqMessageID:r?"":i,messageList:a,isCompleted:r};return Le.l("".concat(s," ret.nextReqMessageID:").concat(u.nextReqMessageID," ret.isCompleted:").concat(u.isCompleted," ret.length:").concat(a.length)),Ko(u)}));this.modifyMessageList(n);var l=this._getMessageListFromMemory({conversationID:n,nextReqMessageID:i,count:o});return Yo(l)}},{key:"_getMessageListFromMemory",value:function(e){var t=e.conversationID,n=e.nextReqMessageID,i=e.count,o="".concat(this._n,"._getMessageListFromMemory"),s=this._messageListHandler.getLocalMessageList(t),r=s.length,a=0,c={isCompleted:!1,nextReqMessageID:"",messageList:[]};return n?(a=s.findIndex((function(e){return e.ID===n})))>i?(c.messageList=s.slice(a-i,a),c.nextReqMessageID=s[a-i].ID):(c.messageList=s.slice(0,a),c.isCompleted=!0):r>i?(a=r-i,c.messageList=s.slice(a,r),c.nextReqMessageID=s[a].ID):(c.messageList=s.slice(0,r),c.isCompleted=!0),Le.l("".concat(o," conversationID:").concat(t)+" ret.nextReqMessageID:".concat(c.nextReqMessageID," ret.isCompleted:").concat(c.isCompleted," ret.length:").concat(c.messageList.length)),c}},{key:"getMessageListHopping",value:function(e){var t=e.conversationID,n=e.sequence,i=e.time,o=e.count,s=e.direction,r=void 0===s?0:s;if((Ye(o)||o>15)&&(o=15),t.startsWith(b.CONV_C2C)){var a=this.getModule(6),c=t.replace(b.CONV_C2C,"");return a.getRoamingMessagesHopping({peerAccount:c,time:i,count:o,direction:r})}if(t.startsWith(b.CONV_GROUP)){var u=this.getModule(7),l=t.replace(b.CONV_GROUP,"");return u.getRoamingMessagesHopping({groupID:l,sequence:n,count:o,direction:r})}}},{key:"_computeRemainingCount",value:function(e){var t=e.conversationID,n=e.nextReqMessageID,i=this._messageListHandler.getLocalMessageList(t),o=i.length;if(!n)return o;var s=0;return gt(t)?s=i.findIndex((function(e){return e.ID===n})):_t(t)&&(s=-1!==n.indexOf("-")?i.findIndex((function(e){return e.ID===n})):i.findIndex((function(e){return e.sequence===n}))),-1===s&&(s=0),s}},{key:"_getMessageListSize",value:function(e){return this._messageListHandler.getLocalMessageList(e).length}},{key:"_needGetHistory",value:function(e){var t=e.conversationID,n=e.remainingCount,i=e.count,o=this.getLocalConversation(t),s="";return o&&o.groupProfile&&(s=o.groupProfile.type),!vt(t)&&!pt(s)&&!(_t(t)&&this._isPagingGetGroupListCompleted()&&this._getLocalGroupCount()<=4e3&&!this._hasLocalGroup(t)&&!this._isTopicConversation(t))&&n<=i&&!this._completedMap.has(t)}},{key:"_isTopicConversation",value:function(e){var t=e.replace(b.CONV_GROUP,"");return ft(t)}},{key:"getHistoryMessages",value:function(e){var t=e.conversationID,n=e.count;if(t===b.CONV_SYSTEM)return Yo();var i=15;n>20&&(i=20);var o=null;if(gt(t)){var s=this._roamingMessageKeyAndTimeMap.has(t);return(o=this.getModule(6))?o.getRoamingMessage({conversationID:t,peerAccount:t.replace(b.CONV_C2C,""),count:i,lastMessageTime:s?this._roamingMessageKeyAndTimeMap.get(t).lastMessageTime:0,messageKey:s?this._roamingMessageKeyAndTimeMap.get(t).messageKey:""}):Wo({code:ho.CANNOT_FIND_MODULE})}if(_t(t)){if(!(o=this.getModule(7)))return Wo({code:ho.CANNOT_FIND_MODULE});var r=null;this._conversationMap.has(t)&&(r=this._conversationMap.get(t).lastMessage);var a=0;r&&(a=r.lastSequence);var c=this._roamingMessageSequenceMap.get(t);return o.getRoamingMessage({conversationID:t,groupID:t.replace(b.CONV_GROUP,""),count:i,sequence:c||a})}return Yo()}},{key:"patchConversationLastMessage",value:function(e){var t=this.getLocalConversation(e);if(t){var n=t.lastMessage,i=n.messageForShow,o=n.payload;if(Gt(i)||Gt(o)){var s=this._messageListHandler.getLocalMessageList(e);if(0===s.length)return;var r=s[s.length-1];Le.l("".concat(this._n,".patchConversationLastMessage conversationID:").concat(e," payload:"),r.payload),t.updateLastMessage(r)}}}},{key:"onRoamingMessage",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],n=arguments.length>1?arguments[1]:void 0,i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],o=n.startsWith(b.CONV_C2C)?b.CONV_C2C:b.CONV_GROUP,s=null,r=[],a=[],c=0,u=e.length,l=null,d=o===b.CONV_GROUP,p=this.getModule(16),h=this.getFileDownloadProxy(),f=function(){c=d?e.length-1:0,u=d?0:e.length},g=function(){d?--c:++c},_=function(){return d?c>=u:c<u};for(f();_();g())if(d&&1===e[c].sequence&&i&&this.setCompleted(n),1!==e[c].isPlaceMessage)if((s=new Ho(e[c])).to=e[c].to,o!==b.CONV_GROUP||Ye(e[c].topicID)||(s.to=e[c].topicID),s.isSystemMessage=!!e[c].isSystemMessage,s.conversationType=o,4===e[c].event?l={type:b.MSG_GRP_TIP,content:t(t({},e[c].elements),{},{groupProfile:e[c].groupProfile})}:(e[c].elements=p.parseElements(e[c].elements,e[c].from),l=e[c].elements),d||s.setNickAndAvatar({nick:e[c].nick,avatar:e[c].avatar}),Gt(l)){var v=new wo("emptyMessageBody");v.setMessage("from:".concat(s.from," to:").concat(s.to," sequence:").concat(s.sequence," event:").concat(e[c].event)),v.setNetworkType(this.getNetworkType()).setLevel("warning").end()}else s.setElement(l,h),s.reInitialize(this.getMyUserID()),r.push(s);return f=g=_=null,i?(this._messageListHandler.unshift(r,a),r=null,a):(a=null,r)}},{key:"findMessage",value:function(e){return this._messageListHandler.findMessage(e)}},{key:"_isNotInCommunity",value:function(e){var t=!1;if(e.startsWith(b.CONV_GROUP)&&this._isTopicConversation(e)){var n=At(e.replace(b.CONV_GROUP,""));this.getModule(7).hasLocalGroup(n)||(t=!0)}return t}},{key:"deleteTopicRoamingMessageInfo",value:function(e){var t=this;ht({groupID:e})&&this._messageListHandler.getTopicConversationIDList(e).forEach((function(e){t._messageListHandler.removeByConversationID(e),t._completedMap.delete(e),t._roamingMessageSequenceMap.delete(e)}))}},{key:"deleteGroupRomaingMessageInfo",value:function(e){var t="".concat(b.CONV_GROUP).concat(e);this._messageListHandler.removeByConversationID(t),this._completedMap.delete(t),this._roamingMessageSequenceMap.delete(t)}},{key:"setMessageRead",value:function(e){var t=e.conversationID,n=this.getLocalConversation(t);if(Le.l("".concat(this._n,".setMessageRead conversationID:").concat(t," unreadCount:").concat(n?n.unreadCount:0)),!n)return Yo();if(n.type!==b.CONV_GROUP&&n.type!==b.CONV_TOPIC||Gt(n.groupAtInfoList)||this.deleteGroupAtTips(t),0===n.unreadCount)return Yo();if(n.type===b.CONV_GROUP&&!this._hasLocalGroup(t))return 0!==n.unreadCount&&(n.unreadCount=0,this.emitConversationUpdate(!0,!1)),Yo();var i=this._messageListHandler.getLocalLastMessage(t),o=n.lastMessage.lastTime;i&&o<i.time&&(o=i.time);var s=n.lastMessage.lastSequence;if(i&&s<i.sequence&&(s=i.sequence),n.type===b.CONV_TOPIC&&Ye(i)){var r=this.getModule(10),a=t.replace(b.CONV_GROUP,""),c=At(a),u=r.getLocalTopic(c,a);u&&(s=u.nextMessageSeq-1)}var l=null;switch(n.type){case b.CONV_C2C:return(l=this.getModule(6))?l.setMessageRead({conversationID:t,lastMessageTime:o}):Wo({code:ho.CANNOT_FIND_MODULE});case b.CONV_GROUP:case b.CONV_TOPIC:return(l=this.getModule(7))?l.setMessageRead({conversationID:t,lastMessageSeq:s}):Wo({code:ho.CANNOT_FIND_MODULE});case b.CONV_SYSTEM:return n.unreadCount=0,this.emitConversationUpdate(!0,!1),Yo();default:return Yo()}}},{key:"setAllMessageRead",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n="setAllMessageRead",i="".concat(this._n,".").concat(n);t.scope||(t.scope=b.READ_ALL_MSG),Le.l("".concat(i," options:"),t);var o=this._createSetAllMessageReadPack(t);if(0===o.readAllC2CMessage&&0===o.groupMessageReadInfoList.length)return Yo();var s=new wo(n);return this.request({protocolName:fi,requestData:o}).then((function(n){var i=n.data,o=e._handleAllMessageRead(i);return s.setMessage("scope:".concat(t.scope," failureGroups:").concat(JSON.stringify(o))).setNetworkType(e.getNetworkType()).end(),Yo()})).catch((function(t){return e.probeNetwork().then((function(e){var n=I(e,2),i=n[0],o=n[1];s.setError(t,i,o).end()})),Le.w("".concat(i," failed. error:"),t),Wo({code:t&&t.code?t.code:ho.MESSAGE_UNREAD_ALL_FAIL,message:t&&t.message?t.message:void 0})}))}},{key:"setConversationCustomData",value:function(e){return this._convGroupHandler.setConvCustomData(e)}},{key:"markConversation",value:function(e){return this._convGroupHandler.markConversation(e)}},{key:"getConversationGroupList",value:function(){return this._convGroupHandler.getLocalConvGroupList()}},{key:"createConversationGroup",value:function(e){return this._convGroupHandler.createConvGroup(e)}},{key:"deleteConversationGroup",value:function(e){return this._convGroupHandler.deleteConvGroup(e)}},{key:"renameConversationGroup",value:function(e){return this._convGroupHandler.renameConvGroup(e)}},{key:"addConversationsToGroup",value:function(e){return this._convGroupHandler.addConvsToGroup(e)}},{key:"deleteConversationsFromGroup",value:function(e){return this._convGroupHandler.deleteConvsFromGroup(e)}},{key:"onConversationMarkUpdated",value:function(e){this._convGroupHandler.onConvMarkUpdated(e)}},{key:"onConversationGroupCreated",value:function(e){this._convGroupHandler.onConvGroupCreated(e)}},{key:"onConversationGroupDeleted",value:function(e){this._convGroupHandler.onConvGroupDeleted(e)}},{key:"onConversationGroupNameUpdated",value:function(e){this._convGroupHandler.onConvGroupNameUpdated(e)}},{key:"onConversationInGroupUpdated",value:function(e){this._convGroupHandler.onConvInGroupUpdated(e)}},{key:"onConversationAddedToOrDeletedFromGroup",value:function(e){this._convGroupHandler.onConvAddedToOrDeletedFromGroup(e)}},{key:"_getConversationLastMessageSequence",value:function(e){var t=this._messageListHandler.getLocalLastMessage(e.conversationID),n=e.lastMessage.lastSequence;return t&&n<t.sequence&&(n=t.sequence),n}},{key:"_getConversationLastMessageTime",value:function(e){var t=this._messageListHandler.getLocalLastMessage(e.conversationID),n=e.lastMessage.lastTime;return t&&n<t.time&&(n=t.time),n}},{key:"_createSetAllMessageReadPack",value:function(e){var t,n={readAllC2CMessage:0,groupMessageReadInfoList:[]},i=e.scope,o=w(this._conversationMap);try{for(o.s();!(t=o.n()).done;){var s=I(t.value,2)[1];if(s.unreadCount>0)if(s.type===b.CONV_C2C&&0===n.readAllC2CMessage){if(i===b.READ_ALL_MSG)n.readAllC2CMessage=1;else if(i===b.READ_ALL_C2C_MSG){n.readAllC2CMessage=1;break}}else if(s.type===b.CONV_GROUP&&(i===b.READ_ALL_GROUP_MSG||i===b.READ_ALL_MSG)){var r=this._getConversationLastMessageSequence(s);n.groupMessageReadInfoList.push({groupID:s.groupProfile.groupID,messageSequence:r})}}}catch(d){o.e(d)}finally{o.f()}return n}},{key:"onPushedAllMessageRead",value:function(e){this._handleAllMessageRead(e)}},{key:"_handleAllMessageRead",value:function(e){var t=e.groupMessageReadInfoList,n=e.readAllC2CMessage,i=this._parseGroupReadInfo(t);return this._updateAllConversationUnreadCount({readAllC2CMessage:n})>=1&&(this.emitConversationUpdate(!0,!1),this.emitTotalUnreadMessageCountUpdate()),i}},{key:"_parseGroupReadInfo",value:function(e){var t=[];if(e&&e.length)for(var n=0,i=e.length;n<i;n++){var o=e[n],s=o.groupID,r=o.sequence,a=o.retCode,c=o.lastMessageSeq;Ye(a)?this._remoteGroupReadSequenceMap.set(s,c):(this._remoteGroupReadSequenceMap.set(s,r),0!==a&&t.push("".concat(s,"-").concat(r,"-").concat(a)))}return t}},{key:"_updateAllConversationUnreadCount",value:function(e){var t,n=e.readAllC2CMessage,i=0,o=w(this._conversationMap);try{for(o.s();!(t=o.n()).done;){var s=I(t.value,2),r=s[0],a=s[1];if(a.unreadCount>=1){if(1===n&&a.type===b.CONV_C2C){var c=this._getConversationLastMessageTime(a);this.updateIsReadAfterReadReport({conversationID:r,lastMessageTime:c})}else if(a.type===b.CONV_GROUP){var u=r.replace(b.CONV_GROUP,"");if(this._remoteGroupReadSequenceMap.has(u)){var l=this._remoteGroupReadSequenceMap.get(u),d=this._getConversationLastMessageSequence(a);this.updateIsReadAfterReadReport({conversationID:r,remoteReadSequence:l}),d>=l&&this._remoteGroupReadSequenceMap.delete(u)}}this.updateUnreadCount(r,!1)&&(i+=1)}}}catch(_){o.e(_)}finally{o.f()}return i}},{key:"isRemoteRead",value:function(e){var t=e.conversationID,n=e.sequence,i=t.replace(b.CONV_GROUP,""),o=!1;if(this._remoteGroupReadSequenceMap.has(i)){var s=this._remoteGroupReadSequenceMap.get(i);n<=s&&(o=!0,Le.l("".concat(this._n,".isRemoteRead conversationID:").concat(t," messageSequence:").concat(n," remoteReadSequence:").concat(s))),n>=s+10&&this._remoteGroupReadSequenceMap.delete(i)}return o}},{key:"updateIsReadAfterReadReport",value:function(e){var t=e.conversationID,n=e.lastMessageSeq,i=e.lastMessageTime,o=this._messageListHandler.getLocalMessageList(t);if(0!==o.length)for(var s,r=o.length-1;r>=0;r--)if(s=o[r],!(i&&s.time>i||n&&s.sequence>n)){if("in"===s.flow&&s.isRead)break;s.setIsRead(!0)}}},{key:"updateUnreadCount",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=!1,i=this.getLocalConversation(e),o=this._messageListHandler.getLocalMessageList(e);if(i){var s=i.unreadCount,r=o.filter((function(e){return!e.isRead&&!e._onlineOnlyFlag&&!e.isDeleted})).length;if(s!==r&&(i.unreadCount=r,n=!0,Le.l("".concat(this._n,".updateUnreadCount from ").concat(s," to ").concat(r,", conversationID:").concat(e)),!0===t&&(this.emitConversationUpdate(!0,!1),this.emitTotalUnreadMessageCountUpdate())),n&&i.type===b.CONV_TOPIC){var a=i.unreadCount,c=this.getModule(10),u=e.replace(b.CONV_GROUP,"");c.onConversationProxy({topicID:u,unreadCount:a})}return n}}},{key:"clearGroupAtInfoList",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=this.getLocalConversation(e);if(n&&n.groupAtInfoList.length>0){if(n.clearGroupAtInfoList(),Le.l("".concat(this._n,".clearGroupAtInfoList conversationID:").concat(e)),n.type===b.CONV_TOPIC){var i=n.groupAtInfoList,o=this.getModule(10),s=e.replace(b.CONV_GROUP,"");o.onConversationProxy({topicID:s,groupAtInfoList:i})}!0===t&&this.emitConversationUpdate(!0,!1)}}},{key:"updateReadReceiptInfo",value:function(e){var t=this,n=e.userID,i=void 0===n?void 0:n,o=e.groupID,s=void 0===o?void 0:o,r=e.readReceiptList;if(!Gt(r)){var a=[];if(Ye(i)){if(!Ye(s)){var c="".concat(b.CONV_GROUP).concat(s);r.forEach((function(e){var n=e.tinyID,i=e.clientTime,o=e.random,r=e.readCount,u=e.unreadCount,l="".concat(n,"-").concat(i,"-").concat(o),d=t._messageListHandler.getLocalMessage(c,l),p={groupID:s,messageID:l,readCount:0,unreadCount:0};d&&(Ve(r)&&(d.readReceiptInfo.readCount=r,p.readCount=r),Ve(u)&&(d.readReceiptInfo.unreadCount=u,p.unreadCount=u),a.push(p))}))}}else{var u="".concat(b.CONV_C2C).concat(i);r.forEach((function(e){var n=e.tinyID,o=e.clientTime,s=e.random,r="".concat(n,"-").concat(o,"-").concat(s),c=t._messageListHandler.getLocalMessage(u,r);if(c){c.readReceiptInfo.isPeerRead=!0;var l={userID:i,messageID:r,isPeerRead:!0};a.push(l)}}))}a.length>0&&this.emitOuterEvent(A.MESSAGE_READ_RECEIPT_RECEIVED,a)}}},{key:"recomputeGroupUnreadCount",value:function(e){var t=e.conversationID,n=e.count,i=this.getLocalConversation(t);if(i){var o=i.unreadCount,s=o-n;s<0&&(s=0),i.unreadCount=s,Le.l("".concat(this._n,".recomputeGroupUnreadCount from ").concat(o," to ").concat(s,", conversationID:").concat(t))}}},{key:"updateIsRead",value:function(e){var t=this.getLocalConversation(e),n=this.getLocalMessageList(e);if(t&&0!==n.length&&!vt(t.type)){for(var i=[],o=0,s=n.length;o<s;o++)"in"!==n[o].flow?"out"!==n[o].flow||n[o].isRead||n[o].setIsRead(!0):i.push(n[o]);var r=0;if(t.type===b.CONV_C2C){var a=i.slice(-t.unreadCount).filter((function(e){return e.isRevoked})).length;r=i.length-t.unreadCount-a}else r=i.length-t.unreadCount;for(var c=0;c<r&&!i[c].isRead;c++)i[c].setIsRead(!0)}}},{key:"deleteGroupAtTips",value:function(e){var t=this,n="".concat(this._n,".deleteGroupAtTips");Le.l("".concat(n));var i=this._conversationMap.get(e);if(!i)return Promise.resolve();var o=i.groupAtInfoList;if(0===o.length)return Promise.resolve();var s=void 0;e.startsWith(b.CONV_GROUP)&&(s=e.replace(b.CONV_GROUP,""));var r=C(o);if((ht({groupID:s})||ft(s))&&0===(r=o.filter((function(e){return!e.atTypeArray.includes(b.CONV_AT_ALL)}))).length)return this.clearGroupAtInfoList(e,!1),Promise.resolve();var a=this.getMyUserID();return this.request({protocolName:Hn,requestData:{messageListToDelete:r.map((function(e){return{from:e.from,to:a,messageSeq:e.__sequence,messageRandom:e.__random,groupID:Ye(e.topicID)?e.groupID:e.topicID}}))}}).then((function(){return Le.l("".concat(n," ok. count:").concat(o.length)),t.clearGroupAtInfoList(e,!1),Promise.resolve()})).catch((function(e){return Le.e("".concat(n," failed. error:"),e),Wo(e)}))}},{key:"appendToMessageList",value:function(e){this._messageListHandler.pushIn(e)}},{key:"setMessageRandom",value:function(e){this.singlyLinkedList.set(e.random)}},{key:"deleteMessageRandom",value:function(e){this.singlyLinkedList.delete(e.random)}},{key:"pushIntoMessageList",value:function(e,t,n){return!(!this._messageListHandler.pushIn(t,n)||this._isMessageFromCurrentInstance(t)&&!n)&&(e.push(t),!0)}},{key:"_isMessageFromCurrentInstance",value:function(e){return this.singlyLinkedList.has(e.random)}},{key:"revoke",value:function(e,t,n){return this._messageListHandler.revoke(e,t,n)}},{key:"getPeerReadTime",value:function(e){return this._peerReadTimeMap.get(e)}},{key:"recordPeerReadTime",value:function(e,t){this._peerReadTimeMap.has(e)?this._peerReadTimeMap.get(e)<t&&this._peerReadTimeMap.set(e,t):this._peerReadTimeMap.set(e,t)}},{key:"updateMessageIsPeerReadProperty",value:function(e,t){if(e.startsWith(b.CONV_C2C)&&t>0){var n=this._messageListHandler.updateMessageIsPeerReadProperty(e,t);if(n.length>0&&this.emitOuterEvent(A.MESSAGE_READ_BY_PEER,n),this._conversationMap.has(e)){var i=this._conversationMap.get(e).lastMessage;Gt(i)||i.fromAccount===this.getMyUserID()&&i.lastTime<=t&&!i.isPeerRead&&(i.isPeerRead=!0,this.emitConversationUpdate(!0,!1))}}}},{key:"updateMessageIsModifiedProperty",value:function(e){this._messageListHandler.updateMessageIsModifiedProperty(e)}},{key:"setCompleted",value:function(e){Le.l("".concat(this._n,".setCompleted. conversationID:").concat(e)),this._completedMap.set(e,!0)}},{key:"updateRoamingMessageKeyAndTime",value:function(e,t,n){this._roamingMessageKeyAndTimeMap.set(e,{messageKey:t,lastMessageTime:n})}},{key:"updateRoamingMessageSequence",value:function(e,t){this._roamingMessageSequenceMap.set(e,t)}},{key:"getConversationList",value:function(e){var t=this,n="getConversationList",i="".concat(this._n,".").concat(n),o="pagingStatus:".concat(this._pagingStatus,", local conversation count:").concat(this._conversationMap.size,", options:").concat(e);if(Le.l("".concat(i,". ").concat(o)),this._pagingStatus===$t.REJECTED){var s=new wo(n);return s.setMessage(o),this.syncConversationList().then((function(){s.setNetworkType(t.getNetworkType()).end();var n=t._getConversationList(e);return Ko({conversationList:n,isSyncCompleted:t._isSyncCompleted()})})).catch((function(e){return t.probeNetwork().then((function(t){var n=I(t,2),i=n[0],o=n[1];s.setError(e,i,o).end()})),Le.e("".concat(i," failed. error:"),e),Wo(e)}))}if(0===this._conversationMap.size){var r=new wo(n);return r.setMessage(o),this.syncConversationList().then((function(){r.setNetworkType(t.getNetworkType()).end();var n=t._getConversationList(e);return Ko({conversationList:n,isSyncCompleted:t._isSyncCompleted()})})).catch((function(e){return t.probeNetwork().then((function(t){var n=I(t,2),i=n[0],o=n[1];r.setError(e,i,o).end()})),Le.e("".concat(i," failed. error:"),e),Wo(e)}))}var a=this._getConversationList(e);return Le.l("".concat(i,". returned conversation count:").concat(a.length)),Yo({conversationList:a,isSyncCompleted:this._isSyncCompleted()})}},{key:"_getConversationList",value:function(e){if(Ye(e))return this.getLocalConversationList();if(ze(e))return 0===e.length?[]:this.getLocalConversationList().filter((function(t){return e.includes(t.conversationID)}));if(je(e)){var t=e.type,n=e.markType,i=e.groupName;return this.getLocalConversationList().filter((function(e){return(t!==b.CONV_C2C&&t!==b.CONV_GROUP||e.type===t)&&(!He(i)||e.conversationGroupList.includes(i))&&(!Ve(n)||e.markList.includes(n))}))}return[]}},{key:"_handleC2CPeerReadTime",value:function(){var e,t=w(this._conversationMap);try{for(t.s();!(e=t.n()).done;){var n=I(e.value,2),i=n[0],o=n[1];o.type===b.CONV_C2C&&(Le.d("".concat(this._n,"._handleC2CPeerReadTime conversationID:").concat(i," peerReadTime:").concat(o.peerReadTime)),this.recordPeerReadTime(i,o.peerReadTime))}}catch(u){t.e(u)}finally{t.f()}}},{key:"_isPagingGetGroupListCompleted",value:function(){return this.getModule(7).isPagingGetCompleted()}},{key:"_getLocalGroupCount",value:function(){return this.getModule(7).getLocalGroupList().length}},{key:"_hasLocalGroup",value:function(e){return this.getModule(7).hasLocalGroup(e.replace(b.CONV_GROUP,""))}},{key:"getConversationProfile",value:function(e){var t,n=this;if((t=this._conversationMap.has(e)?this._conversationMap.get(e):new ls({conversationID:e,type:e.slice(0,3)===b.CONV_C2C?b.CONV_C2C:b.CONV_GROUP},this.isIntl()))._isInfoCompleted||t.type===b.CONV_SYSTEM)return Yo({conversation:t});if(_t(e)&&!this._hasLocalGroup(e))return Yo({conversation:t});var i="".concat(this._n,".").concat("getConversationProfile"),o=new wo("getConversationProfile");return Le.l("".concat(i,". conversationID:").concat(e," remark:").concat(t.remark," lastMessage:"),t.lastMessage),this._updateUserOrGroupProfileCompletely(t).then((function(s){o.setNetworkType(n.getNetworkType()).setMessage("conversationID:".concat(e," unreadCount:").concat(s.data.conversation.unreadCount)).end();var r=n.getModule(8);if(r&&t.type===b.CONV_C2C){var a=e.replace(b.CONV_C2C,"");if(r.isMyFriend(a)){var c=r.getFriendRemark(a);t.remark!==c&&(t.remark=c,Le.l("".concat(i,". conversationID:").concat(e," patch remark:").concat(t.remark)))}}return Le.l("".concat(i," ok. conversationID:").concat(e)),s})).catch((function(t){return n.probeNetwork().then((function(n){var i=I(n,2),s=i[0],r=i[1];o.setError(t,s,r).setMessage("conversationID:".concat(e)).end()})),Le.e("".concat(i," failed. error:"),t),Wo(t)}))}},{key:"_updateUserOrGroupProfileCompletely",value:function(e){var t=this;return e.type===b.CONV_C2C?this.getModule(4).getUserProfile({userIDList:[e.toAccount]}).then((function(n){var i=n.data;return 0===i.length?Wo(new jo({code:ho.USER_OR_GROUP_NOT_FOUND})):(e.userProfile=i[0],e._isInfoCompleted=!0,t._unshiftConversation(e),Yo({conversation:e}))})):this.getModule(7).getGroupProfile({groupID:e.toAccount}).then((function(n){return e.groupProfile=n.data.group,e._isInfoCompleted=!0,t._unshiftConversation(e),Yo({conversation:e})}))}},{key:"_unshiftConversation",value:function(e){e instanceof ls&&!this._conversationMap.has(e.conversationID)&&(this._conversationMap=new Map([[e.conversationID,e]].concat(C(this._conversationMap))),this._setStorageConversationList(),this.emitConversationUpdate(!0,!1))}},{key:"_onProfileUpdated",value:function(e){var t=this;e.data.forEach((function(e){var n=e.userID;if(n===t.getMyUserID())t._onMyProfileModified({latestNick:e.nick,latestAvatar:e.avatar});else{var i=t._conversationMap.get("".concat(b.CONV_C2C).concat(n));i&&(i.userProfile=e)}}))}},{key:"_isSyncCompleted",value:function(){return this._pagingStatus===$t.RESOLVED}},{key:"_errorLog",value:function(e,t,n,i){var o=new Error("Params validate failed."),s="".concat(this.getErrorMessage("API_REFER")).concat(e);throw Le.w("[".concat(e,"] | ").concat(t," | ").concat(this.getErrorMessage(n,i),", ").concat(s)),Le.e("[".concat(e,"] Invalid ").concat(t,": type check failed for ").concat(t,".")),o}},{key:"_isValidConversationID",value:function(e){return gt(e)||_t(e)||vt(e)}},{key:"deleteConversation",value:function(e){var t=this,n="deleteConversation";return He(e)||Ke(e)||this._errorLog(n,"options","StringOrObjectRequiredLog"),He(e)?(this._isValidConversationID(e)||this._errorLog(n,"options","InvalidConversationID",e),Le.l("".concat(this._n,".").concat(n," conversationID:").concat(e)),this.deleteConversationList({conversationIDList:[e],flag:1})):(ze(e.conversationIDList)||this._errorLog(n,"conversationIDList","ArrayRequiredLog"),0===e.conversationIDList.length&&this._errorLog(n,"conversationIDList","NonEmptyArrayLog"),e.conversationIDList.forEach((function(e){t._isValidConversationID(e)||t._errorLog(n,"conversationIDList","InvalidConversationID",e)})),"clearHistoryMessage"in e&&"boolean"!=typeof e.clearHistoryMessage&&this._errorLog(n,"clearHistoryMessage","BooleanRequiredLog"),e.conversationIDList.length>100&&(e.conversationIDList=e.conversationIDList.slice(0,100)),this.deleteConversationList(e))}},{key:"deleteConversationList",value:function(e){var t=this,n=e.conversationIDList,i=void 0===n?[]:n,o=e.clearHistoryMessage,s=void 0===o||o,r=e.flag,a=void 0===r?0:r,c="".concat(this._n,".").concat("deleteConversationList");Le.l("".concat(c," conversationIDList.length:").concat(i.length," clearHistoryMessage:").concat(s));var u=new wo("deleteConversationList");return u.setMessage("conversationIDList:".concat(i)),Promise.all([this.rmLocalOnlyConversationList(i),this.rmLocalAndRemoteConversationList(i,s)]).then((function(e){u.setNetworkType(t.getNetworkType()).end();var n=[].concat(C(e[0]),C(e[1]));return 0===n.length?Wo(new jo({code:ho.CONVERSATION_NOT_FOUND})):(Le.l("".concat(c," ok")),Yo(1===a?{conversationID:n[0]}:{conversationIDList:n}))})).catch((function(e){return t.probeNetwork().then((function(t){var n=I(t,2),i=n[0],o=n[1];u.setError(e,i,o).end()})),Le.e("".concat(c," failed. error:"),e),Wo(e)}))}},{key:"rmLocalOnlyConversationList",value:function(e){var t=this;return e.filter((function(e){if(!t._conversationMap.has(e))return!1;var n=t.getLocalConversation(e).type;return n!==b.CONV_GROUP||t._hasLocalGroup(e)?n===b.CONV_SYSTEM&&(t.getModule(7).deleteGroupSystemNotice({messageList:t._messageListHandler.getLocalMessageList(e)}),t.deleteLocalConversation(e),!0):(t.deleteLocalConversation(e),!0)}))}},{key:"rmLocalAndRemoteConversationList",value:function(e,t){var n=this,i={fromAccount:this.getMyUserID(),conversationList:[],clearHistoryMessage:t?1:0};return e.forEach((function(e){if(n._conversationMap.has(e)){var t=n.getLocalConversation(e).type;t===b.CONV_C2C?i.conversationList.push({toAccount:e.replace(t,""),type:1}):t===b.CONV_GROUP&&n._hasLocalGroup(e)&&i.conversationList.push({toGroupID:e.replace(t,""),type:2})}})),0===i.conversationList.length?[]:this.request({protocolName:$n,requestData:i}).then((function(e){var t=[];return e.data.resultList.length>0&&e.data.resultList.map((function(e){if(0===e.code){var n=1===e.type?"".concat(b.CONV_C2C).concat(e.to):"".concat(b.CONV_GROUP).concat(e.groupID);t.push(n)}})),n.deleteLocalConversationList(t),t}))}},{key:"clearHistoryMessage",value:function(e){var t=this,n={fromAccount:this.getMyUserID(),toAccount:void 0,type:void 0,toGroupID:void 0};if(!this._conversationMap.has(e))return Wo({code:ho.CONVERSATION_NOT_FOUND});var i=this._conversationMap.get(e).type;if(i===b.CONV_C2C)n.type=1,n.toAccount=e.replace(b.CONV_C2C,"");else{if(i!==b.CONV_GROUP)return i===b.CONV_SYSTEM?(this.getModule(7).deleteGroupSystemNotice({messageList:this._messageListHandler.getLocalMessageList(e)}),Yo({conversationID:e})):Wo({code:ho.CONVERSATION_UN_RECORDED_TYPE});n.type=2,n.toGroupID=e.replace(b.CONV_GROUP,"")}var o="".concat(this._n,".").concat("clearHistoryMessage"),s=new wo("clearHistoryMessage");return s.setMessage("conversationID:".concat(e)),Le.l("".concat(o,". conversationID:").concat(e)),this.setMessageRead({conversationID:e}).then((function(){return t.request({protocolName:Vn,requestData:n})})).then((function(){s.setNetworkType(t.getNetworkType()).end(),Le.l("".concat(o," ok")),t._messageListHandler.removeByConversationID(e),t.setCompleted(e);var n=t.getLocalConversation(e);return n&&(n.updateLastMessage(),t._sortConversationListAndEmitEvent()),Yo({conversationID:e})})).catch((function(e){return t.probeNetwork().then((function(t){var n=I(t,2),i=n[0],o=n[1];s.setError(e,i,o).end()})),Le.e("".concat(o," failed. error:"),e),Wo(e)}))}},{key:"pinConversation",value:function(e){var t=this,n=e.conversationID,i=e.isPinned;if(!this._conversationMap.has(n))return Wo({code:ho.CONVERSATION_NOT_FOUND});var o=this.getLocalConversation(n);if(o.isPinned===i)return Yo({conversationID:n});var s="".concat(this._n,".").concat("pinConversation"),r=new wo("pinConversation");r.setMessage("conversationID:".concat(n," isPinned:").concat(i)),Le.l("".concat(s,". conversationID:").concat(n," isPinned:").concat(i));var a=null;return gt(n)?a={type:1,toAccount:n.replace(b.CONV_C2C,"")}:_t(n)&&(a={type:2,groupID:n.replace(b.CONV_GROUP,"")}),this.request({protocolName:"top",requestData:{fromAccount:this.getMyUserID(),operationType:!0===i?1:2,itemList:[a]}}).then((function(){return r.setNetworkType(t.getNetworkType()).end(),Le.l("".concat(s," ok")),o.isPinned!==i&&(o.isPinned=i,t._sortConversationListAndEmitEvent()),Ko({conversationID:n})})).catch((function(e){return t.probeNetwork().then((function(t){var n=I(t,2),i=n[0],o=n[1];r.setError(e,i,o).end()})),Le.e("".concat(s," failed. error:"),e),Wo(e)}))}},{key:"setMessageRemindType",value:function(e){return this._messageRemindHandler.set(e)}},{key:"patchMessageRemindType",value:function(e){var t=e.ID,n=e.isC2CConversation,i=e.messageRemindType,o=!1,s=this.getLocalConversation(n?"".concat(b.CONV_C2C).concat(t):"".concat(b.CONV_GROUP).concat(t));return s&&s.messageRemindType!==i&&(s.messageRemindType=i,o=!0),Le.d("".concat(this._n,".patchMessageRemindType options:"),e,"ret:".concat(o)),o}},{key:"onC2CMessageRemindTypeSynced",value:function(e){var t=this,n="".concat(this._n,".onC2CMessageRemindTypeSynced");Le.d(n,e),e.dataList.forEach((function(e){if(!Gt(e.muteNotificationsSync)){var i,o=e.muteNotificationsSync,s=o.to,r=o.updateSequence,a=o.muteFlag;t._messageRemindHandler.setUpdateSequence(r),0===a?i=b.MSG_REMIND_ACPT_AND_NOTE:1===a?i=b.MSG_REMIND_DISCARD:2===a&&(i=b.MSG_REMIND_ACPT_NOT_NOTE);var c=0;t.patchMessageRemindType({ID:s,isC2CConversation:!0,messageRemindType:i})&&(c+=1),Le.l("".concat(n," updateCount:").concat(c)),c>=1&&t.emitConversationUpdate(!0,!1)}}))}},{key:"onGroupMessageRemindTypeSynced",value:function(e){Le.d("".concat(this._n,".onGroupMessageRemindTypeSynced options:"),e),this._messageRemindHandler.onGroupMessageRemindTypeUpdated(e)}},{key:"deleteLocalConversation",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=this._conversationMap.has(e);if(Le.d("".concat(this._n,".deleteLocalConversation conversationID:").concat(e," has:").concat(n)),n&&(this._conversationMap.delete(e),this._roamingMessageKeyAndTimeMap.has(e)&&this._roamingMessageKeyAndTimeMap.delete(e),this._roamingMessageSequenceMap.has(e)&&this._roamingMessageSequenceMap.delete(e),this._setStorageConversationList(),this._messageListHandler.removeByConversationID(e),this._completedMap.delete(e),t)){var i=!this._isTopicConversation(e);this.emitConversationUpdate(i,!1)}}},{key:"deleteLocalConversationList",value:function(e){var t=this,n=0,i=!1;e.forEach((function(e){t._conversationMap.has(e)&&(n+=t._conversationMap.get(e).unreadCount||0,t.deleteLocalConversation(e,!1),i=!0)})),Le.l("".concat(this._n,".deleteLocalConversationList conversationIDList.length:").concat(e.length," isConvIDExisted:").concat(i)),i&&(this.emitConversationUpdate(!0,!1),n>0&&this.emitTotalUnreadMessageCountUpdate())}},{key:"isMessageSentByCurrentInstance",value:function(e){return!(!this._messageListHandler.hasLocalMessage(e.conversationID,e.ID)&&!this.singlyLinkedList.has(e.random))}},{key:"modifyMessageList",value:function(e){if(e.startsWith(b.CONV_C2C)&&this._conversationMap.has(e)){var t=this._conversationMap.get(e),n=Date.now();this._messageListHandler.modifyMessageSentByPeer({conversationID:e,latestNick:t.userProfile.nick,latestAvatar:t.userProfile.avatar});var i=this.getModule(4).getNickAndAvatarByUserID(this.getMyUserID());this._messageListHandler.modifyMessageSentByMe({conversationID:e,latestNick:i.nick,latestAvatar:i.avatar}),Le.l("".concat(this._n,".modifyMessageList conversationID:").concat(e," cost ").concat(Date.now()-n," ms"))}}},{key:"updateUserProfileSpecifiedKey",value:function(e){Le.l("".concat(this._n,".updateUserProfileSpecifiedKey options:"),e);var t=e.conversationID,n=e.nick,i=e.avatar;if(this._conversationMap.has(t)){var o=this._conversationMap.get(t).userProfile;He(n)&&o.nick!==n&&(o.nick=n),He(i)&&o.avatar!==i&&(o.avatar=i),this.emitConversationUpdate(!0,!1)}}},{key:"_onMyProfileModified",value:function(e){var n=this,i=this.getLocalConversationList(),o=Date.now();i.forEach((function(i){n.modifyMessageSentByMe(t({conversationID:i.conversationID},e))})),Le.l("".concat(this._n,"._onMyProfileModified. modify all messages sent by me, cost ").concat(Date.now()-o," ms"))}},{key:"modifyMessageSentByMe",value:function(e){this._messageListHandler.modifyMessageSentByMe(e)}},{key:"getLatestMessageSentByMe",value:function(e){return this._messageListHandler.getLatestMessageSentByMe(e)}},{key:"modifyMessageSentByPeer",value:function(e){this._messageListHandler.modifyMessageSentByPeer(e)}},{key:"getLatestMessageSentByPeer",value:function(e){return this._messageListHandler.getLatestMessageSentByPeer(e)}},{key:"pushIntoNoticeResult",value:function(e,t){return!(!this._messageListHandler.pushIn(t)||this.singlyLinkedList.has(t.random))&&(e.push(t),!0)}},{key:"getLocalLastMessage",value:function(e){return this._messageListHandler.getLocalLastMessage(e)}},{key:"checkAndPatchRemark",value:function(){var e=Promise.resolve();if(0===this._conversationMap.size)return e;var t=this.getModule(8);if(!t)return e;var n=C(this._conversationMap.values()).filter((function(e){return e.type===b.CONV_C2C}));if(0===n.length)return e;var i=0;return n.forEach((function(e){var n=e.conversationID.replace(b.CONV_C2C,"");if(t.isMyFriend(n)){var o=t.getFriendRemark(n);e.remark!==o&&(e.remark=o,i+=1)}})),Le.l("".concat(this._n,".checkAndPatchRemark. c2c conversation count:").concat(n.length,", patched count:").concat(i)),e}},{key:"updateTopicConversation",value:function(e){this._updateLocalConversationList({conversationOptionsList:e,isFromGetConversations:!0})}},{key:"sendReadReceipt",value:function(e){var t=e[0],n=null;return t.conversationType===b.CONV_C2C?n=this._m.getModule(6):t.conversationType===b.CONV_GROUP&&(n=this._m.getModule(7)),n?n.sendReadReceipt(e):Wo({code:ho.CANNOT_FIND_MODULE})}},{key:"getReadReceiptList",value:function(e){var t=e[0],n=null;return t.conversationType===b.CONV_C2C?n=this._m.getModule(6):t.conversationType===b.CONV_GROUP&&(n=this._m.getModule(7)),n?n.getReadReceiptList(e):Wo({code:ho.CANNOT_FIND_MODULE})}},{key:"getLastMessageTime",value:function(e){var t=this.getLocalConversation(e);return t?t.lastMessage.lastTime:0}},{key:"getTotalUnreadMessageCount",value:function(){var e=this.getLocalConversationList(),t=0;return e.forEach((function(e){e.type!==b.CONV_SYSTEM&&(""!==e.messageRemindType&&e.messageRemindType!==b.MSG_REMIND_ACPT_AND_NOTE||(t+=e.unreadCount))})),t}},{key:"emitTotalUnreadMessageCountUpdate",value:function(){var e=this.getTotalUnreadMessageCount();this._convTotalUnreadCount!==e&&(Le.l("".concat(this._n,".emitTotalUnreadMessageCountUpdate from ").concat(this._convTotalUnreadCount," to ").concat(e)),this._convTotalUnreadCount=e,this.emitOuterEvent(A.TOTAL_UNREAD_MESSAGE_COUNT_UPDATED))}},{key:"reset",value:function(){Le.l("".concat(this._n,".reset")),this._pagingStatus=$t.NOT_START,this._messageListHandler.reset(),this._messageRemindHandler.reset(),this._roamingMessageKeyAndTimeMap.clear(),this._roamingMessageSequenceMap.clear(),this.singlyLinkedList.reset(),this._peerReadTimeMap.clear(),this._completedMap.clear(),this._conversationMap.clear(),this._pagingTimeStamp=0,this._pagingStartIndex=0,this._pagingPinnedTimeStamp=0,this._pagingPinnedStartIndex=0,this._remoteGroupReadSequenceMap.clear(),this._convTotalUnreadCount=0,this.resetReady()}}]),i}(yn),fs=function(){function e(t){r(this,e),this._groupModule=t,this._n="GroupTipsHandler",this._cachedGroupTipsMap=new Map,this._checkCountMap=new Map,this.MAX_CHECK_COUNT=4,this._getTopicPendingMap=new Map}return u(e,[{key:"onCheckTimer",value:function(e){e%1==0&&this._cachedGroupTipsMap.size>0&&this._checkCachedGroupTips()}},{key:"_checkCachedGroupTips",value:function(){var e=this;this._cachedGroupTipsMap.forEach((function(t,n){var i=e._checkCountMap.get(n),o=e._groupModule.hasLocalGroup(n);Le.l("".concat(e._n,"._checkCachedGroupTips groupID:").concat(n," hasLocalGroup:").concat(o," checkCount:").concat(i)),o?(e._notifyCachedGroupTips(n),e._checkCountMap.delete(n),e._groupModule.deleteUnjoinedAVChatRoom(n)):i>=e.MAX_CHECK_COUNT?(e._deleteCachedGroupTips(n),e._checkCountMap.delete(n)):(i++,e._checkCountMap.set(n,i))}))}},{key:"onNewGroupTips",value:function(e){Le.d("".concat(this._n,".onReceiveGroupTips count:").concat(e.dataList.length));var t=this.newGroupTipsStoredAndSummary(e),n=t.eventDataList,i=t.result,o=t.AVChatRoomMessageList;o.length>0&&this._groupModule.onAVChatRoomMessage(o),n.length>0&&(this._groupModule.updateNextMessageSeq(n),this._groupModule.getModule(11).onNewMessage({conversationOptionsList:n,isInstantMessage:!0})),i.length>0&&(this._groupModule.emitOuterEvent(A.MESSAGE_RECEIVED,i),this.handleMessageList(i))}},{key:"newGroupTipsStoredAndSummary",value:function(e){for(var n=this,i=e.event,o=e.dataList,s=null,r=[],a=[],c={},u=[],l=function(e,l){var d=lt(o[e]);if(6===i){if(n._groupModule.isGroupAttributesUpdatedNotice(d))return"continue";if(n._groupModule.isGroupCountersNotice(d))return"continue"}var p=d.groupProfile,h=p.groupID,f=p.communityType,g=void 0===f?0:f,_=p.topicID,v=void 0===_?void 0:_,m=p.invisible,y=void 0,M=n._groupModule.isMessageFromTopic(g,v);if(M){y=b.CONV_TOPIC,d.to=v;var I=n._groupModule.getModule(10);I.hasLocalTopic(h,v)||n._getTopicPendingMap.has(v)||(n._getTopicPendingMap.set(v,1),I.getTopicList({groupID:h,topicIDList:[v]}).finally((function(){n._getTopicPendingMap.delete(v)})))}var C=n._groupModule.hasLocalGroup(h);if(!C&&n._groupModule.isUnjoinedAVChatRoom(h))return"continue";if(!C&&!M)return n._cacheGroupTipsAndProbe({groupID:h,event:i,item:d}),"continue";if(n._groupModule.isMessageFromOrToAVChatroom(h))return d.event=i,u.push(d),"continue";if(d.currentUser=n._groupModule.getMyUserID(),d.conversationType=b.CONV_GROUP,(s=new Ho(d)).setElement({type:b.MSG_GRP_TIP,content:t(t({},d.elements),{},{groupProfile:d.groupProfile})}),s.isSystemMessage=!1,1===m)return n._qualityStat(s),"continue";var T=n._groupModule.getModule(11),k=s,S=k.conversationID,E=k.sequence;if(6===i)s._onlineOnlyFlag=!0,a.push(s);else if(!T.pushIntoNoticeResult(a,s))return"continue";if(n._groupModule.isMessageFromCommunityOfTopic(g,v))return"continue";if(6===i&&T.getLocalConversation(S))return"continue";6!==i&&n._qualityStat(s);var D=T.isRemoteRead({conversationID:S,sequence:E});if(Ye(c[S])){var w=0;"in"===s.flow&&(s._isExcludedFromUnreadCount||s._onlineOnlyFlag||D||(w=1)),c[S]=r.push({conversationID:S,unreadCount:w,type:Ye(y)?s.conversationType:y,subType:s.conversationSubType,lastMessage:s._isExcludedFromLastMessage?"":s})-1}else{var A=c[S];r[A].type=s.conversationType,r[A].subType=s.conversationSubType,r[A].lastMessage=s._isExcludedFromLastMessage?"":s,"in"===s.flow&&(s._isExcludedFromUnreadCount||s._onlineOnlyFlag||D||r[A].unreadCount++)}},d=0,p=o.length;d<p;d++)l(d);return{eventDataList:r,result:a,AVChatRoomMessageList:u}}},{key:"_qualityStat",value:function(e){this._groupModule.getModule(26).addMessageSequence({key:Io,message:e})}},{key:"handleMessageList",value:function(e){var t=this;e.forEach((function(e){switch(e.payload.operationType){case 1:t._onNewMemberComeIn(e);break;case 2:t._onMemberQuit(e);break;case 3:t._onMemberKickedOut(e);break;case 4:t._onMemberSetAdmin(e);break;case 5:t._onMemberCancelledAdmin(e);break;case 6:t._onGroupProfileModified(e);break;case 7:t._onMemberInfoModified(e);break;case 8:t._onTopicProfileUpdated(e);break;default:Le.w("".concat(t._n,".handleMessageList unknown operationType:").concat(e.payload.operationType))}}))}},{key:"_onNewMemberComeIn",value:function(e){var t=e.payload,n=t.memberNum,i=t.groupProfile.groupID,o=this._groupModule.getLocalGroupProfile(i);o&&Ve(n)&&o.memberCount!==n&&(o.memberCount=n,this._updateConversationGroupProfile(o))}},{key:"_onMemberQuit",value:function(e){var t=e.payload,n=t.memberNum,i=t.groupProfile.groupID,o=this._groupModule.getLocalGroupProfile(i);o&&Ve(n)&&o.memberCount!==n&&(o.memberCount=n,this._updateConversationGroupProfile(o)),this._groupModule.getModule(9).deleteLocalGroupMembers(i,e.payload.userIDList)}},{key:"_onMemberKickedOut",value:function(e){var t=e.payload,n=t.memberNum,i=t.groupProfile.groupID,o=this._groupModule.getLocalGroupProfile(i);o&&Ve(n)&&o.memberCount!==n&&(o.memberCount=n,this._updateConversationGroupProfile(o)),this._groupModule.getModule(9).deleteLocalGroupMembers(i,e.payload.userIDList)}},{key:"_updateConversationGroupProfile",value:function(e){this._groupModule.getModule(11).updateConversationGroupProfile([e])}},{key:"_onMemberSetAdmin",value:function(e){var t=e.payload.groupProfile.groupID,n=e.payload.userIDList,i=this._groupModule.getModule(9);n.forEach((function(e){var n=i.getLocalGroupMemberInfo(t,e);n&&n.updateRole(b.GRP_MBR_ROLE_ADMIN)}))}},{key:"_onMemberCancelledAdmin",value:function(e){var t=e.payload.groupProfile.groupID,n=e.payload.userIDList,i=this._groupModule.getModule(9);n.forEach((function(e){var n=i.getLocalGroupMemberInfo(t,e);n&&n.updateRole(b.GRP_MBR_ROLE_MEMBER)}))}},{key:"_onGroupProfileModified",value:function(e){var t=this,n=e.payload,i=n.newGroupProfile,o=n.groupProfile.groupID,s=this._groupModule.getLocalGroupProfile(o);Object.keys(i).forEach((function(e){switch(e){case"ownerID":t._ownerChanged(s,i);break;case"groupName":s.name=i[e];break;default:s[e]=i[e]}}));var r=!s.isSupportTopic;this._groupModule.emitGroupListUpdate(!0,r)}},{key:"_ownerChanged",value:function(e,t){var n=e.groupID,i=this._groupModule.getLocalGroupProfile(n),o=this._groupModule.getMyUserID();if(o===t.ownerID){i.updateGroup({selfInfo:{role:b.GRP_MBR_ROLE_OWNER}});var s=this._groupModule.getModule(9),r=s.getLocalGroupMemberInfo(n,o),a=this._groupModule.getLocalGroupProfile(n).ownerID,c=s.getLocalGroupMemberInfo(n,a);r&&r.updateRole(b.GRP_MBR_ROLE_OWNER),c&&c.updateRole(b.GRP_MBR_ROLE_MEMBER)}}},{key:"_onMemberInfoModified",value:function(e){var t=e.to,n=e.payload,i=n.groupProfile,o=n.memberList,s=i.groupID;ft(t)&&this._updateTopicMuteTime(e);var r=this._groupModule.getModule(9);o.forEach((function(e){var t=r.getLocalGroupMemberInfo(s,e.userID);t&&Ve(e.muteTime)&&t.updateMuteUntil(e.muteTime)}))}},{key:"_updateTopicMuteTime",value:function(e){var t=e.to,n=e.payload,i=n.groupProfile,o=n.memberList,s=void 0===o?[]:o,r=this._groupModule.getModule(10),a=i.groupID,c=r.getLocalTopic(a,t);if(c){for(var u=!1,l=0;l<s.length;l++){var d=s[l];if(d.userID===this._groupModule.getMyUserID()&&d.muteTime>=0){c.updateSelfInfo({muteTime:d.muteTime}),u=!0;break}}u&&this._groupModule.emitOuterEvent(A.TOPIC_UPDATED,{groupID:a,topic:c})}}},{key:"_onTopicProfileUpdated",value:function(e){var n=e.payload,i=n.groupProfile.groupID,o=n.newTopicInfo;this._groupModule.getModule(10).onTopicProfileUpdated(t({groupID:i,topicID:e.to},o))}},{key:"_cacheGroupTips",value:function(e,t){this._cachedGroupTipsMap.has(e)||this._cachedGroupTipsMap.set(e,[]),this._cachedGroupTipsMap.get(e).push(t)}},{key:"_deleteCachedGroupTips",value:function(e){this._cachedGroupTipsMap.has(e)&&this._cachedGroupTipsMap.delete(e)}},{key:"_notifyCachedGroupTips",value:function(e){var t=this,n=this._cachedGroupTipsMap.get(e)||[];n.forEach((function(e){t.onNewGroupTips(e)})),this._deleteCachedGroupTips(e),Le.l("".concat(this._n,"._notifyCachedGroupTips groupID:").concat(e," count:").concat(n.length))}},{key:"_cacheGroupTipsAndProbe",value:function(e){var t=this,n=e.groupID,i=e.event,o=e.item;this._cacheGroupTips(n,{event:i,dataList:[o]}),this._groupModule.getGroupSimplifiedInfo(n).then((function(e){e.type===b.GRP_AVCHATROOM?t._groupModule.hasLocalGroup(n)?t._notifyCachedGroupTips(n):t._groupModule.setUnjoinedAVChatRoom(n):(t._groupModule.updateGroupMap([e]),t._notifyCachedGroupTips(n))})),this._checkCountMap.has(n)||this._checkCountMap.set(n,0),Le.l("".concat(this._n,"._cacheGroupTipsAndProbe groupID:").concat(n))}},{key:"reset",value:function(){this._cachedGroupTipsMap.clear(),this._checkCountMap.clear(),this._getTopicPendingMap.clear()}}]),e}(),gs=function(){function e(t){r(this,e),this._groupModule=t,this._n="CommonGroupHandler",this.tempConversationList=null,this._cachedGroupMessageMap=new Map,this._checkCountMap=new Map,this.MAX_CHECK_COUNT=4,this._getTopicPendingMap=new Map,this._isPagingGetCompleted=!1,t.getInnerEmitterInstance().once(Zo,this._initGroupList,this)}return u(e,[{key:"onCheckTimer",value:function(e){e%1==0&&this._cachedGroupMessageMap.size>0&&this._checkCachedGroupMessage()}},{key:"_checkCachedGroupMessage",value:function(){var e=this;this._cachedGroupMessageMap.forEach((function(t,n){var i=e._checkCountMap.get(n),o=e._groupModule.hasLocalGroup(n);Le.l("".concat(e._n,"._checkCachedGroupMessage groupID:").concat(n," hasLocalGroup:").concat(o," checkCount:").concat(i)),o?(e._notifyCachedGroupMessage(n),e._checkCountMap.delete(n),e._groupModule.deleteUnjoinedAVChatRoom(n)):i>=e.MAX_CHECK_COUNT?(e._deleteCachedGroupMessage(n),e._checkCountMap.delete(n)):(i++,e._checkCountMap.set(n,i))}))}},{key:"_initGroupList",value:function(){var e=this;Le.l("".concat(this._n,"._initGroupList"));var t=new wo("getGroupListInStorage"),n=this._groupModule.getStorageGroupList();if(ze(n)&&n.length>0){n.forEach((function(t){e._groupModule.initGroupMap(t)})),this._groupModule.emitGroupListUpdate(!0,!1);var i=this._groupModule.getLocalGroupList().length;t.setNetworkType(this._groupModule.getNetworkType()).setMessage("group count:".concat(i)).end()}else t.setNetworkType(this._groupModule.getNetworkType()).setMessage("group count:0").end();Le.l("".concat(this._n,"._initGroupList ok"))}},{key:"handleUpdateGroupLastMessage",value:function(e){var n="".concat(this._n,".handleUpdateGroupLastMessage");if(Le.l("".concat(n," conversation count:").concat(e.length,", local group count:").concat(this._groupModule.getLocalGroupList().length)),0!==this._groupModule.getGroupMap().size){for(var i,o,s,r=!1,a=0,c=e.length;a<c;a++)(i=e[a]).type===b.CONV_GROUP&&(o=i.conversationID.split(/^GROUP/)[1],(s=this._groupModule.getLocalGroupProfile(o))&&(s.lastMessage=t({},i.lastMessage),r=!0));r&&(this._groupModule.sortLocalGroupList(),this._groupModule.emitGroupListUpdate(!0,!1))}else this.tempConversationList=e}},{key:"onNewGroupMessage",value:function(e){Le.d("".concat(this._n,".onNewGroupMessage count:").concat(e.dataList.length));var t=this._newGroupMessageStoredAndSummary(e),n=t.conversationOptionsList,i=t.messageList,o=t.AVChatRoomMessageList;o.length>0&&this._groupModule.onAVChatRoomMessage(o),this._groupModule.filterModifiedMessage(i),n.length>0&&(this._groupModule.updateNextMessageSeq(n),this._groupModule.getModule(11).onNewMessage({conversationOptionsList:n,isInstantMessage:e.isInstantMessage||!0,updateUnreadCount:e.updateUnreadCount||!0}));var s=this._groupModule.filterUnmodifiedMessage(i);s.length>0&&this._groupModule.emitOuterEvent(A.MESSAGE_RECEIVED,s),i.length=0}},{key:"_newGroupMessageStoredAndSummary",value:function(e){var t=this,n=e.dataList,i=e.event,o=e.isInstantMessage,s=null,r=[],a=[],c=[],u={},l=this._groupModule.getModule(16),d=this._groupModule.getFileDownloadProxy(),p=n.length;p>1&&n.sort((function(e,t){return e.sequence-t.sequence}));for(var h=function(e){var p=lt(n[e]),h=p.groupProfile,f=h.groupID,g=h.communityType,_=void 0===g?0:g,v=h.topicID,m=void 0===v?void 0:v,y=h.invisible,M=void 0,I=t._groupModule.isMessageFromTopic(_,m);if(I){M=b.CONV_TOPIC,p.to=m;var C=t._groupModule.getModule(10);C.hasLocalTopic(f,m)||t._getTopicPendingMap.has(m)||(t._getTopicPendingMap.set(m,1),C.getTopicList({groupID:f,topicIDList:[m]}).finally((function(){t._getTopicPendingMap.delete(m)})))}var T=t._groupModule.hasLocalGroup(f);if(!T&&t._groupModule.isUnjoinedAVChatRoom(f))return"continue";if(!T&&!I)return t._cacheGroupMessageAndProbe({groupID:f,event:i,item:p}),"continue";if(t._groupModule.isMessageFromOrToAVChatroom(f))return p.event=i,c.push(p),"continue";if(p.currentUser=t._groupModule.getMyUserID(),p.conversationType=b.CONV_GROUP,p.isSystemMessage=!!p.isSystemMessage,s=new Ho(p),p.elements=l.parseElements(p.elements,p.from),s.setElement(p.elements,d),1===y)return t._qualityStat(o,s),"continue";var k=1===n[e].isModified,S=t._groupModule.getModule(11);if(S.isMessageSentByCurrentInstance(s)?s.isModified=k:k=!1,1===p.onlineOnlyFlag)s._onlineOnlyFlag=!0,S.isMessageSentByCurrentInstance(s)||a.push(s);else{if(t._groupModule.isMessageFromCommunityOfTopic(_,m))return a.push(s),"continue";if(!S.pushIntoMessageList(a,s,k))return"continue";t._qualityStat(o,s);var E=s,D=E.conversationID,w=E.sequence,A=S.isRemoteRead({conversationID:D,sequence:w});if(Ye(u[D])){var L=0;"in"===s.flow&&(s._isExcludedFromUnreadCount||A||(L=1)),u[D]=r.push({conversationID:D,unreadCount:L,type:Ye(M)?s.conversationType:M,subType:s.conversationSubType,lastMessage:s._isExcludedFromLastMessage?"":s})-1}else{var R=u[D];r[R].type=Ye(M)?s.conversationType:M,r[R].subType=s.conversationSubType,r[R].lastMessage=s._isExcludedFromLastMessage?"":s,"in"===s.flow&&(s._isExcludedFromUnreadCount||A||r[R].unreadCount++)}}},f=0;f<p;f++)h(f);return{conversationOptionsList:r,messageList:a,AVChatRoomMessageList:c}}},{key:"_qualityStat",value:function(e,t){var n=this._groupModule.getModule(26);n.addMessageSequence({key:Io,message:t}),e&&t.clientTime>0&&n.addMessageDelay(t.clientTime)}},{key:"onGroupMessageRevoked",value:function(e){var t=this._groupModule.getModule(11),n=[],i=null,o=!0;e.dataList.forEach((function(e){var s=e.elements.revokedInfos;Ye(s)||s.forEach((function(e){var s=Gt(e.topicID)?"GROUP".concat(e.groupID):"GROUP".concat(e.topicID);i=t.revoke(s,e.sequence,e.random);var r=e.revokerInfo&&e.revokerInfo.revoker;if(i)i.revoker=r,n.push(i);else{var a={conversationID:s,to:e.topicID||"",sequence:e.sequence,time:e.time,revoker:r};t.isLastMessageRevoked(a)&&(n.push(a),o=!1)}}))})),0!==n.length&&(t.onMessageRevoked(n),!0===o&&(Le.l("".concat(this._n,".onGroupMessageRevoked count:").concat(n.length)),this._groupModule.emitOuterEvent(A.MESSAGE_REVOKED,n)))}},{key:"_groupListTreeShaking",value:function(e){for(var t=new Map(C(this._groupModule.getGroupMap())),n=0,i=e.length;n<i;n++)t.delete(e[n].groupID);this._groupModule.hasJoinedAVChatRoom()&&this._groupModule.getJoinedAVChatRoom().forEach((function(e){t.delete(e)})),this._groupModule.getGroupMap().forEach((function(e,n){e.isSupportTopic&&t.delete(n)}));for(var o=C(t.keys()),s=0,r=o.length;s<r;s++)this._groupModule.deleteGroup(o[s])}},{key:"getGroupList",value:function(e){var t=this,n="".concat(this._n,".").concat("getGroupList"),i=new wo("getGroupList");Le.l("".concat(n));var o={introduction:"Introduction",notification:"Notification",createTime:"CreateTime",ownerID:"Owner_Account",lastInfoTime:"LastInfoTime",memberNum:"MemberNum",maxMemberNum:"MaxMemberNum",joinOption:"ApplyJoinOption",inviteOption:"InviteJoinOption",muteAllMembers:"ShutUpAllMember"},s=["Type","Name","FaceUrl","NextMsgSeq","LastMsgTime","AtInfoList","LastRecallTime"],r=[];e&&e.groupProfileFilter&&e.groupProfileFilter.forEach((function(e){o[e]&&s.push(o[e])}));var a=(e||{}).isGroupWithTopicOnly,c=void 0!==a&&a;return this._pagingGetGroupList({limit:50,offset:0,groupBaseInfoFilter:s,groupList:r,isGroupWithTopicOnly:c}).then((function(){Le.l("".concat(n," ok. count:").concat(r.length," isGroupWithTopicOnly:").concat(c)),c||t._groupListTreeShaking(r),t._groupModule.updateGroupMap(r);var e=t._groupModule.getLocalGroupList().length;i.setNetworkType(t._groupModule.getNetworkType()).setMessage("remote count:".concat(r.length,", after tree shaking, local count:").concat(e,", isGroupWithTopicOnly:").concat(c)).end(),t.tempConversationList&&(t.handleUpdateGroupLastMessage(t.tempConversationList),t.tempConversationList=null),t._groupModule.patchGroupMessageRemindType(),t._groupModule.recomputeUnreadCount(),t._groupModule.emitGroupListUpdate(!0,!c);var o=t._groupModule.getLocalGroupList();if(c){var s=o.filter((function(e){return!0===e.isSupportTopic}));return Ko({groupList:s})}return t._isPagingGetCompleted=!0,Ko({groupList:o})})).catch((function(e){return t._groupModule.probeNetwork().then((function(t){var n=I(t,2),o=n[0],s=n[1];i.setError(e,o,s).end()})),Le.e("".concat(n," failed. error:"),e),Wo(e)}))}},{key:"isPagingGetCompleted",value:function(){return this._isPagingGetCompleted}},{key:"_pagingGetGroupList",value:function(e){var t=this,n="".concat(this._n,".").concat("_pagingGetGroupList"),i=e.isCommunityRelay,o=void 0!==i&&i,s=e.isGroupWithTopicOnly,r=void 0!==s&&s,a=e.limit,c=e.offset,u=e.groupBaseInfoFilter,l=e.groupList;if(r)return this._pagingGetGroupListWithTopic({limit:a,offset:c,groupBaseInfoFilter:u,groupList:l});var d=new wo("_pagingGetGroupList");return this._groupModule.request({protocolName:Qn,requestData:{type:o?b.GRP_COMMUNITY:void 0,memberAccount:this._groupModule.getMyUserID(),limit:a,offset:c,responseFilter:{groupBaseInfoFilter:u,selfInfoFilter:["Role","JoinTime","MsgFlag","MsgSeq"]}}}).then((function(e){var i=e.data,s=i.groups,r=void 0===s?[]:s,p=i.totalCount;l.push.apply(l,C(r)),t._handleGroupAtInfoWithoutTopic(o,r);var h=c+a,f=!(p>h),g="offset:".concat(c," totalCount:").concat(p," isCompleted:").concat(f," ")+"currentCount:".concat(l.length," isCommunityRelay:").concat(o);return d.setNetworkType(t._groupModule.getNetworkType()).setMessage("".concat(g)).end(),o||f?!o&&f?(Le.l("".concat(n," start to get community list")),c=0,t._pagingGetGroupList({limit:a,offset:c,groupBaseInfoFilter:u,groupList:l,isCommunityRelay:!0})):o&&!f?(c=h,t._pagingGetGroupList({limit:a,offset:c,groupBaseInfoFilter:u,groupList:l,isCommunityRelay:!0})):(Le.l("".concat(n," ok. totalCount:").concat(l.length)),Ko({groupList:l})):(c=h,t._pagingGetGroupList({limit:a,offset:c,groupBaseInfoFilter:u,groupList:l}))})).catch((function(e){return 11e3!==e.code&&t._groupModule.probeNetwork().then((function(t){var n=I(t,2),i=n[0],s=n[1];d.setMessage("isCommunityRelay:".concat(o)).setError(e,i,s).end()})),o?(11e3===e.code&&(d=null,Le.l("".concat(n," ok. community unavailable"))),Yo({groupList:l})):Wo(e)}))}},{key:"_pagingGetGroupListWithTopic",value:function(e){var t=this,n="".concat(this._n,"._pagingGetGroupListWithTopic"),i=e.limit,o=e.offset,s=e.groupBaseInfoFilter,r=e.groupList,a=new wo("pagingGetGroupListWithTopic");return this._groupModule.request({protocolName:Qn,requestData:{type:b.GRP_COMMUNITY,memberAccount:this._groupModule.getMyUserID(),limit:i,offset:o,responseFilter:{groupBaseInfoFilter:s,selfInfoFilter:["Role","JoinTime","MsgFlag","MsgSeq"]},isSupportTopic:1}}).then((function(e){var c=e.data,u=c.groups,l=void 0===u?[]:u,d=c.totalCount;r.push.apply(r,C(l));var p=o+i,h=!(d>p),f="offset:".concat(o," totalCount:").concat(d," isCompleted:").concat(h," ")+"currentCount:".concat(r.length);return a.setNetworkType(t._groupModule.getNetworkType()).setMessage("".concat(f)).end(),h?(Le.l("".concat(n," ok. totalCount:").concat(r.length)),Ko({groupList:r})):(o=p,t._pagingGetGroupListWithTopic({limit:i,offset:o,groupBaseInfoFilter:s,groupList:r}))})).catch((function(e){return t._groupModule.probeNetwork().then((function(t){var n=I(t,2),i=n[0],o=n[1];a.setError(e,i,o).end()})),Wo(e)}))}},{key:"_cacheGroupMessage",value:function(e,t){this._cachedGroupMessageMap.has(e)||this._cachedGroupMessageMap.set(e,[]),this._cachedGroupMessageMap.get(e).push(t)}},{key:"_deleteCachedGroupMessage",value:function(e){this._cachedGroupMessageMap.has(e)&&this._cachedGroupMessageMap.delete(e)}},{key:"_notifyCachedGroupMessage",value:function(e){var t=this,n=this._cachedGroupMessageMap.get(e)||[];n.forEach((function(e){t.onNewGroupMessage(e)})),this._deleteCachedGroupMessage(e),Le.l("".concat(this._n,"._notifyCachedGroupMessage groupID:").concat(e," count:").concat(n.length))}},{key:"_cacheGroupMessageAndProbe",value:function(e){var t=this,n=e.groupID,i=e.event,o=e.item;this._cacheGroupMessage(n,{event:i,dataList:[o]}),this._groupModule.getGroupSimplifiedInfo(n).then((function(e){e.type===b.GRP_AVCHATROOM?t._groupModule.hasLocalGroup(n)?t._notifyCachedGroupMessage(n):t._groupModule.setUnjoinedAVChatRoom(n):(t._groupModule.updateGroupMap([e]),t._notifyCachedGroupMessage(n))})),this._checkCountMap.has(n)||this._checkCountMap.set(n,0),Le.l("".concat(this._n,"._cacheGroupMessageAndProbe groupID:").concat(n))}},{key:"_handleGroupAtInfoWithoutTopic",value:function(e,n){var i=this;e&&0!==n.length&&n.forEach((function(e){var n=e.groupID,o=e.groupAtInfoList,s=[];Ye(o)||(o.forEach((function(e){s.push(t(t({},e),{},{groupID:n}))})),i._groupModule.getModule(11).onNewGroupAtTips({dataList:s}))}))}},{key:"reset",value:function(){this._cachedGroupMessageMap.clear(),this._checkCountMap.clear(),this._getTopicPendingMap.clear(),this._isPagingGetCompleted=!1,this._groupModule.getInnerEmitterInstance().once(Zo,this._initGroupList,this)}}]),e}(),_s=function(){function e(t){r(this,e),this._groupModule=t,this._n="GroupAttributesHandler",this._groupAttributesMap=new Map,this._groupAttributesCopy={},this.CACHE_EXPIRE_TIME=3e4,this._groupModule.getInnerEmitterInstance().on(Qo,this._onCloudConfigUpdated,this)}return u(e,[{key:"_onCloudConfigUpdated",value:function(){var e=this._groupModule.getCloudConfig("grp_attr_cache_time");Ye(e)||(this.CACHE_EXPIRE_TIME=Number(e))}},{key:"updateLocalMainSequenceOnReconnected",value:function(){this._groupAttributesMap.forEach((function(e){e.localMainSequence=0}))}},{key:"isGroupAttributesUpdatedNotice",value:function(e){var t=e.to,n=e.elements.newGroupProfile,i=!Ye(n)&&!Gt(n.groupAttributeOption);return i&&this._onGroupAttributesUpdated({groupID:t,groupAttributeOption:n.groupAttributeOption}),i}},{key:"_onGroupAttributesUpdated",value:function(e){var t=this,n=e.groupID,i=e.groupAttributeOption,o=i.mainSequence,s=i.isWithChangedAttributeInfo,r=i.groupAttributeList,a=void 0===r?[]:r,c=i.operationType;if(Le.l("".concat(this._n,".onGroupAttributesUpdated. ")+"groupID:".concat(n," isWithChangedAttributeInfo:").concat(s," operationType:").concat(c)),!Ye(c)){this._groupAttributesCopy=this._getCachedAttributes({groupID:n});var u=this._getLocalGroupAttributes(n).localMainSequence;if(1===s&&o-u==1)return this._refreshCachedGroupAttributes({groupID:n,remoteMainSequence:o,groupAttributeList:a,operationType:c}),void this._emitGroupAttributesUpdated(n);if(this._hasLocalGroupAttributes(n)){var l=this._getLocalGroupAttributes(n).avChatRoomKey;this._getGroupAttributes({groupID:n,avChatRoomKey:l}).then((function(){t._emitGroupAttributesUpdated(n)}))}}}},{key:"initGroupAttributesCache",value:function(e){var t=e.groupID,n=e.avChatRoomKey,i=void 0===n?void 0:n;this._groupAttributesMap.set(t,{lastUpdateTime:0,localMainSequence:0,remoteMainSequence:0,attributes:new Map,avChatRoomKey:i}),Le.l("".concat(this._n,".initGroupAttributesCache groupID:").concat(t," avChatRoomKey:").concat(i))}},{key:"initGroupAttributes",value:function(e){var t=this,n=e.groupID,i=e.groupAttributes,o=this._getLocalGroupAttributes(n),s=o.remoteMainSequence,r=o.avChatRoomKey,a=new wo("initGroupAttributes");return a.setMessage("groupID:".concat(n," avChatRoomKey:").concat(r," mainSequence:").concat(s)),this._groupModule.request({protocolName:Di,requestData:{groupID:n,avChatRoomKey:r,mainSequence:s,groupAttributeList:this._transformGroupAttributes(i)}}).then((function(e){var o=e.data,s=o.mainSequence,r=C(o.groupAttributeList);return r.forEach((function(e){e.value=i[e.key]})),t._refreshCachedGroupAttributes({groupID:n,remoteMainSequence:s,groupAttributeList:r,operationType:1}),a.setNetworkType(t._groupModule.getNetworkType()).end(),Le.l("".concat(t._n,".").concat("initGroupAttributes"," ok. groupID:").concat(n)),Ko({groupAttributes:i})})).catch((function(e){return t._groupModule.probeNetwork().then((function(t){var n=I(t,2),i=n[0],o=n[1];a.setError(e,i,o).end()})),Wo(e)}))}},{key:"setGroupAttributes",value:function(e){var t=this,n="".concat(this._n,".").concat("setGroupAttributes"),i=e.groupID,o=e.groupAttributes,s=this._getLocalGroupAttributes(i),r=s.remoteMainSequence,a=s.avChatRoomKey,c=s.attributes,u=this._transformGroupAttributes(o);u.forEach((function(e){var t=e.key;e.sequence=0,c.has(t)&&(e.sequence=c.get(t).sequence)}));var l=new wo("setGroupAttributes");return l.setMessage("groupID:".concat(i," groupAttributes:").concat(JSON.stringify(o))),Le.l("".concat(n,". groupID:").concat(i," mainSequence:").concat(r)),this._groupModule.request({protocolName:wi,requestData:{groupID:i,avChatRoomKey:a,mainSequence:r,groupAttributeList:u}}).then((function(e){var s=e.data,r=s.mainSequence,a=C(s.groupAttributeList);return a.forEach((function(e){e.value=o[e.key]})),t._refreshCachedGroupAttributes({groupID:i,remoteMainSequence:r,groupAttributeList:a,operationType:2}),l.setNetworkType(t._groupModule.getNetworkType()).end(),Le.l("".concat(n," ok.")),Ko({groupAttributes:o})})).catch((function(e){return t._groupModule.probeNetwork().then((function(t){var n=I(t,2),i=n[0],o=n[1];l.setError(e,i,o).end()})),Wo(e)}))}},{key:"deleteGroupAttributes",value:function(e){var t=this,n=e.groupID,i=e.keyList,o=void 0===i?[]:i,s=this._getLocalGroupAttributes(n),r=s.remoteMainSequence,a=s.avChatRoomKey,c=s.attributes,u=C(c.keys()),l=bi,d=3,p={groupID:n,avChatRoomKey:a,mainSequence:r},h=[];o.length>0&&(u=[],l=Ai,d=4,o.forEach((function(e){var t=0;c.has(e)&&(t=c.get(e).sequence,u.push(e)),h.push({key:e,sequence:t})})),p.groupAttributeList=h);var f=new wo("deleteGroupAttributes");return f.setMessage("groupID:".concat(n," mainSequence:").concat(r," keyList:").concat(o," protocolName:").concat(l)),this._groupModule.request({protocolName:l,requestData:p}).then((function(e){var i=e.data.mainSequence;return t._refreshCachedGroupAttributes({groupID:n,remoteMainSequence:i,groupAttributeList:h,operationType:d}),f.setNetworkType(t._groupModule.getNetworkType()).end(),Le.l("".concat(t._n,".").concat("deleteGroupAttributes"," ok. groupID:").concat(n)),Ko({keyList:u})})).catch((function(e){return t._groupModule.probeNetwork().then((function(t){var n=I(t,2),i=n[0],o=n[1];f.setError(e,i,o).end()})),Wo(e)}))}},{key:"getGroupAttributes",value:function(e){var t=this,n="".concat(this._n,".").concat("getGroupAttributes"),i=e.groupID,o=this._getLocalGroupAttributes(i),s=o.avChatRoomKey,r=o.lastUpdateTime,a=o.localMainSequence,c=o.remoteMainSequence,u=new wo("getGroupAttributes");if(u.setMessage("groupID:".concat(i," localMainSequence:").concat(a," remoteMainSequence:").concat(c," keyList:").concat(e.keyList)),Date.now()-r>=this.CACHE_EXPIRE_TIME||a<c)return this._getGroupAttributes({groupID:i,avChatRoomKey:s}).then((function(o){u.setMoreMessage("get attributes from remote. count:".concat(o.length)).setNetworkType(t._groupModule.getNetworkType()).end(),Le.l("".concat(n," from remote. groupID:").concat(i));var s=t._getCachedAttributes(e);return Ko({groupAttributes:s})})).catch((function(e){return t._groupModule.probeNetwork().then((function(t){var n=I(t,2),i=n[0],o=n[1];u.setError(e,i,o).end()})),Wo(e)}));u.setMoreMessage("get attributes from cache").setNetworkType(this._groupModule.getNetworkType()).end(),Le.l("".concat(n," from cache. groupID:").concat(i));var l=this._getCachedAttributes(e);return Yo({groupAttributes:l})}},{key:"_getGroupAttributes",value:function(e){var n=this,i=0;return Ye(e.avChatRoomKey)||(i=1),this._groupModule.request({protocolName:Li,requestData:t(t({},e),{},{groupType:i})}).then((function(t){var i=t.data,o=i.mainSequence,s=i.groupAttributeList,r=C(s);return Ye(o)||n._refreshCachedGroupAttributes({groupID:e.groupID,remoteMainSequence:o,groupAttributeList:r,operationType:5}),Le.l("".concat(n._n,"._getGroupAttributes ok. groupID:").concat(e.groupID)),s})).catch((function(e){return Wo(e)}))}},{key:"_refreshCachedGroupAttributes",value:function(e){var t=e.groupID,n=e.remoteMainSequence,i=e.groupAttributeList,o=e.operationType;if(this._hasLocalGroupAttributes(t)){var s=this._getLocalGroupAttributes(t),r=s.localMainSequence;if(5===o||n-r==1)s.remoteMainSequence=n,s.localMainSequence=n,s.lastUpdateTime=Date.now(),this._updateCachedAttributes({groupAttributes:s,groupAttributeList:i,operationType:o});else{if(r===n)return;s.remoteMainSequence=n}this._groupAttributesMap.set(t,s);var a="operationType:".concat(o," localMainSequence:").concat(r," remoteMainSequence:").concat(n);Le.l("".concat(this._n,"._refreshCachedGroupAttributes. ").concat(a))}}},{key:"_getCachedAttributes",value:function(e){var t=e.groupID,n=e.keyList,i=void 0===n?[]:n,o={};if(this._hasLocalGroupAttributes(t)){var s=this._getLocalGroupAttributes(t).attributes;if(i.length>0)i.forEach((function(e){s.has(e)&&(o[e]=s.get(e).value)}));else{var r,a=w(s.keys());try{for(a.s();!(r=a.n()).done;){var c=r.value;o[c]=s.get(c).value}}catch(h){a.e(h)}finally{a.f()}}}return o}},{key:"_updateCachedAttributes",value:function(e){var t=e.groupAttributes,n=e.groupAttributeList,i=e.operationType;3!==i?4!==i?(1===i&&t.attributes.clear(),n.forEach((function(e){var n=e.key,i=e.value,o=e.sequence;t.attributes.set(n,{value:i,sequence:o})}))):n.forEach((function(e){t.attributes.delete(e.key)})):t.attributes.clear()}},{key:"_hasLocalGroupAttributes",value:function(e){return this._groupAttributesMap.has(e)}},{key:"_getLocalGroupAttributes",value:function(e){return this._hasLocalGroupAttributes(e)||this.initGroupAttributesCache({groupID:e}),this._groupAttributesMap.get(e)}},{key:"_transformGroupAttributes",value:function(e){var t=[];return Object.keys(e).forEach((function(n){t.push({key:n,value:e[n]})})),t}},{key:"_emitGroupAttributesUpdated",value:function(e){var t=this._getCachedAttributes({groupID:e}),n=this._computeAttrChangedInfo(t),i=n.updatedKeyList,o=n.deletedKeyList;this._groupModule.emitOuterEvent(A.GROUP_ATTRIBUTES_UPDATED,{groupID:e,groupAttributes:t,updatedKeyList:i,deletedKeyList:o})}},{key:"_computeAttrChangedInfo",value:function(e){var t=this,n=[],i=[];return Object.keys(e).forEach((function(i){e[i]!==t._groupAttributesCopy[i]&&n.push(i)})),Object.keys(this._groupAttributesCopy).forEach((function(t){Ye(e[t])&&i.push(t)})),this._groupAttributesCopy={},Le.l("".concat(this._n,"._computeAttrChangedInfo update count:").concat(n.length,", delete count:").concat(i.length)),{updatedKeyList:n,deletedKeyList:i}}},{key:"deleteLocalGroupAttributes",value:function(e){this._hasLocalGroupAttributes(e)&&this._groupAttributesMap.delete(e)}},{key:"reset",value:function(){this._groupAttributesMap.clear(),this._groupAttributesCopy={},this.CACHE_EXPIRE_TIME=3e4}}]),e}(),vs=function(){function e(t){r(this,e),this._groupModule=t,this._n="GroupCountersHandler",this._groupCountersMap=new Map,this.EXPIRE_TIME=3e4,this._groupModule.getInnerEmitterInstance().on(Qo,this._onCloudConfigUpdated,this)}return u(e,[{key:"_onCloudConfigUpdated",value:function(){var e=this._groupModule.getCloudConfig("grp_counter_expire_time");Ye(e)||(this.EXPIRE_TIME=Number(e))}},{key:"isGroupCountersNotice",value:function(e){var t=e.to,n=e.elements.groupCounterInfo,i=!1;return Gt(n)||(this._onGroupCountersUpdated({groupID:t,groupCounterInfo:n}),i=!0),i}},{key:"_onGroupCountersUpdated",value:function(e){var t=this,n=e.groupID;e.groupCounterInfo.forEach((function(e){var i=e.type,o=e.groupCounterSeq,s=e.counterList,r=void 0===s?[]:s;0!==i&&2!==i||(t._updateLocalGroupCounters({groupID:n,groupCounterSeq:o,counterList:r}),r.forEach((function(e){t._groupModule.emitOuterEvent(A.GROUP_COUNTER_UPDATED,{groupID:n,key:e.key,value:e.value})}))),1===i&&t._deleteLocalGroupCounters({groupID:n,groupCounterSeq:o,counterList:r})})),Le.l("".concat(this._n,"._onGroupCountersUpdated groupID:").concat(n))}},{key:"initGroupCountersCache",value:function(e){var t=e.groupID,n=e.avChatRoomKey;this._groupCountersMap.set(t,{lastUpdateTime:0,groupCounterSeq:0,counters:new Map,avChatRoomKey:n}),Le.l("".concat(this._n,".initGroupCountersCache groupID:").concat(t," avChatRoomKey:").concat(n))}},{key:"setGroupCounters",value:function(e){var t=this;if(!this._groupModule.canIUse(F.GRP_COUNTER))return Wo({code:ho.CANNOT_USE_COMMERCIAL_ABILITY});var n="".concat(this._n,".setGroupCounters"),i=e.groupID,o=e.counters,s=this._convertObjectToList(o),r=this._getLocalGroupCounters(i).avChatRoomKey,a="groupID:".concat(i," count:").concat(s.length),c=new wo("setGroupCounters");return c.setMessage("".concat(a)),Le.l("".concat(n,". ").concat(a)),this._updateGroupCounters({groupID:i,counterList:s,avChatRoomKey:r,mode:"Set"}).then((function(e){return c.end(),Le.l("".concat(n," ok.")),Ko({counters:e})})).catch((function(e){return t._groupModule.probeNetwork().then((function(t){var n=I(t,2),i=n[0],o=n[1];c.setError(e,i,o).end()})),Le.e("".concat(n," failed. error:"),e),Wo(e)}))}},{key:"increaseGroupCounter",value:function(e){var t=this;if(!this._groupModule.canIUse(F.GRP_COUNTER))return Wo({code:ho.CANNOT_USE_COMMERCIAL_ABILITY});var n="".concat(this._n,".increaseGroupCounters"),i=e.groupID,o=e.key,s=e.value,r=this._getLocalGroupCounters(i).avChatRoomKey,a="groupID:".concat(i," key:").concat(o," value:").concat(s),c=new wo("increaseGroupCounter");c.setMessage("".concat(a)),Le.l("".concat(n,". ").concat(a));var u=[{key:o,value:s}];return this._updateGroupCounters({groupID:i,counterList:u,avChatRoomKey:r,mode:"Increase"}).then((function(e){return c.end(),Le.l("".concat(n," ok.")),Ko({counters:e})})).catch((function(e){return t._groupModule.probeNetwork().then((function(t){var n=I(t,2),i=n[0],o=n[1];c.setError(e,i,o).end()})),Le.e("".concat(n," failed. error:"),e),Wo(e)}))}},{key:"decreaseGroupCounter",value:function(e){var t=this;if(!this._groupModule.canIUse(F.GRP_COUNTER))return Wo({code:ho.CANNOT_USE_COMMERCIAL_ABILITY});var n="".concat(this._n,".decreaseGroupCounter"),i=e.groupID,o=e.key,s=e.value,r=this._getLocalGroupCounters(i).avChatRoomKey,a="groupID:".concat(i," key:").concat(o," value:").concat(s),c=new wo("decreaseGroupCounter");c.setMessage("".concat(a)),Le.l("".concat(n,". ").concat(a));var u=[{key:o,value:s}];return this._updateGroupCounters({groupID:i,counterList:u,avChatRoomKey:r,mode:"Decrease"}).then((function(e){return c.end(),Le.l("".concat(n," ok.")),Ko({counters:e})})).catch((function(e){return t._groupModule.probeNetwork().then((function(t){var n=I(t,2),i=n[0],o=n[1];c.setError(e,i,o).end()})),Le.e("".concat(n," failed. error:"),e),Wo(e)}))}},{key:"getGroupCounters",value:function(e){var t=this;if(!this._groupModule.canIUse(F.GRP_COUNTER))return Wo({code:ho.CANNOT_USE_COMMERCIAL_ABILITY});var n="".concat(this._n,".getGroupCounters"),i=e.groupID,o=e.keyList,s=void 0===o?[]:o,r=this._getLocalGroupCounters(i),a=r.avChatRoomKey,c=r.lastUpdateTime,u=new wo("getGroupCounters");if(u.setMessage("groupID:".concat(i)),Date.now()-c>=this.EXPIRE_TIME)return this._getRemoteGroupCounters({groupID:i,avChatRoomKey:a}).then((function(e){u.setMoreMessage("from remote. count:".concat(e.length)).end(),Le.l("".concat(n," from remote. groupID:").concat(i));var o=t._getLocalCounters(i,s);return Ko({counters:o})})).catch((function(e){return t._groupModule.probeNetwork().then((function(t){var n=I(t,2),i=n[0],o=n[1];u.setError(e,i,o).end()})),Wo(e)}));u.setMoreMessage("from cache").end(),Le.l("".concat(n," from cache. groupID:").concat(i));var l=this._getLocalCounters(i,s);return Yo({counters:l})}},{key:"_getRemoteGroupCounters",value:function(e){var n=this;return this._groupModule.request({protocolName:Ui,requestData:t({},e)}).then((function(t){var i=t.data,o=i.counterList,s=void 0===o?[]:o,r=i.groupCounterSeq;return n._updateLocalGroupCounters({groupID:e.groupID,counterList:s,groupCounterSeq:r}),Le.l("".concat(n._n,"._getRemoteGroupCounters ok. groupID:").concat(e.groupID)),s})).catch((function(e){return Wo(e)}))}},{key:"_convertObjectToList",value:function(e){var t=[];return Object.keys(e).forEach((function(n){t.push({key:n,value:e[n]})})),t}},{key:"_updateGroupCounters",value:function(e){var n="".concat(this._n,"._updateGroupCounters"),i=e.groupID,o=e.avChatRoomKey,s=e.mode;return Le.l("".concat(n,". groupID:").concat(i," avChatRoomKey:").concat(o," mode:").concat(s)),this._groupModule.request({protocolName:Pi,requestData:t({},e)}).then((function(e){Le.l("".concat(n," ok."));var t=e.data.counterList,i={};return(void 0===t?[]:t).forEach((function(e){var t=e.key,n=e.value;i[t]=n})),i})).catch((function(e){return Wo(e)}))}},{key:"_hasLocalGroupCounters",value:function(e){return this._groupCountersMap.has(e)}},{key:"_getLocalGroupCounters",value:function(e){return this._hasLocalGroupCounters(e)||this.initGroupCountersCache({groupID:e}),this._groupCountersMap.get(e)}},{key:"_updateLocalGroupCounters",value:function(e){var t=e.groupID,n=e.counterList,i=void 0===n?[]:n,o=e.groupCounterSeq;if(this._hasLocalGroupCounters(t)){var s=this._getLocalGroupCounters(t),r=s.counters,a=s.avChatRoomKey,c=s.groupCounterSeq;if(o>0&&o<c)return;i.forEach((function(e){var t=e.key,n=e.value;r.set(t,n)})),this._groupCountersMap.set(t,{lastUpdateTime:Date.now(),groupCounterSeq:o,counters:r,avChatRoomKey:a})}}},{key:"_deleteLocalGroupCounters",value:function(e){var t=e.groupID,n=e.counterList,i=void 0===n?[]:n,o=e.groupCounterSeq;if(this._hasLocalGroupCounters(t)){var s=this._getLocalGroupCounters(t),r=s.counters,a=s.avChatRoomKey;i.forEach((function(e){r.delete(e.key)})),this._groupCountersMap.set(t,{lastUpdateTime:Date.now(),groupCounterSeq:o,counters:r,avChatRoomKey:a})}}},{key:"_getLocalCounters",value:function(e,t){var n={};if(!this._hasLocalGroupCounters(e))return n;var i=this._getLocalGroupCounters(e).counters;if(t.length>0)t.forEach((function(e){i.has(e)&&(n[e]=i.get(e))}));else{var o,s=w(i.keys());try{for(s.s();!(o=s.n()).done;){var r=o.value;n[r]=i.get(r)}}catch(d){s.e(d)}finally{s.f()}}return n}},{key:"reset",value:function(){this._groupCountersMap.clear(),this.EXPIRE_TIME=3e4}}]),e}(),ms=function(){function e(t){r(this,e);var n=t.manager,i=t.groupID,o=t.onInit,s=t.onSuccess,a=t.onFail;this._n="Polling",this._manager=n,this._groupModule=n._groupModule,this._onInit=o,this._onSuccess=s,this._onFail=a,this._groupID=i,this._timeoutID=-1,this._isRunning=!1,this._protocolName=Ci}return u(e,[{key:"start",value:function(){var e=this._groupModule.isLoggedIn();e||(this._protocolName=Ti),Le.l("".concat(this._n,".start pollingInterval:").concat(this._manager.getPollingInterval()," isLoggedIn:").concat(e)),this._isRunning=!0,this._request()}},{key:"isRunning",value:function(){return this._isRunning}},{key:"_request",value:function(){var e=this,t=this._onInit(this._groupID);this._groupModule.request({protocolName:this._protocolName,requestData:t}).then((function(t){e._onSuccess(e._groupID,t),e.isRunning()&&(clearTimeout(e._timeoutID),e._timeoutID=setTimeout(e._request.bind(e),e._manager.getPollingInterval()))})).catch((function(t){e._onFail(e._groupID,t),e.isRunning()&&(clearTimeout(e._timeoutID),e._timeoutID=setTimeout(e._request.bind(e),e._manager.MAX_POLLING_INTERVAL))}))}},{key:"stop",value:function(){Le.l("".concat(this._n,".stop")),this._timeoutID>0&&(clearTimeout(this._timeoutID),this._timeoutID=-1),this._isRunning=!1}}]),e}(),ys={3:!0,4:!0,5:!0,6:!0,17:!0},Ms=function(){function e(t){r(this,e),this._groupModule=t,this._n="AVChatRoomHandler",this._joinedGroupMap=new Map,this._pollingRequestInfoMap=new Map,this._pollingInstanceMap=new Map,this.sequencesLinkedList=new rs(200),this.messageIDLinkedList=new rs(100),this.receivedMessageCount=0,this._reportMessageStackedCount=0,this._onlineMemberCountMap=new Map,this.DEFAULT_EXPIRE_TIME=60,this.DEFAULT_POLLING_INTERVAL=300,this.MAX_POLLING_INTERVAL=2e3,this._pollingInterval=this.DEFAULT_POLLING_INTERVAL,this.DEFAULT_POLLING_NO_MESSAGE_COUNT=20,this.DEFAULT_POLLING_INTERVAL_PLUS=2e3,this._pollingNoMessageCount=0,this._startBroadcastSeq=1,this._broadcastMessageIDMap=new Map,this.DEFAULT_POLLING_SIMPLIFIED_MSG=0}return u(e,[{key:"hasJoinedAVChatRoom",value:function(){return this._joinedGroupMap.size>0}},{key:"checkJoinedAVChatRoomByID",value:function(e){return this._joinedGroupMap.has(e)}},{key:"getJoinedAVChatRoom",value:function(){return this._joinedGroupMap.size>0?C(this._joinedGroupMap.keys()):null}},{key:"_updateRequestData",value:function(e){var n=this._pollingRequestInfoMap.get(e);return e===C(this._pollingInstanceMap.keys())[0]?t(t({},n),{},{startBroadcastSeq:this._startBroadcastSeq,simplifiedMessage:this.DEFAULT_POLLING_SIMPLIFIED_MSG}):t(t({},n),{},{simplifiedMessage:this.DEFAULT_POLLING_SIMPLIFIED_MSG})}},{key:"_handleSuccess",value:function(e,t){var n=t.data,i=n.key,o=n.nextSeq,s=n.rspMsgList,r=n.errorCode,a=n.nextBroadcastSeq,c=n.broadcastMessageList;if(0!==r){var u=this._pollingRequestInfoMap.get(e),l=new wo("longPollingAVError"),d=u?"".concat(u.key,"-").concat(u.startSeq):"requestInfo is undefined";l.setMessage("".concat(e,"-").concat(d,"-").concat(t.errorInfo)).setCode(t.errorCode).setNetworkType(this._groupModule.getNetworkType()).end(!0)}else{if(!this.checkJoinedAVChatRoomByID(e))return;He(i)&&Ve(o)&&this._pollingRequestInfoMap.set(e,{key:i,startSeq:o}),Ve(a)&&a>this._startBroadcastSeq&&(this._startBroadcastSeq=a),ze(s)&&s.length>0?(s.forEach((function(e){e.to=e.groupID})),this.onMessage(s)):(this._pollingNoMessageCount+=1,this._pollingNoMessageCount===this.DEFAULT_POLLING_NO_MESSAGE_COUNT&&(this._pollingInterval=this.DEFAULT_POLLING_INTERVAL+this.DEFAULT_POLLING_INTERVAL_PLUS)),this._onBroadcastMessage(c)}}},{key:"_handleFailure",value:function(e,t){}},{key:"onMessage",value:function(e){if(ze(e)&&0!==e.length){0!==this._pollingNoMessageCount&&(this._pollingNoMessageCount=0,this._pollingInterval=this.DEFAULT_POLLING_INTERVAL);var t=null,n=[],i=this._getModule(11),o=this._getModule(26),s=e.length;s>1&&e.sort((function(e,t){return e.sequence-t.sequence}));for(var r=this._getModule(12),a=0;a<s;a++){var c=this.restoreMessageFromSimplified(e[a]);if(ys[c.event]){if(6===c.event){if(this._groupModule.isGroupAttributesUpdatedNotice(c))continue;if(this._groupModule.isGroupCountersNotice(c))continue}this.receivedMessageCount+=1,t=this.packMessage(c,c.event);var u=1===c.isModified,l=1===c.isHistoryMessage;if((r.isUnlimitedAVChatRoom()||!this.sequencesLinkedList.has(t.sequence))&&!this.messageIDLinkedList.has(t.ID)){var d=t.conversationID;if(this.receivedMessageCount%50==0?this._getModule(22).detectFirstRound(d,this.sequencesLinkedList.data()):this.receivedMessageCount%80==0&&this._getModule(22).detectSecondRound(d,this.sequencesLinkedList.data()),null!==this.sequencesLinkedList.tail()){var p=this.sequencesLinkedList.tail().value,h=t.sequence-p;h>1&&h<=20?this._getModule(22).onMessageMaybeLost(d,p+1,h-1):h<-1&&h>=-20&&this._getModule(22).onMessageMaybeLost(d,t.sequence+1,Math.abs(h)-1)}this.sequencesLinkedList.set(t.sequence),this.messageIDLinkedList.set(t.ID);var f=!1;if(this._isMessageSentByCurrentInstance(t)?u&&(f=!0,t.isModified=u,i.updateMessageIsModifiedProperty(t)):f=!0,f){if(t.conversationType===b.CONV_SYSTEM&&5===t.payload.operationType&&this._onGroupDismissed(t.payload.groupProfile.groupID),!l&&t.conversationType!==b.CONV_SYSTEM){var g=t.conversationID.replace(b.CONV_GROUP,"");this._pollingInstanceMap.has(g)?this._groupModule.isLoggedIn()&&o.addMessageSequence({key:To,message:t}):(t.type!==b.MSG_GRP_TIP&&t.clientTime>0&&o.addMessageDelay(t.clientTime),o.addMessageSequence({key:Co,message:t}))}n.push(t)}}}else Le.w("".concat(this._n,".onMessage unknown event:").concat(c.event))}if(0!==n.length){this._groupModule.filterModifiedMessage(n);var _=this.packConversationOption(n);_.length>0&&this._getModule(11).onNewMessage({conversationOptionsList:_,isInstantMessage:!0}),Le.d("".concat(this._n,".onMessage count:").concat(n.length)),this._checkMessageStacked(n);var v=this._groupModule.filterUnmodifiedMessage(n);v.length>0&&this._groupModule.emitOuterEvent(A.MESSAGE_RECEIVED,v),n.length=0}}}},{key:"isBroadcastOrNormal",value:function(e){return 3===e||17===e}},{key:"isGroupTip",value:function(e){return 4===e||6===e}},{key:"isGroupSystemNotice",value:function(e){return 5===e}},{key:"restoreGroupTipElements",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};e.groupJoinType||(e.groupJoinType=1);var t=e.operatorInfo,n=void 0===t?{}:t,i=e.operatorID,o=e.userIDList,s=void 0===o?[]:o,r=n.userID,a=void 0===r?i:r,c=n.avatar,u=void 0===c?"":c,l=n.nick,d=void 0===l?"":l;e.operatorInfo={userID:a,avatar:u,nick:d};var p=s.map((function(e){return{userID:e}}));return e.memberInfoList=e.memberInfoList||p,e}},{key:"restoreMessageFromSimplified",value:function(e){var n=e.event;if(this.isBroadcastOrNormal(n)&&(e.cloudCustomData=e.cloudCustomData||"",e.elements=e.elements.map((function(e){if(e.type===b.MSG_CUSTOM){var n=e.content,i=void 0===n?{}:n;e.content=t({data:"",description:"",extension:""},i)}return e}))),(this.isGroupTip(n)||this.isGroupSystemNotice(n))&&(e.from=e.from||"@TIM#SYSTEM"),this.isGroupTip(n)){e.elements=this.restoreGroupTipElements(e.elements);var i=e.elements,o=void 0===i?{}:i,s=o.operationType,r=o.operatorInfo;if(1===s){var a=[{userID:(void 0===r?{}:r).userID}];o.memberInfoList=o.memberInfoList||a}}if(this.isGroupSystemNotice(n)){var c=e.elements,u=c.memberInfoList,d=c.operatorInfo;u||(u=void 0===d?{}:d),e.elements.memberInfoList=t({userID:e.elements.operatorID,avatar:"",nick:""},u),e.elements=t({authentication:"",remarkInfo:"",messageKey:1e3*e.time},e.elements);var p=Object.keys(e.elements).filter((function(e){return"operatorInfo"!==e})).reduce((function(n,i){return t(t({},n),{},l({},i,e.elements[i]))}),{});e.elements=p}return e}},{key:"_onGroupDismissed",value:function(e){Le.l("".concat(this._n,"._onGroupDismissed groupID:").concat(e)),this._groupModule.deleteLocalGroupAndConversation(e),this.reset(e)}},{key:"_checkMessageStacked",value:function(e){var t="MessageStacked",n=e.length;n>=100&&(this._groupModule.outputWarning(t),this._reportMessageStackedCount<5&&(new wo(t).setNetworkType(this._groupModule.getNetworkType()).setMessage("count:".concat(n," groupID:").concat(C(this._joinedGroupMap.keys()))).setLevel("warning").end(),this._reportMessageStackedCount+=1))}},{key:"_isMessageSentByCurrentInstance",value:function(e){return!!this._getModule(11).isMessageSentByCurrentInstance(e)}},{key:"packMessage",value:function(e,t){e.currentUser=this._groupModule.getMyUserID(),e.conversationType=5===t?b.CONV_SYSTEM:b.CONV_GROUP,e.isSystemMessage=!!e.isSystemMessage;var n=new Ho(e),i=this.packElements(e,t);return n.setElement(i,this._groupModule.getFileDownloadProxy()),n}},{key:"packElements",value:function(e,n){return 4===n||6===n?(this._updateMemberCountByGroupTips(e),{type:b.MSG_GRP_TIP,content:t(t({},e.elements),{},{groupProfile:e.groupProfile})}):5===n?{type:b.MSG_GRP_SYS_NOTICE,content:t(t({},e.elements),{},{groupProfile:t(t({},e.groupProfile),{},{groupID:e.groupID})})}:this._getModule(16).parseElements(e.elements,e.from)}},{key:"packConversationOption",value:function(e){for(var t=new Map,n=0;n<e.length;n++){var i=e[n],o=i.conversationID;if(t.has(o)){var s=t.get(o);s.lastMessage=i,"in"===i.flow&&s.unreadCount++}else t.set(o,{conversationID:i.conversationID,unreadCount:"out"===i.flow?0:1,type:i.conversationType,subType:i.conversationSubType,lastMessage:i})}return C(t.values())}},{key:"_updateMemberCountByGroupTips",value:function(e){var t=e.groupProfile.groupID,n=e.elements.onlineMemberInfo,i=void 0===n?void 0:n;if(!Gt(i)){var o=i.onlineMemberNum,s=void 0===o?0:o,r=i.expireTime,a=void 0===r?this.DEFAULT_EXPIRE_TIME:r,c=this._onlineMemberCountMap.get(t)||{},u=Date.now();Gt(c)?Object.assign(c,{lastReqTime:0,lastSyncTime:0,latestUpdateTime:u,memberCount:s,expireTime:a}):(c.latestUpdateTime=u,c.memberCount=s),Le.d("".concat(this._n,"._updateMemberCountByGroupTips info:"),c),this._onlineMemberCountMap.set(t,c)}}},{key:"_onBroadcastMessage",value:function(e){if(!Gt(e)){for(var t=[],n=e.length,i=null,o=0;o<n;o++){var s=this.restoreMessageFromSimplified(e[o]);ys[s.event]?((i=this.packMessage(s,s.event)).isBroadcastMessage=!0,this._broadcastMessageIDMap.has(i.ID)||(t.push(i),this._broadcastMessageIDMap.set(i.ID,1))):Le.w("".concat(this._n,"._onBroadcastMessage unknown event:").concat(s.event))}t.length>0&&this._groupModule.emitOuterEvent(A.MESSAGE_RECEIVED,t)}}},{key:"start",value:function(e){if(this._pollingInstanceMap.has(e)){var t=this._pollingInstanceMap.get(e);t.isRunning()||t.start()}else{var n=new ms({manager:this,groupID:e,onInit:this._updateRequestData.bind(this),onSuccess:this._handleSuccess.bind(this),onFail:this._handleFailure.bind(this)});n.start(),this._pollingInstanceMap.set(e,n),Le.l("".concat(this._n,".start groupID:").concat(e))}}},{key:"handleJoinResult",value:function(e){var t=this;return this._preCheck().then((function(){var n=e.longPollingKey,i=e.group,o=i.groupID;return t._joinedGroupMap.set(o,i),t._groupModule.updateGroupMap([i]),t._groupModule.deleteUnjoinedAVChatRoom(o),t._groupModule.emitGroupListUpdate(!0,!1),Ye(n)?Yo({status:Ge,group:i}):Promise.resolve()}))}},{key:"startRunLoop",value:function(e){var t=this;return this.handleJoinResult(e).then((function(){var n=e.longPollingKey,i=e.group,o=e.startSeq,s=void 0===o?0:o,r=i.groupID;return t._pollingRequestInfoMap.set(r,{key:n,startSeq:s}),t.start(r),t._groupModule.isLoggedIn()?Yo({status:Ge,group:i}):Yo({status:Ge})}))}},{key:"_preCheck",value:function(){if(this._getModule(12).isUnlimitedAVChatRoom())return Promise.resolve();if(!this.hasJoinedAVChatRoom())return Promise.resolve();var e=I(this._joinedGroupMap.entries().next().value,2),t=e[0],n=e[1];if(this._groupModule.isLoggedIn()){if(n.selfInfo.role!==b.GRP_MBR_ROLE_OWNER&&n.ownerID!==this._groupModule.getMyUserID())return this._groupModule.quitGroup(t);this._groupModule.deleteLocalGroupAndConversation(t)}else this._groupModule.deleteLocalGroupAndConversation(t);return this.reset(t),Promise.resolve()}},{key:"joinWithoutAuth",value:function(e){var t=this,n=e.groupID,i="".concat(this._n,".").concat("joinWithoutAuth"),o=new wo("joinWithoutAuth");return this._groupModule.request({protocolName:si,requestData:e}).then((function(e){var s=e.data.longPollingKey;if(t._groupModule.probeNetwork().then((function(e){var t=I(e,2);t[0];var i=t[1];o.setNetworkType(i).setMessage("groupID:".concat(n," longPollingKey:").concat(s)).end(!0)})),Ye(s))return Wo({code:ho.CANNOT_JOIN_NON_AVCHATROOM_WITHOUT_LOGIN});Le.l("".concat(i," ok. groupID:").concat(n)),t._getModule(11).setCompleted("".concat(b.CONV_GROUP).concat(n));var r=new cs({groupID:n});return t.startRunLoop({group:r,longPollingKey:s}),Ko({status:Ge})})).catch((function(e){return Le.e("".concat(i," failed. groupID:").concat(n," error:"),e),t._groupModule.probeNetwork().then((function(t){var i=I(t,2),s=i[0],r=i[1];o.setError(e,s,r).setMessage("groupID:".concat(n)).end(!0)})),Wo(e)})).finally((function(){t._groupModule.getModule(14).reportAtOnce()}))}},{key:"getGroupOnlineMemberCount",value:function(e){var t=this._onlineMemberCountMap.get(e)||{},n=Date.now();return Gt(t)||n-t.lastSyncTime>1e3*t.expireTime&&n-t.latestUpdateTime>1e4&&n-t.lastReqTime>3e3?(t.lastReqTime=n,this._onlineMemberCountMap.set(e,t),this._getGroupOnlineMemberCount(e).then((function(e){return Ko({memberCount:e.memberCount})})).catch((function(e){return Wo(e)}))):Yo({memberCount:t.memberCount})}},{key:"_getGroupOnlineMemberCount",value:function(e){var t=this,n="".concat(this._n,".").concat("_getGroupOnlineMemberCount");return this._groupModule.request({protocolName:ki,requestData:{groupID:e}}).then((function(i){var o=t._onlineMemberCountMap.get(e)||{},s=i.data,r=s.onlineMemberNum,a=void 0===r?0:r,c=s.expireTime,u=void 0===c?t.DEFAULT_EXPIRE_TIME:c;Le.l("".concat(n," ok. groupID:").concat(e," memberCount:").concat(a," expireTime:").concat(u));var l=Date.now();return Gt(o)&&(o.lastReqTime=l),t._onlineMemberCountMap.set(e,Object.assign(o,{lastSyncTime:l,latestUpdateTime:l,memberCount:a,expireTime:u})),{memberCount:a}})).catch((function(i){return Le.w("".concat(n," failed. error:"),i),new wo("_getGroupOnlineMemberCount").setCode(i.code).setMessage("groupID:".concat(e," error:").concat(JSON.stringify(i))).setNetworkType(t._groupModule.getNetworkType()).end(),Promise.reject(i)}))}},{key:"_getModule",value:function(e){return this._groupModule.getModule(e)}},{key:"setPollingInterval",value:function(e){Ye(e)||(Ve(e)?this._pollingInterval=this.DEFAULT_POLLING_INTERVAL=e:this._pollingInterval=this.DEFAULT_POLLING_INTERVAL=parseInt(e,10))}},{key:"setPollingIntervalPlus",value:function(e){Ye(e)||(Ve(e)?this.DEFAULT_POLLING_INTERVAL_PLUS=e:this.DEFAULT_POLLING_INTERVAL_PLUS=parseInt(e,10))}},{key:"setPollingNoMessageCount",value:function(e){Ye(e)||(Ve(e)?this.DEFAULT_POLLING_NO_MESSAGE_COUNT=e:this.DEFAULT_POLLING_NO_MESSAGE_COUNT=parseInt(e,10))}},{key:"setPollingSimplifiedMessage",value:function(e){Ye(e)||"0"!==e&&"1"!==e||(this.DEFAULT_POLLING_SIMPLIFIED_MSG=parseInt(e,10))}},{key:"getPollingInterval",value:function(){return this._pollingInterval}},{key:"onAVChatRoomMemberBanned",value:function(e){var t=e.payload.groupProfile.groupID;Le.l("".concat(this._n,".onAVChatRoomMemberBanned groupID:").concat(t)),this._groupModule.deleteLocalGroupAndConversation(t),this.reset(t)}},{key:"restartPolling",value:function(){Le.l("".concat(this._n,".restartPolling count:").concat(this._pollingInstanceMap.size));var e,t=w(this._pollingInstanceMap.values());try{for(t.s();!(e=t.n()).done;){var n=e.value;n.stop(),n.start()}}catch(r){t.e(r)}finally{t.f()}}},{key:"reset",value:function(e){if(e){Le.l("".concat(this._n,".reset groupID:").concat(e));var t=this._pollingInstanceMap.get(e);t&&t.stop(),this._pollingInstanceMap.delete(e),this._joinedGroupMap.delete(e),this._pollingRequestInfoMap.delete(e),this._onlineMemberCountMap.delete(e)}else{Le.l("".concat(this._n,".reset all"));var n,i=w(this._pollingInstanceMap.values());try{for(i.s();!(n=i.n()).done;)n.value.stop()}catch(a){i.e(a)}finally{i.f()}this._pollingInstanceMap.clear(),this._joinedGroupMap.clear(),this._pollingRequestInfoMap.clear(),this._onlineMemberCountMap.clear(),this._broadcastMessageIDMap.clear()}this.sequencesLinkedList.reset(),this.messageIDLinkedList.reset(),this.receivedMessageCount=0,this._reportMessageStackedCount=0,this._pollingInterval=this.DEFAULT_POLLING_INTERVAL=300,this.DEFAULT_POLLING_NO_MESSAGE_COUNT=20,this.DEFAULT_POLLING_INTERVAL_PLUS=2e3,this._pollingNoMessageCount=0}}]),e}(),Is=function(){function e(t){r(this,e),this._groupModule=t,this._n="GroupSystemNoticeHandler",this.pendencyMap=new Map}return u(e,[{key:"onNewGroupSystemNotice",value:function(e){var t=e.dataList,n=e.isSyncingEnded,i=e.isInstantMessage;Le.d("".concat(this._n,".onReceiveSystemNotice count:").concat(t.length));var o=this.newSystemNoticeStoredAndSummary({notifiesList:t,isInstantMessage:i}),s=o.eventDataList,r=o.result;s.length>0&&(this._groupModule.getModule(11).onNewMessage({conversationOptionsList:s,isInstantMessage:i}),this._onReceivedGroupSystemNotice({result:r,isInstantMessage:i})),i?r.length>0&&this._groupModule.emitOuterEvent(A.MESSAGE_RECEIVED,r):!0===n&&this._clearGroupSystemNotice()}},{key:"newSystemNoticeStoredAndSummary",value:function(e){var n=e.notifiesList,i=e.isInstantMessage,o=null,s=n.length,r=0,a=[],c={conversationID:b.CONV_SYSTEM,unreadCount:0,type:b.CONV_SYSTEM,subType:null,lastMessage:null};for(r=0;r<s;r++){var u=n[r],l=u.groupProfile,d=l.communityType,p=void 0===d?0:d,h=l.topicID,f=void 0===h?void 0:h,g=u.elements,_=g.topicIDList,v=void 0===_?void 0:_,m=g.operationType;if(!(2!==p||Gt(f)&&Gt(v))){if([17,18,20].includes(m)){this._handleTopicSystemNotice(u);continue}Gt(f)||(u.to=f)}15!==u.elements.operationType&&(u.currentUser=this._groupModule.getMyUserID(),u.conversationType=b.CONV_SYSTEM,u.conversationID=b.CONV_SYSTEM,(o=new Ho(u)).setElement({type:b.MSG_GRP_SYS_NOTICE,content:t(t({},u.elements),{},{groupProfile:t({},u.groupProfile)})}),o.isSystemMessage=!0,(1===o.sequence&&1===o.random||2===o.sequence&&2===o.random)&&(o.sequence=ot(),o.random=ot(),o.generateMessageID(),Le.l("".concat(this._n,".newSystemNoticeStoredAndSummary sequence and random maybe duplicated, regenerate. ID:").concat(o.ID))),this._groupModule.getModule(11).pushIntoNoticeResult(a,o)&&(i?c.unreadCount++:o.setIsRead(!0),c.subType=o.conversationSubType))}return c.lastMessage=a[a.length-1],{eventDataList:a.length>0?[c]:[],result:a}}},{key:"_clearGroupSystemNotice",value:function(){var e=this;this._getPendencyList().then((function(t){t.forEach((function(t){e.pendencyMap.set("".concat(t.from,"_").concat(t.groupID,"_").concat(t.to),t)}));var n=e._groupModule.getModule(11).getLocalMessageList(b.CONV_SYSTEM),i=[];n.forEach((function(t){var n=t.payload,o=n.operatorID,s=n.operationType,r=n.groupProfile;if(1===s){var a="".concat(o,"_").concat(r.groupID,"_").concat(r.to),c=e.pendencyMap.get(a);c&&Ve(c.handled)&&0!==c.handled&&i.push(t)}})),e.deleteGroupSystemNotice({messageList:i})}))}},{key:"deleteGroupSystemNotice",value:function(e){var t=this,n="".concat(this._n,".deleteGroupSystemNotice");return ze(e.messageList)&&0!==e.messageList.length?(Le.l("".concat(n," ")+e.messageList.map((function(e){return e.ID}))),this._groupModule.request({protocolName:Ii,requestData:{messageListToDelete:e.messageList.map((function(e){return{from:b.CONV_SYSTEM,messageSeq:e.clientSequence,messageRandom:e.random}}))}}).then((function(){Le.l("".concat(n," ok"));var i=t._groupModule.getModule(11);return e.messageList.forEach((function(e){i.deleteLocalMessage(e)})),Ko()})).catch((function(e){return Le.e("".concat(n," error:"),e),Wo(e)}))):Yo()}},{key:"_getPendencyList",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=t.type,i=void 0===n?void 0:n,o=t.startTime,s=void 0===o?0:o,r=t.limit,a=void 0===r?20:r;return this._groupModule.request({protocolName:Mi,requestData:{type:i,startTime:s,limit:a,handleAccount:this._groupModule.getMyUserID()}}).then((function(t){var n=t.data.pendencyList;return 0!==t.data.nextStartTime?e._getPendencyList({startTime:t.data.nextStartTime}).then((function(e){return[].concat(C(n),C(e))})):n}))}},{key:"getGroupApplicationList",value:function(){var e=this;return this._getPendencyList().then((function(t){return e._getPendencyList({type:b.GRP_COMMUNITY}).then((function(n){return t.push.apply(t,C(n)),e._handlePendencyResult(t)})).catch((function(n){return e._handlePendencyResult(t)}))}))}},{key:"_handlePendencyResult",value:function(e){var t=this,n=[];return e.forEach((function(e){t.pendencyMap.set("".concat(e.from,"_").concat(e.groupID,"_").concat(e.to),e),0===e.handled&&n.push({applicant:e.from,applicantNick:e.fromUserNickName,groupName:e.groupName,groupID:e.groupID,authentication:e.authentication,messageKey:e.time,applicationType:e.applicationType,userID:e.userID})})),Yo({applicationList:n})}},{key:"_onReceivedGroupSystemNotice",value:function(e){var t=this,n=e.result;e.isInstantMessage&&n.forEach((function(e){switch(e.payload.operationType){case 1:break;case 2:t._onApplyGroupRequestAgreed(e);break;case 3:break;case 4:t._onMemberKicked(e);break;case 5:t._onGroupDismissed(e);break;case 6:break;case 7:t._onInviteGroup(e);break;case 8:t._onQuitGroup(e);break;case 9:t._onSetManager(e);break;case 10:t._onDeleteManager(e);break;case 11:case 12:case 15:break;case 20:t._onMessageRemindTypeSynced(e);break;case 21:t._groupModule.onAVChatRoomMemberBanned(e)}}))}},{key:"_onApplyGroupRequestAgreed",value:function(e){var t=this,n=e.payload.groupProfile.groupID;this._groupModule.hasLocalGroup(n)||this._groupModule.getGroupProfile({groupID:n}).then((function(e){var n=e.data.group;if(n){t._groupModule.updateGroupMap([n]);var i=!n.isSupportTopic;t._groupModule.emitGroupListUpdate(!0,i)}}))}},{key:"_onMemberKicked",value:function(e){var t=e.payload.groupProfile.groupID;this._groupModule.hasLocalGroup(t)&&this._groupModule.deleteLocalGroupAndConversation(t)}},{key:"_onGroupDismissed",value:function(e){var t=e.payload.groupProfile.groupID;this._groupModule.hasLocalGroup(t)&&this._groupModule.deleteLocalGroupAndConversation(t);var n=this._groupModule._AVChatRoomHandler;n&&n.checkJoinedAVChatRoomByID(t)&&n.reset(t)}},{key:"_onInviteGroup",value:function(e){var t=this,n=e.payload.groupProfile.groupID;this._groupModule.hasLocalGroup(n)||this._groupModule.getGroupProfile({groupID:n}).then((function(e){var n=e.data.group;n&&(t._groupModule.updateGroupMap([n]),t._groupModule.emitGroupListUpdate())}))}},{key:"_onQuitGroup",value:function(e){var t=e.payload.groupProfile.groupID;this._groupModule.hasLocalGroup(t)&&this._groupModule.deleteLocalGroupAndConversation(t)}},{key:"_onSetManager",value:function(e){var t=e.payload.groupProfile,n=t.to,i=t.groupID,o=this._groupModule.getModule(9).getLocalGroupMemberInfo(i,n);o&&o.updateRole(b.GRP_MBR_ROLE_ADMIN)}},{key:"_onDeleteManager",value:function(e){var t=e.payload.groupProfile,n=t.to,i=t.groupID,o=this._groupModule.getModule(9).getLocalGroupMemberInfo(i,n);o&&o.updateRole(b.GRP_MBR_ROLE_MEMBER)}},{key:"_onMessageRemindTypeSynced",value:function(e){var t=e.payload.groupProfile.groupID,n=e.payload.messageRemindType;this._groupModule.getModule(11).onGroupMessageRemindTypeSynced({groupID:t,messageRemindType:n})}},{key:"_handleTopicSystemNotice",value:function(e){var t=e.groupProfile,n=t.groupID,i=t.topicID,o=e.elements,s=o.operationType,r=o.topicIDList,a=o.messageRemindType,c=this._groupModule.getModule(10);17===s?c.onTopicCreated({groupID:n,topicID:i}):18===s?c.onTopicDeleted({groupID:n,topicIDList:r}):20===s&&c.onTopicMessageRemindTypeUpdated({groupID:n,topicID:i,messageRemindType:a})}},{key:"reset",value:function(){this.pendencyMap.clear()}}]),e}(),Cs=["relayFlag"],Ts=function(e){d(i,e);var n=M(i);function i(e){var t;return r(this,i),(t=n.call(this,e))._n="GroupModule",t._commonGroupHandler=null,t._AVChatRoomHandler=null,t._groupSystemNoticeHandler=null,t._commonGroupHandler=new gs(m(t)),t._groupAttributesHandler=new _s(m(t)),t._groupCountersHandler=new vs(m(t)),t._AVChatRoomHandler=new Ms(m(t)),t._groupTipsHandler=new fs(m(t)),t._groupSystemNoticeHandler=new Is(m(t)),t.groupMap=new Map,t._unjoinedAVChatRoomList=new Map,t._receiptDetailCompleteMap=new Map,t.getInnerEmitterInstance().on(Qo,t._onCloudConfigUpdated,m(t)),t}return u(i,[{key:"_onCloudConfigUpdated",value:function(){var e=this.getCloudConfig("polling_interval"),t=this.getCloudConfig("polling_interval_plus"),n=this.getCloudConfig("polling_no_msg_count"),i=this.getCloudConfig("polling_simplified_msg");this._AVChatRoomHandler&&(Le.l("".concat(this._n,"._onCloudConfigUpdated pollingInterval:").concat(e)+" pollingIntervalPlus:".concat(t," pollingNoMessageCount:").concat(n)+" pollingSimplifiedMessage:".concat(i)),this._AVChatRoomHandler.setPollingInterval(e),this._AVChatRoomHandler.setPollingIntervalPlus(t),this._AVChatRoomHandler.setPollingNoMessageCount(n),this._AVChatRoomHandler.setPollingSimplifiedMessage(i))}},{key:"onCheckTimer",value:function(e){this.isLoggedIn()&&(this._commonGroupHandler.onCheckTimer(e),this._groupTipsHandler.onCheckTimer(e))}},{key:"guardForAVChatRoom",value:function(e){var t=this;if(e.conversationType===b.CONV_GROUP){var n=ft(e.to)?At(e.to):e.to;return this.hasLocalGroup(n)?Yo():this.getGroupProfile({groupID:n}).then((function(i){var o=i.data.group.type;if(Le.l("".concat(t._n,".guardForAVChatRoom. groupID:").concat(n," type:").concat(o)),o===b.GRP_AVCHATROOM){var s=ho.MESSAGE_SEND_FAIL_NOT_IN_AVCHATROOM;return Wo(new jo({code:s,message:t.getErrorMessage(s,e.from,n),data:{message:e}}))}return Yo()}))}return Yo()}},{key:"checkJoinedAVChatRoomByID",value:function(e){return!!this._AVChatRoomHandler&&this._AVChatRoomHandler.checkJoinedAVChatRoomByID(e)}},{key:"onNewGroupMessage",value:function(e){this._commonGroupHandler&&this._commonGroupHandler.onNewGroupMessage(e)}},{key:"updateNextMessageSeq",value:function(e){var t=this;if(ze(e)){var n=this.getModule(10);e.forEach((function(e){var i=e.conversationID.replace(b.CONV_GROUP,"");ft(i)&&n.updateLastMessage(i,e.lastMessage),t.groupMap.has(i)&&(t.groupMap.get(i).nextMessageSeq=e.lastMessage.sequence+1)}))}}},{key:"onNewGroupTips",value:function(e){this._groupTipsHandler&&this._groupTipsHandler.onNewGroupTips(e)}},{key:"onGroupMessageRevoked",value:function(e){this._commonGroupHandler&&this._commonGroupHandler.onGroupMessageRevoked(e)}},{key:"onNewGroupSystemNotice",value:function(e){this._groupSystemNoticeHandler&&this._groupSystemNoticeHandler.onNewGroupSystemNotice(e)}},{key:"onGroupMessageReadNotice",value:function(e){var t=this;e.dataList.forEach((function(e){var n=e.elements.groupMessageReadNotice;if(!Ye(n)){var i=t.getModule(11);n.forEach((function(e){var n=e.groupID,o=e.topicID,s=void 0===o?void 0:o,r=e.lastMessageSeq;Le.d("".concat(t._n,".onGroupMessageReadNotice groupID:").concat(n," lastMessageSeq:").concat(r));var a="".concat(b.CONV_GROUP).concat(n),c=!0;Gt(s)||(a="".concat(b.CONV_GROUP).concat(s),c=!1),i.updateIsReadAfterReadReport({conversationID:a,lastMessageSeq:r}),i.updateUnreadCount(a,c),i.clearGroupAtInfoList(a,c)}))}}))}},{key:"onReadReceiptList",value:function(e){var t=this;Le.d("".concat(this._n,".onReadReceiptList options:"),JSON.stringify(e)),e.dataList.forEach((function(e){var n=e.groupProfile,i=e.elements,o=n.groupID,s=t.getModule(11),r=i.readReceiptList;s.updateReadReceiptInfo({groupID:o,readReceiptList:r})}))}},{key:"onGroupMessageModified",value:function(e){Le.d("".concat(this._n,".onGroupMessageModified options:"),JSON.stringify(e));var n=this.getModule(11);e.dataList.forEach((function(e){n.onMessageModified(t(t({},e),{},{conversationType:b.CONV_GROUP,to:e.topicID?e.topicID:e.groupID}))}))}},{key:"deleteGroupSystemNotice",value:function(e){this._groupSystemNoticeHandler&&this._groupSystemNoticeHandler.deleteGroupSystemNotice(e)}},{key:"initGroupMap",value:function(e){this.groupMap.set(e.groupID,new cs(e))}},{key:"deleteGroup",value:function(e){this.groupMap.delete(e)}},{key:"updateGroupMap",value:function(e){var t,n=this,i=this.getModule(11);e.forEach((function(e){t=e.groupID,n.groupMap.has(t)?n.groupMap.get(t).updateGroup(e):(n.groupMap.set(t,new cs(e)),i.deleteGroupRomaingMessageInfo(t))}));var o,s=this.getMyUserID(),r=w(this.groupMap);try{for(r.s();!(o=r.n()).done;){var a=I(o.value,2)[1];a.selfInfo.userID=s,"Owner"===a.selfInfo.role&&(a.ownerID=s)}}catch(p){r.e(p)}finally{r.f()}this._setStorageGroupList()}},{key:"getStorageGroupList",value:function(){return this.getModule(13).getItem("groupMap")}},{key:"_setStorageGroupList",value:function(){var e=this.getLocalGroupList().filter((function(e){var t=e.type;return!pt(t)})).filter((function(e){return!e.isSupportTopic})).slice(0,20).map((function(e){return{groupID:e.groupID,name:e.name,avatar:e.avatar,type:e.type}}));this.getModule(13).setItem("groupMap",e)}},{key:"getGroupMap",value:function(){return this.groupMap}},{key:"getLocalGroupList",value:function(){return C(this.groupMap.values())}},{key:"getLocalGroupProfile",value:function(e){return this.groupMap.get(e)}},{key:"sortLocalGroupList",value:function(){var e=C(this.groupMap).filter((function(e){var t=I(e,2);return t[0],!Gt(t[1].lastMessage)}));e.sort((function(e,t){return t[1].lastMessage.lastTime-e[1].lastMessage.lastTime})),this.groupMap=new Map(C(e))}},{key:"updateGroupLastMessage",value:function(e){this._commonGroupHandler&&this._commonGroupHandler.handleUpdateGroupLastMessage(e)}},{key:"emitGroupListUpdate",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=this.getLocalGroupList();if(e&&this.emitOuterEvent(A.GROUP_LIST_UPDATED),t){var i=JSON.parse(JSON.stringify(n)),o=this.getModule(11);o.updateConversationGroupProfile(i)}}},{key:"patchGroupMessageRemindType",value:function(){var e=this.getLocalGroupList(),t=this.getModule(11),n=0;e.forEach((function(e){!0===t.patchMessageRemindType({ID:e.groupID,isC2CConversation:!1,messageRemindType:e.selfInfo.messageRemindType})&&(n+=1)})),Le.l("".concat(this._n,".patchGroupMessageRemindType count:").concat(n))}},{key:"recomputeUnreadCount",value:function(){var e=this.getLocalGroupList(),t=this.getModule(11);e.forEach((function(e){var n=e.groupID,i=e.selfInfo,o=i.excludedUnreadSequenceList,s=i.readedSequence;if(ze(o)){var r=0;o.forEach((function(t){t>=s&&t<=e.nextMessageSeq-1&&(r+=1)})),r>=1&&t.recomputeGroupUnreadCount({conversationID:"".concat(b.CONV_GROUP).concat(n),count:r})}}))}},{key:"getMyNameCardByGroupID",value:function(e){var t=this.getLocalGroupProfile(e);return t?t.selfInfo.nameCard:""}},{key:"isPagingGetCompleted",value:function(){return!!this._commonGroupHandler&&this._commonGroupHandler.isPagingGetCompleted()}},{key:"getGroupList",value:function(e){return this._commonGroupHandler?this._commonGroupHandler.getGroupList(e):Yo()}},{key:"getGroupProfile",value:function(e){var t=this,n="".concat(this._n,".").concat("getGroupProfile"),i=new wo("getGroupProfile"),o=e.groupID,s=e.groupCustomFieldFilter;Le.l("".concat(n," groupID:").concat(o));var r={groupIDList:[o],responseFilter:{groupBaseInfoFilter:["Type","Name","Introduction","Notification","FaceUrl","Owner_Account","CreateTime","InfoSeq","LastInfoTime","LastMsgTime","MemberNum","MaxMemberNum","ApplyJoinOption","NextMsgSeq","ShutUpAllMember","InviteJoinOption"],groupCustomFieldFilter:s,memberInfoFilter:["Role","JoinTime","MsgSeq","MsgFlag","NameCard"]}};return this.getGroupProfileAdvance(r).then((function(e){var s,r=e.data,a=r.successGroupList,c=r.failureGroupList;return Le.l("".concat(n," ok")),c.length>0?Wo(c[0]):(pt(a[0].type)&&!t.hasLocalGroup(o)?s=new cs(a[0]):(t.updateGroupMap(a),s=t.getLocalGroupProfile(o)),s.isSupportTopic||t.getModule(11).updateConversationGroupProfile([s]),i.setNetworkType(t.getNetworkType()).setMessage("groupID:".concat(o," type:").concat(s.type," muteAllMembers:").concat(s.muteAllMembers," ownerID:").concat(s.ownerID)).end(),Ko({group:s}))})).catch((function(o){return t.probeNetwork().then((function(t){var n=I(t,2),s=n[0],r=n[1];i.setError(o,s,r).setMessage("groupID:".concat(e.groupID)).end()})),Le.e("".concat(n," failed. error:"),o),Wo(o)}))}},{key:"getGroupProfileAdvance",value:function(e){var n="".concat(this._n,".getGroupProfileAdvance"),i=e.groupIDList;ze(i)&&i.length>50&&(this.outputWarning("GetGroupProfileLimit"),i.length=50);var o=[],s=[];i.forEach((function(e){ht({groupID:e})?s.push(e):o.push(e)}));var r=[];if(o.length>0){var a=this._getGroupProfileAdvance(t(t({},e),{},{groupIDList:o}));r.push(a)}if(s.length>0){var c=this._getGroupProfileAdvance(t(t({},e),{},{groupIDList:s,relayFlag:o.length>0}));r.push(c)}return Promise.all(r).then((function(e){var t=[],n=[];return e.forEach((function(e){t.push.apply(t,C(e.successGroupList)),n.push.apply(n,C(e.failureGroupList))})),Ko({successGroupList:t,failureGroupList:n})})).catch((function(e){return Le.e("".concat(n," failed. error:"),e),Wo(e)}))}},{key:"_getGroupProfileAdvance",value:function(e){var t=this,n=e.relayFlag,i=void 0!==n&&n,o=v(e,Cs);return this.request({protocolName:ei,requestData:o}).then((function(e){Le.l("".concat(t._n,"._getGroupProfileAdvance ok."));var n=e.data.groups;return{successGroupList:n.filter((function(e){return Ye(e.errorCode)||0===e.errorCode})),failureGroupList:n.filter((function(e){return e.errorCode&&0!==e.errorCode})).map((function(e){return new jo({code:e.errorCode,message:e.errorInfo,data:{groupID:e.groupID}})}))}})).catch((function(t){return i&&ht({groupID:e.groupIDList[0]})?{successGroupList:[],failureGroupList:[]}:Wo(t)}))}},{key:"createGroup",value:function(e){var n=this,i="".concat(this._n,".").concat("createGroup"),o=e.type,s=e.groupID;if(e.name&&!1===this._filterProfanity("name",e))return Wo({code:ho.PROFANITY_FOUND});if(e.introduction&&!1===this._filterProfanity("introduction",e))return Wo({code:ho.PROFANITY_FOUND});if(e.notification&&!1===this._filterProfanity("notification",e))return Wo({code:ho.PROFANITY_FOUND});if(!["Public","Private","ChatRoom","AVChatRoom","Community"].includes(o))return Wo({code:ho.ILLEGAL_GROUP_TYPE});if(!ht({type:o})){if(!Gt(s)&&ht({groupID:s}))return Wo({code:ho.ILLEGAL_GROUP_ID});e.isSupportTopic=void 0}if(pt(o)&&!Ye(e.memberList)&&e.memberList.length>0&&(e.memberList=void 0),this._canIUseJoinOption(o)||Ye(e.joinOption)||(e.joinOption=void 0),ht({type:o})){if(!Gt(s)&&!ht({groupID:s}))return Wo({code:ho.ILLEGAL_GROUP_ID});e.isSupportTopic=!0===e.isSupportTopic?1:0}var r=new wo("createGroup");Le.l("".concat(i," options:"),e);var a=null,c=[];return this.request({protocolName:ti,requestData:t(t({},e),{},{ownerID:this.getMyUserID(),webPushFlag:1})}).then((function(o){var s=o.data,u=s.groupID,l=s.overLimitUserIDList,d=void 0===l?[]:l;if(a=u,c=d,r.setNetworkType(n.getNetworkType()).setMessage("groupType:".concat(e.type," groupID:").concat(u," overLimitUserIDList=").concat(d)).end(),Le.l("".concat(i," ok groupID:").concat(u," overLimitUserIDList:"),d),e.type===b.GRP_AVCHATROOM)return n.getGroupProfile({groupID:u});if(e.type===b.GRP_COMMUNITY&&1===e.isSupportTopic)return n.getGroupProfile({groupID:u});Gt(e.memberList)||Gt(d)||(e.memberList=e.memberList.filter((function(e){return-1===d.indexOf(e.userID)}))),n.updateGroupMap([t(t({},e),{},{groupID:u})]);var p=n.getModule(2),h=p.createCustomMessage({to:u,conversationType:b.CONV_GROUP,payload:{data:"group_create",extension:n.isIntl()?"".concat(n.getMyUserID()," created a group"):"".concat(n.getMyUserID(),"\u521b\u5efa\u7fa4\u7ec4")}});return p.sendMessageInstance(h),n.emitGroupListUpdate(),n.getGroupProfile({groupID:u})})).then((function(e){var t=e.data.group,n=t.selfInfo,i=n.nameCard,o=n.joinTime;return t.updateSelfInfo({nameCard:i,joinTime:o,messageRemindType:b.MSG_REMIND_ACPT_AND_NOTE,role:b.GRP_MBR_ROLE_OWNER}),Ko({group:t,overLimitUserIDList:c})})).catch((function(o){if(r.setMessage("groupType:".concat(e.type)),n.probeNetwork().then((function(e){var t=I(e,2),n=t[0],i=t[1];r.setError(o,n,i).end()})),10010===o.code||10007===o.code){n.updateGroupMap([t(t({},e),{},{groupID:a})]);var s=n.getLocalGroupProfile(a);return Le.l("".concat(i," success, but failed to get group profile.")),Ko({group:s,overLimitUserIDList:c})}return Le.e("".concat(i," failed. error:"),o),Wo(o)}))}},{key:"dismissGroup",value:function(e){var t=this,n="".concat(this._n,".").concat("dismissGroup");if(this.hasLocalGroup(e)&&this.getLocalGroupProfile(e).type===b.GRP_WORK)return Wo(new jo({code:ho.CANNOT_DISMISS_WORK}));var i=new wo("dismissGroup");return i.setMessage("groupID:".concat(e)),Le.l("".concat(n," groupID:").concat(e)),this.request({protocolName:ni,requestData:{groupID:e}}).then((function(){return i.setNetworkType(t.getNetworkType()).end(),Le.l("".concat(n," ok")),t.deleteLocalGroupAndConversation(e),t.checkJoinedAVChatRoomByID(e)&&t._AVChatRoomHandler.reset(e),t._groupAttributesHandler.deleteLocalGroupAttributes(e),Ko({groupID:e})})).catch((function(e){return t.probeNetwork().then((function(t){var n=I(t,2),o=n[0],s=n[1];i.setError(e,o,s).end()})),Le.e("".concat(n," failed. error:"),e),Wo(e)}))}},{key:"updateGroupProfile",value:function(e){var t=this,n="".concat(this._n,".").concat("updateGroupProfile");if(this.hasLocalGroup(e.groupID)){var i=this.getLocalGroupProfile(e.groupID).type;this._canIUseJoinOption(i)||Ye(e.joinOption)||(Le.w("".concat(n," joinOption is unavailable for Work/Meeting/AVChatRoom")),e.joinOption=void 0)}if(Ye(e.muteAllMembers)||(e.muteAllMembers?e.muteAllMembers="On":e.muteAllMembers="Off"),e.name&&!1===this._filterProfanity("name",e))return Wo({code:ho.PROFANITY_FOUND});if(e.introduction&&!1===this._filterProfanity("introduction",e))return Wo({code:ho.PROFANITY_FOUND});if(e.notification&&!1===this._filterProfanity("notification",e))return Wo({code:ho.PROFANITY_FOUND});var o=new wo("updateGroupProfile");return o.setMessage(JSON.stringify(e)),Le.l("".concat(n," groupID:").concat(e.groupID)),this.request({protocolName:ii,requestData:e}).then((function(){return o.setNetworkType(t.getNetworkType()).end(),Le.l("".concat(n," ok")),t.hasLocalGroup(e.groupID)&&(t.groupMap.get(e.groupID).updateGroup(e),t._setStorageGroupList()),Ko({group:t.groupMap.get(e.groupID)})})).catch((function(e){return t.probeNetwork().then((function(t){var n=I(t,2),i=n[0],s=n[1];o.setError(e,i,s).end()})),Le.l("".concat(n," failed. error:"),e),Wo(e)}))}},{key:"_filterProfanity",value:function(e,t){var n=this.getModule(29);if(!n)return!0;var i=n.filterText(t[e],q),o=i.isAllowedToSend,s=i.modifiedText;return!0===o&&(t[e]=s,!0)}},{key:"joinGroup",value:function(e){var t=this,n=e.groupID,i=e.type,o="".concat(this._n,".joinGroup");if(i===b.GRP_WORK)return Wo({code:ho.CANNOT_JOIN_WORK});if(this.deleteUnjoinedAVChatRoom(n),this.hasLocalGroup(n)){if(!this.isLoggedIn())return Yo({status:b.JOIN_STATUS_ALREADY_IN_GROUP});var s=new wo("applyJoinGroup");return this.getGroupProfile({groupID:n}).then((function(){return s.setNetworkType(t.getNetworkType()).setMessage("groupID:".concat(n," joinedStatus:").concat(b.JOIN_STATUS_ALREADY_IN_GROUP)).end(),Yo({status:b.JOIN_STATUS_ALREADY_IN_GROUP})})).catch((function(i){return s.setNetworkType(t.getNetworkType()).setMessage("groupID:".concat(n," unjoined")).end(),Le.w("".concat(o," ").concat(n," was unjoined, now join!")),t.groupMap.delete(n),t.applyJoinGroup(e)}))}return Le.l("".concat(o," groupID:").concat(n)),this.isLoggedIn()?this.applyJoinGroup(e):this._AVChatRoomHandler.joinWithoutAuth(e)}},{key:"applyJoinGroup",value:function(e){var n=this,i="".concat(this._n,".").concat("applyJoinGroup"),o=e.groupID;if(!Gt(e.applyMessage)&&!1===this._filterProfanity("applyMessage",e))return Wo({code:ho.PROFANITY_FOUND});var s=new wo("applyJoinGroup"),r=t({},e),a=this.canIUse(F.AVCHATROOM_HISTORY_MSG);return a&&(r.historyMessageFlag=1),this.getModule(11).deleteTopicRoamingMessageInfo(o),this.request({protocolName:oi,requestData:r}).then((function(e){var t=e.data,r=t.joinedStatus,c=t.longPollingKey,u=t.startSeq,l=t.avChatRoomFlag,d=t.avChatRoomKey,p=t.messageList,h="groupID:".concat(o," joinedStatus:").concat(r," longPollingKey:").concat(c," startSeq:").concat(u)+" avChatRoomFlag:".concat(l," canGetAVChatRoomHistoryMessage:").concat(a,",")+" history message count:".concat(Gt(p)?0:p.length);switch(s.setNetworkType(n.getNetworkType()).setMessage("".concat(h)).end(),Le.l("".concat(i," ok. ").concat(h)),r){case xe:return Ko({status:xe});case Ge:return n.getGroupProfile({groupID:o}).then((function(e){var t=e.data.group;return n._handleJoinResult({group:t,avChatRoomFlag:l,longPollingKey:c,startSeq:u,avChatRoomKey:d,messageList:p})})).catch((function(){var e=new cs({groupID:o});return n._handleJoinResult({group:e,avChatRoomFlag:l,longPollingKey:c,startSeq:u,avChatRoomKey:d,messageList:p})}));default:var f=new jo({code:ho.JOIN_GROUP_FAIL});return Le.e("".concat(i," failed. error:"),f),Wo(f)}})).catch((function(e){return s.setMessage("groupID:".concat(o)),n.probeNetwork().then((function(t){var n=I(t,2),i=n[0],o=n[1];s.setError(e,i,o).end()})),Le.e("".concat(i," failed. error:"),e),Wo(e)}))}},{key:"_handleJoinResult",value:function(e){var t,n=this,i=e.group,o=e.avChatRoomFlag,s=e.longPollingKey,r=e.startSeq,a=e.avChatRoomKey,c=e.messageList,u=i.groupID;return 1===o?(this.getModule(11).setCompleted("".concat(b.CONV_GROUP).concat(u)),this._groupAttributesHandler.initGroupAttributesCache({groupID:u,avChatRoomKey:a}),this._groupCountersHandler.initGroupCountersCache({groupID:u,avChatRoomKey:a}),(t=Ye(s)?this._AVChatRoomHandler.handleJoinResult({group:i}):this._AVChatRoomHandler.startRunLoop({group:i,longPollingKey:s,startSeq:r})).then((function(){n._onAVChatRoomHistoryMessage(c)})),t):(this.emitGroupListUpdate(!0,!1),Ko({status:Ge,group:i}))}},{key:"quitGroup",value:function(e){var t=this,n="".concat(this._n,".").concat("quitGroup");Le.l("".concat(n," groupID:").concat(e));var i=this.checkJoinedAVChatRoomByID(e);if(!i&&!this.hasLocalGroup(e))return Wo({code:ho.MEMBER_NOT_IN_GROUP});if(i&&!this.isLoggedIn())return Le.l("".concat(n," anonymously ok. groupID:").concat(e)),this.deleteLocalGroupAndConversation(e),this._AVChatRoomHandler.reset(e),Yo({groupID:e});var o=new wo("quitGroup");return o.setMessage("groupID:".concat(e)),this.request({protocolName:ri,requestData:{groupID:e}}).then((function(){return o.setNetworkType(t.getNetworkType()).end(),Le.l("".concat(n," ok")),t.deleteLocalGroupAndConversation(e),i&&t._AVChatRoomHandler.reset(e),t._groupAttributesHandler.deleteLocalGroupAttributes(e),Ko({groupID:e})})).catch((function(e){return t.probeNetwork().then((function(t){var n=I(t,2),i=n[0],s=n[1];o.setError(e,i,s).end()})),Le.e("".concat(n," failed. error:"),e),Wo(e)}))}},{key:"searchGroupByID",value:function(e){var t=this,n="".concat(this._n,".").concat("searchGroupByID"),i={groupIDList:[e]},o=new wo("searchGroupByID");return o.setMessage("groupID:".concat(e)),Le.l("".concat(n," groupID:").concat(e)),this.request({protocolName:ai,requestData:i}).then((function(e){var i=e.data.groupProfile;if(0!==i[0].errorCode)throw new jo({code:i[0].errorCode,message:i[0].errorInfo});return o.setNetworkType(t.getNetworkType()).end(),Le.l("".concat(n," ok")),Ko({group:new cs(i[0])})})).catch((function(e){return t.probeNetwork().then((function(t){var n=I(t,2),i=n[0],s=n[1];o.setError(e,i,s).end()})),Le.w("".concat(n," failed. error:"),e),Wo(e)}))}},{key:"changeGroupOwner",value:function(e){var t=this,n="".concat(this._n,".").concat("changeGroupOwner");if(this.hasLocalGroup(e.groupID)&&this.getLocalGroupProfile(e.groupID).type===b.GRP_AVCHATROOM)return Wo({code:ho.CANNOT_CHANGE_OWNER_IN_AVCHATROOM});if(e.newOwnerID===this.getMyUserID())return Wo({code:ho.CANNOT_CHANGE_OWNER_TO_SELF});var i=new wo("changeGroupOwner");return i.setMessage("groupID:".concat(e.groupID," newOwnerID:").concat(e.newOwnerID)),Le.l("".concat(n," groupID:").concat(e.groupID)),this.request({protocolName:ci,requestData:e}).then((function(){i.setNetworkType(t.getNetworkType()).end(),Le.l("".concat(n," ok"));var o=e.groupID,s=e.newOwnerID;t.groupMap.get(o).ownerID=s;var r=t.getModule(9).getLocalGroupMemberList(o);if(r instanceof Map){var a=r.get(t.getMyUserID());Ye(a)||(a.updateRole("Member"),t.groupMap.get(o).selfInfo.role="Member");var c=r.get(s);Ye(c)||c.updateRole("Owner")}return t.emitGroupListUpdate(!0,!1),Ko({group:t.groupMap.get(o)})})).catch((function(e){return t.probeNetwork().then((function(t){var n=I(t,2),o=n[0],s=n[1];i.setError(e,o,s).end()})),Le.e("".concat(n," failed. error:"),e),Wo(e)}))}},{key:"getGroupApplicationList",value:function(){return this._groupSystemNoticeHandler.getGroupApplicationList()}},{key:"handleGroupApplication",value:function(e){var t,n,i,o,s,r=this,a="".concat(this._n,".").concat("handleGroupApplication"),c=e.handleAction,u=e.handleMessage,l=e.message,d=e.application;l?(t=l.payload.operatorID,n=l.payload.groupProfile.groupID,i=l.payload.authentication,o=l.payload.messageKey):d&&(t=d.applicant,n=d.groupID,i=d.authentication,o=d.messageKey);var p=ui;d&&2===d.applicationType&&(p=li,s=d.userID);var h=new wo("handleGroupApplication");return h.setMessage("groupID:".concat(n)),Le.l("".concat(a," groupID:").concat(n)),this.request({protocolName:p,requestData:{handleAction:c,handleMessage:u,applicant:t,invitee:s,groupID:n,authentication:i,messageKey:o}}).then((function(){return h.setNetworkType(r.getNetworkType()).end(),Le.l("".concat(a," ok")),l&&r._groupSystemNoticeHandler.deleteGroupSystemNotice({messageList:[e.message]}),Ko({group:r.getLocalGroupProfile(n)})})).catch((function(e){return r.probeNetwork().then((function(t){var n=I(t,2),i=n[0],o=n[1];h.setError(e,i,o).end()})),Le.e("".concat(a," failed. error"),e),Wo(e)}))}},{key:"handleGroupInvitation",value:function(e){var n=this,i="".concat(this._n,".").concat("handleGroupInvitation"),o=e.message.payload,s=o.groupProfile.groupID,r=o.authentication,a=o.messageKey,c=o.operatorID,u=e.handleAction,l=new wo("handleGroupInvitation");return l.setMessage("groupID:".concat(s," inviter:").concat(c," handleAction:").concat(u)),Le.l("".concat(i," groupID:").concat(s," inviter:").concat(c," handleAction:").concat(u)),this.request({protocolName:di,requestData:t(t({},e),{},{inviter:c,groupID:s,authentication:r,messageKey:a})}).then((function(){return l.setNetworkType(n.getNetworkType()).end(),Le.l("".concat(i," ok")),n._groupSystemNoticeHandler.deleteGroupSystemNotice({messageList:[e.message]}),Ko({group:n.getLocalGroupProfile(s)})})).catch((function(e){return n.probeNetwork().then((function(t){var n=I(t,2),i=n[0],o=n[1];l.setError(e,i,o).end()})),Le.e("".concat(i," failed. error"),e),Wo(e)}))}},{key:"getGroupOnlineMemberCount",value:function(e){return this._AVChatRoomHandler?this._AVChatRoomHandler.checkJoinedAVChatRoomByID(e)?this._AVChatRoomHandler.getGroupOnlineMemberCount(e):Yo({memberCount:0}):Wo({code:ho.CANNOT_FIND_MODULE})}},{key:"hasLocalGroup",value:function(e){return this.groupMap.has(e)}},{key:"deleteLocalGroupAndConversation",value:function(e){var t=this.checkJoinedAVChatRoomByID(e);if(Le.l("".concat(this._n,".deleteLocalGroupAndConversation isJoinedAVChatRoom:").concat(t)),t&&this.getModule(11).deleteLocalConversation("".concat(b.CONV_GROUP).concat(e)),ht({groupID:e})){var n=this.getLocalGroupProfile(e);n&&!0===n.isSupportTopic&&this.getModule(10).deleteTopicListInCommunity(e)}this._deleteLocalGroup(e),this.emitGroupListUpdate(!0,!1)}},{key:"_deleteLocalGroup",value:function(e){this.groupMap.delete(e),this.getModule(9).deleteGroupMemberList(e),this._setStorageGroupList()}},{key:"sendMessage",value:function(e,t){if(ze(e._receiverList)&&e._receiverList.length>0&&!this.canIUse(F.MSG_TO_SPECIFIED_GRP_MBR))return Wo({code:ho.CANNOT_USE_COMMERCIAL_ABILITY});var n=this.createGroupMessagePack(e,t);return this.request(n)}},{key:"createGroupMessagePack",value:function(e,t){var n=null;t&&t.offlinePushInfo&&(n=t.offlinePushInfo);var i="";He(e.cloudCustomData)&&e.cloudCustomData.length>0&&(i=e.cloudCustomData);var o=[];if(je(t)&&je(t.messageControlInfo)){var s=t.messageControlInfo,r=s.excludedFromUnreadCount,a=s.excludedFromLastMessage,c=s.excludedFromContentModeration;!0===r&&o.push("NoUnread"),!0===a&&o.push("NoLastMsg"),!0===c&&o.push("NoMsgCheck")}var u=void 0;ze(e._receiverList)&&e._receiverList.length>0&&(u=e._receiverList,e._receiverList.length>50&&(u=e._receiverList.slice(0,50),this.outputWarning("ReceiverListLimit")));var l=this.isOnlineMessage(e,t)?1:0,d=e.getGroupAtInfoList(),p={fromAccount:this.getMyUserID(),groupID:e.to,msgBody:e.getElements(),cloudCustomData:i,random:e.random,priority:e.priority,clientSequence:e.clientSequence,groupAtInfo:e.type!==b.MSG_TEXT||Gt(d)?void 0:d,onlineOnlyFlag:l,clientTime:e.clientTime,offlinePushInfo:n?{pushFlag:!0===n.disablePush?1:0,title:n.title||"",desc:n.description||"",ext:n.extension||"",apnsInfo:{badgeMode:!0===n.ignoreIOSBadge?1:0,isVoipPush:this._isVoipPush(n)},androidInfo:{OPPOChannelID:n.androidOPPOChannelID||""}}:void 0,messageControlInfo:0===l?o:void 0,needReadReceipt:!0!==e.needReadReceipt||this.isMessageFromOrToAVChatroom(e.to)?0:1,receiverList:u,isSupportExtension:!0===e.isSupportExtension?1:0};return ft(e.to)&&(p.groupID=At(e.to),p.topicID=e.to),{protocolName:Sn,tjgID:this.generateTjgID(e),requestData:p}}},{key:"_isVoipPush",value:function(e){var t=void 0;return Ye(e.disableVoipPush)||(t=!1===e.disableVoipPush?1:0),t}},{key:"revokeMessage",value:function(e){var t={groupID:e.to,msgSeqList:[{msgSeq:e.sequence}]};return ft(e.to)&&(t.groupID=At(e.to),t.topicID=e.to),this.request({protocolName:pi,requestData:t})}},{key:"deleteMessage",value:function(e){var t=e.to,n=e.keyList;Le.l("".concat(this._n,".deleteMessage groupID:").concat(t," count:").concat(n.length));var i={groupID:t,deleter:this.getMyUserID(),keyList:n};return ft(t)&&(i.groupID=At(t),i.topicID=t),this.request({protocolName:Si,requestData:i})}},{key:"modifyRemoteMessage",value:function(e){var t=e.to,n=e.sequence,i=e.payload,o=e.type,s=e.version,r=void 0===s?0:s,a=e.cloudCustomData,c=t,u=void 0;ft(t)&&(c=At(t),u=t);var l=void 0;return Lt(o)&&(l=[]).push({type:o,content:i}),this.request({protocolName:Ei,requestData:{groupID:c,topicID:u,sequence:n,version:r,elements:l,cloudCustomData:a}})}},{key:"getRoamingMessage",value:function(e){var t=this,n="".concat(this._n,".getRoamingMessage"),i=e.conversationID,o=e.groupID,s=e.sequence,r=new wo("getGroupRoamingMessages"),a=0,c=void 0;return ft(o)&&(o=At(c=o)),this._computeLastSequence({groupID:o,topicID:c,sequence:s}).then((function(e){return a=e,Le.l("".concat(n," groupID:").concat(o," startSequence:").concat(a)),t.request({protocolName:gi,requestData:{groupID:o,count:21,sequence:a,topicID:c}})})).then((function(e){var s=e.data,u=s.messageList,l=s.complete,d=s.invisibleSequenceList,p=void 0===d?[]:d;Ye(u)?Le.l("".concat(n," ok. complete:").concat(l," but messageList is undefined!")):Le.l("".concat(n," ok. complete:").concat(l," count:").concat(u.length));var h=t._getMinSequence(p,u)-1;r.setNetworkType(t.getNetworkType()).setMessage("groupID:".concat(o," topicID:").concat(c," startSequence:").concat(a," complete:").concat(l," nextSequence:").concat(h)).end();var f=t.getModule(11),g=[];return Gt(u)||(f.updateRoamingMessageSequence(i,h),g=f.onRoamingMessage(u,i),f.updateIsRead(i),f.patchConversationLastMessage(i)),(2===l||h<=1)&&(f.setCompleted(i),h=""),Le.l("".concat(n," nextReqID:").concat(h,", stored message count:").concat(g.length,", invisible sequence count:").concat(p.length)),{nextReqID:h+"",storedMessageList:g}})).catch((function(e){return t.probeNetwork().then((function(t){var n=I(t,2),i=n[0],s=n[1];r.setError(e,i,s).setMessage("groupID:".concat(o," topicID:").concat(c," startSequence:").concat(a)).end()})),Le.w("".concat(n," failed. error:"),e),Wo(e)}))}},{key:"_getGroupIDOfMessage",value:function(e){return e.conversationID.replace(b.CONV_GROUP,"")}},{key:"_getMinSequence",value:function(e,t){var n=0;Gt(t)||(n=t[t.length-1].sequence);var i=0;return Gt(e)||(i=e[e.length-1]),Le.l("".concat(this._n,"._getMinSequence minVisibleSequence:").concat(n," minInvisibleSequence:").concat(i)),i>0&&i<n?i:n}},{key:"getReadReceiptList",value:function(e){var t=this,n="".concat(this._n,".").concat("getReadReceiptList"),i=this._getGroupIDOfMessage(e[0]),o=this.getMyUserID(),s=e.filter((function(e){return e.from===o&&!0===e.needReadReceipt})).map((function(e){return{sequence:e.sequence}}));if(Le.l("".concat(n," groupID:").concat(i," sequenceList:").concat(JSON.stringify(s))),0===s.length)return Yo({messageList:e});var r=new wo("getReadReceiptList");return r.setMessage("groupID:".concat(i)),this.request({protocolName:_i,requestData:{groupID:i,sequenceList:s}}).then((function(t){r.end(),Le.l("".concat(n," ok"));var i=t.data.readReceiptList;return ze(i)&&i.forEach((function(t){e.forEach((function(e){0===t.code&&t.sequence===e.sequence&&(e.readReceiptInfo.readCount=t.readCount,e.readReceiptInfo.unreadCount=t.unreadCount)}))})),Ko({messageList:e})})).catch((function(e){return t.probeNetwork().then((function(t){var n=I(t,2),i=n[0],o=n[1];r.setError(e,i,o).end()})),Le.w("".concat(n," failed. error:"),e),Wo(e)}))}},{key:"sendReadReceipt",value:function(e){var t=this,n="".concat(this._n,".").concat("sendReadReceipt"),i=this._getGroupIDOfMessage(e[0]),o=new wo("sendReadReceipt");o.setMessage("groupID:".concat(i));var s=this.getMyUserID(),r=e.filter((function(e){return e.from!==s&&!0===e.needReadReceipt})).map((function(e){return{sequence:e.sequence}}));return 0===r.length?Wo({code:ho.READ_RECEIPT_MESSAGE_LIST_EMPTY}):(Le.l("".concat(n,". sequenceList:").concat(JSON.stringify(r))),this.request({protocolName:vi,requestData:{groupID:i,sequenceList:r}}).then((function(e){return o.end(),Le.l("".concat(n," ok")),Ko()})).catch((function(e){return t.probeNetwork().then((function(t){var n=I(t,2),i=n[0],s=n[1];o.setError(e,i,s).end()})),Le.w("".concat(n," failed. error:"),e),Wo(e)})))}},{key:"getReadReceiptDetail",value:function(e){var t=this,n=e.message,i=e.filter,o=e.cursor,s=e.count,r=this._getGroupIDOfMessage(n),a=n.ID,c=n.sequence,u="".concat(this._n,".").concat("getReadReceiptDetail"),l=this._receiptDetailCompleteMap.get(a)||!1,d=0!==i&&1!==i?0:i,p=He(o)?o:"",h=!Ve(s)||s<=0||s>=100?100:s,f="groupID:".concat(r," sequence:").concat(c," cursor:").concat(p," filter:").concat(d," completeFlag:").concat(l);Le.l("".concat(u," ").concat(f));var g={cursor:"",isCompleted:!1,messageID:a,unreadUserIDList:[],readUserIDList:[]},_=new wo("getReadReceiptDetail");return _.setMessage(f),this.request({protocolName:yi,requestData:{groupID:r,sequence:c,flag:d,cursor:p,count:h}}).then((function(e){_.end();var n=e.data,i=n.cursor,o=n.isCompleted,s=n.unreadUserIDList,r=n.readUserIDList;return g.cursor=i,1===o&&(g.isCompleted=!0,t._receiptDetailCompleteMap.set(a,!0)),0===d?g.readUserIDList=r.map((function(e){return e.userID})):1===d&&(g.unreadUserIDList=s.map((function(e){return e.userID}))),Le.l("".concat(u," ok")),Ko(g)})).catch((function(e){return t.probeNetwork().then((function(t){var n=I(t,2),i=n[0],o=n[1];_.setError(e,i,o).end()})),Le.w("".concat(u," failed. error:"),e),Wo(e)}))}},{key:"getRoamingMessagesHopping",value:function(e){var t=this,n="".concat(this._n,".getRoamingMessagesHopping"),i=new wo("getGroupRoamingMessagesHopping"),o=e.groupID,s=e.count,r=e.sequence,a=e.direction,c=r;1===a&&(c=r+s-1);var u=void 0;ft(o)&&(o=At(u=o));var l="".concat(u?"topicID:".concat(u):"groupID:".concat(o)," sequence:").concat(r," direction:").concat(a);return Le.l("".concat(n," ").concat(l)),this.request({protocolName:gi,requestData:{groupID:o,topicID:u,count:s,sequence:c}}).then((function(o){var s=o.data,c=s.messageList,u=s.complete,d="complete:".concat(u," count:").concat(c?c.length:0);if(Le.l("".concat(n," ok. ").concat(d)),i.setNetworkType(t.getNetworkType()).setMessage("".concat(l," ").concat(d)).end(),2===u||Gt(c)){var p=t._computeResult();return Ko(p)}var h="".concat(b.CONV_GROUP).concat(e.groupID),f=t.getModule(11).onRoamingMessage(c,h,!1),g=t._computeResult({direction:a,sequence:r,remoteMessageList:c,processedMessageList:f});return Ko(g)})).catch((function(e){return t.probeNetwork().then((function(t){var n=I(t,2),a=n[0],c=n[1];i.setError(e,a,c).setMessage("groupID:".concat(o," sequence:").concat(r," count:").concat(s)).end()})),Le.w("".concat(n," failed. error:"),e),Wo(e)}))}},{key:"_computeResult",value:function(e){var t={messageList:[],isCompleted:!1,nextMessageSeq:""};if(Ye(e))return t.isCompleted=!0,t;var n=e.direction,i=e.sequence,o=e.remoteMessageList,s=void 0===o?[]:o,r=e.processedMessageList,a=void 0===r?[]:r,c=s.length;return 1===n?(t.nextMessageSeq=s[0].sequence+1,a.forEach((function(e){e.sequence>=i&&t.messageList.push(e)})),0===t.messageList.length&&s[0].sequence<i&&(t.isCompleted=!0,t.nextMessageSeq=""),t):(t.nextMessageSeq=s[c-1].sequence-1,t.messageList=C(a),0===t.nextMessageSeq&&(t.isCompleted=!0,t.nextMessageSeq=""),t)}},{key:"setMessageRead",value:function(e){var t=this,n=e.conversationID,i=e.lastMessageSeq,o="".concat(this._n,".setMessageRead");Le.l("".concat(o," conversationID:").concat(n," lastMessageSeq:").concat(i)),Ve(i)||this.outputWarning("DoNotModifyLastSeq");var s=new wo("setGroupMessageRead");s.setMessage("".concat(n,"-").concat(i));var r=n.replace(b.CONV_GROUP,""),a=void 0;return ft(r)&&(r=At(a=r)),this.request({protocolName:hi,requestData:{groupID:r,topicID:a,messageReadSeq:i}}).then((function(){s.setNetworkType(t.getNetworkType()).end(),Le.l("".concat(o," ok."));var e=t.getModule(11);e.updateIsReadAfterReadReport({conversationID:n,lastMessageSeq:i});var c=!0;if(!Ye(a)){c=!1;var u=t.getModule(10).getLocalTopic(r,a);u&&u.updateSelfInfo({readedSequence:i})}return e.updateUnreadCount(n,c),Ko()})).catch((function(e){return t.probeNetwork().then((function(t){var n=I(t,2),i=n[0],o=n[1];s.setError(e,i,o).end()})),Le.l("".concat(o," failed. error:"),e),Wo(e)}))}},{key:"_computeLastSequence",value:function(e){var t=e.groupID,n=e.topicID,i=void 0===n?void 0:n,o=e.sequence;return o>0?Promise.resolve(o):Ye(i)||this.hasLocalGroup(t)?Ye(i)?this.getGroupLastSequence(t):this.getTopicLastSequence({groupID:t,topicID:i}):Promise.resolve(0)}},{key:"getGroupLastSequence",value:function(e){var t=this,n="".concat(this._n,".").concat("getGroupLastSequence"),i=new wo("getGroupLastSequence"),o=0,s="";if(this.hasLocalGroup(e)){var r=this.getLocalGroupProfile(e),a=r.lastMessage;if(a.lastSequence>0&&!1===a.onlineOnlyFlag)return o=a.lastSequence,s="got lastSequence:".concat(o," from local group profile[lastMessage.lastSequence]. groupID:").concat(e),Le.l("".concat(n," ").concat(s)),i.setNetworkType(this.getNetworkType()).setMessage("".concat(s)).end(),Promise.resolve(o);if(r.nextMessageSeq>1)return o=r.nextMessageSeq-1,s="got lastSequence:".concat(o," from local group profile[nextMessageSeq]. groupID:").concat(e),Le.l("".concat(n," ").concat(s)),i.setNetworkType(this.getNetworkType()).setMessage("".concat(s)).end(),Promise.resolve(o)}var c="GROUP".concat(e),u=this.getModule(11).getLocalConversation(c);if(u&&u.lastMessage.lastSequence&&!1===u.lastMessage.onlineOnlyFlag)return o=u.lastMessage.lastSequence,s="got lastSequence:".concat(o," from local conversation profile[lastMessage.lastSequence]. groupID:").concat(e),Le.l("".concat(n," ").concat(s)),i.setNetworkType(this.getNetworkType()).setMessage("".concat(s)).end(),Promise.resolve(o);var l={groupIDList:[e],responseFilter:{groupBaseInfoFilter:["NextMsgSeq"]}};return this.getGroupProfileAdvance(l).then((function(r){var a=r.data.successGroupList;return Gt(a)?Le.l("".concat(n," successGroupList is empty. groupID:").concat(e)):(o=a[0].nextMessageSeq-1,s="got lastSequence:".concat(o," from getGroupProfileAdvance. groupID:").concat(e),Le.l("".concat(n," ").concat(s))),i.setNetworkType(t.getNetworkType()).setMessage("".concat(s)).end(),o})).catch((function(o){return t.probeNetwork().then((function(t){var n=I(t,2),s=n[0],r=n[1];i.setError(o,s,r).setMessage("get lastSequence failed from getGroupProfileAdvance. groupID:".concat(e)).end()})),Le.w("".concat(n," failed. error:"),o),Wo(o)}))}},{key:"getTopicLastSequence",value:function(e){var t=this,n=e.groupID,i=e.topicID,o="".concat(this._n,".").concat("getTopicLastSequence"),s=new wo("getTopicLastSequence"),r=0,a="",c=this.getModule(10);return c.hasLocalTopic(n,i)?(r=c.getLocalTopic(n,i).nextMessageSeq-1,a="get lastSequence:".concat(r," from local topic info[nextMessageSeq]. topicID:").concat(i),Le.l("".concat(o," ").concat(a)),s.setNetworkType(this.getNetworkType()).setMessage("".concat(a)).end(),Promise.resolve(r)):c.getTopicList({groupID:n,topicIDList:[i]}).then((function(e){var n=e.data.successTopicList;return Gt(n)?Le.l("".concat(o," successTopicList is empty. topicID:").concat(i)):(r=n[0].nextMessageSeq-1,a="get lastSequence:".concat(r," from getTopicList. topicID:").concat(i),Le.l("".concat(o," ").concat(a))),s.setNetworkType(t.getNetworkType()).setMessage("".concat(a)).end(),r})).catch((function(e){return t.probeNetwork().then((function(t){var n=I(t,2),o=n[0],r=n[1];s.setError(e,o,r).setMessage("get lastSequence failed from getTopicList. topicID:".concat(i)).end()})),Le.w("".concat(o," failed. error:"),e),Wo(e)}))}},{key:"isMessageFromOrToAVChatroom",value:function(e){return!!this._AVChatRoomHandler&&this._AVChatRoomHandler.checkJoinedAVChatRoomByID(e)}},{key:"hasJoinedAVChatRoom",value:function(){return this._AVChatRoomHandler?this._AVChatRoomHandler.hasJoinedAVChatRoom():0}},{key:"getJoinedAVChatRoom",value:function(){return this._AVChatRoomHandler?this._AVChatRoomHandler.getJoinedAVChatRoom():[]}},{key:"isOnlineMessage",value:function(e,t){return!(!this._canIUseOnlineOnlyFlag(e)||!t||!0!==t.onlineUserOnly)}},{key:"_canIUseOnlineOnlyFlag",value:function(e){var t=this.getJoinedAVChatRoom();return!t||!t.includes(e.to)||e.conversationType!==b.CONV_GROUP}},{key:"_onAVChatRoomHistoryMessage",value:function(e){if(!Gt(e)){Le.l("".concat(this._n,"._onAVChatRoomHistoryMessage count:").concat(e.length));var n=[];e.forEach((function(e){n.push(t(t({},e),{},{isHistoryMessage:1}))})),this.onAVChatRoomMessage(n)}}},{key:"onAVChatRoomMessage",value:function(e){this._AVChatRoomHandler&&this._AVChatRoomHandler.onMessage(e)}},{key:"onAVChatRoomMemberBanned",value:function(e){this._AVChatRoomHandler&&this._AVChatRoomHandler.onAVChatRoomMemberBanned(e)}},{key:"getGroupSimplifiedInfo",value:function(e){var t=this,n=new wo("getGroupSimplifiedInfo"),i={groupIDList:[e],responseFilter:{groupBaseInfoFilter:["Type","Name"]}};return this.getGroupProfileAdvance(i).then((function(i){var o=i.data.successGroupList;return n.setNetworkType(t.getNetworkType()).setMessage("groupID:".concat(e," type:").concat(o[0].type)).end(),o[0]})).catch((function(i){t.probeNetwork().then((function(t){var o=I(t,2),s=o[0],r=o[1];n.setError(i,s,r).setMessage("groupID:".concat(e)).end()}))}))}},{key:"setUnjoinedAVChatRoom",value:function(e){this._unjoinedAVChatRoomList.set(e,1)}},{key:"deleteUnjoinedAVChatRoom",value:function(e){this._unjoinedAVChatRoomList.has(e)&&this._unjoinedAVChatRoomList.delete(e)}},{key:"isUnjoinedAVChatRoom",value:function(e){return this._unjoinedAVChatRoomList.has(e)}},{key:"isGroupAttributesUpdatedNotice",value:function(e){return this._groupAttributesHandler.isGroupAttributesUpdatedNotice(e)}},{key:"updateLocalMainSequenceOnReconnected",value:function(){this._groupAttributesHandler.updateLocalMainSequenceOnReconnected()}},{key:"initGroupAttributes",value:function(e){return this._groupAttributesHandler.initGroupAttributes(e)}},{key:"setGroupAttributes",value:function(e){return this._groupAttributesHandler.setGroupAttributes(e)}},{key:"deleteGroupAttributes",value:function(e){return this._groupAttributesHandler.deleteGroupAttributes(e)}},{key:"getGroupAttributes",value:function(e){return this._groupAttributesHandler.getGroupAttributes(e)}},{key:"isMessageFromTopic",value:function(e,t){return 2===e&&!Gt(t)}},{key:"isMessageFromCommunityOfTopic",value:function(e,t){return 2===e&&Gt(t)}},{key:"getMessageExtensions",value:function(e,t){return Le.l("".concat(this._n,".getMessageExtensions startSequence:").concat(t)),this.request({protocolName:Oi,requestData:{groupID:e.to,messageSequence:e.sequence,startSequence:t}})}},{key:"modifyMessageExtensions",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;return Le.l("".concat(this._n,".modifyMessageExtensions operateType:").concat(n)),this.request({protocolName:Ri,requestData:{groupID:e.to,messageSequence:e.sequence,extensionList:t,operateType:n}})}},{key:"getGroupNotify",value:function(e){var n=this;if(this.hasLocalGroup(e)){var i=this.getLocalGroupProfile(e),o=i.type,s=i.isSupportTopic;if(!pt(o)&&!s){var r="".concat(this._n,".getGroupNotify"),a=this._getGroupLastRevokedTime(e),c=1e3*Se();Le.l("".concat(r," groupID:").concat(e," type:").concat(o," beginTime:").concat(a," endTime:").concat(c)),this.request({protocolName:Ni,requestData:{type:ht({type:o,groupID:e})?b.GRP_COMMUNITY:void 0,groupID:e,beginTime:a,endTime:c}}).then((function(i){var o=i.data,s=o.nextRevokedTime,a=o.notifyList;Le.l("".concat(r," ok. groupID:").concat(e," nextRevokedTime:").concat(s));var c={dataList:[{elements:{revokedInfos:[]}}]};ze(a)&&a.forEach((function(n){c.dataList[0].elements.revokedInfos.push({groupID:e,sequence:n.sequence,random:n.random,revokerInfo:t({},n.revokerInfo)})})),n.onGroupMessageRevoked(c),0!==s?(n._setGroupLastRevokedTime(e,s),n.getGroupNotify(e)):n._setGroupLastRevokedTime(e,1e3*Se())})).catch((function(e){Le.e("".concat(r," failed. error:"),e)}))}}}},{key:"_getGroupLastRevokedTime",value:function(e){return this.hasLocalGroup(e)?this.getLocalGroupProfile(e)._lastRevokedTime:0}},{key:"_setGroupLastRevokedTime",value:function(e,t){this.hasLocalGroup(e)&&(this.getLocalGroupProfile(e)._lastRevokedTime=t)}},{key:"isGroupCountersNotice",value:function(e){return this._groupCountersHandler.isGroupCountersNotice(e)}},{key:"setGroupCounters",value:function(e){return this._groupCountersHandler.setGroupCounters(e)}},{key:"increaseGroupCounter",value:function(e){return this._groupCountersHandler.increaseGroupCounter(e)}},{key:"decreaseGroupCounter",value:function(e){return this._groupCountersHandler.decreaseGroupCounter(e)}},{key:"getGroupCounters",value:function(e){return this._groupCountersHandler.getGroupCounters(e)}},{key:"restartPolling",value:function(){this._AVChatRoomHandler&&this._AVChatRoomHandler.restartPolling()}},{key:"_canIUseJoinOption",value:function(e){return function(e){return e===b.GRP_PUBLIC}(e)||ht({type:e})}},{key:"reset",value:function(){this.groupMap.clear(),this._unjoinedAVChatRoomList.clear(),this._receiptDetailCompleteMap.clear(),this._commonGroupHandler.reset(),this._groupSystemNoticeHandler.reset(),this._groupTipsHandler.reset(),this._groupAttributesHandler.reset(),this._groupCountersHandler.reset(),this._AVChatRoomHandler&&this._AVChatRoomHandler.reset()}}]),i}(yn),ks=function(){function e(t){r(this,e),this.userID="",this.avatar="",this.nick="",this.role="",this.joinTime="",this.lastSendMsgTime="",this.nameCard="",this.muteUntil=0,this.memberCustomField=[],this._initMember(t)}return u(e,[{key:"_initMember",value:function(e){this.updateMember(e)}},{key:"updateMember",value:function(e){var t=[null,void 0,"",0,NaN];e.memberCustomField&&dt(this.memberCustomField,e.memberCustomField),et(this,e,["memberCustomField","marks"],t)}},{key:"updateRole",value:function(e){["Owner","Admin","Member"].indexOf(e)<0||(this.role=e)}},{key:"updateMuteUntil",value:function(e){Ye(e)||(this.muteUntil=Math.floor((Date.now()+1e3*e)/1e3))}},{key:"updateNameCard",value:function(e){Ye(e)||(this.nameCard=e)}},{key:"updateMemberCustomField",value:function(e){e&&dt(this.memberCustomField,e)}}]),e}(),Ss=function(e){d(i,e);var n=M(i);function i(e){var t;return r(this,i),(t=n.call(this,e))._n="GroupMemberModule",t.groupMemberListMap=new Map,t.getInnerEmitterInstance().on(es,t._onProfileUpdated,m(t)),t}return u(i,[{key:"_onProfileUpdated",value:function(e){for(var t=this,n=e.data,i=function(e){var i=n[e];t.groupMemberListMap.forEach((function(e){e.has(i.userID)&&e.get(i.userID).updateMember({nick:i.nick,avatar:i.avatar})}))},o=0;o<n.length;o++)i(o)}},{key:"deleteGroupMemberList",value:function(e){this.groupMemberListMap.delete(e)}},{key:"getGroupMemberList",value:function(e){var t=this,n=e.groupID,i=e.offset,o=void 0===i?0:i,s=e.count,r=void 0===s?15:s,a=e.filter,c=void 0===a?void 0:a,u="".concat(this._n,".").concat("getGroupMemberList"),l=this.getModule(7),d=l.hasLocalGroup(n);if(Le.l("".concat(u," groupID:").concat(n," offset:").concat(o," count:").concat(r," hasLocalGroup:").concat(d)),!d)return Yo({memberList:[],offset:0});if(l.getLocalGroupProfile(n).type===b.GRP_AVCHATROOM){if(this.canIUse(F.AVCHATROOM_MBR_LIST))return this._getAVChatRoomMemberList({groupID:n,offset:o,filter:c});this.outputWarning("LiveOnlineMember")}var p=new wo("getGroupMemberList"),h=0,f={groupID:n,limit:r>100?100:r};ht({groupID:n})?f.next="".concat(o):(f.offset=o,h=o+r);var g=[];return this.request({protocolName:Gi,requestData:f}).then((function(e){var i=e.data,o=i.members,s=i.memberNum,r=i.next,a=void 0===r?void 0:r;if(Ye(a)||(h=Gt(a)?0:a),!ze(o)||0===o.length)return h=0,Promise.resolve([]);var c=t.getModule(7);return c.hasLocalGroup(n)&&(c.getLocalGroupProfile(n).memberNum=s),g=t._updateLocalGroupMemberMap(n,o),t.getModule(4).getUserProfile({userIDList:o.map((function(e){return e.userID})),tagList:[Oe.NICK,Oe.AVATAR]})})).then((function(e){var i=e.data;if(!ze(i)||0===i.length)return Yo({memberList:[],offset:h});var s=i.map((function(e){return{userID:e.userID,nick:e.nick,avatar:e.avatar}}));return t._updateLocalGroupMemberMap(n,s),g.length<r&&(h=0),p.setNetworkType(t.getNetworkType()).setMessage("groupID:".concat(n," offset:").concat(o," count:").concat(r)).end(),Le.l("".concat(u," ok.")),Ko({memberList:g,offset:h})})).catch((function(e){return t.probeNetwork().then((function(t){var n=I(t,2),i=n[0],o=n[1];p.setError(e,i,o).end()})),Le.e("".concat(u," failed. error:"),e),Wo(e)}))}},{key:"_getAVChatRoomMemberList",value:function(e){var t=this,n=e.groupID,i=e.offset,o=e.filter,s="".concat(this._n,".").concat("_getAVChatRoomMemberList"),r=new wo("_getAVChatRoomMemberList");return r.setMessage("groupID:".concat(n," offset:").concat(i," filter:").concat(o)),this.request({protocolName:xi,requestData:{groupID:n,offset:i,filter:o}}).then((function(e){var i=e.data,o=i.memberList,a=void 0===o?[]:o,c=i.offset,u=void 0===c?0:c;r.setNetworkType(t.getNetworkType()).end(),Le.l("".concat(s," ok. member count:").concat(a.length,", next request timestamp:").concat(u));var l=t._updateLocalGroupMemberMap(n,a);return Ko({memberList:l,offset:u})})).catch((function(e){return t.probeNetwork().then((function(t){var n=I(t,2),i=n[0],o=n[1];r.setError(e,i,o).end()})),Le.e("".concat(s," failed. error:"),e),Wo(e)}))}},{key:"getGroupMemberProfile",value:function(e){var n=this,i="".concat(this._n,".").concat("getGroupMemberProfile"),o=new wo("getGroupMemberProfile");o.setMessage(e.userIDList.length>5?"userIDList.length:".concat(e.userIDList.length):"userIDList:".concat(e.userIDList)),Le.l("".concat(i," groupID:").concat(e.groupID," userIDList:").concat(e.userIDList.join(","))),e.userIDList.length>50&&(e.userIDList=e.userIDList.slice(0,50));var s=e.groupID,r=e.userIDList;return this._getGroupMemberProfileAdvance(t(t({},e),{},{userIDList:r})).then((function(e){var t=e.data.members;return ze(t)&&0!==t.length?(n._updateLocalGroupMemberMap(s,t),n.getModule(4).getUserProfile({userIDList:t.map((function(e){return e.userID})),tagList:[Oe.NICK,Oe.AVATAR]})):Yo([])})).then((function(e){var t=e.data.map((function(e){return{userID:e.userID,nick:e.nick,avatar:e.avatar}}));n._updateLocalGroupMemberMap(s,t);var i=r.filter((function(e){return n.hasLocalGroupMember(s,e)})).map((function(e){return n.getLocalGroupMemberInfo(s,e)}));return o.setNetworkType(n.getNetworkType()).end(),Ko({memberList:i})}))}},{key:"addGroupMember",value:function(e){var t=this,n="".concat(this._n,".").concat("addGroupMember"),i=e.groupID,o=this.getModule(7).getLocalGroupProfile(i),s=o.type,r=new wo("addGroupMember");if(r.setMessage("groupID:".concat(i," groupType:").concat(s)),pt(s)){var a=new jo({code:ho.CANNOT_ADD_MEMBER_IN_AVCHATROOM});return r.setError(a,!0,this.getNetworkType()).end(),Wo(a)}return e.userIDList=e.userIDList.map((function(e){return{userID:e}})),Le.l("".concat(n," groupID:").concat(i)),this.request({protocolName:qi,requestData:e}).then((function(i){var s=i.data.members;Le.l("".concat(n," ok"));var a=s.filter((function(e){return 1===e.result})).map((function(e){return e.userID})),c=s.filter((function(e){return 0===e.result})).map((function(e){return e.userID})),u=s.filter((function(e){return 2===e.result})).map((function(e){return e.userID})),l=s.filter((function(e){return 4===e.result})).map((function(e){return e.userID})),d="groupID:".concat(e.groupID,", ")+"successUserIDList:".concat(a,", ")+"failureUserIDList:".concat(c,", ")+"existedUserIDList:".concat(u,", ")+"overLimitUserIDList:".concat(l);return r.setNetworkType(t.getNetworkType()).setMoreMessage(d).end(),0===a.length?Ko({successUserIDList:a,failureUserIDList:c,existedUserIDList:u,overLimitUserIDList:l}):(o.memberCount+=a.length,t._updateConversationGroupProfile(o),Ko({successUserIDList:a,failureUserIDList:c,existedUserIDList:u,overLimitUserIDList:l,group:o}))})).catch((function(e){return t.probeNetwork().then((function(t){var n=I(t,2),i=n[0],o=n[1];r.setError(e,i,o).end()})),Le.e("".concat(n," failed. error:"),e),Wo(e)}))}},{key:"deleteGroupMember",value:function(e){var t=this,n="".concat(this._n,".").concat("deleteGroupMember"),i=e.groupID,o=e.userIDList,s=this.getModule(7).getLocalGroupProfile(i);if(Ye(s))return Wo({code:ho.CANNOT_FIND_GROUP});if(pt(s.type))return this.canIUse(F.AVCHATROOM_BAN_MBR)?this._banAVChatRoomMember(e):Wo({code:ho.CANNOT_USE_COMMERCIAL_ABILITY});var r=new wo("deleteGroupMember"),a="groupID:".concat(i," ").concat(o.length>5?"userIDList.length:".concat(o.length):"userIDList:".concat(o));return r.setMessage(a),Le.l("".concat(n," groupID:").concat(i," userIDList:"),o),this.request({protocolName:Bi,requestData:e}).then((function(){return r.setNetworkType(t.getNetworkType()).end(),Le.l("".concat(n," ok")),s.memberCount-=1,t._updateConversationGroupProfile(s),t.deleteLocalGroupMembers(i,o),Ko({group:s,userIDList:o})})).catch((function(e){return t.probeNetwork().then((function(t){var n=I(t,2),i=n[0],o=n[1];r.setError(e,i,o).end()})),Le.e("".concat(n," failed. error:"),e),Wo(e)}))}},{key:"_updateConversationGroupProfile",value:function(e){this.getModule(11).updateConversationGroupProfile([e])}},{key:"_banAVChatRoomMember",value:function(e){var t=this,n="".concat(this._n,".").concat("deleteGroupMember"),i=e.groupID,o=e.userIDList,s="groupID:".concat(i," ").concat(o.length>5?"userIDList.length:".concat(o.length):"userIDList:".concat(o)),r=new wo("deleteGroupMember");r.setMessage(s),Le.l("".concat(n," groupID:").concat(i," userIDList:"),o);var a=this.getModule(7).getLocalGroupProfile(i);return Ye(e.duration)||0===e.duration?Wo({code:ho.BAN_DURATION_INVALID}):this.request({protocolName:$i,requestData:e}).then((function(){return r.setNetworkType(t.getNetworkType()).end(),Le.l("".concat(n," ok")),t.deleteLocalGroupMembers(i,o),Ko({group:a,userIDList:o})})).catch((function(e){return t.probeNetwork().then((function(t){var n=I(t,2),i=n[0],o=n[1];r.setError(e,i,o).end()})),Le.e("".concat(n," failed. error:"),e),Wo(e)}))}},{key:"setGroupMemberMuteTime",value:function(e){var t=this,n=e.groupID,i=e.userID,o=e.muteTime,s="".concat(this._n,".").concat("setGroupMemberMuteTime");if(i===this.getMyUserID())return Wo(new jo({code:ho.CANNOT_MUTE_SELF}));Le.l("".concat(s," groupID:").concat(n," userID:").concat(i));var r=new wo("setGroupMemberMuteTime");return r.setMessage("groupID:".concat(n," userID:").concat(i," muteTime:").concat(o)),this.modifyGroupMemberInfo({groupID:n,userID:i,muteTime:o}).then((function(e){r.setNetworkType(t.getNetworkType()).end(),Le.l("".concat(s," ok"));var i=t.getModule(7);return Ko({group:i.getLocalGroupProfile(n),member:e})})).catch((function(e){return t.probeNetwork().then((function(t){var n=I(t,2),i=n[0],o=n[1];r.setError(e,i,o).end()})),Le.e("".concat(s," failed. error:"),e),Wo(e)}))}},{key:"setGroupMemberRole",value:function(e){var t=this,n="".concat(this._n,".").concat("setGroupMemberRole"),i=e.groupID,o=e.userID,s=e.role,r=this.getModule(7).getLocalGroupProfile(i);if(r.selfInfo.role!==b.GRP_MBR_ROLE_OWNER)return Wo({code:ho.NOT_OWNER});if([b.GRP_WORK,b.GRP_AVCHATROOM].includes(r.type))return Wo({code:ho.CANNOT_SET_MEMBER_ROLE_IN_WORK_AND_AVCHATROOM});var a=[b.GRP_MBR_ROLE_ADMIN,b.GRP_MBR_ROLE_MEMBER];if(ht({groupID:i})&&a.push(b.GRP_MBR_ROLE_CUSTOM),a.indexOf(s)<0)return Wo({code:ho.INVALID_MEMBER_ROLE});if(o===this.getMyUserID())return Wo({code:ho.CANNOT_SET_SELF_MEMBER_ROLE});var c=new wo("setGroupMemberRole");return c.setMessage("groupID:".concat(i," userID:").concat(o," role:").concat(s)),Le.l("".concat(n," groupID:").concat(i," userID:").concat(o)),this.modifyGroupMemberInfo({groupID:i,userID:o,role:s}).then((function(e){return c.setNetworkType(t.getNetworkType()).end(),Le.l("".concat(n," ok")),Ko({group:r,member:e})})).catch((function(e){return t.probeNetwork().then((function(t){var n=I(t,2),i=n[0],o=n[1];c.setError(e,i,o).end()})),Le.e("".concat(n," failed. error:"),e),Wo(e)}))}},{key:"_filterProfanity",value:function(e,t){var n=this.getModule(29);if(!n)return!0;var i=n.filterText(t[e],"group_member_profile"),o=i.isAllowedToSend,s=i.modifiedText;return!0===o&&(t[e]=s,!0)}},{key:"setGroupMemberNameCard",value:function(e){var t=this,n="".concat(this._n,".").concat("setGroupMemberNameCard");if(e.nameCard&&!1===this._filterProfanity("nameCard",e))return Wo({code:ho.PROFANITY_FOUND});var i=e.groupID,o=e.userID,s=void 0===o?this.getMyUserID():o,r=e.nameCard;Le.l("".concat(n," groupID:").concat(i," userID:").concat(s));var a=new wo("setGroupMemberNameCard");return a.setMessage("groupID:".concat(i," userID:").concat(s," nameCard:").concat(r)),this.modifyGroupMemberInfo({groupID:i,userID:s,nameCard:r}).then((function(e){Le.l("".concat(n," ok")),a.setNetworkType(t.getNetworkType()).end();var o=t.getModule(7).getLocalGroupProfile(i);return s===t.getMyUserID()&&o&&o.setSelfNameCard(r),Ko({group:o,member:e})})).catch((function(e){return t.probeNetwork().then((function(t){var n=I(t,2),i=n[0],o=n[1];a.setError(e,i,o).end()})),Le.e("".concat(n," failed. error:"),e),Wo(e)}))}},{key:"setGroupMemberCustomField",value:function(e){var t=this,n="".concat(this._n,".").concat("setGroupMemberCustomField"),i=e.groupID,o=e.userID,s=void 0===o?this.getMyUserID():o,r=e.memberCustomField;Le.l("".concat(n," groupID:").concat(i," userID:").concat(s));var a=new wo("setGroupMemberCustomField");return a.setMessage("groupID:".concat(i," userID:").concat(s," memberCustomField:").concat(JSON.stringify(r))),this.modifyGroupMemberInfo({groupID:i,userID:s,memberCustomField:r}).then((function(e){a.setNetworkType(t.getNetworkType()).end(),Le.l("".concat(n," ok"));var o=t.getModule(7).getLocalGroupProfile(i);return Ko({group:o,member:e})})).catch((function(e){return t.probeNetwork().then((function(t){var n=I(t,2),i=n[0],o=n[1];a.setError(e,i,o).end()})),Le.e("".concat(n," failed. error:"),e),Wo(e)}))}},{key:"modifyGroupMemberInfo",value:function(e){var n=this,i=e.groupID,o=e.userID,s=void 0;return ft(i)&&(i=At(s=i)),this.request({protocolName:Vi,requestData:t(t({},e),{},{groupID:i,topicID:s})}).then((function(){if(n.hasLocalGroupMember(i,o)){var t=n.getLocalGroupMemberInfo(i,o);return Ye(e.muteTime)||t.updateMuteUntil(e.muteTime),Ye(e.role)||t.updateRole(e.role),Ye(e.nameCard)||t.updateNameCard(e.nameCard),Ye(e.memberCustomField)||t.updateMemberCustomField(e.memberCustomField),t}return n.getGroupMemberProfile({groupID:i,userIDList:[o]}).then((function(e){return I(e.data.memberList,1)[0]}))}))}},{key:"markGroupMemberList",value:function(e){var t=this,n="".concat(this._n,".").concat("markGroupMemberList"),i=e.groupID,o=e.markType,s=e.enableMark,r=e.userIDList,a=void 0===r?[]:r,c="groupID:".concat(i," markType:").concat(o," enableMark:").concat(s," userIDList count: ").concat(a.length);Le.l("".concat(n," ").concat(c));var u=2,l=[];!0===s&&(u=1);var d=C(a);a.length>500&&(d=a.slice(0,500),Le.w("".concat(n," ").concat(Nt(500)))),d.forEach((function(e){l.push({userID:e,markType:[o]})})),d=null;var p=new wo("markGroupMemberList");return p.setMessage("".concat(c)),this.request({protocolName:Hi,requestData:{groupID:i,operationType:u,memberList:l}}).then((function(e){var i=e.data.memberList,o=void 0===i?[]:i,s=[],r=[];o.length===a.length?s.push.apply(s,C(a)):(o.forEach((function(e){s.push(e.userID)})),a.forEach((function(e){s.includes(e)||r.push(e)})));var c="success count:".concat(s.length," fail count:").concat(r.length);return p.setNetworkType(t.getNetworkType()).setMessage(c).end(),Le.l("".concat(n," ok. ").concat(c)),Ko({successUserIDList:s,failureUserIDList:r})})).catch((function(e){return t.probeNetwork().then((function(t){var n=I(t,2),i=n[0],o=n[1];p.setError(e,i,o).end()})),Le.e("".concat(n," failed. error:"),e),Wo(e)}))}},{key:"_getGroupMemberProfileAdvance",value:function(e){return this.request({protocolName:Fi,requestData:t(t({},e),{},{memberInfoFilter:e.memberInfoFilter?e.memberInfoFilter:["Role","JoinTime","NameCard","ShutUpUntil"]})})}},{key:"_updateLocalGroupMemberMap",value:function(e,t){var n=this;return ze(t)&&0!==t.length?t.map((function(t){return n.hasLocalGroupMember(e,t.userID)?n.getLocalGroupMemberInfo(e,t.userID).updateMember(t):n.setLocalGroupMember(e,new ks(t)),n.getLocalGroupMemberInfo(e,t.userID)})):[]}},{key:"deleteLocalGroupMembers",value:function(e,t){var n=this.groupMemberListMap.get(e);n&&t.forEach((function(e){n.delete(e)}))}},{key:"getLocalGroupMemberInfo",value:function(e,t){return this.groupMemberListMap.has(e)?this.groupMemberListMap.get(e).get(t):null}},{key:"setLocalGroupMember",value:function(e,t){if(this.groupMemberListMap.has(e))this.groupMemberListMap.get(e).set(t.userID,t);else{var n=(new Map).set(t.userID,t);this.groupMemberListMap.set(e,n)}}},{key:"getLocalGroupMemberList",value:function(e){return this.groupMemberListMap.get(e)}},{key:"hasLocalGroupMember",value:function(e,t){return this.groupMemberListMap.has(e)&&this.groupMemberListMap.get(e).has(t)}},{key:"hasLocalGroupMemberMap",value:function(e){return this.groupMemberListMap.has(e)}},{key:"reset",value:function(){this.groupMemberListMap.clear()}}]),i}(yn),Es=["topicID","topicName","avatar","introduction","notification","unreadCount","muteAllMembers","customData","groupAtInfoList","nextMessageSeq","selfInfo"],Ds=function(e,t){return Gt(e)?{lastTime:0,lastSequence:0,fromAccount:"",payload:null,type:"",messageForShow:"",nick:"",version:0,cloudCustomData:"",isRevoked:!1,revoker:null}:{lastTime:e.time||0,lastSequence:e.sequence||0,fromAccount:e.from||"",payload:e.payload||null,type:e.type||"",messageForShow:bt(e.type,e.payload,t),nick:e.nick||"",version:e.version||0,cloudCustomData:e.cloudCustomData||"",isRevoked:e.isRevoked||!1,revoker:e.revoker||null}},ws=function(){function e(t,n){r(this,e),this.topicID="",this.topicName="",this.avatar="",this.introduction="",this.notification="",this.unreadCount=0,this.muteAllMembers=!1,this.customData="",this.groupAtInfoList=[],this.nextMessageSeq=0,this.lastMessage=Ds(t.lastMessage,n),this.selfInfo={muteTime:0,readedSequence:0,messageRemindType:"",excludedUnreadSequenceList:void 0},this._initTopic(t)}return u(e,[{key:"_initTopic",value:function(e){for(var t in e)Es.indexOf(t)<0||("selfInfo"===t?this.updateSelfInfo(e[t]):this[t]="muteAllMembers"===t?1===e[t]:e[t])}},{key:"updateUnreadCount",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;this.unreadCount=e}},{key:"updateNextMessageSeq",value:function(e){this.nextMessageSeq=e}},{key:"updateLastMessage",value:function(e){this.lastMessage=Ds(e)}},{key:"updateGroupAtInfoList",value:function(e){this.groupAtInfoList=JSON.parse(JSON.stringify(e))}},{key:"updateTopic",value:function(e){Ye(e.selfInfo)||this.updateSelfInfo(e.selfInfo),Ye(e.muteAllMembers)||(this.muteAllMembers=1===e.muteAllMembers),et(this,e,["groupID","lastMessageTime","selfInfo","muteAllMembers","lastMsg"])}},{key:"updateSelfInfo",value:function(e){return 0!==et(this.selfInfo,e,[],[""])}},{key:"reduceUnreadCount",value:function(){return this.unreadCount>=1&&(this.unreadCount-=1,!0)}},{key:"isLastMessageRevoked",value:function(e){return e.sequence===this.lastMessage.lastSequence}},{key:"setLastMessageRevoked",value:function(e){this.lastMessage.isRevoked=e}},{key:"setLastMessageRevoker",value:function(e){this.lastMessage.revoker=e}}]),e}(),As=function(e){d(i,e);var n=M(i);function i(e){var t;return r(this,i),(t=n.call(this,e))._n="TopicModule",t._topicMap=new Map,t._getTopicTimeMap=new Map,t.TOPIC_CACHE_TIME=300,t.TOPIC_LAST_ACTIVE_TIME=3600,t.getInnerEmitterInstance().on(Qo,t._onCloudConfigUpdated,m(t)),t}return u(i,[{key:"_onCloudConfigUpdated",value:function(){var e=this.getCloudConfig("topic_cache_time"),t=this.getCloudConfig("topic_last_active_time");Ye(e)||(this.TOPIC_CACHE_TIME=Number(e)),Ye(t)||(this.TOPIC_LAST_ACTIVE_TIME=Number(t))}},{key:"onTopicCreated",value:function(e){var t=e.groupID;this.resetGetTopicTime(t),this.emitOuterEvent(A.TOPIC_CREATED,e)}},{key:"onTopicDeleted",value:function(e){var t=this,n=e.groupID,i=e.topicIDList;(void 0===i?[]:i).forEach((function(e){t._deleteLocalTopic(n,e)})),this.emitOuterEvent(A.TOPIC_DELETED,e)}},{key:"onTopicMessageRemindTypeUpdated",value:function(e){var t=e.groupID,n=e.topicID,i=e.messageRemindType,o=this.getLocalTopic(t,n);if(o){var s=o.updateSelfInfo({messageRemindType:i});s&&this.emitOuterEvent(A.TOPIC_UPDATED,{groupID:t,topic:o}),Le.d("".concat(this._n,".onTopicMessageRemindTypeUpdated topicID:").concat(n)+" messageRemindType:".concat(i," isTopicUpdated:").concat(s))}}},{key:"onTopicProfileUpdated",value:function(e){var t=e.groupID,n=e.topicID,i=this.getLocalTopic(t,n);i&&(i.updateTopic(e),this.emitOuterEvent(A.TOPIC_UPDATED,{groupID:t,topic:i}))}},{key:"onConversationProxy",value:function(e){var t=e.topicID,n=e.unreadCount,i=e.groupAtInfoList,o=At(t),s=this.getLocalTopic(o,t),r=!1;s&&(Ye(n)||s.unreadCount===n||(s.updateUnreadCount(n),r=!0),Ye(i)||(s.updateGroupAtInfoList(i),r=!0)),r&&this.emitOuterEvent(A.TOPIC_UPDATED,{groupID:o,topic:s})}},{key:"onMessageSent",value:function(e){var t=e.groupID,n=e.topicID,i=e.lastMessage,o=this.getLocalTopic(t,n);o&&(o.nextMessageSeq+=1,o.updateLastMessage(i),this.emitOuterEvent(A.TOPIC_UPDATED,{groupID:t,topic:o}))}},{key:"onMessageModified",value:function(e){var t=e.to,n=e.time,i=e.sequence,o=e.elements,s=e.cloudCustomData,r=e.messageVersion,a=At(t),c=this.getLocalTopic(a,t);if(c){var u=c.lastMessage;Le.d("".concat(this._n,".onMessageModified topicID:").concat(t," lastMessage:"),JSON.stringify(u),"options:",JSON.stringify(e)),u&&(null===u.payload||u.lastTime===n&&u.lastSequence===i&&u.version!==r)&&(u.type=o[0].type,u.payload=o[0].content,u.messageForShow=bt(u.type,u.payload,this.isIntl()),u.cloudCustomData=s,u.version=r,u.lastSequence=i,u.lastTime=n,this.emitOuterEvent(A.TOPIC_UPDATED,{groupID:a,topic:c}))}}},{key:"onMessageRevoked",value:function(e){var t=this;if(0!==e.length){var n=null,i=null,o=!1;e.forEach((function(e){var s=e.to;i=At(s),(n=t.getLocalTopic(i,s))&&(n.reduceUnreadCount()&&(o=!0),n.isLastMessageRevoked(e)&&(n.setLastMessageRevoked(!0),n.setLastMessageRevoker(e.revoker),o=!0))})),o&&this.emitOuterEvent(A.TOPIC_UPDATED,{groupID:i,topic:n})}}},{key:"isLastMessageRevoked",value:function(e){var t=e.topicID,n=e.sequence,i=At(t),o=this.getLocalTopic(i,t),s=!1;return o&&(s=o.isLastMessageRevoked({sequence:n})),s}},{key:"getJoinedCommunityList",value:function(){return this.getModule(7).getGroupList({isGroupWithTopicOnly:!0}).then((function(e){var t=e.data.groupList;return Ko({groupList:void 0===t?[]:t})})).catch((function(e){return Wo(e)}))}},{key:"createTopicInCommunity",value:function(e){var n=this,i="".concat(this._n,".").concat("createTopicInCommunity"),o=e.topicID;if(!Ye(o)&&!ft(o))return Wo({code:ho.ILLEGAL_TOPIC_ID});if(e.topicName&&!1===this._filterProfanity("topicName",e))return Wo({code:ho.PROFANITY_FOUND});if(e.introduction&&!1===this._filterProfanity("introduction",e))return Wo({code:ho.PROFANITY_FOUND});if(e.notification&&!1===this._filterProfanity("notification",e))return Wo({code:ho.PROFANITY_FOUND});var s=new wo("createTopicInCommunity");return this.request({protocolName:Qi,requestData:t({},e)}).then((function(o){var r=o.data.topicID;return s.setMessage("topicID:".concat(r)).setNetworkType(n.getNetworkType()).end(),Le.l("".concat(i," ok")),n._updateTopicMap([t(t({},e),{},{topicID:r})]),Ko({topicID:r})})).catch((function(e){return n.probeNetwork().then((function(t){var n=I(t,2),i=n[0],o=n[1];s.setError(e,i,o).end()})),Le.e("".concat(i," failed. error:"),e),Wo(e)}))}},{key:"deleteTopicFromCommunity",value:function(e){var t=this,n="".concat(this._n,".").concat("deleteTopicFromCommunity"),i=e.groupID,o=e.topicIDList,s=void 0===o?[]:o,r=new wo("deleteTopicFromCommunity");return r.setMessage("groupID:".concat(i," topicIDList:").concat(s)),this.request({protocolName:eo,requestData:{groupID:i,topicIDList:s}}).then((function(e){var n=e.data.resultList,o=[],s=[];(void 0===n?[]:n).forEach((function(e){var t=e.topicID,n=e.errorCode,i=e.errorInfo;0===n?o.push({topicID:t}):s.push({topicID:t,code:n,message:i})}));var a="success count:".concat(o.length,", fail count:").concat(s.length);return r.setMoreMessage("".concat(a)).setNetworkType(t.getNetworkType()).end(),Le.l("".concat(a)),o.forEach((function(e){t._deleteLocalTopic(i,e.topicID)})),Ko({successTopicList:o,failureTopicList:s})})).catch((function(e){return t.probeNetwork().then((function(t){var n=I(t,2),i=n[0],o=n[1];r.setError(e,i,o).end()})),Le.e("".concat(n," failed. error:"),e),Wo(e)}))}},{key:"updateTopicProfile",value:function(e){var n=this,i="".concat(this._n,".").concat("updateTopicProfile");if(Le.l("".concat(i," options:"),e),e.topicName&&!1===this._filterProfanity("topicName",e))return Wo({code:ho.PROFANITY_FOUND});if(e.introduction&&!1===this._filterProfanity("introduction",e))return Wo({code:ho.PROFANITY_FOUND});if(e.notification&&!1===this._filterProfanity("notification",e))return Wo({code:ho.PROFANITY_FOUND});var o=new wo("updateTopicProfile");return o.setMessage("groupID:".concat(e.groupID," topicID:").concat(e.topicID)),Ye(e.muteAllMembers)||(e.muteAllMembers=!0===e.muteAllMembers?"On":"Off"),this.request({protocolName:to,requestData:t({},e)}).then((function(){return o.setNetworkType(n.getNetworkType()).end(),Le.l("".concat(i," ok")),n._updateTopicMap([e]),Ko({topic:n.getLocalTopic(e.groupID,e.topicID)})})).catch((function(e){return n.probeNetwork().then((function(t){var n=I(t,2),i=n[0],s=n[1];o.setError(e,i,s).end()})),Le.e("".concat(i," failed. error:"),e),Wo(e)}))}},{key:"getTopicList",value:function(e){var n=this,i="".concat(this._n,".").concat("getTopicList"),o=e.groupID,s=e.topicIDList,r=void 0===s?[]:s,a=0===r.length,c=new wo("getTopicList");if(c.setMessage("groupID:".concat(o)),this._getTopicTimeMap.has(o)){var u=this._getTopicTimeMap.get(o),l=u.isGetAll,d=u.time;if((l||!l&&!a)&&Date.now()-d<1e3*this.TOPIC_CACHE_TIME){var p=this._getLocalTopicList(o,r);if(a||p.length===r.length)return c.setNetworkType(this.getNetworkType()).setMoreMessage("from cache, topic count:".concat(p.length)).end(),Le.l("".concat(i," groupID:").concat(o," from cache, topic count:").concat(p.length)),Yo({successTopicList:p,failureTopicList:[]})}}return this.request({protocolName:no,requestData:{groupID:o,topicIDList:r}}).then((function(e){var s=e.data.topicInfoList,r=[],u=[],l=[];(void 0===s?[]:s).forEach((function(e){var n=e.topic,i=e.selfInfo,o=e.errorCode,s=e.errorInfo,a=n.topicID;0===o?(r.push(t(t({},n),{},{selfInfo:i})),u.push(a)):l.push({topicID:a,code:o,message:s})})),n._updateTopicMap(r),n._handleTopicAtInfo(r);var d="success count:".concat(u.length,", fail count:").concat(l.length);c.setNetworkType(n.getNetworkType()).setMoreMessage("".concat(d)).end(),Le.l("".concat(i," groupID:").concat(o," from remote, ").concat(d));var p=[];return Gt(u)||(n._getTopicTimeMap.set(o,{time:Date.now(),isGetAll:a}),p=n._getLocalTopicList(o,u)),Ko({successTopicList:p,failureTopicList:l})})).catch((function(e){return n.probeNetwork(e).then((function(t){var n=I(t,2),i=n[0],o=n[1];c.setError(e,i,o).end()})),Le.e("".concat(i," failed. error:"),e),Wo(e)}))}},{key:"hasLocalTopic",value:function(e,t){return!!this._topicMap.has(e)&&this._topicMap.get(e).has(t)}},{key:"getLocalTopic",value:function(e,t){var n=null;return this._topicMap.has(e)&&(n=this._topicMap.get(e).get(t)),n}},{key:"_getLocalTopicList",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=this._topicMap.get(e),i=[];return n&&(i=C(n.values())),0===t.length?i:i.filter((function(e){return t.includes(e.topicID)}))}},{key:"_deleteLocalTopic",value:function(e,t){this._topicMap.has(e)&&(this._topicMap.get(e).delete(t),Le.l("".concat(this._n,"._deleteLocalTopic groupID:").concat(e," topicID:").concat(t)))}},{key:"_updateTopicMap",value:function(e){var t=this,n=[];e.forEach((function(e){var i=e.groupID,o=e.topicID,s=null;t._topicMap.has(i)||t._topicMap.set(i,new Map),t._topicMap.get(i).has(o)?(s=t._topicMap.get(i).get(o)).updateTopic(e):(t._getTopicLastMessage(e),s=new ws(e,t.isIntl()),t._topicMap.get(i).set(o,s));var r=t._computeUnreadCount(s);s.updateUnreadCount(r),n.push({conversationID:"".concat(b.CONV_GROUP).concat(o),type:b.CONV_TOPIC,unreadCount:r})})),n.length>0&&this.getModule(11).updateTopicConversation(n)}},{key:"resetGetTopicTime",value:function(e){var t=this;Ye(e)?C(this._getTopicTimeMap.keys()).forEach((function(e){t._getTopicTimeMap.set(e,0)})):this._getTopicTimeMap.set(e,0)}},{key:"getTopicListOnReconnected",value:function(){var e=this,t=C(this._topicMap.keys()),n=[];t.forEach((function(t){var i=[];e._getLocalTopicList(t).forEach((function(t){var n=t.lastMessage.lastTime,o=void 0===n?0:n;Date.now()-1e3*o<1e3*e.TOPIC_LAST_ACTIVE_TIME&&i.push(t.topicID)})),i.length>0&&n.push({groupID:t,topicIDList:i})})),Le.l("".concat(this._n,".getTopicListOnReconnected. active community count:").concat(n.length)),this._relayGetTopicList(n)}},{key:"_relayGetTopicList",value:function(e){var t=this;if(0!==e.length){var n=e.shift(),i=n.topicIDList.length>5?"topicIDList.length:".concat(n.topicIDList.length):"topicIDList:".concat(n.topicIDList),o=new wo("relayGetTopicList");o.setMessage(i),Le.l("".concat(this._n,"._relayGetTopicList. ").concat(i)),this.getTopicList(n).then((function(){o.setNetworkType(t.getNetworkType()).end(),t._relayGetTopicList(e)})).catch((function(n){t.probeNetwork().then((function(e){var t=I(e,2),i=t[0],s=t[1];o.setError(n,i,s).end()})),t._relayGetTopicList(e)}))}}},{key:"_handleTopicAtInfo",value:function(e){var n=this;0!==e.length&&e.forEach((function(e){var i=e.groupID,o=e.topicID,s=e.groupAtInfoList,r=[];Ye(s)||(s.forEach((function(e){r.push(t(t({},e),{},{groupID:i,topicID:o}))})),n.getModule(11).onNewGroupAtTips({dataList:r}))}))}},{key:"_getTopicLastMessage",value:function(e){if(!Ye(e.lastMsg)){var t={time:e.lastMsg.time,sequence:e.lastMsg.sequence,from:e.lastMsg.from,payload:e.lastMsg.elements[0]?e.lastMsg.elements[0].content:null,type:e.lastMsg.elements[0]?e.lastMsg.elements[0].type:"",nick:e.lastMsg.nick,version:e.lastMsg.messageVersion,cloudCustomData:e.lastMsg.cloudCustomData,isRevoked:2===e.lastMsg.isPlaceMessage,revoker:Gt(e.lastMsg.revokerInfo)?null:e.lastMsg.revokerInfo.revoker};e.lastMessage=t}}},{key:"deleteTopicListInCommunity",value:function(e){var t=this,n=this._getLocalTopicList(e),i=this.getModule(11);n.forEach((function(n){var o=n.topicID;t._deleteLocalTopic(e,o),t._getTopicTimeMap.delete(e),i.deleteLocalConversation("".concat(b.CONV_GROUP).concat(o))}))}},{key:"_computeUnreadCount",value:function(e){var t=e.selfInfo,n=t.excludedUnreadSequenceList,i=t.readedSequence,o=e.nextMessageSeq-e.selfInfo.readedSequence-1;if(ze(n)){var s=0;n.forEach((function(t){t>=i&&t<=e.nextMessageSeq-1&&(s+=1)})),s>=1&&(o-=s)}return o<0?0:o}},{key:"_filterProfanity",value:function(e,t){var n=this.getModule(29);if(!n)return!0;var i=n.filterText(t[e],q),o=i.isAllowedToSend,s=i.modifiedText;return!0===o&&(t[e]=s,!0)}},{key:"updateLastMessage",value:function(e,t){var n=At(e),i=this.getLocalTopic(n,e);if(i){var o=t.sequence+1;i.updateNextMessageSeq(o),i.updateLastMessage(t),this.emitOuterEvent(A.TOPIC_UPDATED,{groupID:n,topic:i})}}},{key:"getMessageExtensions",value:function(e,t){Le.l("".concat(this._n,".getMessageExtensions startSequence:").concat(t));var n=At(e.to);return this.request({protocolName:Oi,requestData:{groupID:n,topicID:e.to,messageSequence:e.sequence,startSequence:t}})}},{key:"modifyMessageExtensions",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;Le.l("".concat(this._n,".modifyMessageExtensions operateType:").concat(n));var i=At(e.to);return this.request({protocolName:Ri,requestData:{groupID:i,topicID:e.to,messageSequence:e.sequence,extensionList:t,operateType:n}})}},{key:"reset",value:function(){Le.l("".concat(this._n,".reset")),this._topicMap.clear(),this._getTopicTimeMap.clear(),this.TOPIC_CACHE_TIME=300,this.TOPIC_LAST_ACTIVE_TIME=3600}}]),i}(yn),bs=function(){function e(t){r(this,e),this._userModule=t,this._n="ProfileHandler",this.TAG="profile",this.accountProfileMap=new Map,this.expirationTime=864e5}return u(e,[{key:"setExpirationTime",value:function(e){this.expirationTime=e}},{key:"getUserProfile",value:function(e){var t=this,n="".concat(this._n,".").concat("getUserProfile"),i=e.userIDList;e.fromAccount=this._userModule.getMyAccount(),i.length>100&&(Le.w("".concat(n," ").concat(Nt(100))),i.length=100);for(var o,s=[],r=[],a=0,c=i.length;a<c;a++)o=i[a],this._userModule.isMyFriend(o)&&this._contains(o)?r.push(this._getProfileFromMap(o)):s.push(o);if(0===s.length)return Yo(r);e.toAccount=s;var u=e.bFromGetMyProfile||!1,l=[];e.toAccount.forEach((function(e){l.push({toAccount:e,standardSequence:0,customSequence:0})})),e.userItem=l;var d=new wo("getUserProfile");return d.setMessage(i.length>5?"userIDList.length:".concat(i.length):"userIDList:".concat(i)),this._userModule.request({protocolName:En,requestData:e}).then((function(e){d.setNetworkType(t._userModule.getNetworkType()).end(),Le.i("".concat(n," ok"));var i=t._handleResponse(e).concat(r);return Ko(u?i[0]:i)})).catch((function(e){return t._userModule.probeNetwork().then((function(t){var n=I(t,2),i=n[0],o=n[1];d.setError(e,i,o).end()})),Le.e("".concat(n," failed. error:"),e),Wo(e)}))}},{key:"getMyProfile",value:function(){var e=this._userModule.getMyAccount(),t="".concat(this._n,".getMyProfile");if(Le.l("".concat(t," myAccount:").concat(e)),this._fill(),this._contains(e)){var n=this._getProfileFromMap(e);return Le.d("".concat(t," from cache, myProfile:").concat(JSON.stringify(n))),Yo(n)}return this.getUserProfile({fromAccount:e,userIDList:[e],bFromGetMyProfile:!0})}},{key:"_handleResponse",value:function(e){var t=e.data.userProfileItem;if(!ze(t))return[];for(var n=[],i=Date.now(),o=0,s=t.length;o<s;o++){var r=t[o],a=r.to,c=r.profileItem;if("@TLS#NOT_FOUND"!==a&&""!==a){var u=this._update(a,this._getLatestProfileFromResponse(a,c)).latestProfile;n.push(u)}}return Le.l("".concat(this._n,"._handleResponse cost ").concat(Date.now()-i," ms")),n}},{key:"_getLatestProfileFromResponse",value:function(e,t){var n={userID:e,profileCustomField:[]};if(!Gt(t))for(var i=0,o=t.length;i<o;i++)if(t[i].tag.indexOf("Tag_Profile_Custom")>-1)n.profileCustomField.push({key:t[i].tag,value:t[i].value});else switch(t[i].tag){case Oe.NICK:n.nick=t[i].value;break;case Oe.GENDER:n.gender=t[i].value;break;case Oe.BIRTHDAY:n.birthday=t[i].value;break;case Oe.LOCATION:n.location=t[i].value;break;case Oe.SELFSIGNATURE:n.selfSignature=t[i].value;break;case Oe.ALLOWTYPE:n.allowType=t[i].value;break;case Oe.LANGUAGE:n.language=t[i].value;break;case Oe.AVATAR:n.avatar=t[i].value;break;case Oe.MESSAGESETTINGS:n.messageSettings=t[i].value;break;case Oe.ADMINFORBIDTYPE:n.adminForbidType=t[i].value;break;case Oe.LEVEL:n.level=t[i].value;break;case Oe.ROLE:n.role=t[i].value;break;default:Le.w("".concat(this._n,"._getLatestProfileFromResponse unknown tag:"),t[i].tag,t[i].value)}return n}},{key:"updateMyProfile",value:function(e){var t=this,n="".concat(this._n,".").concat("updateMyProfile");if(e.nick&&!1===this._userModule.filterProfanity("nick",e))return Wo({code:ho.PROFANITY_FOUND});if(e.selfSignature&&!1===this._userModule.filterProfanity("selfSignature",e))return Wo({code:ho.PROFANITY_FOUND});var i=new wo("updateMyProfile");i.setMessage(JSON.stringify(e));var o=(new os).validate(e);if(!o.valid)return i.setCode(ho.UPDATE_PROFILE_INVALID_PARAM).setMoreMessage("info:".concat(o.tips)).setNetworkType(this._userModule.getNetworkType()).end(),Le.e("".concat(n," info:").concat(o.tips)),Wo({code:ho.UPDATE_PROFILE_INVALID_PARAM});var s=[];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&("profileCustomField"===r?e.profileCustomField.forEach((function(e){s.push({tag:e.key,value:e.value})})):s.push({tag:Oe[r.toUpperCase()],value:e[r]}));if(0===s.length){var a=new jo({code:ho.UPDATE_PROFILE_NO_KEY});return i.setError(a,!0,this._userModule.getNetworkType()).end(),Le.e("".concat(n," failed. error:"),a),Wo(a)}var c=this._userModule.getMyAccount();return this._userModule.request({protocolName:Dn,requestData:{fromAccount:c,profileItem:s}}).then((function(o){i.setNetworkType(t._userModule.getNetworkType()).end(),Le.i("".concat(n," ok"));var s=t._update(c,e),r=s.isProfileUpdated,a=s.latestProfile;return!0===r&&t._userModule.emitOuterEvent(A.PROFILE_UPDATED,[a]),Yo(a)})).catch((function(e){return t._userModule.probeNetwork().then((function(t){var n=I(t,2),o=n[0],s=n[1];i.setError(e,o,s).end()})),Le.e("".concat(n," failed. error:"),e),Wo(e)}))}},{key:"onProfileModified",value:function(e){var t=e.dataList;if(!Gt(t)){var n,i=t.length;Le.d("".concat(this._n,".onProfileModified count:").concat(i," dataList:"),e.dataList);for(var o=[],s=0;s<i;s++){n=t[s].userID;var r=this._update(n,this._getLatestProfileFromResponse(n,t[s].profileList)),a=r.isProfileUpdated,c=r.latestProfile;!0===a&&o.push(c)}o.length>0&&(this._userModule.emitInnerEvent(es,o),this._userModule.emitOuterEvent(A.PROFILE_UPDATED,o))}}},{key:"_fill",value:function(){if(0===this.accountProfileMap.size){for(var e=this._getCachedProfiles(),t=Date.now(),n=0,i=e.length;n<i;n++)t-e[n].lastUpdatedTime<this.expirationTime&&this.accountProfileMap.set(e[n].userID,e[n]);Le.l("".concat(this._n,"._fill from cache, size:").concat(this.accountProfileMap.size))}}},{key:"_update",value:function(e,t){var n,i=!1,o=Date.now();return this._contains(e)?(n=this._getProfileFromMap(e),t.profileCustomField&&!0===dt(n.profileCustomField,t.profileCustomField)&&(n.lastUpdatedTime=o,i=!0),et(n,t,["profileCustomField"])>0&&(n.lastUpdatedTime=o,i=!0)):(n=new os(t),(this._userModule.isMyFriend(e)||e===this._userModule.getMyAccount())&&(n.lastUpdatedTime=o,i=!0,this.accountProfileMap.set(e,n))),this._flush(e===this._userModule.getMyAccount()),Le.l("".concat(this._n,"._update account:").concat(e," isProfileUpdated:").concat(i)),{isProfileUpdated:i,latestProfile:n}}},{key:"_flush",value:function(e){var t=C(this.accountProfileMap.values()),n=this._userModule.getStorageModule();Le.d("".concat(this._n,"._flush length:").concat(t.length," flushAtOnce:").concat(e)),n.setItem(this.TAG,t,e)}},{key:"_contains",value:function(e){return this.accountProfileMap.has(e)}},{key:"_getProfileFromMap",value:function(e){return this.accountProfileMap.get(e)}},{key:"_getCachedProfiles",value:function(){var e=this._userModule.getStorageModule().getItem(this.TAG);return Gt(e)?[]:e}},{key:"onConversationsProfileUpdated",value:function(e){for(var t,n,i,o=[],s=0,r=e.length;s<r;s++)n=(t=e[s]).userID,this._userModule.isMyFriend(n)||(this._contains(n)?(i=this._getProfileFromMap(n),et(i,t)>0&&o.push(n)):o.push(t.userID));0!==o.length&&(Le.i("".concat(this._n,".onConversationsProfileUpdated toAccountList:").concat(o)),this.getUserProfile({userIDList:o}))}},{key:"getNickAndAvatarByUserID",value:function(e){if(this._contains(e)){var t=this._getProfileFromMap(e);return{nick:t.nick,avatar:t.avatar}}return{nick:"",avatar:""}}},{key:"reset",value:function(){this._flush(!0),this.accountProfileMap.clear()}}]),e}(),Ls=u((function e(t){r(this,e),Gt||(this.userID=t.userID||"",this.timeStamp=t.timeStamp||0)})),Rs=function(){function e(t){r(this,e),this._userModule=t,this._n="BlacklistHandler",this._blacklistMap=new Map,this.startIndex=0,this.maxLimited=100,this.currentSequence=0}return u(e,[{key:"getLocalBlacklist",value:function(){return C(this._blacklistMap.keys())}},{key:"getBlacklist",value:function(){var e=this,t="".concat(this._n,".getBlacklist"),n={fromAccount:this._userModule.getMyAccount(),maxLimited:this.maxLimited,startIndex:0,lastSequence:this.currentSequence},i=new wo("getBlacklist");return this._userModule.request({protocolName:wn,requestData:n}).then((function(n){var o=n.data,s=o.blackListItem,r=o.currentSequence,a=Gt(s)?0:s.length;i.setNetworkType(e._userModule.getNetworkType()).setMessage("count:".concat(a)).end(),Le.i("".concat(t," ok")),e.currentSequence=r,e._handleResponse(s,!0),e._userModule.emitOuterEvent(A.BLACKLIST_UPDATED,C(e._blacklistMap.keys()))})).catch((function(n){return e._userModule.probeNetwork().then((function(e){var t=I(e,2),o=t[0],s=t[1];i.setError(n,o,s).end()})),Le.e("".concat(t," failed. error:"),n),Wo(n)}))}},{key:"addBlacklist",value:function(e){var t=this,n=new wo("addToBlacklist"),i="".concat(this._n,".addBlacklist"),o=this._userModule.getMyAccount();if(1===e.userIDList.length&&e.userIDList[0]===o){var s=ho.CANNOT_ADD_SELF_TO_BLACKLIST,r=this._userModule.getErrorMessage(s);n.setCode(s).setMessage(r).setNetworkType(this._userModule.getNetworkType()).end();var a=new jo({code:s});return Le.e("".concat(i," failed. error:"),a),Wo(a)}return e.userIDList.includes(o)&&(e.userIDList=e.userIDList.filter((function(e){return e!==o}))),e.fromAccount=this._userModule.getMyAccount(),e.toAccount=e.userIDList,this._userModule.request({protocolName:An,requestData:e}).then((function(o){return n.setNetworkType(t._userModule.getNetworkType()).setMessage(e.userIDList.length>5?"userIDList.length:".concat(e.userIDList.length):"userIDList:".concat(e.userIDList)).end(),Le.i("".concat(i," ok")),t._handleResponse(o.resultItem,!0),Ko(C(t._blacklistMap.keys()))})).catch((function(e){return t._userModule.probeNetwork().then((function(t){var i=I(t,2),o=i[0],s=i[1];n.setError(e,o,s).end()})),Le.e("".concat(i," failed. error:"),e),Wo(e)}))}},{key:"_handleResponse",value:function(e,t){if(!Gt(e))for(var n,i,o,s=0,r=e.length;s<r;s++)i=e[s].to,o=e[s].resultCode,(Ye(o)||0===o)&&(t?((n=this._blacklistMap.has(i)?this._blacklistMap.get(i):new Ls).userID=i,!Gt(e[s].addBlackTimeStamp)&&(n.timeStamp=e[s].addBlackTimeStamp),this._blacklistMap.set(i,n)):this._blacklistMap.has(i)&&(n=this._blacklistMap.get(i),this._blacklistMap.delete(i)));Le.l("".concat(this._n,"._handleResponse total:").concat(this._blacklistMap.size," bAdd:").concat(t))}},{key:"deleteBlacklist",value:function(e){var t=this,n="".concat(this._n,".deleteBlacklist"),i=new wo("removeFromBlacklist");return e.fromAccount=this._userModule.getMyAccount(),e.toAccount=e.userIDList,this._userModule.request({protocolName:bn,requestData:e}).then((function(o){return i.setNetworkType(t._userModule.getNetworkType()).setMessage(e.userIDList.length>5?"userIDList.length:".concat(e.userIDList.length):"userIDList:".concat(e.userIDList)).end(),Le.i("".concat(n," ok")),t._handleResponse(o.data.resultItem,!1),Ko(C(t._blacklistMap.keys()))})).catch((function(e){return t._userModule.probeNetwork().then((function(t){var n=I(t,2),o=n[0],s=n[1];i.setError(e,o,s).end()})),Le.e("".concat(n," failed. error:"),e),Wo(e)}))}},{key:"onAccountDeleted",value:function(e){for(var t,n=[],i=0,o=e.length;i<o;i++)t=e[i],this._blacklistMap.has(t)&&(this._blacklistMap.delete(t),n.push(t));n.length>0&&(Le.l("".concat(this._n,".onAccountDeleted count:").concat(n.length," userIDList:"),n),this._userModule.emitOuterEvent(A.BLACKLIST_UPDATED,C(this._blacklistMap.keys())))}},{key:"onAccountAdded",value:function(e){for(var t,n=[],i=0,o=e.length;i<o;i++)t=e[i],this._blacklistMap.has(t)||(this._blacklistMap.set(t,new Ls({userID:t})),n.push(t));n.length>0&&(Le.l("".concat(this._n,".onAccountAdded count:").concat(n.length," userIDList:"),n),this._userModule.emitOuterEvent(A.BLACKLIST_UPDATED,C(this._blacklistMap.keys())))}},{key:"reset",value:function(){this._blacklistMap.clear(),this.startIndex=0,this.maxLimited=100,this.currentSequence=0}}]),e}(),Os=function(e){var t=String(e).replace(/[=]+$/,""),n="";if(t.length%4==1)return"";for(var i,o,s=0,r=0;o=t.charAt(r++);~o&&(i=s%4?64*i+o:o,s++%4)?n+=String.fromCharCode(255&i>>(-2*s&6)):0)o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(o);try{return decodeURIComponent(escape(n))}catch(d){return""}},Ns=function(){function e(t){r(this,e),this._userModule=t,this._n="UserStatusHandler",this.MAX_QUERY_USER_COUNT=500,this.MAX_SUBSCRIBE_USER_COUNT=100,this.MAX_UNSUBSCRIBE_USER_COUNT=100,this._userModule.getInnerEmitterInstance().on(Qo,this._onCloudConfigUpdated,this)}return u(e,[{key:"_onCloudConfigUpdated",value:function(){var e=this._userModule.getCloudConfig("status_query_count"),t=this._userModule.getCloudConfig("status_sub_count"),n=this._userModule.getCloudConfig("status_unsub_count");Le.l("".concat(this._n,"._onCloudConfigUpdated statusQueryCount:").concat(e," statusSubscribeCount:").concat(t)+" statusUnsubscribeCount:".concat(n)),Ye(e)||(this.MAX_QUERY_USER_COUNT=parseInt(e,10)),Ye(e)||(this.MAX_SUBSCRIBE_USER_COUNT=parseInt(t,10)),Ye(e)||(this.MAX_UNSUBSCRIBE_USER_COUNT=parseInt(n,10))}},{key:"onUserStatusUpdated",value:function(e){var t=e.dataList,n=this._userModule.getMyUserID(),i=this._userModule.getModule(12),o=t.map((function(e){var t=e.to,o=e.statusType,s=e.customStatus,r=Os(s);return t===n&&i.setCustomStatus(r),{userID:t,statusType:o,customStatus:r}}));this._userModule.emitOuterEvent(A.USER_STATUS_UPDATED,o)}},{key:"setSelfStatus",value:function(e){var t=this,n="".concat(this._n,".setSelfStatus");if(!1===this._userModule.filterProfanity("customStatus",e))return Wo({code:ho.PROFANITY_FOUND});var i=new wo("setSelfStatus"),o=e.customStatus;return this._userModule.request({protocolName:io,requestData:{customStatus:o}}).then((function(e){return i.setNetworkType(t._userModule.getNetworkType()).setMessage("customStatus:".concat(o)).end(),Le.l("".concat(n," ok. customStatus:").concat(o)),t._userModule.getModule(12).setCustomStatus(o),Ko({userID:t._userModule.getMyUserID(),statusType:1,customStatus:o})})).catch((function(e){return t._userModule.probeNetwork().then((function(t){var n=I(t,2),o=n[0],s=n[1];i.setError(e,o,s).end()})),Le.e("".concat(n," failed. error:"),e),Wo(e)}))}},{key:"getUserStatus",value:function(e){var t=this,n="".concat(this._n,".getUserStatus"),i=e.userIDList,o=void 0===i?[]:i,s=this._userModule.getMyUserID(),r=C(o),a=void 0,c=r.indexOf(s);if(c>-1){r.splice(c,1);var u=this._userModule.getModule(12).getCustomStatus();a={userID:s,statusType:1,customStatus:u}}if(0===r.length)return Yo({successUserList:[a],failureUserList:[]});if(!this._userModule.canIUse(F.USER_STATUS))return Wo({code:ho.CANNOT_USE_COMMERCIAL_ABILITY});r.length>this.MAX_QUERY_USER_COUNT&&(Le.w("".concat(n," ").concat(Nt(this.MAX_QUERY_USER_COUNT))),r=o.slice(0,this.MAX_QUERY_USER_COUNT));var l=new wo("getUserStatus");return this._userModule.request({protocolName:oo,requestData:{userIDList:r}}).then((function(e){var i=e.data,s=i.successUserList,r=void 0===s?[]:s,c=i.failureUserList,u=void 0===c?[]:c,d=r.map((function(e){var t=e.userID,n=e.statusType,i=e.customStatus;return{userID:t,statusType:n,customStatus:Os(i)}})),p=u.map((function(e){var t=e.userID,n=e.invalidUserID,i=e.errorCode,o=e.errorInfo;return{userID:Gt(n)?t:n,code:i,message:o}}));Ye(a)||d.unshift(a);var h="userID count:".concat(o.length,", success count:").concat(d.length,", fail count:").concat(p.length);return l.setNetworkType(t._userModule.getNetworkType()).setMessage("".concat(h)).end(),Le.l("".concat(n," ok. ").concat(h,".")),Ko({successUserList:d,failureUserList:p})})).catch((function(e){return t._userModule.probeNetwork().then((function(t){var n=I(t,2),i=n[0],s=n[1];l.setMessage("userID count:".concat(o.length)).setError(e,i,s).end()})),Le.e("".concat(n," failed. error:"),e),Wo(e)}))}},{key:"subscribeUserStatus",value:function(e){var t=this;if(!this._userModule.canIUse(F.USER_STATUS))return Wo({code:ho.CANNOT_USE_COMMERCIAL_ABILITY});var n="".concat(this._n,".subscribeUserStatus"),i=e.userIDList,o=void 0===i?[]:i,s=C(o);s.length>this.MAX_SUBSCRIBE_USER_COUNT&&(Le.w("".concat(n," ").concat(Nt(this.MAX_SUBSCRIBE_USER_COUNT))),s=o.slice(0,this.MAX_SUBSCRIBE_USER_COUNT));var r=new wo("subscribeUserStatus"),a="userID count:".concat(o.length);return Le.l("".concat(n," ").concat(a)),this._userModule.request({protocolName:so,requestData:{userIDList:s}}).then((function(e){var i=e.data.failureUserList,o=(void 0===i?[]:i).map((function(e){var t=e.userID,n=e.invalidUserID,i=e.errorCode,o=e.errorInfo;return{userID:Gt(n)?t:n,code:i,message:o}}));return r.setNetworkType(t._userModule.getNetworkType()).setMessage("".concat(a," fail count:").concat(o.length)).end(),Le.l("".concat(n," ok. fail count:").concat(o.length,".")),Ko({failureUserList:o})})).catch((function(e){return t._userModule.probeNetwork().then((function(t){var n=I(t,2),i=n[0],o=n[1];r.setMessage("".concat(a)).setError(e,i,o).end()})),Le.e("".concat(n," failed. error:"),e),Wo(e)}))}},{key:"unsubscribeUserStatus",value:function(e){var t=this;if(!this._userModule.canIUse(F.USER_STATUS))return Wo({code:ho.CANNOT_USE_COMMERCIAL_ABILITY});var n="".concat(this._n,".unsubscribeUserStatus"),i=(e||{}).userIDList,o=void 0===i?[]:i,s=C(o);o.length>this.MAX_UNSUBSCRIBE_USER_COUNT&&(Le.w("".concat(n," ").concat(Nt(this.MAX_UNSUBSCRIBE_USER_COUNT))),s=o.slice(0,this.MAX_UNSUBSCRIBE_USER_COUNT));var r=new wo("unsubscribeUserStatus"),a="userID count:".concat(o.length);Le.l("".concat(n," ").concat(a));var c={userIDList:s};return 0===s.length&&(c.userIDList=void 0,c.unsubscribeAll=1),this._userModule.request({protocolName:ro,requestData:c}).then((function(e){var i=e.data.failureUserList,o=(void 0===i?[]:i).map((function(e){var t=e.userID,n=e.invalidUserID,i=e.errorCode,o=e.errorInfo;return{userID:Gt(n)?t:n,code:i,message:o}}));return r.setNetworkType(t._userModule.getNetworkType()).setMessage("".concat(a," fail count:").concat(o.length)).end(),Le.l("".concat(n," ok. fail count:").concat(o.length,".")),Ko({failureUserList:o})})).catch((function(e){return t._userModule.probeNetwork().then((function(t){var n=I(t,2),i=n[0],o=n[1];r.setMessage("".concat(a)).setError(e,i,o).end()})),Le.e("".concat(n," failed. error:"),e),Wo(e)}))}},{key:"reset",value:function(){this.MAX_QUERY_USER_COUNT=500,this.MAX_SUBSCRIBE_USER_COUNT=100,this.MAX_UNSUBSCRIBE_USER_COUNT=100}}]),e}(),Ps=function(e){d(n,e);var t=M(n);function n(e){var i;return r(this,n),(i=t.call(this,e))._n="UserModule",i._profileHandler=new bs(m(i)),i._blacklistHandler=new Rs(m(i)),i._userStatusHandler=new Ns(m(i)),i.getInnerEmitterInstance().on(Zo,i.onContextUpdated,m(i)),i}return u(n,[{key:"onContextUpdated",value:function(e){this._profileHandler.getMyProfile(),this._blacklistHandler.getBlacklist()}},{key:"onProfileModified",value:function(e){this._profileHandler.onProfileModified(e)}},{key:"onRelationChainModified",value:function(e){var t=e.dataList;if(!Gt(t)){var n=[];t.forEach((function(e){e.blackListDelAccount&&n.push.apply(n,C(e.blackListDelAccount))})),n.length>0&&this._blacklistHandler.onAccountDeleted(n);var i=[];t.forEach((function(e){e.blackListAddAccount&&i.push.apply(i,C(e.blackListAddAccount))})),i.length>0&&this._blacklistHandler.onAccountAdded(i)}}},{key:"onConversationsProfileUpdated",value:function(e){this._profileHandler.onConversationsProfileUpdated(e)}},{key:"getMyAccount",value:function(){return this.getMyUserID()}},{key:"getMyProfile",value:function(){return this._profileHandler.getMyProfile()}},{key:"getStorageModule",value:function(){return this.getModule(13)}},{key:"filterProfanity",value:function(e,t){var n=this.getModule(29);if(!n)return!0;var i=n.filterText(t[e],"user_profile"),o=i.isAllowedToSend,s=i.modifiedText;return!0===o&&(t[e]=s,!0)}},{key:"isMyFriend",value:function(e){var t=this.getModule(8);return!!t&&t.isMyFriend(e)}},{key:"getUserProfile",value:function(e){return this._profileHandler.getUserProfile(e)}},{key:"updateMyProfile",value:function(e){return this._profileHandler.updateMyProfile(e)}},{key:"getNickAndAvatarByUserID",value:function(e){return this._profileHandler.getNickAndAvatarByUserID(e)}},{key:"getLocalBlacklist",value:function(){var e=this._blacklistHandler.getLocalBlacklist();return Yo(e)}},{key:"addBlacklist",value:function(e){return this._blacklistHandler.addBlacklist(e)}},{key:"deleteBlacklist",value:function(e){return this._blacklistHandler.deleteBlacklist(e)}},{key:"onUserStatusUpdated",value:function(e){this._userStatusHandler.onUserStatusUpdated(e)}},{key:"setSelfStatus",value:function(e){return this._userStatusHandler.setSelfStatus(e)}},{key:"getUserStatus",value:function(e){return this._userStatusHandler.getUserStatus(e)}},{key:"subscribeUserStatus",value:function(e){return this._userStatusHandler.subscribeUserStatus(e)}},{key:"unsubscribeUserStatus",value:function(e){return this._userStatusHandler.unsubscribeUserStatus(e)}},{key:"reset",value:function(){Le.l("".concat(this._n,".reset")),this._profileHandler.reset(),this._blacklistHandler.reset(),this._userStatusHandler.reset()}}]),n}(yn),Us=function(){function e(t,n){r(this,e),this._m=t,this._isLoggedIn=!1,this._SDKAppID=n.SDKAppID,this._userID=n.userID||"",this._userSig=n.userSig||"",this._version="2.27.2",this._a2Key="",this._tinyID="",this._customStatus="",this._contentType="json",this._unlimitedAVChatRoom=n.unlimitedAVChatRoom,this._scene=n.scene||"",this._oversea=n.oversea,this._instanceID=n.instanceID,this._statusInstanceID=0,this._isDevMode=n.devMode,this._proxyServer=n.proxyServer,this._fileUploadProxy=n.fileUploadProxy,this._fileDownloadProxy=n.fileDownloadProxy}return u(e,[{key:"isLoggedIn",value:function(){return this._isLoggedIn}},{key:"isOversea",value:function(){return this._oversea}},{key:"isPrivateNetWork",value:function(){return this._proxyServer}},{key:"isDevMode",value:function(){return this._isDevMode}},{key:"isSingaporeSite",value:function(){return this._SDKAppID>=2e7&&this._SDKAppID<3e7||this._SDKAppID>=172e7&&this._SDKAppID<173e7}},{key:"isKoreaSite",value:function(){return this._SDKAppID>=3e7&&this._SDKAppID<4e7||this._SDKAppID>=173e7&&this._SDKAppID<174e7}},{key:"isGermanySite",value:function(){return this._SDKAppID>=4e7&&this._SDKAppID<5e7||this._SDKAppID>=174e7&&this._SDKAppID<175e7}},{key:"isIndiaSite",value:function(){return this._SDKAppID>=5e7&&this._SDKAppID<6e7||this._SDKAppID>=175e7&&this._SDKAppID<176e7}},{key:"isJapanSite",value:function(){return this._SDKAppID>=6e7&&this._SDKAppID<7e7||this._SDKAppID>=176e7&&this._SDKAppID<177e7}},{key:"isUSASite",value:function(){return this._SDKAppID>=7e7&&this._SDKAppID<8e7||this._SDKAppID>=177e7&&this._SDKAppID<178e7}},{key:"isIntl",value:function(){return 0===(e=this._SDKAppID)||e>=2e7&&e<8e7||e>=172e7&&e<178e7;var e}},{key:"isUnlimitedAVChatRoom",value:function(){return this._unlimitedAVChatRoom}},{key:"setUserID",value:function(e){this._userID=e}},{key:"getUserID",value:function(){return this._userID}},{key:"setUserSig",value:function(e){this._userSig=e}},{key:"getUserSig",value:function(){return this._userSig}},{key:"getSDKAppID",value:function(){return this._SDKAppID}},{key:"setTinyID",value:function(e){this._tinyID=e,this._isLoggedIn=!0}},{key:"getTinyID",value:function(){return this._tinyID}},{key:"setCustomStatus",value:function(e){this._customStatus=e}},{key:"getCustomStatus",value:function(){return this._customStatus}},{key:"getScene",value:function(){return ye?window.tencent_cloud_im_csig_flutter_for_web_25F_cy:this._isTUIKit()?"tuikit":this._scene}},{key:"getInstanceID",value:function(){return this._instanceID}},{key:"getStatusInstanceID",value:function(){return this._statusInstanceID}},{key:"setStatusInstanceID",value:function(e){this._statusInstanceID=e}},{key:"getVersion",value:function(){return this._version}},{key:"getA2Key",value:function(){return this._a2Key}},{key:"setA2Key",value:function(e){this._a2Key=e}},{key:"getContentType",value:function(){return this._contentType}},{key:"getProxyServer",value:function(){return this._proxyServer}},{key:"getFileUploadProxy",value:function(){return this._fileUploadProxy}},{key:"getFileDownloadProxy",value:function(){return this._fileDownloadProxy}},{key:"_isTUIKit",value:function(){var e=!1,t=!1,n=!1,i=!1,o=[];W&&(o=Object.keys(X)),J&&(o=Y?Object.keys(uni):Object.keys(window));for(var s=0,r=o.length;s<r;s++)if(o[s].toLowerCase().includes("uikit")){e=!0;break}if(o=null,W&&!Je(X.createGamePortal)&&Je(getApp)&&!Ye(getApp())){var a=getApp().globalData;je(a)&&!0===a.isTUIKit&&(t=!0)}!0===this._m.getModule(13).getStorageSync("TIM_".concat(this._SDKAppID,"_isTUIKit"))&&(n=!0);var c=null;if(B&&!V&&"undefined"==typeof uni&&__wxConfig&&(c=__wxConfig.pages),$&&"undefined"==typeof uni&&__qqConfig&&(c=__qqConfig.pages),ze(c)&&c.length>0){for(var u=0,l=c.length;u<l;u++)if(c[u].toLowerCase().includes("tui")){i=!0;break}c=null}return e||t||n||i}},{key:"reset",value:function(){this._isLoggedIn=!1,this._userSig="",this._a2Key="",this._tinyID="",this._customStatus="",this._statusInstanceID=0}}]),e}(),Gs=function(e){d(n,e);var t=M(n);function n(e){var i;return r(this,n),(i=t.call(this,e))._n="SignModule",i._helloInterval=120,i._lastLoginTs=0,i._lastWsHelloTs=0,i._isWebUniapp=0,ts.mixin(m(i)),i}return u(n,[{key:"onCheckTimer",value:function(e){this.isLoggedIn()&&e%this._helloInterval==0&&this._hello()}},{key:"login",value:function(e){var t="";if(this.isLoggedIn()){var n=this.getMyUserID();return(t=this.getErrorMessage("RepeatLogin",n))&&Le.w(t),Yo({actionStatus:"OK",errorCode:0,errorInfo:t,repeatLogin:!0})}if(Date.now()-this._lastLoginTs<=15e3)return this.outputWarning("LoggingIn",e.userID),Wo({code:ho.REPEAT_LOGIN});Le.l("".concat(this._n,".login userID:").concat(e.userID));var i=this._checkLoginInfo(e);if(0!==i.code)return Wo(i);var o=this.getModule(12),s=e.userID,r=e.userSig;return o.setUserID(s),o.setUserSig(r),this.getModule(20).updateProtocolConfig(),this._login()}},{key:"_login",value:function(){var e=this,t=this.getModule(12),n=t.getScene(),i=0,o=new wo("login");o.setMessage("".concat(n)).setMoreMessage("identifier:".concat(this.getMyUserID())),Y?"tuikit"===n?o.setUIPlatform(4):o.setUIPlatform(3):W?"tuikit"===n?o.setUIPlatform(12):o.setUIPlatform(11):J&&(ye?"flutter_web_uikit"===n?o.setUIPlatform(21):o.setUIPlatform(20):this._isReactUIKit()?me?o.setUIPlatform(25):o.setUIPlatform(24):me?"tuikit"===n?o.setUIPlatform(17):o.setUIPlatform(16):"tuikit"===n?o.setUIPlatform(14):o.setUIPlatform(13));var s=this.getModule(28);if(s.canIUseOfflinePush()){this._isWebUniapp=s.getUniAppPlatform();var r=this._getStatusInstanceID();t.setStatusInstanceID(r),this.getModule(20).updateProtocolConfig(),i=s.getDeviceBrand()}var a="".concat(this._n,"._login");return this._lastLoginTs=Date.now(),this.request({protocolName:Mn,requestData:{deviceBrand:i,isWebUniapp:this._isWebUniapp}}).then((function(i){e._lastLoginTs=0;var s=Date.now(),r=null,c=i.data,u=c.a2Key,l=c.tinyID,d=c.helloInterval,p=c.instanceID,h=c.timeStamp,f=c.customStatus,g=void 0===f?"":f;Le.l("".concat(a," ok. scene:").concat(n," helloInterval:").concat(d," instanceID:").concat(p," timeStamp:").concat(h));var _=1e3*h,v=s-o.getStartTs(),m=_+parseInt(v/2)-s,y=o.getStartTs()+m;if(o.start(y),function(e,t){ke=t;var n=new Date;n.setTime(e),Le.i("baseTime from server:".concat(n," offset:").concat(ke))}(_,m),!l)throw r=new jo({code:ho.NO_TINYID}),o.setError(r,!0,e.getNetworkType()).end(),r;if(!u)throw r=new jo({code:ho.NO_A2KEY}),o.setError(r,!0,e.getNetworkType()).end(),r;var M=Os(g);o.setNetworkType(e.getNetworkType()).setMoreMessage("helloInterval:".concat(d," instanceID:").concat(p," offset:").concat(m," customStatus:").concat(M)).end(),t.setA2Key(u),t.setTinyID(l),t.setStatusInstanceID(p),t.setCustomStatus(M),e.getModule(20).updateProtocolConfig(),e.emitInnerEvent(Zo),e._helloInterval=d,e.triggerReady();var I=e.getModule(28);return I.canIUseOfflinePush()&&(uni.setStorageSync("timUniAppInstanceID",p),I.init()),e._fetchCloudControlConfig(),e.getModule(29).init(),i})).catch((function(t){return e.probeNetwork().then((function(e){var n=I(e,2),i=n[0],s=n[1];o.setError(t,i,s).end(!0)})),e._m.setNotReadyReason(ho.LOGIN_FAILED),Le.e("".concat(a," failed. error:"),t),e._lastLoginTs=0,e._m.onLoginFailed(),Wo(t)}))}},{key:"logout",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;if(!this.isLoggedIn())return Wo({code:ho.USER_NOT_LOGGED_IN});var n=new wo("logout");n.setNetworkType(this.getNetworkType()).setMessage("identifier:".concat(this.getMyUserID())).end(!0);var i="".concat(this._n,".logout");return Le.i("".concat(i," type:").concat(t)),0===t&&this._m.setNotReadyReason(ho.LOGGED_OUT),this.request({protocolName:In,requestData:{type:t}}).then((function(){return e.resetReady(),Yo({})})).catch((function(t){return Le.e("".concat(i," error:"),t),e.resetReady(),Yo({})}))}},{key:"_fetchCloudControlConfig",value:function(){this.getModule(23).fetchConfig()}},{key:"_getStatusInstanceID",value:function(){return uni.getStorageSync("timUniAppInstanceID")}},{key:"_hello",value:function(){var e=this;this._lastWsHelloTs=Date.now(),this.request({protocolName:Cn,requestData:{isWebUniapp:this._isWebUniapp}}).catch((function(t){Le.w("".concat(e._n,"._hello error:"),t)}))}},{key:"getLastWsHelloTs",value:function(){return this._lastWsHelloTs}},{key:"_checkLoginInfo",value:function(e){var t=0;return Gt(this.getModule(12).getSDKAppID())?t=ho.NO_SDKAPPID:Gt(e.userID)?t=ho.NO_IDENTIFIER:Gt(e.userSig)&&(t=ho.NO_USERSIG),{code:t}}},{key:"_isReactUIKit",value:function(){return J&&void 0!==window.tencent_cloud_im_csig_react_uikit_23F_xa}},{key:"onMultipleAccountKickedOut",value:function(e){var t=this;new wo("kickedOut").setNetworkType(this.getNetworkType()).setMessage("type:".concat(b.KICKED_OUT_MULT_ACCOUNT," newInstanceInfo:").concat(JSON.stringify(e))).end(!0),Le.w("".concat(this._n,".onMultipleAccountKickedOut userID:").concat(this.getMyUserID()," newInstanceInfo:"),e),this.logout(1).then((function(){t.emitOuterEvent(A.KICKED_OUT,{type:b.KICKED_OUT_MULT_ACCOUNT}),t._m.setNotReadyReason(ho.KICKED_OUT_MULT_ACCOUNT),t._m.reset()}))}},{key:"onMultipleDeviceKickedOut",value:function(e){var t=this;new wo("kickedOut").setNetworkType(this.getNetworkType()).setMessage("type:".concat(b.KICKED_OUT_MULT_DEVICE," newInstanceInfo:").concat(JSON.stringify(e))).end(!0),Le.w("".concat(this._n,".onMultipleDeviceKickedOut userID:").concat(this.getMyUserID()," newInstanceInfo:"),e),this.logout(1).then((function(){t.emitOuterEvent(A.KICKED_OUT,{type:b.KICKED_OUT_MULT_DEVICE}),t._m.setNotReadyReason(ho.KICKED_OUT_MULT_DEVICE),t._m.reset()}))}},{key:"onUserSigExpired",value:function(){new wo("kickedOut").setNetworkType(this.getNetworkType()).setMessage(b.KICKED_OUT_USERSIG_EXPIRED).end(!0),Le.w("".concat(this._n,".onUserSigExpired: userSig expired")),0!==this.getModule(12).getStatusInstanceID()&&(this.emitOuterEvent(A.KICKED_OUT,{type:b.KICKED_OUT_USERSIG_EXPIRED}),this._m.setNotReadyReason(ho.KICKED_OUT_USERSIG_EXPIRED),this._m.reset())}},{key:"onRestApiKickedOut",value:function(e){new wo("kickedOut").setNetworkType(this.getNetworkType()).setMessage("type:".concat(b.KICKED_OUT_REST_API," newInstanceInfo:").concat(JSON.stringify(e))).end(!0),Le.w("".concat(this._n,".onRestApiKickedOut userID:").concat(this.getMyUserID()," newInstanceInfo:"),e),0!==this.getModule(12).getStatusInstanceID()&&(this.emitOuterEvent(A.KICKED_OUT,{type:b.KICKED_OUT_REST_API}),this._m.setNotReadyReason(ho.KICKED_OUT_REST_API),this._m.reset(),this.getModule(21).onRestApiKickedOut())}},{key:"reset",value:function(){Le.l("".concat(this._n,".reset")),this.resetReady(),this._helloInterval=120,this._lastLoginTs=0,this._lastWsHelloTs=0,this._isWebUniapp=0}}]),n}(yn);function xs(){return null}var Fs=function(){function e(t){r(this,e),this._m=t,this._n="StorageModule",this._storageQueue=new Map,this._errorTolerantHandle()}return u(e,[{key:"_errorTolerantHandle",value:function(){W||!Ye(window)&&this._canIUseCookies()||(this.getItem=xs,this.setItem=xs,this.removeItem=xs,this.clear=xs)}},{key:"onCheckTimer",value:function(e){if(e%20==0){if(0===this._storageQueue.size)return;this._doFlush()}}},{key:"_doFlush",value:function(){try{var e,t=w(this._storageQueue);try{for(t.s();!(e=t.n()).done;){var n=I(e.value,2),i=n[0],o=n[1];this._setStorageSync(this._getKey(i),o)}}catch(u){t.e(u)}finally{t.f()}this._storageQueue.clear()}catch(l){Le.w("".concat(this._n,"._doFlush error:"),l)}}},{key:"_getPrefix",value:function(){var e=this._m.getModule(12);return"TIM_".concat(e.getSDKAppID(),"_").concat(e.getUserID(),"_")}},{key:"_getKey",value:function(e){return"".concat(this._getPrefix()).concat(e)}},{key:"getItem",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];try{var n=t?this._getKey(e):e;return this.getStorageSync(n)}catch(r){return Le.w("".concat(this._n,".getItem error:"),r),{}}}},{key:"setItem",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];if(n){var o=i?this._getKey(e):e;this._setStorageSync(o,t)}else this._storageQueue.set(e,t)}},{key:"clear",value:function(){try{W?X.clearStorageSync():this._canIUseCookies()&&localStorage.clear()}catch(e){Le.w("".concat(this._n,".clear error:"),e)}}},{key:"removeItem",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];try{var n=t?this._getKey(e):e;this._removeStorageSync(n)}catch(r){Le.w("".concat(this._n,".removeItem error:"),r)}}},{key:"getSize",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"b";try{var i={size:0,limitSize:5242880,unit:n};if(Object.defineProperty(i,"leftSize",{enumerable:!0,get:function(){return i.limitSize-i.size}}),W&&(i.limitSize=1024*X.getStorageInfoSync().limitSize),e)i.size=JSON.stringify(this.getItem(e)).length+this._getKey(e).length;else if(W){var o=X.getStorageInfoSync(),s=o.keys;s.forEach((function(e){i.size+=JSON.stringify(t.getStorageSync(e)).length+t._getKey(e).length}))}else if(this._canIUseCookies())for(var r in localStorage)localStorage.hasOwnProperty(r)&&(i.size+=localStorage.getItem(r).length+r.length);return this._convertUnit(i)}catch(d){Le.w("".concat(this._n," error:"),d)}}},{key:"_convertUnit",value:function(e){var t={},n=e.unit;for(var i in t.unit=n,e)"number"==typeof e[i]&&("kb"===n.toLowerCase()?t[i]=Math.round(e[i]/1024):"mb"===n.toLowerCase()?t[i]=Math.round(e[i]/1024/1024):t[i]=e[i]);return t}},{key:"_setStorageSync",value:function(e,t){W?K?my.setStorageSync({key:e,data:t}):X.setStorageSync(e,t):this._canIUseCookies()&&localStorage.setItem(e,JSON.stringify(t))}},{key:"getStorageSync",value:function(e){return W?K?my.getStorageSync({key:e}).data:X.getStorageSync(e):this._canIUseCookies()?JSON.parse(localStorage.getItem(e)):{}}},{key:"_removeStorageSync",value:function(e){W?K?my.removeStorageSync({key:e}):X.removeStorageSync(e):this._canIUseCookies()&&localStorage.removeItem(e)}},{key:"_canIUseCookies",value:function(){return navigator&&navigator.cookieEnabled&&localStorage}},{key:"reset",value:function(){Le.l("".concat(this._n,".reset")),this._doFlush()}}]),e}(),qs=function(){function e(t){r(this,e),this._n="SSOLogBody",this._report=[]}return u(e,[{key:"pushIn",value:function(e){Le.d("".concat(this._n,".pushIn"),this._report.length,e),this._report.push(e)}},{key:"backfill",value:function(e){var t;ze(e)&&0!==e.length&&(Le.d("".concat(this._n,".backfill"),this._report.length,e.length),(t=this._report).unshift.apply(t,C(e)))}},{key:"getLogsNumInMemory",value:function(){return this._report.length}},{key:"isEmpty",value:function(){return 0===this._report.length}},{key:"_reset",value:function(){this._report.length=0,this._report=[]}},{key:"getLogsInMemory",value:function(){var e=this._report.slice();return this._reset(),e}}]),e}(),Bs=function(e){var t=e.getModule(12);return{SDKType:10,SDKAppID:t.getSDKAppID(),SDKVersion:t.getVersion(),tinyID:Number(t.getTinyID()),userID:t.getUserID(),platform:e.getPlatform(),instanceID:t.getInstanceID(),traceID:Se()}},$s=function(e){d(i,e);var n=M(i);function i(e){var t;r(this,i),(t=n.call(this,e))._n="EventStatModule",t.TAG="im-ssolog-event",t._reportBody=new qs,t.MIN_THRESHOLD=20,t.MAX_THRESHOLD=100,t.WAITING_TIME=6e4,t.REPORT_LEVEL=[4,5,6],t.REPORT_SDKAPPID_BLACKLIST=[],t.REPORT_TINYID_WHITELIST=[],t._lastReportTime=Date.now();var o=t.getInnerEmitterInstance();return o.on(Zo,t._onLoginSuccess,m(t)),o.on(Qo,t._onCloudConfigUpdated,m(t)),t}return u(i,[{key:"reportAtOnce",value:function(){Le.d("".concat(this._n,".reportAtOnce")),this._report()}},{key:"_onLoginSuccess",value:function(){var e=this,t=this.getModule(13),n=t.getItem(this.TAG,!1);!Gt(n)&&Je(n.forEach)&&(Le.l("".concat(this._n,"._onLoginSuccess get ssolog in storage, count:").concat(n.length)),n.forEach((function(t){e._reportBody.pushIn(t)})),t.removeItem(this.TAG,!1))}},{key:"_onCloudConfigUpdated",value:function(){var e=this.getCloudConfig("evt_rpt_threshold"),t=this.getCloudConfig("evt_rpt_waiting"),n=this.getCloudConfig("evt_rpt_level"),i=this.getCloudConfig("evt_rpt_sdkappid_bl"),o=this.getCloudConfig("evt_rpt_tinyid_wl");Ye(e)||(this.MIN_THRESHOLD=Number(e)),Ye(t)||(this.WAITING_TIME=Number(t)),Ye(n)||(this.REPORT_LEVEL=n.split(",").map((function(e){return Number(e)}))),Ye(i)||(this.REPORT_SDKAPPID_BLACKLIST=i.split(",").map((function(e){return Number(e)}))),Ye(o)||(this.REPORT_TINYID_WHITELIST=o.split(","))}},{key:"pushIn",value:function(e){e instanceof wo&&(e.updateTimeStamp(),this._reportBody.pushIn(e),this._reportBody.getLogsNumInMemory()>=this.MIN_THRESHOLD&&this._report())}},{key:"onCheckTimer",value:function(){Date.now()<this._lastReportTime+this.WAITING_TIME||this._reportBody.isEmpty()||this._report()}},{key:"_filterLogs",value:function(e){var t=this,n=this.getModule(12),i=n.getSDKAppID(),o=n.getTinyID();return Dt(this.REPORT_SDKAPPID_BLACKLIST,i)&&!wt(this.REPORT_TINYID_WHITELIST,o)?[]:e.filter((function(e){return t.REPORT_LEVEL.includes(e.level)}))}},{key:"_report",value:function(){var e=this;if(!this._reportBody.isEmpty()){var n=this._reportBody.getLogsInMemory(),i=this._filterLogs(n);if(0!==i.length){var o={header:Bs(this),event:i};this.request({protocolName:zi,requestData:t({},o)}).then((function(){e._lastReportTime=Date.now()})).catch((function(t){Le.w("".concat(e._n,".report failed. networkType:").concat(e.getNetworkType()," error:"),t),e._reportBody.backfill(n),e._reportBody.getLogsNumInMemory()>e.MAX_THRESHOLD&&e._flushAtOnce()}))}else this._lastReportTime=Date.now()}}},{key:"_flushAtOnce",value:function(){var e=this.getModule(13),t=e.getItem(this.TAG,!1),n=this._reportBody.getLogsInMemory(),i="".concat(this._n,"._flushAtOnce");if(Gt(t))Le.l("".concat(i," count:").concat(n.length)),e.setItem(this.TAG,n,!0,!1);else{var o=n.concat(t);o.length>this.MAX_THRESHOLD&&(o=o.slice(0,this.MAX_THRESHOLD)),Le.l("".concat(i," count:").concat(o.length)),e.setItem(this.TAG,o,!0,!1)}}},{key:"reset",value:function(){Le.l("".concat(this._n,".reset")),this._lastReportTime=0,this._report(),this.REPORT_SDKAPPID_BLACKLIST=[],this.REPORT_TINYID_WHITELIST=[]}}]),i}(yn),Vs="none",Hs="online",Ks=[ho.OVER_FREQUENCY_LIMIT,ho.OPEN_SERVICE_OVERLOAD_ERROR],js=function(){function e(t){r(this,e),this._m=t,this._networkType="",this._n="NetMonitorModule",this.MAX_WAIT_TIME=3e3,this._mpNetworkStatusCallback=null,this._webOnlineCallback=null,this._webOfflineCallback=null}return u(e,[{key:"start",value:function(){var e=this;W?(X.getNetworkType({success:function(t){e._networkType=t.networkType||t.subtype||"",t.networkType===Vs?Le.w("".concat(e._n,".start no network, please check!")):Le.i("".concat(e._n,".start networkType:").concat(t.networkType))}}),this._mpNetworkStatusCallback=this._onNetworkStatusChange.bind(this),X.onNetworkStatusChange(this._mpNetworkStatusCallback)):(this._networkType=Hs,this._webOnlineCallback=this._onWebOnline.bind(this),this._webOfflineCallback=this._onWebOffline.bind(this),window&&(window.addEventListener("online",this._webOnlineCallback),window.addEventListener("offline",this._webOfflineCallback)))}},{key:"_onWebOnline",value:function(){this._onNetworkStatusChange({isConnected:!0,networkType:Hs})}},{key:"_onWebOffline",value:function(){this._onNetworkStatusChange({isConnected:!1,networkType:Vs})}},{key:"_onNetworkStatusChange",value:function(e){var t=e.isConnected,n=e.networkType,i="".concat(this._n,"._onNetworkStatusChange"),o=!1;t?(Le.i("".concat(i," previous:").concat(this._networkType," current:").concat(n)),this._networkType!==n&&(o=!0,this._m.getModule(21).reConnect(!0))):this._networkType!==n&&(o=!0,Le.w("".concat(i," no network, please check!")),this._m.getModule(21).offline()),o&&(new wo("networkChange").setMessage("isConnected:".concat(t," previousNetworkType:").concat(this._networkType," networkType:").concat(n)).end(),this._networkType=n)}},{key:"probe",value:function(e){var t=this;if(!Ye(e)&&Ks.includes(e.code))return Promise.resolve([!0,this._networkType]);var n="".concat(this._n,".probe");return new Promise((function(e,i){W?X.getNetworkType({success:function(i){t._networkType=i.networkType,i.networkType===Vs?(Le.w("".concat(n," no network, please check!")),e([!1,i.networkType])):(Le.i("".concat(n," networkType:").concat(i.networkType)),e([!0,i.networkType]))}}):t._networkType===Vs?e([!1,Vs]):e([!0,Hs])}))}},{key:"getNetworkType",value:function(){return this._networkType}},{key:"reset",value:function(){Le.l("".concat(this._n,".reset")),W?null!==this._mpNetworkStatusCallback&&(X.offNetworkStatusChange&&(z||V?X.offNetworkStatusChange(this._mpNetworkStatusCallback):X.offNetworkStatusChange()),this._mpNetworkStatusCallback=null):window&&(null!==this._webOnlineCallback&&(window.removeEventListener("online",this._webOnlineCallback),this._webOnlineCallback=null),null!==this._onWebOffline&&(window.removeEventListener("offline",this._webOfflineCallback),this._webOfflineCallback=null))}}]),e}(),zs=function(e,t){return function(e){var t=Object.prototype.hasOwnProperty,n="~";function i(){}function o(e,t,n){this.fn=e,this.context=t,this.once=n||!1}function s(e,t,i,s,r){if("function"!=typeof i)throw new TypeError("The listener must be a function");var a=new o(i,s||e,r),c=n?n+t:t;return e._events[c]?e._events[c].fn?e._events[c]=[e._events[c],a]:e._events[c].push(a):(e._events[c]=a,e._eventsCount++),e}function r(e,t){0==--e._eventsCount?e._events=new i:delete e._events[t]}function a(){this._events=new i,this._eventsCount=0}Object.create&&(i.prototype=Object.create(null),(new i).__proto__||(n=!1)),a.prototype.eventNames=function(){var e,i,o=[];if(0===this._eventsCount)return o;for(i in e=this._events)t.call(e,i)&&o.push(n?i.slice(1):i);return Object.getOwnPropertySymbols?o.concat(Object.getOwnPropertySymbols(e)):o},a.prototype.listeners=function(e){var t=n?n+e:e,i=this._events[t];if(!i)return[];if(i.fn)return[i.fn];for(var o=0,s=i.length,r=new Array(s);o<s;o++)r[o]=i[o].fn;return r},a.prototype.listenerCount=function(e){var t=n?n+e:e,i=this._events[t];return i?i.fn?1:i.length:0},a.prototype.emit=function(e,t,i,o,s,r){var a=n?n+e:e;if(!this._events[a])return!1;var c,u,l=this._events[a],d=arguments.length;if(l.fn){switch(l.once&&this.removeListener(e,l.fn,void 0,!0),d){case 1:return l.fn.call(l.context),!0;case 2:return l.fn.call(l.context,t),!0;case 3:return l.fn.call(l.context,t,i),!0;case 4:return l.fn.call(l.context,t,i,o),!0;case 5:return l.fn.call(l.context,t,i,o,s),!0;case 6:return l.fn.call(l.context,t,i,o,s,r),!0}for(u=1,c=new Array(d-1);u<d;u++)c[u-1]=arguments[u];l.fn.apply(l.context,c)}else{var p,h=l.length;for(u=0;u<h;u++)switch(l[u].once&&this.removeListener(e,l[u].fn,void 0,!0),d){case 1:l[u].fn.call(l[u].context);break;case 2:l[u].fn.call(l[u].context,t);break;case 3:l[u].fn.call(l[u].context,t,i);break;case 4:l[u].fn.call(l[u].context,t,i,o);break;default:if(!c)for(p=1,c=new Array(d-1);p<d;p++)c[p-1]=arguments[p];l[u].fn.apply(l[u].context,c)}}return!0},a.prototype.on=function(e,t,n){return s(this,e,t,n,!1)},a.prototype.once=function(e,t,n){return s(this,e,t,n,!0)},a.prototype.removeListener=function(e,t,i,o){var s=n?n+e:e;if(!this._events[s])return this;if(!t)return r(this,s),this;var a=this._events[s];if(a.fn)a.fn!==t||o&&!a.once||i&&a.context!==i||r(this,s);else{for(var c=0,u=[],l=a.length;c<l;c++)(a[c].fn!==t||o&&!a[c].once||i&&a[c].context!==i)&&u.push(a[c]);u.length?this._events[s]=1===u.length?u[0]:u:r(this,s)}return this},a.prototype.removeAllListeners=function(e){var t;return e?(t=n?n+e:e,this._events[t]&&r(this,t)):(this._events=new i,this._eventsCount=0),this},a.prototype.off=a.prototype.removeListener,a.prototype.addListener=a.prototype.on,a.prefixed=n,a.EventEmitter=a,e.exports=a}(t={exports:{}}),t.exports}(),Ys=function(e){d(n,e);var t=M(n);function n(e){var i;return r(this,n),(i=t.call(this,e))._n="BigDataChannelModule",i.FILETYPE={SOUND:2106,FILE:2107,VIDEO:2113},i._bdh_download_server="grouptalk.c2c.qq.com",i._BDHBizID=10001,i._authKey="",i._expireTime=0,i.getInnerEmitterInstance().on(Zo,i._getAuthKey,m(i)),i}return u(n,[{key:"_getAuthKey",value:function(){var e=this;this.isIntl()||this.request({protocolName:Tn}).then((function(t){t.data.authKey&&(e._authKey=t.data.authKey,e._expireTime=parseInt(t.data.expireTime))}))}},{key:"_isFromOlderVersion",value:function(e){return!(!e.content||2===e.content.downloadFlag)}},{key:"parseElements",value:function(e,t){if(!ze(e)||!t)return[];for(var n=[],i=null,o=0;o<e.length;o++)i=e[o],this._needParse(i)?n.push(this._parseElement(i,t)):n.push(e[o]);return n}},{key:"_needParse",value:function(e){return!e.cloudCustomData&&!(!this._isFromOlderVersion(e)||e.type!==b.MSG_AUDIO&&e.type!==b.MSG_FILE&&e.type!==b.MSG_VIDEO)}},{key:"_parseElement",value:function(e,t){switch(e.type){case b.MSG_AUDIO:return this._parseAudioElement(e,t);case b.MSG_FILE:return this._parseFileElement(e,t);case b.MSG_VIDEO:return this._parseVideoElement(e,t)}}},{key:"_parseAudioElement",value:function(e,t){return e.content.url=this._genAudioUrl(e.content.uuid,t),e}},{key:"_parseFileElement",value:function(e,t){return e.content.url=this._genFileUrl(e.content.uuid,t,e.content.fileName),e}},{key:"_parseVideoElement",value:function(e,t){return e.content.url=this._genVideoUrl(e.content.uuid,t),e}},{key:"_genAudioUrl",value:function(e,t){if(""===this._authKey)return"";var n=this.getModule(12).getSDKAppID();return"https://".concat(this._bdh_download_server,"/asn.com/stddownload_common_file?authkey=").concat(this._authKey,"&bid=").concat(this._BDHBizID,"&subbid=").concat(n,"&fileid=").concat(e,"&filetype=").concat(this.FILETYPE.SOUND,"&openid=").concat(t,"&ver=0")}},{key:"_genFileUrl",value:function(e,t,n){if(""===this._authKey)return"";n||(n="".concat(Math.floor(1e5*Math.random()),"-").concat(Date.now()));var i=this.getModule(12).getSDKAppID();return"https://".concat(this._bdh_download_server,"/asn.com/stddownload_common_file?authkey=").concat(this._authKey,"&bid=").concat(this._BDHBizID,"&subbid=").concat(i,"&fileid=").concat(e,"&filetype=").concat(this.FILETYPE.FILE,"&openid=").concat(t,"&ver=0&filename=").concat(encodeURIComponent(n))}},{key:"_genVideoUrl",value:function(e,t){if(""===this._authKey)return"";var n=this.getModule(12).getSDKAppID();return"https://".concat(this._bdh_download_server,"/asn.com/stddownload_common_file?authkey=").concat(this._authKey,"&bid=").concat(this._BDHBizID,"&subbid=").concat(n,"&fileid=").concat(e,"&filetype=").concat(this.FILETYPE.VIDEO,"&openid=").concat(t,"&ver=0")}},{key:"reset",value:function(){this._authKey="",this.expireTime=0}}]),n}(yn),Ws=["requestSnapshotUrl"],Js=function(e){d(i,e);var n=M(i);function i(e){var t;r(this,i),(t=n.call(this,e))._n="UploadModule",t.TIMUploadPlugin=null,t.timUploadPlugin=null,t.COSSDK=null,t._cosUploadMethod=null,t.expiredTimeLimit=600,t.appid=0,t.bucketName="",t.ciUrl="",t.directory="",t.downloadUrl="",t.uploadUrl="",t.region="ap-shanghai",t.cos=null,t.cosOptions={secretId:"",secretKey:"",sessionToken:"",expiredTime:0},t.uploadFileType="",t.duration=900,t.tryCount=0,t.UPLOAD_SIZE_LIMIT={AUDIO:20971520,FILE:104857600,IMAGE:20971520,VIDEO:104857600};var o=t.getInnerEmitterInstance();return o.on(Zo,t._init,m(t)),o.on(Qo,t._onCloudConfigUpdated,m(t)),t}return u(i,[{key:"_init",value:function(){var e=this.getModule(18);if(this.TIMUploadPlugin=e.getPlugin("tim-upload-plugin"),this.TIMUploadPlugin)this._initUploaderMethod();else{var t=W?"cos-wx-sdk":"cos-js-sdk";this.COSSDK=e.getPlugin(t),this.COSSDK?(this._getAuthorizationKey(),this.outputWarning("CosReplacement",t)):this.outputWarning("PluginUndetected")}}},{key:"_onCloudConfigUpdated",value:function(){var e="".concat(this._n,"._onCloudConfigUpdated"),t=this.getCloudConfig("upload_size_limit");if(Le.l("".concat(e," uploadSizeLimit:").concat(t)),!Ye(t))try{var n=JSON.parse(t);this.UPLOAD_SIZE_LIMIT={AUDIO:n.a?1048576*parseInt(n.a):this.UPLOAD_SIZE_LIMIT.AUDIO,FILE:n.f?1048576*parseInt(n.f):this.UPLOAD_SIZE_LIMIT.FILE,IMAGE:n.i?1048576*parseInt(n.i):this.UPLOAD_SIZE_LIMIT.IMAGE,VIDEO:n.v?1048576*parseInt(n.v):this.UPLOAD_SIZE_LIMIT.VIDEO}}catch(r){Le.e("".concat(e," JSON parse error. uploadSizeLimit:"),t)}}},{key:"_getAuthorizationKey",value:function(){var e=this,t="".concat(this._n,".").concat("_getAuthorizationKey"),n=new wo("_getAuthorizationKey"),i=Math.ceil(Date.now()/1e3);this.request({protocolName:"cos",requestData:{duration:this.expiredTimeLimit}}).then((function(o){var s=o.data;Le.l("".concat(t," ok. data:"),s);var r=s.expiredTime-i;n.setMessage("requestId:".concat(s.requestId," requestTime:").concat(i," expiredTime:").concat(s.expiredTime," diff:").concat(r,"s")).setNetworkType(e.getNetworkType()).end(),!W&&s.region&&(e.region=s.region),e.appid=s.appid,e.bucketName=s.bucketName,e.ciUrl=s.ciUrl,e.directory=s.directory,e.downloadUrl=s.downloadUrl,e.uploadUrl=s.uploadUrl,e.cosOptions={secretId:s.secretId,secretKey:s.secretKey,sessionToken:s.sessionToken,expiredTime:s.expiredTime},Le.l("".concat(t," ok. region:").concat(e.region," bucketName:").concat(e.bucketName)),e._initUploaderMethod()})).catch((function(i){e.probeNetwork().then((function(e){var t=I(e,2),o=t[0],s=t[1];n.setError(i,o,s).end()})),Le.w("".concat(t," failed. error:"),i)}))}},{key:"_getCosPreSigUrl",value:function(e){var t=this,n="".concat(this._n,".").concat("_getCosPreSigUrl"),i=Math.ceil(Date.now()/1e3),o=new wo("_getCosPreSigUrl");return this.request({protocolName:Ki,requestData:{fileType:e.fileType,fileName:e.fileName,uploadMethod:e.uploadMethod,duration:e.duration}}).then((function(e){t.tryCount=0;var s=e.data||{},r=s.expiredTime-i;return Le.l("".concat(n," ok. data:"),s),o.setMessage("requestId:".concat(s.requestId," expiredTime:").concat(s.expiredTime," diff:").concat(r,"s")).setNetworkType(t.getNetworkType()).end(),s})).catch((function(i){return-1===i.code&&(i.code=ho.COS_GET_SIG_FAIL),t.probeNetwork().then((function(e){var t=I(e,2),n=t[0],s=t[1];o.setError(i,n,s).end()})),Le.w("".concat(n," failed. error:"),i),t.tryCount<1?(t.tryCount++,t._getCosPreSigUrl(e)):(t.tryCount=0,Wo({code:ho.COS_GET_SIG_FAIL}))}))}},{key:"_initUploaderMethod",value:function(){var e=this;if(this.TIMUploadPlugin)return this.timUploadPlugin=new this.TIMUploadPlugin,void(this._cosUploadMethod=function(t,n){e.timUploadPlugin.uploadFile(t,n)});this.appid&&(this.cos=W?new this.COSSDK({ForcePathStyle:!0,getAuthorization:this._getAuthorization.bind(this)}):new this.COSSDK({getAuthorization:this._getAuthorization.bind(this)}),this._cosUploadMethod=W?function(t,n){e.cos.postObject(t,n)}:function(t,n){e.cos.uploadFiles(t,n)})}},{key:"onCheckTimer",value:function(e){this.COSSDK&&(this.TIMUploadPlugin||this.isLoggedIn()&&e%60==0&&Math.ceil(Date.now()/1e3)>=this.cosOptions.expiredTime-120&&this._getAuthorizationKey())}},{key:"_getAuthorization",value:function(e,t){t({TmpSecretId:this.cosOptions.secretId,TmpSecretKey:this.cosOptions.secretKey,XCosSecurityToken:this.cosOptions.sessionToken,ExpiredTime:this.cosOptions.expiredTime})}},{key:"upload",value:function(e){if(!0===e.getRelayFlag())return Promise.resolve();var t=this.getModule(26);switch(e.type){case b.MSG_IMAGE:return t.addTotalCount(Mo),this._uploadImage(e);case b.MSG_FILE:return t.addTotalCount(Mo),this._uploadFile(e);case b.MSG_AUDIO:return t.addTotalCount(Mo),this._uploadAudio(e);case b.MSG_VIDEO:return t.addTotalCount(Mo),this._uploadVideo(e);default:return Promise.resolve()}}},{key:"_uploadImage",value:function(e){var n=this,i=this.getModule(2),o=e.getElements()[0],s=i.getMessageOption(e.clientSequence);return this.doUploadImage({file:s.payload.file,to:s.to,onProgress:function(e){if(o.updatePercent(e),Je(s.onProgress))try{s.onProgress(e)}catch(t){return Wo({code:ho.MESSAGE_ONPROGRESS_FUNCTION_ERROR})}}}).then((function(i){var s,r,a=i.location,c=i.fileType,u=i.fileSize,l=i.width,d=i.height,p=i.smallImageUrl,h=i.smallImageWidth,f=i.smallImageHeight,g=i.largeImageUrl,_=i.largeImageWidth,v=i.largeImageHeight,m=n.isPrivateNetWork()?a:ut(a);return o.updateImageFormat(c),p&&g?(s={url:p,width:h,height:f},r={url:g,width:_,height:v}):(s=Tt({originUrl:m,originWidth:l,originHeight:d,min:198}),r=Tt({originUrl:m,originWidth:l,originHeight:d,min:720})),o.updateImageInfoArray([{size:u,url:m,width:l,height:d},t({},r),t({},s)]),e}))}},{key:"_uploadFile",value:function(e){var t=this,n=this.getModule(2),i=e.getElements()[0],o=n.getMessageOption(e.clientSequence);return this.doUploadFile({file:o.payload.file,to:o.to,onProgress:function(e){if(i.updatePercent(e),Je(o.onProgress))try{o.onProgress(e)}catch(t){return Wo({code:ho.MESSAGE_ONPROGRESS_FUNCTION_ERROR})}}}).then((function(n){var o=n.location,s=t.isPrivateNetWork()?o:ut(o);return i.updateFileUrl(s),e}))}},{key:"_uploadAudio",value:function(e){var t=this,n=this.getModule(2),i=e.getElements()[0],o=n.getMessageOption(e.clientSequence);return this.doUploadAudio({file:o.payload.file,to:o.to,onProgress:function(e){if(i.updatePercent(e),Je(o.onProgress))try{o.onProgress(e)}catch(t){return Wo({code:ho.MESSAGE_ONPROGRESS_FUNCTION_ERROR})}}}).then((function(n){var o=n.location,s=t.isPrivateNetWork()?o:ut(o);return i.updateAudioUrl(s),e}))}},{key:"_uploadVideo",value:function(e){var t=this,n=this.getModule(2),i=e.getElements()[0],o=n.getMessageOption(e.clientSequence);return this.doUploadVideo({file:o.payload.file,to:o.to,onProgress:function(e){if(i.updatePercent(e),Je(o.onProgress))try{o.onProgress(e)}catch(t){return Wo({code:ho.MESSAGE_ONPROGRESS_FUNCTION_ERROR})}}}).then((function(n){var o=n.location,s=n.snapshotInfo,r=t.isPrivateNetWork()?o:ut(o);return i.updateVideoUrl(r),Gt(s)||i.updateSnapshotInfo(s),e}))}},{key:"_checkSizeError",value:function(e){return Wo({code:ho["MESSAGE_".concat(e,"_SIZE_LIMIT")],message:this.getErrorMessage("UploadSizeLimit",e.toLowerCase(),"".concat(this.UPLOAD_SIZE_LIMIT[e]/1048576," MB"))})}},{key:"doUploadImage",value:function(e){var t=this;if(!e.file)return Wo({code:ho.MESSAGE_IMAGE_SELECT_FILE_FIRST});var n=this._checkImageType(e.file);if(!0!==n)return n;var i=this._checkImageSize(e.file);if(!0!==i)return i;var o=null;return this._setUploadFileType(1),this.uploadByCOS(e).then((function(e){return o=e,t.isPrivateNetWork()?yt(e.location):yt("https://".concat(e.location))})).then((function(e){return o.width=e.width,o.height=e.height,Promise.resolve(o)}))}},{key:"_checkImageType",value:function(e){var t="";return t=W?e.url.slice(e.url.lastIndexOf(".")+1):e.files[0].name.slice(e.files[0].name.lastIndexOf(".")+1),ns.indexOf(t.toLowerCase())>=0||Wo({code:ho.MESSAGE_IMAGE_TYPES_LIMIT})}},{key:"_checkImageSize",value:function(e){var t;return 0===(t=W?e.size:e.files[0].size)?Wo({code:ho.MESSAGE_FILE_IS_EMPTY}):t<this.UPLOAD_SIZE_LIMIT.IMAGE||this._checkSizeError("IMAGE")}},{key:"doUploadFile",value:function(e){return e.file?e.file.files[0].size>this.UPLOAD_SIZE_LIMIT.FILE?this._checkSizeError("FILE"):0===e.file.files[0].size?Wo({code:ho.MESSAGE_FILE_IS_EMPTY}):(this._setUploadFileType(255),this.uploadByCOS(e)):Wo({code:ho.MESSAGE_FILE_SELECT_FILE_FIRST})}},{key:"doUploadVideo",value:function(e){return e.file.videoFile.size>this.UPLOAD_SIZE_LIMIT.VIDEO?this._checkSizeError("VIDEO"):0===e.file.videoFile.size?Wo({code:ho.MESSAGE_FILE_IS_EMPTY}):-1===is.indexOf(e.file.videoFile.type)?Wo({code:ho.MESSAGE_VIDEO_TYPES_LIMIT}):(this._setUploadFileType(2),W?this.handleVideoUpload({file:e.file.videoFile,onProgress:e.onProgress}):J?this.handleVideoUpload(e):void 0)}},{key:"handleVideoUpload",value:function(e){var t=this;return new Promise((function(n,i){t.uploadByCOS(e).then((function(e){n(e)})).catch((function(){t.uploadByCOS(e).then((function(e){n(e)})).catch((function(){i(new jo({code:ho.MESSAGE_VIDEO_UPLOAD_FAIL}))}))}))}))}},{key:"doUploadAudio",value:function(e){return e.file?e.file.size>this.UPLOAD_SIZE_LIMIT.AUDIO?this._checkSizeError("AUDIO"):0===e.file.size?Wo({code:ho.MESSAGE_FILE_IS_EMPTY}):(this._setUploadFileType(3),this.uploadByCOS(e)):Wo({code:ho.MESSAGE_AUDIO_UPLOAD_FAIL})}},{key:"uploadByCOS",value:function(e){var t=this;if(!Je(this._cosUploadMethod))return this.outputWarning("PluginUndetected"),Wo({code:ho.COS_UNDETECTED});if(this.timUploadPlugin)return this._uploadWithPreSigUrl(e);var n=new wo("upload"),i="".concat(this._n,".uploadByCOS"),o=Date.now(),s=this._getFile(e);return new Promise((function(r,a){var c=W?t._createCosOptionsWXMiniApp(e):t._createCosOptionsWeb(e),u=t;t._cosUploadMethod(c,(function(e,c){var l=Object.create(null);if(c){if(e||ze(c.files)&&c.files[0].error){var d=new jo({code:ho.MESSAGE_FILE_UPLOAD_FAIL});return n.setError(d,!0,t.getNetworkType()).end(),Le.l("".concat(i," failed. error:"),c.files[0].error),403===c.files[0].error.statusCode&&(Le.w("".concat(i," failed. cos AccessKeyId was invalid, regain auth key!")),t._getAuthorizationKey()),void a(d)}l.fileName=s.name,l.fileSize=s.size,l.fileType=s.type.slice(s.type.indexOf("/")+1).toLowerCase(),l.location=W?c.Location:c.files[0].data.Location;var p=Date.now()-o,h=u._formatFileSize(s.size),f=u._formatSpeed(1e3*s.size/p),g="size:".concat(h," time:").concat(p,"ms speed:").concat(f);Le.l("".concat(i," success. name:").concat(s.name," ").concat(g)),r(l);var _=t.getModule(26);return _.addCost(Mo,p),_.addFileSize(Mo,s.size),void n.setNetworkType(t.getNetworkType()).setMessage(g).end()}var v=new jo({code:ho.MESSAGE_FILE_UPLOAD_FAIL});n.setError(v,!0,u.getNetworkType()).end(),Le.w("".concat(i," failed. error:"),e),403===e.statusCode&&(Le.w("".concat(i," failed. cos AccessKeyId was invalid, regain auth key!")),t._getAuthorizationKey()),a(v)}))}))}},{key:"_uploadWithPreSigUrl",value:function(e){var t=this,n="".concat(this._n,"._uploadWithPreSigUrl"),i=this._getFile(e);return this._createCosOptionsPreSigUrl(e).then((function(e){return new Promise((function(o,s){var r=new wo("upload"),a=e.requestSnapshotUrl,c=void 0===a?void 0:a,u=v(e,Ws),l=Date.now();t._cosUploadMethod(u,(function(e,a){if(e||403===a.statusCode)return r.setError(new jo(e),!0,t.getNetworkType()).end(),Le.l("".concat(n," failed, error:"),e),void s(new jo({code:ho.MESSAGE_FILE_UPLOAD_FAIL}));var d=Object.create(null),p=a.data.location||"";t.isPrivateNetWork()||0!==p.indexOf("https://")&&0!==p.indexOf("http://")||(p=p.split("//")[1]),d.fileName=i.name,d.fileSize=i.size,d.fileType=i.type.slice(i.type.indexOf("/")+1).toLowerCase(),d.location=p;var h=Date.now()-l,f=t._formatFileSize(i.size),g=t._formatSpeed(1e3*i.size/h),_="size:".concat(f,",time:").concat(h,"ms,speed:").concat(g," res:").concat(JSON.stringify(a.data));Le.l("".concat(n," success name:").concat(i.name,",").concat(_)),r.setNetworkType(t.getNetworkType()).setMessage(_).end();var v=t.getModule(26);v.addCost(Mo,h),v.addFileSize(Mo,i.size);var m=[];if(u.thumbUrl&&u.largeUrl&&(m=[t._getSmallImageInfoByUrl(u.thumbUrl,d),t._getLargeImageInfoByUrl(u.largeUrl,d)]),c&&m.push(t._getSnapshotInfoByUrl(c,d)),m.length>0)return Promise.all(m).then((function(){o(d)}));o(d)}))}))}))}},{key:"_getRawOrUploadProxyUrl",value:function(e){var t=this.getModule(12).getFileUploadProxy(),n=e;return t&&(n=e.replace(/^https:\/\/[^/]+/,t)),n}},{key:"_getFile",value:function(e){var t;return ze(e.file.files)||(t=e.file.files,"filelist"===Ze(t))?e.file.files[0]:e.file}},{key:"_formatFileSize",value:function(e){return e<1024?e+"B":e<1048576?Math.floor(e/1024)+"KB":Math.floor(e/1048576)+"MB"}},{key:"_formatSpeed",value:function(e){return e<=1048576?Et(e/1024,1)+"KB/s":Et(e/1048576,1)+"MB/s"}},{key:"_createCosOptionsWeb",value:function(e){var t=this._getFile(e),n=t.name,i=n.slice(n.lastIndexOf(".")),o=this._genFileName("".concat(ot(999999)).concat(i));return{files:[{Bucket:"".concat(this.bucketName,"-").concat(this.appid),Region:this.region,Key:"".concat(this.directory,"/").concat(o),Body:t}],SliceSize:1048576,onProgress:function(t){if("function"==typeof e.onProgress)try{e.onProgress(t.percent)}catch(n){Le.w("onProgress callback error:",n)}},onFileFinish:function(e,t,n){}}}},{key:"_createCosOptionsWXMiniApp",value:function(e){var t=this._getFile(e),n=this._genFileName(t.name),i=t.url;return{Bucket:"".concat(this.bucketName,"-").concat(this.appid),Region:this.region,Key:"".concat(this.directory,"/").concat(n),FilePath:i,onProgress:function(t){if(Le.l(JSON.stringify(t)),"function"==typeof e.onProgress)try{e.onProgress(t.percent)}catch(n){Le.w("onProgress callback error:",n)}}}}},{key:"_createCosOptionsPreSigUrl",value:function(e){var t=this,n="",i="",o=0,s=this._getFile(e);if(W)n=this._genFileName(s.name),i=s.url,o=1;else{var r=s.name,a=r.slice(r.lastIndexOf("."));n=this._genFileName("".concat(ot(999999)).concat(a)),i=s,o=0}return this._getCosPreSigUrl({fileType:this.uploadFileType,fileName:n,uploadMethod:o,duration:this.duration}).then((function(o){var s=o.uploadUrl,r=o.downloadUrl,a=o.requestSnapshotUrl,c=void 0===a?void 0:a,u=o.thumbUrl,l=o.largeUrl;return{url:t._getRawOrUploadProxyUrl(s),fileType:t.uploadFileType,fileName:n,resources:i,downloadUrl:r,requestSnapshotUrl:c,thumbUrl:u,largeUrl:l,onProgress:function(t){if("function"==typeof e.onProgress)try{e.onProgress(t.percent)}catch(n){Le.w("onProgress callback error:",n),Le.e(n)}}}}))}},{key:"_genFileName",value:function(e){return"".concat(Mt(),"-").concat(e)}},{key:"_setUploadFileType",value:function(e){this.uploadFileType=e}},{key:"_getSnapshotInfoByUrl",value:function(e,t){var n=this,i=new wo("getSnapshotInfo");return this.request({protocolName:ji,requestData:{platform:this.getPlatform(),coverName:this._genFileName(ot(99999)),requestSnapshotUrl:e}}).then((function(e){var n=(e.data||{}).snapshotUrl;return i.setMessage("snapshotUrl:".concat(n)).end(),Gt(n)?{}:yt(n).then((function(e){t.snapshotInfo={snapshotUrl:n,snapshotWidth:e.width,snapshotHeight:e.height}}))})).catch((function(e){return Le.w("".concat(n._n,"._getSnapshotInfoByUrl failed. error:"),e),i.setCode(e.errorCode).setMessage(e.errorInfo).end(),{}}))}},{key:"_getSmallImageInfoByUrl",value:function(e,t){return yt(e).then((function(n){t.smallImageUrl=e,t.smallImageWidth=n.width,t.smallImageHeight=n.height}))}},{key:"_getLargeImageInfoByUrl",value:function(e,t){return yt(e).then((function(n){t.largeImageUrl=e,t.largeImageWidth=n.width,t.largeImageHeight=n.height}))}},{key:"reset",value:function(){Le.l("".concat(this._n,".reset"))}}]),i}(yn),Xs=["downloadKey","pbDownloadKey","messageList"],Zs=function(){function e(t){r(this,e),this._n="MergerMessageHandler",this._messageModule=t}return u(e,[{key:"uploadMergerMessage",value:function(e,t){var n=this,i="".concat(this._n,".").concat("uploadMergerMessage");Le.d("".concat(i," message:"),e,"messageBytes:".concat(t));var o=e.payload.messageList,s=o.length,r=new wo("uploadMergerMessage");return this._messageModule.request({protocolName:Wi,requestData:{messageList:o}}).then((function(e){Le.d("".concat(i," ok. response:"),e.data);var o=e.data,a=o.pbDownloadKey,c=o.downloadKey,u={pbDownloadKey:a,downloadKey:c,messageNumber:s};return r.setNetworkType(n._messageModule.getNetworkType()).setMessage("".concat(s,"-").concat(t,"-").concat(c)).end(),u})).catch((function(e){throw Le.w("".concat(i," failed. error:"),e),n._messageModule.probeNetwork().then((function(t){var n=I(t,2),i=n[0],o=n[1];r.setError(e,i,o).end()})),e}))}},{key:"downloadMergerMessage",value:function(e){var n=this,i="".concat(this._n,".").concat("downloadMergerMessage");Le.d("".concat(i," message:"),e);var o=e.payload.downloadKey,s=this._messageModule.getFileDownloadProxy(),r=new wo("downloadMergerMessage");return r.setMessage("downloadKey:".concat(o)),this._messageModule.request({protocolName:Ji,requestData:{downloadKey:o}}).then((function(o){if(Le.d("".concat(i," ok. response:"),o.data),Je(e.clearElement)){var a=e.payload;a.downloadKey,a.pbDownloadKey,a.messageList;var c=v(a,Xs);e.clearElement(),e.setElement({type:e.type,content:t({messageList:o.data.messageList},c)},s)}else{var u=[];o.data.messageList.forEach((function(e){if(!Gt(e)){var t=new Bo(e,s);u.push(t)}})),e.payload.messageList=u,e.payload.downloadKey="",e.payload.pbDownloadKey=""}return r.setNetworkType(n._messageModule.getNetworkType()).end(),e})).catch((function(e){throw Le.w("".concat(i," failed. key:").concat(o," error:"),e),n._messageModule.probeNetwork().then((function(t){var n=I(t,2),i=n[0],o=n[1];r.setError(e,i,o).end()})),e}))}},{key:"createMergerMessagePack",value:function(e,t,n){return e.conversationType===b.CONV_C2C?this._createC2CMergerMessagePack(e,t,n):this._createGroupMergerMessagePack(e,t,n)}},{key:"_createC2CMergerMessagePack",value:function(e,t,n){var i=null;t&&(t.offlinePushInfo&&(i=t.offlinePushInfo),!0===t.onlineUserOnly&&(i?i.disablePush=!0:i={disablePush:!0}));var o=[];if(je(t)&&je(t.messageControlInfo)){var s=t.messageControlInfo,r=s.excludedFromUnreadCount,a=s.excludedFromLastMessage,c=s.excludedFromContentModeration;!0===r&&o.push("NoUnread"),!0===a&&o.push("NoLastMsg"),!0===c&&o.push("NoMsgCheck")}var u="";He(e.cloudCustomData)&&e.cloudCustomData.length>0&&(u=e.cloudCustomData);var l=n.pbDownloadKey,d=n.downloadKey,p=n.messageNumber,h=e.payload,f=h.title,g=h.abstractList,_=h.compatibleText,v=this._messageModule.getModule(6),m=v&&v.isOnlineMessage(e,t)?0:void 0;return{protocolName:kn,tjgID:this._messageModule.generateTjgID(e),requestData:{fromAccount:this._messageModule.getMyUserID(),toAccount:e.to,msgBody:[{msgType:e.type,msgContent:{pbDownloadKey:l,downloadKey:d,title:f,abstractList:g,compatibleText:_,messageNumber:p}}],cloudCustomData:u,clientTime:e.clientTime,msgSeq:e.sequence,msgRandom:e.random,msgLifeTime:m,offlinePushInfo:i?{pushFlag:!0===i.disablePush?1:0,title:i.title||"",desc:i.description||"",ext:i.extension||"",apnsInfo:{badgeMode:!0===i.ignoreIOSBadge?1:0},androidInfo:{OPPOChannelID:i.androidOPPOChannelID||""}}:void 0,messageControlInfo:0!==m?o:void 0,isSupportExtension:!0===e.isSupportExtension?1:0}}}},{key:"_createGroupMergerMessagePack",value:function(e,t,n){var i=null;t&&t.offlinePushInfo&&(i=t.offlinePushInfo);var o=[];if(je(t)&&je(t.messageControlInfo)){var s=t.messageControlInfo,r=s.excludedFromUnreadCount,a=s.excludedFromLastMessage,c=s.excludedFromContentModeration;!0===r&&o.push("NoUnread"),!0===a&&o.push("NoLastMsg"),!0===c&&o.push("NoMsgCheck")}var u="";He(e.cloudCustomData)&&e.cloudCustomData.length>0&&(u=e.cloudCustomData);var l=n.pbDownloadKey,d=n.downloadKey,p=n.messageNumber,h=e.payload,f=h.title,g=h.abstractList,_=h.compatibleText,v=this._messageModule.getModule(7),m=v&&v.isOnlineMessage(e,t)?1:0;return{protocolName:Sn,tjgID:this._messageModule.generateTjgID(e),requestData:{fromAccount:this._messageModule.getMyUserID(),groupID:e.to,msgBody:[{msgType:e.type,msgContent:{pbDownloadKey:l,downloadKey:d,title:f,abstractList:g,compatibleText:_,messageNumber:p}}],random:e.random,priority:e.priority,clientSequence:e.clientSequence,groupAtInfo:void 0,cloudCustomData:u,onlineOnlyFlag:m,offlinePushInfo:i?{pushFlag:!0===i.disablePush?1:0,title:i.title||"",desc:i.description||"",ext:i.extension||"",apnsInfo:{badgeMode:!0===i.ignoreIOSBadge?1:0},androidInfo:{OPPOChannelID:i.androidOPPOChannelID||""}}:void 0,clientTime:e.clientTime,needReadReceipt:!0!==e.needReadReceipt||v.isMessageFromOrToAVChatroom(e.to)?0:1,messageControlInfo:0===m?o:void 0,isSupportExtension:!0===e.isSupportExtension?1:0}}}}]),e}(),Qs={ERR_SVR_COMM_SENSITIVE_TEXT:80001,ERR_SVR_COMM_BODY_SIZE_LIMIT:80002,OPEN_SERVICE_OVERLOAD_ERROR:60022,ERR_SVR_MSG_PKG_PARSE_FAILED:20001,ERR_SVR_MSG_INTERNAL_AUTH_FAILED:20002,ERR_SVR_MSG_INVALID_ID:20003,ERR_SVR_MSG_PUSH_DENY:20006,ERR_SVR_MSG_IN_PEER_BLACKLIST:20007,ERR_SVR_MSG_BOTH_NOT_FRIEND:20009,ERR_SVR_MSG_NOT_PEER_FRIEND:20010,ERR_SVR_MSG_NOT_SELF_FRIEND:20011,ERR_SVR_MSG_SHUTUP_DENY:20012,ERR_SVR_GROUP_INVALID_PARAMETERS:10004,ERR_SVR_GROUP_PERMISSION_DENY:10007,ERR_SVR_GROUP_NOT_FOUND:10010,ERR_SVR_GROUP_INVALID_GROUPID:10015,ERR_SVR_GROUP_REJECT_FROM_THIRDPARTY:10016,ERR_SVR_GROUP_SHUTUP_DENY:10017,MESSAGE_SEND_FAIL:2100,OVER_FREQUENCY_LIMIT:2996},er=[ho.MESSAGE_ONPROGRESS_FUNCTION_ERROR,ho.MESSAGE_IMAGE_SELECT_FILE_FIRST,ho.MESSAGE_IMAGE_TYPES_LIMIT,ho.MESSAGE_FILE_IS_EMPTY,ho.MESSAGE_IMAGE_SIZE_LIMIT,ho.MESSAGE_FILE_SELECT_FILE_FIRST,ho.MESSAGE_FILE_SIZE_LIMIT,ho.MESSAGE_VIDEO_SIZE_LIMIT,ho.MESSAGE_VIDEO_TYPES_LIMIT,ho.MESSAGE_AUDIO_UPLOAD_FAIL,ho.MESSAGE_AUDIO_SIZE_LIMIT,ho.COS_UNDETECTED];function tr(e){var t=!1;return Object.values(Qs).includes(e)&&(t=!0),(e>=120001&&e<=13e4||e>=10100&&e<=10200)&&(t=!0),t}var nr=function(e){d(i,e);var n=M(i);function i(e){var t;return r(this,i),(t=n.call(this,e))._n="MessageModule",t._messageOptionsMap=new Map,t._mergerMessageHandler=new Zs(m(t)),t}return u(i,[{key:"createTextMessage",value:function(e){var t=this.getMyUserID();e.currentUser=t,e.senderTinyID=this.getMyTinyID();var n=new Ho(e),i="string"==typeof e.payload?e.payload:e.payload.text,o=new Ao({text:i}),s=this._getNickAndAvatarByUserID(t);return n.setElement(o),n.setNickAndAvatar(s),n.setNameCard(this._getNameCardByGroupID(n)),n}},{key:"createImageMessage",value:function(e){var t=this.getMyUserID();e.currentUser=t,e.senderTinyID=this.getMyTinyID();var n=new Ho(e);if(W){var i=e.payload.file;if($e(i))return void this.outputWarning("FileUnsupportedInMP","createImageMessage");var o=i.tempFiles[0].path||i.tempFiles[0].tempFilePath,s={url:o,name:o.slice(o.lastIndexOf("/")+1),size:i.tempFiles&&i.tempFiles[0].size||1,type:o.slice(o.lastIndexOf(".")+1).toLowerCase()};e.payload.file=s}else if(J)if($e(e.payload.file)){var r=e.payload.file;e.payload.file={files:[r]}}else if(je(e.payload.file)&&"undefined"!=typeof uni){var a=e.payload.file.tempFiles[0];e.payload.file={files:[a]}}var c=new bo({imageFormat:Re.UNKNOWN,uuid:this._generateUUID(e.payload.file),file:e.payload.file}),u=this._getNickAndAvatarByUserID(t);return n.setElement(c),n.setNickAndAvatar(u),n.setNameCard(this._getNameCardByGroupID(n)),this._messageOptionsMap.set(n.clientSequence,e),n}},{key:"createAudioMessage",value:function(e){var t=e.payload.file;if(W){var n={url:t.tempFilePath,name:t.tempFilePath.slice(t.tempFilePath.lastIndexOf("/")+1),size:t.fileSize,second:parseInt(t.duration)/1e3,type:t.tempFilePath.slice(t.tempFilePath.lastIndexOf(".")+1).toLowerCase()};e.payload.file=n}var i=this.getMyUserID();e.currentUser=i,e.senderTinyID=this.getMyTinyID();var o=new Ho(e),s=new Ro({second:Math.floor(t.duration/1e3),size:t.fileSize||t.size,url:t.tempFilePath,uuid:this._generateUUID(e.payload.file)}),r=this._getNickAndAvatarByUserID(i);return o.setElement(s),o.setNickAndAvatar(r),o.setNameCard(this._getNameCardByGroupID(o)),this._messageOptionsMap.set(o.clientSequence,e),o}},{key:"createVideoMessage",value:function(e){var t=this.getMyUserID();e.currentUser=t,e.senderTinyID=this.getMyTinyID(),e.payload.file.thumbUrl="",e.payload.file.thumbSize=0;var n={};if(W){if(K)return void this.outputWarning("VideoUnsupportedInAlipay");if($e(e.payload.file))return void this.outputWarning("FileUnsupportedInMP","createVideoMessage");var i=e.payload.file;ze(i.tempFiles)&&(i=i.tempFiles[0]),n.url=i.tempFilePath,n.name=i.tempFilePath.slice(i.tempFilePath.lastIndexOf("/")+1),n.size=i.size||1,n.second=i.duration||0,n.type=i.tempFilePath.slice(i.tempFilePath.lastIndexOf(".")+1).toLowerCase()}else if(J){if($e(e.payload.file)){var o=e.payload.file;e.payload.file.files=[o]}else if(je(e.payload.file)&&"undefined"!=typeof uni){var s=e.payload.file.tempFile;e.payload.file.files=[s]}var r=e.payload.file;n.url=window.URL.createObjectURL(r.files[0]),n.name=r.files[0].name,n.size=r.files[0].size||1,n.second=r.files[0].duration||0,n.type=r.files[0].type.split("/")[1]}e.payload.file.videoFile=n;var a=new Ho(e),c=new Fo({videoFormat:n.type,videoSecond:Et(n.second,0),videoSize:n.size,remoteVideoUrl:"",videoUrl:n.url,videoUUID:this._generateUUID(e.payload.file.videoFile),thumbUUID:this._generateUUID(e.payload.file.videoFile),thumbWidth:e.payload.file.width||200,thumbHeight:e.payload.file.height||200,thumbUrl:e.payload.file.thumbUrl,thumbSize:e.payload.file.thumbSize,thumbFormat:e.payload.file.thumbUrl.slice(e.payload.file.thumbUrl.lastIndexOf(".")+1).toLowerCase()}),u=this._getNickAndAvatarByUserID(t);return a.setElement(c),a.setNickAndAvatar(u),a.setNameCard(this._getNameCardByGroupID(a)),this._messageOptionsMap.set(a.clientSequence,e),a}},{key:"createCustomMessage",value:function(e){var t=this.getMyUserID();e.currentUser=t,e.senderTinyID=this.getMyTinyID();var n=new Ho(e),i=new xo({data:e.payload.data,description:e.payload.description,extension:e.payload.extension}),o=this._getNickAndAvatarByUserID(t);return n.setElement(i),n.setNickAndAvatar(o),n.setNameCard(this._getNameCardByGroupID(n)),n}},{key:"createFaceMessage",value:function(e){var t=this.getMyUserID();e.currentUser=t,e.senderTinyID=this.getMyTinyID();var n=new Ho(e),i=new Lo(e.payload),o=this._getNickAndAvatarByUserID(t);return n.setElement(i),n.setNickAndAvatar(o),n.setNameCard(this._getNameCardByGroupID(n)),n}},{key:"createMergerMessage",value:function(e){var t=this.getMyUserID();e.currentUser=t,e.senderTinyID=this.getMyTinyID();var n=this._getNickAndAvatarByUserID(t),i=new Ho(e),o=new $o(e.payload);return i.setElement(o),i.setNickAndAvatar(n),i.setNameCard(this._getNameCardByGroupID(i)),i.setRelayFlag(!0),i}},{key:"createForwardMessage",value:function(e){var t=e.to,n=e.conversationType,i=e.priority,o=e.payload,s=e.needReadReceipt,r=e.receiverList,a=this.getMyUserID(),c=this._getNickAndAvatarByUserID(a);if(o.type===b.MSG_GRP_TIP)return Wo({code:ho.MESSAGE_FORWARD_TYPE_INVALID});var u={to:t,conversationType:n,conversationID:"".concat(n).concat(t),priority:i,isPlaceMessage:0,status:Bt.UNSEND,currentUser:a,senderTinyID:this.getMyTinyID(),cloudCustomData:e.cloudCustomData||o.cloudCustomData||"",needReadReceipt:s,receiverList:r,isSupportExtension:e.isSupportExtension||!1},l=new Ho(u);return l.setElement(o.getElements()[0]),l.setNickAndAvatar(c),l.setNameCard(this._getNameCardByGroupID(o)),l.setRelayFlag(!0),l}},{key:"downloadMergerMessage",value:function(e){return this._mergerMessageHandler.downloadMergerMessage(e)}},{key:"createFileMessage",value:function(e){if(W){if(!B&&!$&&!z)return;var n=X.getSystemInfoSync().SDKVersion;if(B&&Ct(n,"2.5.0")<0)return void this.outputWarning("WXChooseMessageFile");if($&&Ct(n,"1.18.0")<0)return void this.outputWarning("QQChooseMessageFile")}if(J||z){if($e(e.payload.file)){var i=e.payload.file;e.payload.file={files:[i]}}else if(je(e.payload.file)&&"undefined"!=typeof uni){var o=e.payload.file,s=o.tempFiles,r=o.files,a=null;ze(s)?a=s[0]:ze(r)&&(a=r[0]),e.payload.file={files:[a]}}}else if(B||$){var c=e.payload.file.tempFiles,u=t(t({},c[0]),{},{url:c[0].path});e.payload.file={files:[u]}}var l=this.getMyUserID();e.currentUser=l,e.senderTinyID=this.getMyTinyID();var d=new Ho(e),p=new Go({uuid:this._generateUUID(e.payload.file),file:e.payload.file}),h=this._getNickAndAvatarByUserID(l);return d.setElement(p),d.setNickAndAvatar(h),d.setNameCard(this._getNameCardByGroupID(d)),this._messageOptionsMap.set(d.clientSequence,e),d}},{key:"createLocationMessage",value:function(e){var t=this.getMyUserID();e.currentUser=t,e.senderTinyID=this.getMyTinyID();var n=new Ho(e),i=new qo(e.payload),o=this._getNickAndAvatarByUserID(t);return n.setElement(i),n.setNickAndAvatar(o),n.setNameCard(this._getNameCardByGroupID(n)),n}},{key:"_onCannotFindModule",value:function(){return Wo({code:ho.CANNOT_FIND_MODULE})}},{key:"sendMessageInstance",value:function(e,t){var n=this;if(!1===this.getModule(29).filterMessage(e,t))return this._onSendMessageFailed(e,new jo({code:ho.PROFANITY_FOUND}));var i,o=null;switch(e.conversationType){case b.CONV_C2C:if(!(o=this.getModule(6)))return this._onCannotFindModule();break;case b.CONV_GROUP:if(!(o=this.getModule(7)))return this._onCannotFindModule();if(ht({groupID:e.to})){var s=o.getLocalGroupProfile(e.to);if(s&&s.isSupportTopic)return Wo({code:ho.MESSAGE_SEND_GROUP_WITH_TOPIC_FAIL})}break;default:return Wo({code:ho.MESSAGE_SEND_INVALID_CONVERSATION_TYPE})}var r=this.getModule(17),a=this.getModule(7);return r.upload(e).then((function(){return n._getSendMessageSpecifiedKey(e)===yo&&n.getModule(26).addSuccessCount(Mo),a.guardForAVChatRoom(e).then((function(){if(!e.isSendable())return Wo({code:ho.MESSAGE_FILE_URL_IS_EMPTY});n._addSendMessageTotalCount(e),i=Date.now();var s=function(e){var t="utf-8";J&&document&&(t=document.charset.toLowerCase());var n,i,o=0;if(i=e.length,"utf-8"===t||"utf8"===t)for(var s=0;s<i;s++)(n=e.codePointAt(s))<=127?o+=1:n<=2047?o+=2:n<=65535?o+=3:(o+=4,s++);else if("utf-16"===t||"utf16"===t)for(var r=0;r<i;r++)(n=e.codePointAt(r))<=65535?o+=2:(o+=4,r++);else o=e.replace(/[^\x00-\xff]/g,"aa").length;return o}(JSON.stringify(e));return e.type===b.MSG_MERGER&&s>11264?n._mergerMessageHandler.uploadMergerMessage(e,s).then((function(i){var o=n._mergerMessageHandler.createMergerMessagePack(e,t,i);return n.request(o)})):(n.getModule(11).setMessageRandom(e),e.conversationType===b.CONV_C2C||e.conversationType===b.CONV_GROUP?o.sendMessage(e,t):void 0)})).then((function(s){var r=s.data,a=r.time,c=r.sequence,u=r.readReceiptCode;Ve(u)&&0!==u&&(new wo("sendMessageWithReceipt").setMessage("from:".concat(e.from," to:").concat(e.to," sequence:").concat(c," readReceiptCode:").concat(u)).end(),Le.w("".concat(n._n,".sendMessageInstance readReceiptCode:").concat(u," message:").concat(n.getErrorMessage(u)))),n._addSendMessageSuccessCount(e,i),n._messageOptionsMap.delete(e.clientSequence);var l=n.getModule(11);e.status=Bt.SUCCESS,e.time=a;var d=!1;if(e.conversationType===b.CONV_GROUP)e.sequence=c;else if(e.conversationType===b.CONV_C2C){var p=l.getLatestMessageSentByMe(e.conversationID);if(p){var h=p.nick,f=p.avatar;h===e.nick&&f===e.avatar||(d=!0)}}if(d&&l.modifyMessageSentByMe({conversationID:e.conversationID,latestNick:e.nick,latestAvatar:e.avatar}),o.isOnlineMessage(e,t))e._onlineOnlyFlag=!0;else{l.appendToMessageList(e);var g=e;je(t)&&je(t.messageControlInfo)&&(!0===t.messageControlInfo.excludedFromLastMessage&&(e._isExcludedFromLastMessage=!0,g=""),!0===t.messageControlInfo.excludedFromUnreadCount&&(e._isExcludedFromUnreadCount=!0));var _=e.conversationType;ft(e.to)&&(_=b.CONV_TOPIC,n.getModule(10).onMessageSent({groupID:At(e.to),topicID:e.to,lastMessage:g})),l.onMessageSent({conversationOptionsList:[{conversationID:e.conversationID,unreadCount:0,type:_,subType:e.conversationSubType,lastMessage:g}]})}return e.getRelayFlag()||"TIMImageElem"!==e.type||kt(e.payload.imageInfoArray),Ko({message:e})}))})).catch((function(t){return n._onSendMessageFailed(e,t)}))}},{key:"_onSendMessageFailed",value:function(e,t){e.status=Bt.FAIL,this.getModule(11).deleteMessageRandom(e),this._addSendMessageFailCountOnUser(e,t);var n=new wo("sendMessage");return n.setMessage("tjg_id:".concat(this.generateTjgID(e)," type:").concat(e.type," from:").concat(e.from," to:").concat(e.to)),this.probeNetwork().then((function(e){var i=I(e,2),o=i[0],s=i[1];n.setError(t,o,s).end()})),Le.e("".concat(this._n,"._onSendMessageFailed error:"),t),Wo(new jo({code:t&&t.code?t.code:ho.MESSAGE_SEND_FAIL,message:t&&t.message?t.message:void 0,data:{message:e}}))}},{key:"_getSendMessageSpecifiedKey",value:function(e){if([b.MSG_IMAGE,b.MSG_AUDIO,b.MSG_VIDEO,b.MSG_FILE].includes(e.type))return yo;if(e.conversationType===b.CONV_C2C)return _o;if(e.conversationType===b.CONV_GROUP){var t=this.getModule(7).getLocalGroupProfile(e.to);if(!t)return;var n=t.type;return pt(n)?mo:vo}}},{key:"_addSendMessageTotalCount",value:function(e){var t=this._getSendMessageSpecifiedKey(e);t&&this.getModule(26).addTotalCount(t)}},{key:"_addSendMessageSuccessCount",value:function(e,t){var n=Math.abs(Date.now()-t),i=this._getSendMessageSpecifiedKey(e);if(i){var o=this.getModule(26);o.addSuccessCount(i),o.addCost(i,n)}}},{key:"_addSendMessageFailCountOnUser",value:function(e,t){var n,i,o=t.code,s=void 0===o?-1:o,r=this.getModule(26),a=this._getSendMessageSpecifiedKey(e);a===yo&&(n=s,i=!1,er.includes(n)&&(i=!0),i)?r.addFailedCountOfUserSide(Mo):tr(s)&&a&&r.addFailedCountOfUserSide(a)}},{key:"resendMessage",value:function(e){return e.isResend=!0,e.status=Bt.UNSEND,this.sendMessageInstance(e)}},{key:"revokeMessage",value:function(e){var t=this,n=null;if(e.conversationType===b.CONV_C2C?n=this.getModule(6):e.conversationType===b.CONV_GROUP&&(n=this.getModule(7)),!n)return this._onCannotFindModule();var i=new wo("revokeMessage");i.setMessage("tjg_id:".concat(this.generateTjgID(e)," type:").concat(e.type," from:").concat(e.from," to:").concat(e.to));var o="".concat(this._n,".").concat("revokeMessage");return n.revokeMessage(e).then((function(n){var s=n.data.recallRetList;if(!Gt(s)&&0!==s[0].retCode){var r=new jo({code:s[0].retCode,data:{message:e}});return i.setCode(r.code).setMoreMessage(r.message).end(),Wo(r)}return Le.i("".concat(o," ok. ID:").concat(e.ID)),e.isRevoked=!0,i.end(),t.getModule(11).onMessageRevoked([e]),Ko({message:e})})).catch((function(n){t.probeNetwork().then((function(e){var t=I(e,2),o=t[0],s=t[1];i.setError(n,o,s).end()}));var s=new jo({code:n&&n.code?n.code:ho.MESSAGE_REVOKE_FAIL,message:n&&n.message?n.message:void 0,data:{message:e}});return Le.w("".concat(o," failed. error:"),n),Wo(s)}))}},{key:"deleteMessage",value:function(e){var t=this,n=null,i=e[0],o=i.conversationID,s="",r=[],a=[];if(i.conversationType===b.CONV_C2C)n=this.getModule(6),s=o.replace(b.CONV_C2C,""),e.forEach((function(e){e&&e.status===Bt.SUCCESS&&e.conversationID===o&&(e._onlineOnlyFlag||r.push("".concat(e.sequence,"_").concat(e.random,"_").concat(e.time)),a.push(e))}));else if(i.conversationType===b.CONV_GROUP)n=this.getModule(7),s=o.replace(b.CONV_GROUP,""),e.forEach((function(e){e&&e.status===Bt.SUCCESS&&e.conversationID===o&&(e._onlineOnlyFlag||r.push("".concat(e.sequence)),a.push(e))}));else if(i.conversationType===b.CONV_SYSTEM)return Wo({code:ho.CANNOT_DELETE_GROUP_SYSTEM_NOTICE});if(!n)return this._onCannotFindModule();if(0===r.length)return this._onMessageDeleted(a);r.length>30&&(r=r.slice(0,30),a=a.slice(0,30));var c=new wo("deleteMessage");c.setMessage("to:".concat(s," count:").concat(r.length));var u="".concat(this._n,".").concat("deleteMessage");return n.deleteMessage({to:s,keyList:r}).then((function(e){return c.end(),Le.i("".concat(u," ok")),t._onMessageDeleted(a)})).catch((function(e){t.probeNetwork().then((function(t){var n=I(t,2),i=n[0],o=n[1];c.setError(e,i,o).end()})),Le.w("".concat(u," failed. error:"),e);var n=new jo({code:e&&e.code?e.code:ho.MESSAGE_DELETE_FAIL,message:e&&e.message?e.message:void 0});return Wo(n)}))}},{key:"_onMessageDeleted",value:function(e){return this.getModule(11).onMessageDeleted(e),Yo({messageList:e})}},{key:"translateText",value:function(e){var n="".concat(this._n,".").concat("translateText"),i=e.sourceTextList,o=e.sourceLanguage,s=e.targetLanguage,r=new wo("translateText");return r.setMessage("sourceLanguage:".concat(o," targetLanguage:").concat(s)),this.request({protocolName:po,requestData:{sourceTextList:i,source:o||"auto",target:s,from:this.getMyTinyID(),SDKAppID:this.getSDKAppID()}}).then((function(e){var i=e.data,o=i.error,s=i.requestID,a=i.translatedTextList;if(0===o.code)return r.end(),Le.i("".concat(n," ok. requestID:").concat(s)),Ko({translatedTextList:a});throw t(t({},o),{},{requestID:s})})).catch((function(e){return r.setCode(e.code).setMoreMessage(e.requestID).end(),Le.w("".concat(n," failed. error:"),e),Wo({code:ho.TRANSLATE_TEXT_FAIL})}))}},{key:"modifyRemoteMessage",value:function(e){var t=this,n=null,i=e.conversationType,o=e.to;if(this.getModule(7).isMessageFromOrToAVChatroom(o))return Wo({code:ho.MESSAGE_MODIFY_DISABLED_IN_AVCHATROOM,data:{message:e}});if(!1===this.getModule(29).filterMessage(e))return Wo({code:ho.PROFANITY_FOUND,data:{message:e}});i===b.CONV_C2C?n=this.getModule(6):i===b.CONV_GROUP&&(n=this.getModule(7));var s=new wo("modifyMessage");s.setMessage("to:".concat(o));var r="".concat(this._n,".modifyRemoteMessage");return n.modifyRemoteMessage(e).then((function(n){s.end(),Le.i("".concat(r," ok"));var i=t._onModifyRemoteMessageResp(e,n.data);return Ko({message:i})})).catch((function(n){if(s.setCode(n.code).setMoreMessage(n.message).end(),Le.w("".concat(r," failed. error:"),n),20027===n.code){var i=t._onModifyRemoteMessageResp(e,n.data);return Wo({code:ho.MESSAGE_MODIFY_CONFLICT,data:{message:i}})}return Wo({code:n.code,message:n.message,data:{message:e}})}))}},{key:"_onModifyRemoteMessageResp",value:function(e,t){Le.d("".concat(this._n,"._onModifyRemoteMessageResp options:"),t);var n=e.conversationType,i=e.from,o=e.to,s=e.random,r=e.sequence,a=e.time,c=t.elements,u=t.messageVersion,l=t.cloudCustomData,d=void 0===l?"":l;return this.getModule(11).onMessageModified({conversationType:n,from:i,to:o,time:a,random:s,sequence:r,elements:c,cloudCustomData:d,messageVersion:u})}},{key:"_generateUUID",value:function(e){var t=this.getModule(12),n="".concat(t.getSDKAppID(),"-").concat(t.getUserID(),"-").concat(function(){for(var e="",t=32;t>0;--t)e+=st[Math.floor(Math.random()*rt)];return e}()),i=e.name||e.value||e.url||e.tempFilePath,o=i&&i.slice(i.lastIndexOf(".")+1);return o&&(n="".concat(n,".").concat(o)),n}},{key:"getMessageOption",value:function(e){return this._messageOptionsMap.get(e)}},{key:"_getNickAndAvatarByUserID",value:function(e){return this.getModule(4).getNickAndAvatarByUserID(e)}},{key:"_getNameCardByGroupID",value:function(e){if(e.conversationType===b.CONV_GROUP){var t=this.getModule(7);if(t)return t.getMyNameCardByGroupID(e.to)}return""}},{key:"reset",value:function(){Le.l("".concat(this._n,".reset")),this._messageOptionsMap.clear()}}]),i}(yn),ir=function(e){d(n,e);var t=M(n);function n(e){var i;return r(this,n),(i=t.call(this,e))._n="MessageExtensionModule",i.messageExtensionMap=new Map,i.globalSeqMap=new Map,i.getMessageExtensionsMap=new Map,i}return u(n,[{key:"onMessageExtensionNotify",value:function(e){var t=this,n=e.dataList,i=n.messageInfo,o=n.operateType,s=n.operateResultList,r=n.tinyID,a=n.globalSequence,c=i.clientTime,u=i.random,l="".concat(r,"-").concat(c,"-").concat(u),d=[],p=[];Le.l("".concat(this._n,".onMessageExtensionNotify messageID:").concat(l," operateType:").concat(o," globalSequence:").concat(a)),this._updateGlobalSequence(l,a);var h=!1,f=!1;s.forEach((function(e){var n=e.extensions,i=void 0===n?[]:n,s=e.clearSequence;1===o?(h=!0,i.forEach((function(e){d.push({key:e.key,value:e.value})})),t._updateLocalExtension(l,i)):2===o?(f=!0,i.forEach((function(e){p.push(e.key)})),t._updateLocalExtension(l,i)):3===o&&(f=!0,t._hasLocalExtension(l)&&t._getLocalExtension(l).forEach((function(e,t){e.seq<=s&&!Gt(e.value)&&p.push(t)})),t._clearLocalExtension(l,s))})),h&&this.emitOuterEvent(A.MESSAGE_EXTENSIONS_UPDATED,{messageID:l,extensions:d}),f&&this.emitOuterEvent(A.MESSAGE_EXTENSIONS_DELETED,{messageID:l,keyList:p})}},{key:"setMessageExtensions",value:function(e,t){var n=this;if(!this.canIUse(F.MSG_EXT))return Wo({code:ho.CANNOT_USE_COMMERCIAL_ABILITY});var i="".concat(this._n,".").concat("setMessageExtensions"),o=e.ID,s=e.conversationID,r=e.sequence,a=e.time,c=C(t);t.length>20&&(c=t.slice(0,20),Le.w("".concat(i,". the length of extensions cannot exceed 20.")));var u="conversationID:".concat(s," messageID:").concat(o," sequence:").concat(r," time:").concat(a," count:").concat(c.length),l=new wo("setMessageExtensions");return l.setMessage(u),Le.l("".concat(i," ").concat(u)),this._modifyMessageExtensions(e,c).then((function(e){var t=e.resultList,n=e.successCount,o=e.failureCount,s="success count:".concat(n," fail count:").concat(o);return l.setMoreMessage(s).end(),Le.l("".concat(i," ok. ").concat(s)),Ko({extensions:t})})).catch((function(e){return n.probeNetwork().then((function(t){var n=I(t,2),i=n[0],o=n[1];l.setError(e,i,o).end()})),Le.e("".concat(i," failed. error:"),e),Wo(e)}))}},{key:"getMessageExtensions",value:function(e){var t=this;if(!this.canIUse(F.MSG_EXT))return Wo({code:ho.CANNOT_USE_COMMERCIAL_ABILITY});var n="".concat(this._n,".").concat("getMessageExtensions"),i=e.ID,o=e.conversationID,s=e.sequence,r=e.time,a="conversationID:".concat(o," messageID:").concat(i," sequence:").concat(s," time:").concat(r),c=new wo("getMessageExtensions");c.setMessage(a),Le.l("".concat(n," ").concat(a));var u=void 0;return this.getMessageExtensionsMap.has(i)&&(u=this._getGlobalSequence(i)),this._getMessageExtensions(e,u).then((function(e){return c.end(),Le.l("".concat(n," ok. total count:").concat(e.length)),Ye(u)&&e.length>0&&t.getMessageExtensionsMap.set(i,1),Ko({extensions:e})})).catch((function(e){return t.probeNetwork().then((function(t){var n=I(t,2),i=n[0],o=n[1];c.setError(e,i,o).end()})),Le.e("".concat(n," failed. error:"),e),Wo(e)}))}},{key:"deleteMessageExtensions",value:function(e,t){var n=this;if(!this.canIUse(F.MSG_EXT))return Wo({code:ho.CANNOT_USE_COMMERCIAL_ABILITY});var i="".concat(this._n,".").concat("deleteMessageExtensions"),o=[],s=3;Gt(t)||(s=2,t.forEach((function(e){o.push({key:e,value:"",seq:0})})));var r=e.ID,a=e.conversationID,c=e.sequence,u=e.time,l="conversationID:".concat(a," messageID:").concat(r," sequence:").concat(c," time:").concat(u," operateType:").concat(s),d=new wo("deleteMessageExtensions");return d.setMessage(l),Le.l("".concat(i," ").concat(l)),this._modifyMessageExtensions(e,o,s).then((function(e){var t=e.resultList,n=e.successCount,o=e.failureCount,r="";return 2===s&&(r="success count:".concat(n," fail count:").concat(o)),d.setMoreMessage("".concat(r)).end(),Le.l("".concat(i," ok. ").concat(r)),Ko({extensions:t})})).catch((function(e){return n.probeNetwork().then((function(t){var n=I(t,2),i=n[0],o=n[1];d.setError(e,i,o).end()})),Le.e("".concat(i," failed. error:"),e),Wo(e)}))}},{key:"_modifyMessageExtensions",value:function(e,t){var n=this,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,o=ft(e.to)?b.CONV_TOPIC:e.conversationType,s=void 0;3!==i&&(s=this._getRequestExtensions(e,t));var r=null;switch(o){case b.CONV_C2C:r=this.getModule(6);break;case b.CONV_GROUP:r=this.getModule(7);break;case b.CONV_TOPIC:r=this.getModule(10);break;default:return Wo({code:ho.CANNOT_FIND_MODULE})}return r.modifyMessageExtensions(e,s,i).then((function(t){var i=t.data,o=i.extensions,s=i.seq,r=[],a=0,c=0,u=[];return(o=Gt(o)?[]:o).forEach((function(e){var t=e.errorCode,n=e.extension,i=n.key,o=n.value,s=n.seq;r.push({code:t,key:i,value:o}),0===t?a++:c++,u.push({key:i,value:o,seq:s})})),n._updateGlobalSequence(e.ID,s),u.length>0&&(n._updateLocalExtension(e.ID,u),u=null),{resultList:r,successCount:a,failureCount:c}})).catch((function(e){return Wo(e)}))}},{key:"_getRequestExtensions",value:function(e,t){var n=[];if(this._hasLocalExtension(e.ID)){var i=this._getLocalExtension(e.ID);return t.forEach((function(e){var t=e.key,o=e.value,s=0;i.has(t)&&(s=i.get(t).seq),n.push({key:t,value:o,seq:s})})),n}return t.forEach((function(e){var t=e.key,i=e.value;n.push({key:t,value:i,seq:0})})),n}},{key:"_getMessageExtensions",value:function(e,t){var n=this,i="".concat(this._n,"._getMessageExtensions"),o=e.ID,s=e.to,r=null;switch(ft(s)?b.CONV_TOPIC:e.conversationType){case b.CONV_C2C:r=this.getModule(6);break;case b.CONV_GROUP:r=this.getModule(7);break;case b.CONV_TOPIC:r=this.getModule(10);break;default:return Wo({code:ho.CANNOT_FIND_MODULE})}return r.getMessageExtensions(e,t).then((function(t){var s=t.data,r=s.extensions,a=s.completeFlag,c=s.globalSequence,u=s.clearSequence;if(r=Gt(r)?[]:r,Le.l("".concat(i," ok. completeFlag:").concat(a," globalSequence:").concat(c," clearSequence:").concat(u," count:").concat(r.length)),n._updateLocalExtension(o,r),n._clearLocalExtension(o,u),n._updateGlobalSequence(o,c),1!==a){var l=r.slice(-1)[0].seq+1;return n._getMessageExtensions(e,l)}return n._getLocalExtensions(o)})).catch((function(e){return Wo(e)}))}},{key:"_hasLocalExtension",value:function(e){return this.messageExtensionMap.has(e)}},{key:"_getLocalExtension",value:function(e){return this.messageExtensionMap.get(e)}},{key:"_updateLocalExtension",value:function(e,t){this._hasLocalExtension(e)||this.messageExtensionMap.set(e,new Map);var n=this._getLocalExtension(e);t.forEach((function(e){var t=e.key,i=e.value,o=void 0===i?"":i,s=e.seq;n.set(t,{value:o,seq:s})}))}},{key:"_clearLocalExtension",value:function(e,t){if(!(t<=0)&&this._hasLocalExtension(e)){var n=this._getLocalExtension(e);n.forEach((function(e,i){e.seq<=t&&n.delete(i)}))}}},{key:"_getLocalExtensions",value:function(e){var t=[];return this._hasLocalExtension(e)&&this._getLocalExtension(e).forEach((function(e,n){var i=e.value;Gt(i)||t.push({key:n,value:i})})),t}},{key:"_getGlobalSequence",value:function(e){return this.globalSeqMap.get(e)}},{key:"_updateGlobalSequence",value:function(e,t){this.globalSeqMap.set(e,t)}},{key:"reset",value:function(){Le.l("".concat(this._n,".reset")),this.messageExtensionMap.clear(),this.globalSeqMap.clear(),this.getMessageExtensionsMap.clear()}}]),n}(yn),or=function(e){d(n,e);var t=M(n);function n(e){var i;return r(this,n),(i=t.call(this,e))._n="ComboMessageModule",i}return u(n,[{key:"sendMessage",value:function(e){var t=this,n=this._constructMessageInstance(e);if(null===n)return Wo({code:ho.MESSAGE_SEND_FAIL});this._addSendMessageTotalCount(n);var i=Date.now();return this.getModule(11).setMessageRandom(n),this._sendComboMessage(n,e).then((function(e){var o=e.data,s=o.time,r=o.sequence,a=o.readReceiptCode;Ve(a)&&0!==a&&(new wo("sendMessageWithReceipt").setMessage("from:".concat(n.from," to:").concat(n.to," sequence:").concat(r," readReceiptCode:").concat(a)).end(),Le.w("".concat(t._n,".sendMessage readReceiptCode:").concat(a," message:").concat(t.getErrorMessage(a)))),t._addSendMessageSuccessCount(n,i);var c=t.getModule(11);n.status=Bt.SUCCESS,n.time=s,n.conversationType===b.CONV_GROUP&&(n.sequence=r),c.appendToMessageList(n);var u=n;return!0===n._isExcludedFromLastMessage&&(u=""),c.onMessageSent({conversationOptionsList:[{conversationID:n.conversationID,unreadCount:0,type:n.conversationType,subType:n.conversationSubType,lastMessage:u}]}),Ko({message:n})})).catch((function(e){return t._onSendMessageFailed(n,e)}))}},{key:"_sendComboMessage",value:function(e,t){var n=this._m.getModule(20),i="";return e.conversationType===b.CONV_C2C&&(i="".concat(x.NAME.OPEN_IM,".").concat(x.CMD.SEND_MESSAGE)),e.conversationType===b.CONV_GROUP&&(i="".concat(x.NAME.GROUP,".").concat(x.CMD.SEND_GROUP_MESSAGE)),n.sendComboMessage({servcmd:i,data:t})}},{key:"_constructMessageInstance",value:function(e){var t="".concat(this._n,"._constructMessageInstance"),n=null;try{var i=this.getMyUserID(),o={};if(o.senderTinyID=this.getMyTinyID(),o.currentUser=i,o.from=e.From_Account||i,e.GroupId?(o.conversationID="".concat(b.CONV_GROUP).concat(e.GroupId),o.conversationType=b.CONV_GROUP,o.to=e.GroupId):e.To_Account&&(o.conversationID="".concat(b.CONV_C2C).concat(e.To_Account),o.conversationType=b.CONV_C2C,o.to=e.To_Account),o.time=e.MsgTimeStamp||0,o.random=e.Random||e.MsgRandom||0,o.priority=e.MsgPriority,He(e.CloudCustomData)&&e.CloudCustomData.length>0&&(o.cloudCustomData=e.CloudCustomData),ze(e.SendMsgControl)&&(o.messageControlInfo={},e.SendMsgControl.includes("NoUnread")&&(o.messageControlInfo.excludedFromUnreadCount=1),e.SendMsgControl.includes("NoLastMsg")&&(o.messageControlInfo.excludedFromLastMessage=1)),o.conversationType===b.CONV_GROUP&&ze(e.To_Account)&&e.To_Account.length>0){var s=e.To_Account;e.To_Account.length>50&&(s=e.To_Account.slice(0,50),Le.w("".concat(t," To_Account must be less than or equal to 50."))),o.receiverList=C(s),e.To_Account=C(s)}1!==e.IsNeedReadReceipt&&1!==e.NeedReadReceipt||(o.needReadReceipt=!0),1===e.SupportMessageExtension&&(o.isSupportExtension=!0),(n=new Ho(o)).status=Bt.UNSEND,e.MsgClientTime=n.clientTime,n.conversationType===b.CONV_C2C&&(e.MsgSeq=n.sequence);for(var r,a=e.MsgBody.length,c=0;c<a;c++)"TIMTextElem"===(r=e.MsgBody[c]).MsgType?n.setTextElement(r.MsgContent.Text):"TIMCustomElem"===r.MsgType?n.setCustomElement({data:r.MsgContent.Data||"",description:r.MsgContent.Desc||"",extension:r.MsgContent.Ext||""}):"TIMFaceElem"===r.MsgType&&n.setFaceElement({index:r.MsgContent.Index,data:r.MsgContent.Data});var u=n.getElements();n.payload=u[0].content,n.type=u[0].type}catch(f){n=null,Le.e("".concat(t," failed. error:"),f)}return n}},{key:"_onSendMessageFailed",value:function(e,t){e.status=Bt.FAIL,this.getModule(11).deleteMessageRandom(e),this._addSendMessageFailCountOnUser(e,t);var n=new wo("sendMessage");return n.setMessage("tjg_id:".concat(this.generateTjgID(e)," type:").concat(e.type," from:").concat(e.from," to:").concat(e.to)),this.probeNetwork().then((function(e){var i=I(e,2),o=i[0],s=i[1];n.setError(t,o,s).end()})),Le.e("".concat(this._n,"._onSendMessageFailed error:"),t),Wo(new jo({code:t&&t.code?t.code:ho.MESSAGE_SEND_FAIL,message:t&&t.message?t.message:void 0,data:{message:e}}))}},{key:"_getSendMessageSpecifiedKey",value:function(e){if(e.conversationType===b.CONV_C2C)return _o;if(e.conversationType===b.CONV_GROUP){var t=this.getModule(7).getLocalGroupProfile(e.to);if(!t)return;var n=t.type;return pt(n)?mo:vo}}},{key:"_addSendMessageTotalCount",value:function(e){var t=this._getSendMessageSpecifiedKey(e);t&&this.getModule(26).addTotalCount(t)}},{key:"_addSendMessageSuccessCount",value:function(e,t){var n=Math.abs(Date.now()-t),i=this._getSendMessageSpecifiedKey(e);if(i){var o=this.getModule(26);o.addSuccessCount(i),o.addCost(i,n)}}},{key:"_addSendMessageFailCountOnUser",value:function(e,t){var n=t.code,i=void 0===n?-1:n,o=this.getModule(26),s=this._getSendMessageSpecifiedKey(e);tr(i)&&s&&o.addFailedCountOfUserSide(s)}}]),n}(yn),sr=function(e){d(n,e);var t=M(n);function n(e){var i;return r(this,n),(i=t.call(this,e))._n="PluginModule",i.plugins={},i}return u(n,[{key:"registerPlugin",value:function(e){var t=this;Object.keys(e).forEach((function(n){t.plugins[n]=e[n]})),new wo("registerPlugin").setMessage("".concat(Object.keys(e))).end()}},{key:"getPlugin",value:function(e){return this.plugins[e]}},{key:"reset",value:function(){}}]),n}(yn),rr=function(e){d(i,e);var n=M(i);function i(e){var t;return r(this,i),(t=n.call(this,e))._n="SyncUnreadMessageModule",t._cookie="",t._onlineSyncFlag=!1,t.getInnerEmitterInstance().on(Zo,t._onLoginSuccess,m(t)),t}return u(i,[{key:"_onLoginSuccess",value:function(e){this._startSync({cookie:this._cookie,syncFlag:0,isOnlineSync:0})}},{key:"_startSync",value:function(e){var n=this,i=e.cookie,o=e.syncFlag,s=e.isOnlineSync,r="".concat(this._n,"._startSync");Le.l("".concat(r," cookie:").concat(i," syncFlag:").concat(o," isOnlineSync:").concat(s)),this.request({protocolName:"getmsg",requestData:{cookie:i,syncFlag:o,isOnlineSync:s}}).then((function(e){var i=e.data,o=i.cookie,s=i.syncFlag;n._cookie=o,Gt(o)||(0===s||1===s?(n._dispatchUnreadMessage(t(t({},e.data),{},{isSyncingEnded:!1})),n._startSync({cookie:o,syncFlag:s,isOnlineSync:0})):2===s&&n._dispatchUnreadMessage(t(t({},e.data),{},{isSyncingEnded:!0})))})).catch((function(e){Le.e("".concat(r," failed. error:"),e)}))}},{key:"_dispatchUnreadMessage",value:function(e){e.eventArray&&this.getModule(20).onMessage({head:{},body:{eventArray:e.eventArray,isInstantMessage:this._onlineSyncFlag,isSyncingEnded:e.isSyncingEnded}}),this.getModule(6).onNewC2CMessage({dataList:e.messageList,isInstantMessage:!!e.isSyncingEnded&&this._onlineSyncFlag,C2CRemainingUnreadList:e.C2CRemainingUnreadList,C2CPairUnreadList:e.C2CPairUnreadList})}},{key:"startOnlineSync",value:function(){Le.l("".concat(this._n,".startOnlineSync")),this._onlineSyncFlag=!0,this._startSync({cookie:this._cookie,syncFlag:0,isOnlineSync:1})}},{key:"startSyncOnReconnected",value:function(){Le.l("".concat(this._n,".startSyncOnReconnected.")),this._onlineSyncFlag=!0,this._startSync({cookie:this._cookie,syncFlag:0,isOnlineSync:0})}},{key:"reset",value:function(){Le.l("".concat(this._n,".reset")),this._onlineSyncFlag=!1,this._cookie=""}}]),i}(yn),ar={request:{toAccount:"To_Account",fromAccount:"From_Account",to:"To_Account",from:"From_Account",groupID:"GroupId",groupAtUserID:"GroupAt_Account",extension:"Ext",data:"Data",description:"Desc",elements:"MsgBody",sizeType:"Type",downloadFlag:"Download_Flag",thumbUUID:"ThumbUUID",videoUUID:"VideoUUID",remoteAudioUrl:"Url",remoteVideoUrl:"VideoUrl",videoUrl:"",imageUrl:"URL",fileUrl:"Url",uuid:"UUID",priority:"MsgPriority",receiverUserID:"To_Account",receiverGroupID:"GroupId",messageSender:"SenderId",messageReceiver:"ReceiverId",nick:"From_AccountNick",avatar:"From_AccountHeadurl",messageNumber:"MsgNum",pbDownloadKey:"PbMsgKey",downloadKey:"JsonMsgKey",applicationType:"PendencyType",userIDList:"To_Account",groupNameList:"GroupName",userID:"To_Account",groupAttributeList:"GroupAttr",mainSequence:"AttrMainSeq",avChatRoomKey:"BytesKey",attributeControl:"AttrControl",sequence:"seq",messageControlInfo:"SendMsgControl",updateSequence:"UpdateSeq",clientTime:"MsgClientTime",sequenceList:"MsgSeqList",topicID:"TopicId",customData:"CustomString",isSupportTopic:"SupportTopic",isWebUniapp:"is_web_uniapp",isSupportExtension:"SupportMessageExtension",messageSequence:"MsgSeq",messageKey:"MsgKey",startSequence:"startSeq",simplifiedMessage:"DownsizeFlag"},response:{MsgPriority:"priority",ThumbUUID:"thumbUUID",VideoUUID:"videoUUID",Download_Flag:"downloadFlag",GroupId:"groupID",Member_Account:"userID",MsgList:"messageList",SyncFlag:"syncFlag",To_Account:"to",From_Account:"from",MsgSeq:"sequence",MsgRandom:"random",MsgTime:"time",MsgTimeStamp:"time",MsgContent:"content",MsgBody:"elements",From_AccountNick:"nick",From_AccountHeadurl:"avatar",GroupWithdrawInfoArray:"revokedInfos",GroupReadInfoArray:"groupMessageReadNotice",LastReadMsgSeq:"lastMessageSeq",WithdrawC2cMsgNotify:"c2cMessageRevokedNotify",C2cWithdrawInfoArray:"revokedInfos",C2cReadedReceipt:"c2cMessageReadReceipt",ReadC2cMsgNotify:"c2cMessageReadNotice",LastReadTime:"peerReadTime",MsgRand:"random",MsgType:"type",MsgShow:"messageShow",NextMsgSeq:"nextMessageSeq",FaceUrl:"avatar",ProfileDataMod:"profileModify",Profile_Account:"userID",ValueBytes:"value",ValueNum:"value",NoticeSeq:"noticeSequence",NotifySeq:"notifySequence",MsgFrom_AccountExtraInfo:"messageFromAccountExtraInformation",Operator_Account:"operatorID",OpType:"operationType",ReportType:"operationType",UserId:"userID",User_Account:"userID",List_Account:"userIDList",MsgOperatorMemberExtraInfo:"operatorInfo",MsgMemberExtraInfo:"memberInfoList",ImageUrl:"avatar",NickName:"nick",MsgGroupNewInfo:"newGroupProfile",MsgAppDefinedData:"groupCustomField",Owner_Account:"ownerID",GroupFaceUrl:"avatar",GroupIntroduction:"introduction",GroupNotification:"notification",GroupApplyJoinOption:"joinOption",MsgKey:"messageKey",GroupInfo:"groupProfile",ShutupTime:"muteTime",Desc:"description",Ext:"extension",GroupAt_Account:"groupAtUserID",MsgNum:"messageNumber",PbMsgKey:"pbDownloadKey",JsonMsgKey:"downloadKey",MsgModifiedFlag:"isModified",PendencyItem:"applicationItem",PendencyType:"applicationType",AddTime:"time",AddSource:"source",AddWording:"wording",ProfileImImage:"avatar",PendencyAdd:"friendApplicationAdded",FrienPencydDel_Account:"friendApplicationDeletedUserIDList",Peer_Account:"userID",GroupAttr:"groupAttributeList",GroupAttrAry:"groupAttributeList",AttrMainSeq:"mainSequence",seq:"sequence",GroupAttrOption:"groupAttributeOption",BytesChangedKeys:"changedKeyList",GroupAttrInfo:"groupAttributeList",GroupAttrSeq:"mainSequence",PushChangedAttrValFlag:"isWithChangedAttributeInfo",SubKeySeq:"sequence",Val:"value",MsgGroupFromCardName:"senderNameCard",MsgGroupFromNickName:"senderNick",C2cNick:"peerNick",C2cImage:"peerAvatar",SendMsgControl:"messageControlInfo",NoLastMsg:"excludedFromLastMessage",NoUnread:"excludedFromUnreadCount",UpdateSeq:"updateSequence",MuteNotifications:"muteFlag",MsgClientTime:"clientTime",TinyId:"tinyID",GroupMsgReceiptList:"readReceiptList",ReadNum:"readCount",UnreadNum:"unreadCount",TopicId:"topicID",MillionGroupFlag:"communityType",SupportTopic:"isSupportTopic",MsgTopicNewInfo:"newTopicInfo",ShutupAll:"muteAllMembers",CustomString:"customData",TopicFaceUrl:"avatar",TopicIntroduction:"introduction",TopicNotification:"notification",TopicIdArray:"topicIDList",MsgVersion:"messageVersion",C2cMsgModNotifys:"c2cMessageModified",GroupMsgModNotifys:"groupMessageModified",ApplyJoinOption:"joinOption",MsgFlag:"messageRemindType",AtInfoList:"groupAtInfoList",AtFlagList:"groupAtType",AtMsgSeq:"sequence",BanDuration:"duration",BanDescription:"reason",NotVisible:"invisible",BytesTag:"tag",BytesValue:"value",RptBytesValue:"value",LatestSeq:"globalSequence",ClearSeq:"clearSequence",SupportMessageExtension:"isSupportExtension",ExtensionList:"extensions",GroupCounter:"counterList",Revoker_Account:"revoker",MsgExtensionNotify:"messageExtensionNotify",ExtensionC2cMsgInfo:"messageInfo",ExtensionGroupMsgInfo:"messageInfo",MsgOptType:"operateType",SetKVInfo:"operateResultList",DeleteKVInfo:"operateResultList",ClearKVInfo:"operateResultList",MsgKeyValue:"extensions",ClearMsgSeq:"clearSequence",MsgLastSeq:"globalSequence",InviteJoinOption:"inviteOption",MemberList_Account:"inviteeList",MsgMemberExtraInfoList:"inviteeInfoList",E:"event",GInf:"groupProfile",MCT:"clientTime",MR:"random",MP:"priority",MTS:"time",GId:"groupID",MS:"sequence",CCD:"cloudCustomData",F_Account:"from",F_Hd:"avatar",F_NN:"nick",GN:"groupName",GT:"groupType",IsSys:"isSystemMessage",OpInf:"operatorInfo",Img:"avatar",NN:"nick",OnlineInf:"onlineMemberInfo",ET:"expireTime",Num:"onlineMemberNum",Opt:"operationType",O_Account:"operatorID",RT:"operationType",UDF:"userDefinedField",L_Account:"userIDList"},ignoreKeyWord:["C2C","ID","USP"]};function cr(e,t){if("string"!=typeof e&&!Array.isArray(e))throw new TypeError("Expected the input to be `string | string[]`");var n;return t=Object.assign({pascalCase:!1},t),0===(e=Array.isArray(e)?e.map((function(e){return e.trim()})).filter((function(e){return e.length})).join("-"):e.trim()).length?"":1===e.length?t.pascalCase?e.toUpperCase():e.toLowerCase():(e!==e.toLowerCase()&&(e=ur(e)),e=e.replace(/^[_.\- ]+/,"").toLowerCase().replace(/[_.\- ]+(\w|$)/g,(function(e,t){return t.toUpperCase()})).replace(/\d+(\w|$)/g,(function(e){return e.toUpperCase()})),n=e,t.pascalCase?n.charAt(0).toUpperCase()+n.slice(1):n)}var ur=function(e){for(var t=!1,n=!1,i=!1,o=0;o<e.length;o++){var s=e[o];t&&/[a-zA-Z]/.test(s)&&s.toUpperCase()===s?(e=e.slice(0,o)+"-"+e.slice(o),t=!1,i=n,n=!0,o++):n&&i&&/[a-zA-Z]/.test(s)&&s.toLowerCase()===s?(e=e.slice(0,o-1)+"-"+e.slice(o-1),i=n,n=!1,t=!0):(t=s.toLowerCase()===s&&s.toUpperCase()!==s,i=n,n=s.toUpperCase()===s&&s.toLowerCase()!==s)}return e};var lr=String.fromCharCode,dr=function(e){var t=0|e.charCodeAt(0);if(55296<=t)if(t<56320){var n=0|e.charCodeAt(1);if(56320<=n&&n<=57343){if((t=(t<<10)+n-56613888|0)>65535)return lr(240|t>>>18,128|t>>>12&63,128|t>>>6&63,128|63&t)}else t=65533}else t<=57343&&(t=65533);return t<=2047?lr(192|t>>>6,128|63&t):lr(224|t>>>12,128|t>>>6&63,128|63&t)},pr=function(e){for(var t=void 0===e?"":(""+e).replace(/[\x80-\uD7ff\uDC00-\uFFFF]|[\uD800-\uDBFF][\uDC00-\uDFFF]?/g,dr),n=0|t.length,i=new Uint8Array(n),o=0;o<n;o=o+1|0)i[o]=0|t.charCodeAt(o);return i},hr=function(e){for(var t=new Uint8Array(e),n="",i=0,o=t.length;i<o;){var s=t[i],r=0,a=0;if(s<=127?(r=0,a=255&s):s<=223?(r=1,a=31&s):s<=239?(r=2,a=15&s):s<=244&&(r=3,a=7&s),o-i-r>0)for(var c=0;c<r;)a=a<<6|63&(s=t[i+c+1]),c+=1;else a=65533,r=o-i;n+=String.fromCodePoint(a),i+=r+1}return n},fr=function(){function e(t){r(this,e),this._handler=t;var n=t.getURL();if(this._socket=null,this._workerSocket=null,this._id=ot(),this._handler.getIsWorkerEnabled()){var i=URL.createObjectURL(new Blob([';let _socket = null;onmessage = function(event) {  if (event.data.cmd === "start") {    const url = event.data.url;    _socket = new WebSocket(url);    _socket.binaryType = "arraybuffer";    _socket.onopen = function() {      postMessage({ callback: "onOpen" });    };    _socket.onclose = function(e) {      postMessage({ callback: "onOpen", e: { code: e.code, reason: e.reason } });    };    _socket.onmessage = function(e) {      postMessage({ callback: "onMessage", data: e.data });    };    _socket.onerror = function(e) {      postMessage({ callback: "onError", e: { isTrusted: "true" } });    };  } else if (event.data.cmd === "sendMessage") {    if (_socket !== null) {      _socket.send(event.data.data);    }  } else if (event.data.cmd === "stop") {    if (_socket !== null) {      _socket.close(event.data.code);      _socket = null;    }  }};'],{type:"application/javascript; charset=utf-8"}));this._workerSocket=new Worker(i);var o=this;this._workerSocket.onmessage=function(e){var t=e.data,n=t.callback,i=t.e;"onOpen"===n?o._onOpen():"onClose"===n?o._onClose(i):"onError"===n?o._onError(i):"onMessage"===n&&o._onMessage(e.data)},this._workerSocket.postMessage({cmd:"start",id:this._id,url:n})}else W?K?(X.connectSocket({url:n,header:{"content-type":"application/json"}}),X.onSocketClose(this._onClose.bind(this)),X.onSocketOpen(this._onOpen.bind(this)),X.onSocketMessage(this._onMessage.bind(this)),X.onSocketError(this._onError.bind(this))):(this._socket=X.connectSocket({url:n,header:{"content-type":"application/json"},complete:function(){}}),this._socket.onClose(this._onClose.bind(this)),this._socket.onOpen(this._onOpen.bind(this)),this._socket.onMessage(this._onMessage.bind(this)),this._socket.onError(this._onError.bind(this))):J&&(this._socket=new WebSocket(n),this._socket.binaryType="arraybuffer",this._socket.onopen=this._onOpen.bind(this),this._socket.onmessage=this._onMessage.bind(this),this._socket.onclose=this._onClose.bind(this),this._socket.onerror=this._onError.bind(this));this._canIUseBinaryFrame=t.canIUseBinaryFrame()}return u(e,[{key:"getID",value:function(){return this._id}},{key:"_onOpen",value:function(){this._handler.onOpen({id:this._id})}},{key:"_onClose",value:function(e){this._handler.onClose({id:this._id,e:e})}},{key:"_onMessage",value:function(e){this._handler.onMessage({data:this._canIUseBinaryFrame?hr(e.data):e.data})}},{key:"_onError",value:function(e){this._handler.onError({id:this._id,e:e})}},{key:"setIsWorkerEnabled",value:function(e){this._isWorkerEnabled=!0}},{key:"close",value:function(e){if(this._workerSocket&&(this._workerSocket.postMessage({cmd:"stop",code:e}),this._workerSocket.terminate(),this._workerSocket=null),K)return X.offSocketClose(),X.offSocketMessage(),X.offSocketOpen(),X.offSocketError(),void X.closeSocket();this._socket&&(W?(this._socket.onClose((function(){})),this._socket.onOpen((function(){})),this._socket.onMessage((function(){})),this._socket.onError((function(){}))):J&&(this._socket.onopen=null,this._socket.onmessage=null,this._socket.onclose=null,this._socket.onerror=null),H?this._socket.close({code:e}):this._socket.close(e),this._socket=null)}},{key:"send",value:function(e){if(this._workerSocket)this._workerSocket.postMessage({cmd:"sendMessage",data:this._canIUseBinaryFrame?pr(e.data).buffer:e.data});else{if(K)return void X.sendSocketMessage({data:e.data,fail:function(){e.fail&&e.requestID&&e.fail(e.requestID)}});this._socket&&(W?this._socket.send({data:this._canIUseBinaryFrame?pr(e.data).buffer:e.data,fail:function(){e.fail&&e.requestID&&e.fail(e.requestID)}}):J&&this._socket.send(this._canIUseBinaryFrame?pr(e.data).buffer:e.data))}}}]),e}(),gr=["keyMap"],_r=["keyMap"],vr="connected",mr="connecting",yr="disconnected",Mr=function(){function e(t){r(this,e),this._channelModule=t,this._n="SocketHandler",this._promiseMap=new Map,this._readyState=yr,this._simpleRequestMap=new Map,this.MAX_SIZE=100,this._startSequence=ot(),this._startTs=0,this._reConnectFlag=!1,this._nextPingTs=0,this._reConnectCount=0,this.MAX_RECONNECT_COUNT=3,this._socketID=-1,this._random=0,this._socket=null,this._url="",this._onOpenTs=0,this._canIUseBinaryFrame=!0,this._isWorkerEnabled=!0,this._setWebsocketHost(),this._initConnection()}return u(e,[{key:"_setWebsocketHost",value:function(){var e=this._channelModule.getModule(12),t=G;this._channelModule.isOversea()&&(t="OVERSEA"),e.isSingaporeSite()?t="SINGAPORE":e.isKoreaSite()?t="KOREA":e.isGermanySite()?t="GERMANY":e.isIndiaSite()?t="IND":e.isJapanSite()?t="JPN":e.isUSASite()&&(t="USA"),x.HOST.setCurrent(t)}},{key:"_initConnection",value:function(){Ye(x.HOST.CURRENT.BACKUP)||""===this._url?this._url=x.HOST.CURRENT.DEFAULT:this._url===x.HOST.CURRENT.DEFAULT?this._url=x.HOST.CURRENT.BACKUP:this._url===x.HOST.CURRENT.BACKUP?this._url=this._canIUseAnyCast()?x.HOST.CURRENT.ANYCAST:x.HOST.CURRENT.DEFAULT:this._url===x.HOST.CURRENT.ANYCAST&&(x.HOST.CURRENT.ANYCAST="",this._url=x.HOST.CURRENT.DEFAULT);var e=this._channelModule.getModule(12).getProxyServer();Gt(e)||(this._url=e),this._connect(),this._nextPingTs=0}},{key:"_canIUseAnyCast",value:function(){return J&&x.HOST.CURRENT.ANYCAST}},{key:"onCheckTimer",value:function(e){e%1==0&&this._checkPromiseMap()}},{key:"_checkPromiseMap",value:function(){var e=this;0!==this._promiseMap.size&&this._promiseMap.forEach((function(t,n){var i=t.reject,o=t.timestamp,s=15e3;-1!==n.indexOf(Mn)&&(s=9e4),Date.now()-o>=s&&(Le.l("".concat(e._n,"._checkPromiseMap request timeout, delete requestID:").concat(n)),e._promiseMap.delete(n),i(new jo({code:ho.NETWORK_TIMEOUT})),e._channelModule.onRequestTimeout(n))}))}},{key:"onOpen",value:function(e){if(""!==this._readyState){this._onOpenTs=Date.now();var t=e.id;this._socketID=t;var n=Date.now()-this._startTs;Le.l("".concat(this._n,"._onOpen cost ").concat(n," ms. socketID:").concat(t)),new wo("wsOnOpen").setMessage(n).setCostTime(n).setMoreMessage("socketID:".concat(t)).end(),e.id===this._socketID&&(this._readyState=vr,this._reConnectCount=0,this._resend(),!0===this._reConnectFlag&&(this._channelModule.onReconnected(),this._reConnectFlag=!1),this._channelModule.onOpen())}}},{key:"onClose",value:function(e){var t=new wo("wsOnClose"),n=e.id,i=e.e,o="sourceSocketID:".concat(n," currentSocketID:").concat(this._socketID," code:").concat(i.code," reason:").concat(i.reason),s=0;0!==this._onOpenTs&&(s=Date.now()-this._onOpenTs),t.setMessage(s).setCostTime(s).setMoreMessage(o).setCode(i.code).end(),Le.l("".concat(this._n,"._onClose ").concat(o," onlineTime:").concat(s)),n===this._socketID&&(this._readyState=yr,s<1e3?this._channelModule.onReconnectFailed():this._channelModule.onClose())}},{key:"onError",value:function(e){var t=e.id,n=e.e,i="sourceSocketID:".concat(t," currentSocketID:").concat(this._socketID);new wo("wsOnError").setMessage(n.errMsg||nt(n)).setMoreMessage(i).setLevel("error").end(),Le.w("".concat(this._n,"._onError"),n,i),t===this._socketID&&(this._readyState="",this._channelModule.onError())}},{key:"onMessage",value:function(e){var t;try{t=JSON.parse(e.data)}catch(h){new wo("jsonParseError").setMessage(e.data).end()}if(t&&t.head){var n=this._getRequestIDFromHead(t.head),i=t.body;if(!n.startsWith(x.NAME.TUIROOM_SVR)){var o=St(t.head);i=function e(t,n){if(ze(t))return t.map((function(t){return Ke(t)?e(t,n):t}));if(Ke(t)){var i=(o=t,s=function(e,t){return Ye(n[t])?cr(t):n[t]},r={},Object.keys(o).forEach((function(e){r[s(o[e],e)]=o[e]})),r);return mt(i,(function(t){return ze(t)||Ke(t)?e(t,n):t}))}var o,s,r}(t.body,this._getResponseKeyMap(o))}if(Le.d("".concat(this._n,".onMessage ret:").concat(JSON.stringify(i)," requestID:").concat(n," has:").concat(this._promiseMap.has(n))),this._setNextPingTs(),this._promiseMap.has(n)){var s=this._promiseMap.get(n),r=s.resolve,a=s.reject,c=s.timestamp;return this._promiseMap.delete(n),this._calcRTT(c),void(i.errorCode&&0!==i.errorCode?(this._channelModule.onErrorCodeNotZero(i),a(new jo({code:i.errorCode,message:i.errorInfo||"",data:n.includes(xn)||n.includes(Ei)?{elements:i.elements,messageVersion:i.messageVersion,cloudCustomData:i.cloudCustomData}:void 0}))):r(Ko(i)))}this._channelModule.onMessage({head:t.head,body:i})}}},{key:"_calcRTT",value:function(e){var t=Date.now()-e;this._channelModule.getModule(26).addRTT(t)}},{key:"_connect",value:function(){this._startTs=Date.now(),this._onOpenTs=0,this._socket=new fr(this),this._socketID=this._socket.getID(),this._readyState=mr,Le.l("".concat(this._n,"._connect isWorkerEnabled:").concat(this.getIsWorkerEnabled()," socketID:").concat(this._socketID," url:").concat(this.getURL())),new wo("wsConnect").setMessage("socketID:".concat(this._socketID," url:").concat(this.getURL())).end()}},{key:"getURL",value:function(){this._channelModule.isDevMode()&&(this._canIUseBinaryFrame=!1);var e=It();(K||B&&"windows"===e||z)&&(this._canIUseBinaryFrame=!1);var t=-1;"ios"===e?t=ce||-1:"android"===e&&(t=le||-1);var n=this._channelModule.getModule(12),i=this._channelModule.getPlatform(),o=n.getSDKAppID(),s=n.getInstanceID(),r="sdkappid=".concat(o,"&instanceid=").concat(s,"&random=").concat(this._getRandom(),"&platform=").concat(i,"&host=").concat(e,"&version=").concat(t);return this._canIUseBinaryFrame?"".concat(this._url,"/binfo?").concat(r):"".concat(this._url,"/info?").concat(r)}},{key:"_closeConnection",value:function(e){Le.l("".concat(this._n,"._closeConnection socketID:").concat(this._socketID)),this._socket&&(this._socket.close(e),this._socketID=-1,this._socket=null,this._readyState=yr)}},{key:"_resend",value:function(){var e=this;if(Le.l("".concat(this._n,"._resend reConnectFlag:").concat(this._reConnectFlag),"promiseMap.size:".concat(this._promiseMap.size," simpleRequestMap.size:").concat(this._simpleRequestMap.size)),this._promiseMap.size>0&&this._promiseMap.forEach((function(t,n){var i=t.uplinkData,o=t.resolve,s=t.reject;e._promiseMap.set(n,{resolve:o,reject:s,timestamp:Date.now(),uplinkData:i}),e._execute(n,i)})),this._simpleRequestMap.size>0){var t,n=w(this._simpleRequestMap);try{for(n.s();!(t=n.n()).done;){var i=I(t.value,2),o=i[0],s=i[1];this._execute(o,s)}}catch(l){n.e(l)}finally{n.f()}this._simpleRequestMap.clear()}}},{key:"send",value:function(e){var t=this;e.head.seq=this._getSequence(),e.head.reqtime=Math.floor(Date.now()/1e3),e.keyMap;var n=v(e,gr),i=this._getRequestIDFromHead(e.head),o=JSON.stringify(n);return new Promise((function(e,s){t._promiseMap.set(i,{resolve:e,reject:s,timestamp:Date.now(),uplinkData:o}),Le.d("".concat(t._n,".send uplinkData:").concat(JSON.stringify(n)," requestID:").concat(i," readyState:").concat(t._readyState)),t._readyState!==vr?t._reConnect():(t._execute(i,o),t._channelModule.getModule(26).addRequestCount())}))}},{key:"simplySend",value:function(e){e.head.seq=this._getSequence(),e.head.reqtime=Math.floor(Date.now()/1e3),e.keyMap;var t=v(e,_r),n=this._getRequestIDFromHead(e.head),i=JSON.stringify(t);this._readyState!==vr?(this._simpleRequestMap.size<this.MAX_SIZE?this._simpleRequestMap.set(n,i):Le.l("".concat(this._n,".simplySend. simpleRequestMap is full, drop request!")),this._reConnect()):this._execute(n,i)}},{key:"_execute",value:function(e,t){this._socket.send({data:t,fail:W?this._onSendFail.bind(this):void 0,requestID:e})}},{key:"_onSendFail",value:function(e){Le.l("".concat(this._n,"._onSendFail requestID:").concat(e))}},{key:"_getSequence",value:function(){var e;if(this._startSequence<2415919103)return e=this._startSequence,this._startSequence+=1,2415919103===this._startSequence&&(this._startSequence=ot()),e}},{key:"_getRequestIDFromHead",value:function(e){return e.servcmd+e.seq}},{key:"_getResponseKeyMap",value:function(e){var n=this._channelModule.getKeyMap(e);return t(t({},ar.response),n.response)}},{key:"_reConnect",value:function(){this._readyState!==vr&&this._readyState!==mr&&this.forcedReconnect()}},{key:"forcedReconnect",value:function(){var e=this,t="".concat(this._n,".forcedReconnect");Le.l("".concat(t," count:").concat(this._reConnectCount," readyState:").concat(this._readyState)),this._reConnectFlag=!0,this._resetRandom(),this._reConnectCount<this.MAX_RECONNECT_COUNT?(this._reConnectCount+=1,this._closeConnection(4001),this._initConnection()):(this._reConnectCount=0,this._channelModule.probeNetwork().then((function(n){var i=I(n,2),o=i[0];i[1],o?(Le.w("".concat(t," disconnected from wsserver but network is ok, continue...")),e._closeConnection(4001),e._initConnection()):e._channelModule.onReconnectFailed()})))}},{key:"getReconnectFlag",value:function(){return this._reConnectFlag}},{key:"_setNextPingTs",value:function(){this._nextPingTs=Date.now()+1e4}},{key:"getNextPingTs",value:function(){return this._nextPingTs}},{key:"isConnected",value:function(){return this._readyState===vr}},{key:"canIUseBinaryFrame",value:function(){return this._canIUseBinaryFrame}},{key:"setIsWorkerEnabled",value:function(e){Le.l("".concat(this._n,".setIsWorkerEnabled flag:").concat(e)),this._isWorkerEnabled=e}},{key:"getIsWorkerEnabled",value:function(){return this._isWorkerEnabled&&ve}},{key:"_getRandom",value:function(){return 0===this._random&&(this._random=Math.random()),this._random}},{key:"_resetRandom",value:function(){this._random=0}},{key:"close",value:function(){Le.l("".concat(this._n,".close")),this._closeConnection(4e3),this._promiseMap.clear(),this._startSequence=ot(),this._readyState=yr,this._simpleRequestMap.clear(),this._reConnectFlag=!1,this._reConnectCount=0,this._onOpenTs=0,this._url="",this._random=0,this._canIUseBinaryFrame=!0,this._isWorkerEnabled=!0}}]),e}(),Ir=function(e){d(n,e);var t=M(n);function n(e){var i;if(r(this,n),(i=t.call(this,e))._n="ChannelModule",i._socketHandler=new Mr(m(i)),i._probing=!1,i._isAppShowing=!0,i._previousState=b.NET_STATE_CONNECTED,W&&"function"==typeof X.onAppShow&&"function"==typeof X.onAppHide){var o=i._onAppHide.bind(m(i)),s=i._onAppShow.bind(m(i));"function"==typeof X.offAppHide&&X.offAppHide(o),"function"==typeof X.offAppShow&&X.offAppShow(s),X.onAppHide(o),X.onAppShow(s)}return i._timerForNotLoggedIn=-1,i._timerForNotLoggedIn=setInterval(i.onCheckTimer.bind(m(i)),1e3),i._fatalErrorFlag=!1,i}return u(n,[{key:"onCheckTimer",value:function(e){this._socketHandler&&(this.isLoggedIn()?(this._timerForNotLoggedIn>0&&(clearInterval(this._timerForNotLoggedIn),this._timerForNotLoggedIn=-1),this._socketHandler.onCheckTimer(e)):this._socketHandler.onCheckTimer(1),this._checkNextPing())}},{key:"onErrorCodeNotZero",value:function(e){this.getModule(20).onErrorCodeNotZero(e)}},{key:"onMessage",value:function(e){this.getModule(20).onMessage(e)}},{key:"send",value:function(e){return this._socketHandler?this._previousState!==b.NET_STATE_CONNECTED&&e.head.servcmd.includes(zi)?(this.reConnect(),this._sendLogViaHTTP(e)):this._socketHandler.send(e):Promise.reject()}},{key:"_sendLogViaHTTP",value:function(e){var t=x.HOST.CURRENT.STAT;return new Promise((function(n,i){var o="".concat(t,"/v4/imopenstat/tim_web_report_v2?sdkappid=").concat(e.head.sdkappid,"&reqtime=").concat(Date.now()),s=JSON.stringify(e.body),r="application/x-www-form-urlencoded;charset=UTF-8";if(W)X.request({url:o,data:s,method:"POST",timeout:3e3,header:{"content-type":r},success:function(){n()},fail:function(){i(new jo({code:ho.NETWORK_ERROR}))}});else{var a=new XMLHttpRequest,c=setTimeout((function(){a.abort(),i(new jo({code:ho.NETWORK_TIMEOUT}))}),3e3);a.onreadystatechange=function(){4===a.readyState&&(clearTimeout(c),200===a.status||304===a.status?n():i(new jo({code:ho.NETWORK_ERROR})))},a.open("POST",o,!0),a.setRequestHeader("Content-type",r),a.send(s)}}))}},{key:"simplySend",value:function(e){return this._socketHandler?this._socketHandler.simplySend(e):Promise.reject()}},{key:"onOpen",value:function(){this._ping()}},{key:"onClose",value:function(){this._socketHandler&&this._socketHandler.getReconnectFlag()&&this._emitNetStateChangeEvent(b.NET_STATE_DISCONNECTED),this.reConnect()}},{key:"onError",value:function(){W&&!z&&this.outputWarning("DomainNameInMP"),this._emitNetStateChangeEvent(b.NET_STATE_DISCONNECTED)}},{key:"getKeyMap",value:function(e){return this.getModule(20).getKeyMap(e)}},{key:"_onAppHide",value:function(){this._isAppShowing=!1}},{key:"_onAppShow",value:function(){this._isAppShowing=!0}},{key:"onRequestTimeout",value:function(e){}},{key:"onReconnected",value:function(){Le.l("".concat(this._n,".onReconnected")),this._m.restartTimer(),this.getModule(20).onReconnected(),this._emitNetStateChangeEvent(b.NET_STATE_CONNECTED)}},{key:"onReconnectFailed",value:function(){Le.l("".concat(this._n,".onReconnectFailed")),this._emitNetStateChangeEvent(b.NET_STATE_DISCONNECTED)}},{key:"setIsWorkerEnabled",value:function(e){this._socketHandler&&this._socketHandler.setIsWorkerEnabled(!1)}},{key:"offline",value:function(){this._emitNetStateChangeEvent(b.NET_STATE_DISCONNECTED)}},{key:"reConnect",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=!1;this._socketHandler&&(t=this._socketHandler.getReconnectFlag());var n="forcedFlag:".concat(e," fatalErrorFlag:").concat(this._fatalErrorFlag," previousState:").concat(this._previousState," reconnectFlag:").concat(t);if(Le.l("".concat(this._n,".reConnect ").concat(n)),!this._fatalErrorFlag&&this._socketHandler){if(!0===e)this._socketHandler.forcedReconnect();else{if(this._previousState===b.NET_STATE_CONNECTING&&t)return;this._socketHandler.forcedReconnect()}this._emitNetStateChangeEvent(b.NET_STATE_CONNECTING)}}},{key:"_emitNetStateChangeEvent",value:function(e){this._previousState!==e&&(Le.l("".concat(this._n,"._emitNetStateChangeEvent from ").concat(this._previousState," to ").concat(e)),this._previousState=e,this.emitOuterEvent(A.NET_STATE_CHANGE,{state:e}))}},{key:"_ping",value:function(){var e=this;if(!0!==this._probing){this._probing=!0;var t=this.getModule(20).getProtocolData({protocolName:"alive"});this.send(t).then((function(){e._probing=!1})).catch((function(t){if(Le.w("".concat(e._n,"._ping failed. error:"),t),e._probing=!1,t&&60002===t.code)return new wo("error").setMessage("code:".concat(t.code," message:").concat(t.message)).setNetworkType(e.getModule(15).getNetworkType()).end(),e._fatalErrorFlag=!0,void e._emitNetStateChangeEvent(b.NET_STATE_DISCONNECTED);e.probeNetwork().then((function(t){var n=I(t,2),i=n[0],o=n[1];Le.l("".concat(e._n,"._ping failed. probe network, isAppShowing:").concat(e._isAppShowing," online:").concat(i," networkType:").concat(o)),i?e.reConnect():e._emitNetStateChangeEvent(b.NET_STATE_DISCONNECTED)}))}))}}},{key:"_checkNextPing",value:function(){this._socketHandler&&this._socketHandler.isConnected()&&Date.now()>=this._socketHandler.getNextPingTs()&&this._ping()}},{key:"dealloc",value:function(){this._socketHandler&&(this._socketHandler.close(),this._socketHandler=null),this._timerForNotLoggedIn>-1&&clearInterval(this._timerForNotLoggedIn)}},{key:"onRestApiKickedOut",value:function(){this._socketHandler&&(this._socketHandler.close(),this.reConnect(!0))}},{key:"reset",value:function(){Le.l("".concat(this._n,".reset")),this._previousState=b.NET_STATE_CONNECTED,this._probing=!1,this._fatalErrorFlag=!1,this._timerForNotLoggedIn=setInterval(this.onCheckTimer.bind(this),1e3)}}]),n}(yn),Cr=["a2","tinyid"],Tr=["a2","tinyid"],kr=function(){function e(t){r(this,e),this._n="ProtocolHandler",this._sessionModule=t,this._configMap=new Map,this._fillConfigMap()}return u(e,[{key:"_fillConfigMap",value:function(){this._configMap.clear();var e=this._sessionModule.genCommonHead(),n=this._sessionModule.genCosSpecifiedHead(),i=this._sessionModule.genSSOReportHead(),o=this._sessionModule.isIntl();this._configMap.set(Mn,function(e){return{head:t(t({},e),{},{servcmd:"".concat(x.NAME.IM_OPEN_STATUS,".").concat(x.CMD.LOGIN)}),body:{state:"Online",isWebUniapp:0,deviceBrand:0},keyMap:{request:{deviceBrand:"InstType"},response:{InstId:"instanceID",HelloInterval:"helloInterval"}}}}(e)),this._configMap.set(In,function(e){return{head:t(t({},e),{},{servcmd:"".concat(x.NAME.IM_OPEN_STATUS,".").concat(x.CMD.LOGOUT)}),body:{type:0},keyMap:{request:{type:"wslogout_type"}}}}(e)),this._configMap.set(Cn,function(e){return{head:t(t({},e),{},{servcmd:"".concat(x.NAME.IM_OPEN_STATUS,".").concat(x.CMD.HELLO)}),body:{isWebUniapp:0},keyMap:{response:{NewInstInfo:"newInstanceInfo"}}}}(e)),this._configMap.set("KickOther",function(e){return{head:t(t({},e),{},{servcmd:"".concat(x.NAME.STAT_SERVICE,".").concat(x.CMD.KICK_OTHER)}),body:{}}}(e)),this._configMap.set("cos",function(e){return{head:t(t({},e),{},{servcmd:"".concat(x.NAME.IM_COS_SIGN,".").concat(x.CMD.COS_SIGN)}),body:{cmd:"open_im_cos_svc",subCmd:"get_cos_token",duration:300,version:2},keyMap:{request:{userSig:"usersig",subCmd:"sub_cmd",cmd:"cmd",duration:"duration",version:"version"},response:{expired_time:"expiredTime",bucket_name:"bucketName",session_token:"sessionToken",tmp_secret_id:"secretId",tmp_secret_key:"secretKey"}}}}(n)),this._configMap.set(Ki,function(e){return{head:t(t({},e),{},{servcmd:"".concat(x.NAME.CUSTOM_UPLOAD,".").concat(x.CMD.COS_PRE_SIG)}),body:{fileType:void 0,fileName:void 0,uploadMethod:0,duration:900},keyMap:{request:{userSig:"usersig",fileType:"file_type",fileName:"file_name",uploadMethod:"upload_method"},response:{expired_time:"expiredTime",request_id:"requestId",head_url:"headUrl",upload_url:"uploadUrl",download_url:"downloadUrl",ci_url:"ciUrl",snapshot_url:"requestSnapshotUrl"}}}}(n)),this._configMap.set(ji,function(e){return{head:t(t({},e),{},{servcmd:"".concat(x.NAME.CUSTOM_UPLOAD,".").concat(x.CMD.VIDEO_COVER)}),body:{version:1,platform:void 0,coverName:void 0,requestSnapshotUrl:void 0},keyMap:{request:{version:"version",platform:"platform",coverName:"cover_name",requestSnapshotUrl:"snapshot_url"},response:{error_code:"errorCode",error_msg:"errorInfo",download_url:"snapshotUrl"}}}}(n)),this._configMap.set(Zi,function(e){return{head:t(t({},e),{},{servcmd:"".concat(x.NAME.IM_CONFIG_MANAGER,".").concat(x.CMD.FETCH_COMMERCIAL_CONFIG)}),body:{SDKAppID:0},keyMap:{request:{SDKAppID:"uint32_sdkappid"},response:{int32_error_code:"errorCode",str_error_message:"errorMessage",str_purchase_bits:"purchaseBits",uint32_expired_time:"expiredTime"}}}}(e)),this._configMap.set("push_imsdk_purchase_bitsv2",function(e){return{head:t(t({},e),{},{servcmd:"".concat(x.NAME.IM_CONFIG_MANAGER,".").concat(x.CMD.PUSHED_COMMERCIAL_CONFIG)}),body:{},keyMap:{response:{int32_error_code:"errorCode",str_error_message:"errorMessage",str_purchase_bits:"purchaseBits",uint32_expired_time:"expiredTime"}}}}(e)),this._configMap.set(Xi,function(e){return{head:t(t({},e),{},{servcmd:"".concat(x.NAME.IM_CONFIG_MANAGER,".").concat(x.CMD.FETCH_CLOUD_CONTROL_CONFIG)}),body:{SDKAppID:0,version:0},keyMap:{request:{SDKAppID:"uint32_sdkappid",version:"uint64_version"},response:{int32_error_code:"errorCode",str_error_message:"errorMessage",str_json_config:"cloudControlConfig",uint32_expired_time:"expiredTime",uint32_sdkappid:"SDKAppID",uint64_version:"version"}}}}(e)),this._configMap.set("push_configv2",function(e){return{head:t(t({},e),{},{servcmd:"".concat(x.NAME.IM_CONFIG_MANAGER,".").concat(x.CMD.PUSHED_CLOUD_CONTROL_CONFIG)}),body:{},keyMap:{response:{int32_error_code:"errorCode",str_error_message:"errorMessage",str_json_config:"cloudControlConfig",uint32_expired_time:"expiredTime",uint32_sdkappid:"SDKAppID",uint64_version:"version"}}}}(e)),this._configMap.set("notify2",function(e){return{head:t(t({},e),{},{servcmd:"".concat(x.NAME.OVERLOAD_PUSH,".").concat(x.CMD.OVERLOAD_NOTIFY)}),body:{},keyMap:{response:{OverLoadServCmd:"overloadCommand",DelaySecs:"waitingTime"}}}}(e)),this._configMap.set("getmsg",function(e){return{head:t(t({},e),{},{servcmd:"".concat(x.NAME.OPEN_IM,".").concat(x.CMD.GET_MESSAGES)}),body:{cookie:"",syncFlag:0,needAbstract:1,isOnlineSync:0,needSignaling:1},keyMap:{request:{fromAccount:"From_Account",toAccount:"To_Account",from:"From_Account",to:"To_Account",time:"MsgTimeStamp",sequence:"MsgSeq",random:"MsgRandom",elements:"MsgBody"},response:{MsgList:"messageList",SyncFlag:"syncFlag",To_Account:"to",From_Account:"from",ClientSeq:"clientSequence",MsgSeq:"sequence",NoticeSeq:"noticeSequence",NotifySeq:"notifySequence",MsgRandom:"random",MsgTimeStamp:"time",MsgContent:"content",ToGroupId:"to",MsgKey:"messageKey",GroupTips:"groupTips",MsgBody:"elements",MsgType:"type",C2CRemainingUnreadCount:"C2CRemainingUnreadList",C2CPairUnreadCount:"C2CPairUnreadList"}}}}(e)),o||(this._configMap.set(Tn,function(e){return{head:t(t({},e),{},{servcmd:"".concat(x.NAME.OPEN_IM,".").concat(x.CMD.BIG_DATA_HALLWAY_AUTH_KEY)}),body:{}}}(e)),this._configMap.set(lo,function(e){return{head:t(t({},e),{},{servcmd:"".concat(x.NAME.IM_MSG_AUDIT_MGR,".").concat(x.CMD.GET_RPOFANITY_LIST)}),body:{version:0,deviceID:"",startIndex:void 0},keyMap:{request:{version:"uint64_version",deviceID:"str_device_id",startIndex:"uint64_start_index"},response:{msg_cmd_error_code:"errorInfo",str_err_msg:"errorMessage",uint32_code:"errorCode",msg_scene_ctl_config:"filterConfig",uint64_c2c_custom_msg_flag:"c2c_custom_message",uint64_c2c_text_msg_flag:"c2c_text_message",uint64_group_custom_msg_flag:"group_custom_message",uint64_group_text_msg_flag:"group_text_message",uint64_group_info_flag:"group_profile",uint64_group_member_info_flag:"group_member_profile",uint64_relation_chain_flag:"sns",uint64_user_info_flag:"user_profile",rpt_msg_dirty_word:"lexicon",str_dirty_word:"profanity",str_replaced_content:"replacement",uint64_filter_type:"filterType",uint64_id:"id",uint64_word_type:"profanityType",uint64_complete_flag:"completeFlag",uint64_next_start_index:"nextStartIndex",uint64_version:"version",uint64_expired_time:"expiredTime"}}}}(e))),this._configMap.set(kn,function(e){return{head:t(t({},e),{},{servcmd:"".concat(x.NAME.OPEN_IM,".").concat(x.CMD.SEND_MESSAGE)}),body:{fromAccount:"",toAccount:"",msgSeq:0,msgRandom:0,msgBody:[],cloudCustomData:void 0,nick:"",avatar:"",msgLifeTime:void 0,offlinePushInfo:{pushFlag:0,title:"",desc:"",ext:"",apnsInfo:{badgeMode:0,isVoipPush:void 0},androidInfo:{OPPOChannelID:""}},messageControlInfo:void 0,clientTime:void 0,needReadReceipt:0,isSupportExtension:0},keyMap:{request:{fromAccount:"From_Account",toAccount:"To_Account",msgTimeStamp:"MsgTimeStamp",msgSeq:"MsgSeq",msgRandom:"MsgRandom",msgBody:"MsgBody",count:"MaxCnt",lastMessageTime:"LastMsgTime",messageKey:"MsgKey",peerAccount:"Peer_Account",data:"Data",description:"Desc",extension:"Ext",type:"MsgType",content:"MsgContent",sizeType:"Type",uuid:"UUID",url:"",imageUrl:"URL",fileUrl:"Url",remoteAudioUrl:"Url",remoteVideoUrl:"VideoUrl",thumbUUID:"ThumbUUID",videoUUID:"VideoUUID",videoUrl:"",downloadFlag:"Download_Flag",nick:"From_AccountNick",avatar:"From_AccountHeadurl",from:"From_Account",time:"MsgTimeStamp",messageRandom:"MsgRandom",messageSequence:"MsgSeq",elements:"MsgBody",clientSequence:"ClientSeq",payload:"MsgContent",messageList:"MsgList",messageNumber:"MsgNum",abstractList:"AbstractList",messageBody:"MsgBody",needReadReceipt:"IsNeedReadReceipt"}}}}(e)),this._configMap.set(Sn,function(e){return{head:t(t({},e),{},{servcmd:"".concat(x.NAME.GROUP,".").concat(x.CMD.SEND_GROUP_MESSAGE)}),body:{fromAccount:"",groupID:"",random:0,clientSequence:0,priority:"",msgBody:[],cloudCustomData:void 0,onlineOnlyFlag:0,offlinePushInfo:{pushFlag:0,title:"",desc:"",ext:"",apnsInfo:{badgeMode:0,isVoipPush:void 0},androidInfo:{OPPOChannelID:""}},groupAtInfo:[],messageControlInfo:void 0,clientTime:void 0,needReadReceipt:0,topicID:void 0,receiverList:void 0,isSupportExtension:0},keyMap:{request:{to:"GroupId",extension:"Ext",data:"Data",description:"Desc",random:"Random",sequence:"ReqMsgSeq",count:"ReqMsgNumber",type:"MsgType",priority:"MsgPriority",content:"MsgContent",elements:"MsgBody",sizeType:"Type",uuid:"UUID",url:"",imageUrl:"URL",fileUrl:"Url",remoteAudioUrl:"Url",remoteVideoUrl:"VideoUrl",thumbUUID:"ThumbUUID",videoUUID:"VideoUUID",videoUrl:"",downloadFlag:"Download_Flag",clientSequence:"ClientSeq",from:"From_Account",time:"MsgTimeStamp",messageRandom:"MsgRandom",messageSequence:"MsgSeq",payload:"MsgContent",messageList:"MsgList",messageNumber:"MsgNum",abstractList:"AbstractList",messageBody:"MsgBody",needReadReceipt:"NeedReadReceipt",receiverList:"To_Account"},response:{MsgTime:"time",MsgSeq:"sequence"}}}}(e)),this._configMap.set(Ln,function(e){return{head:t(t({},e),{},{servcmd:"".concat(x.NAME.OPEN_IM,".").concat(x.CMD.REVOKE_C2C_MESSAGE)}),body:{msgInfo:{fromAccount:"",toAccount:"",msgTimeStamp:0,msgSeq:0,msgRandom:0}},keyMap:{request:{msgInfo:"MsgInfo",msgTimeStamp:"MsgTimeStamp",msgSeq:"MsgSeq",msgRandom:"MsgRandom"}}}}(e)),this._configMap.set(pi,function(e){return{head:t(t({},e),{},{servcmd:"".concat(x.NAME.GROUP,".").concat(x.CMD.REVOKE_GROUP_MESSAGE)}),body:{groupID:"",msgSeqList:void 0,topicID:""},keyMap:{request:{msgSeqList:"MsgSeqList",msgSeq:"MsgSeq"}}}}(e)),this._configMap.set(Pn,function(e){return{head:t(t({},e),{},{servcmd:"".concat(x.NAME.OPEN_IM,".").concat(x.CMD.GET_C2C_ROAM_MESSAGES)}),body:{peerAccount:"",count:15,lastMessageTime:0,messageKey:"",withRecalledMessage:1,direction:0},keyMap:{request:{messageKey:"MsgKey",peerAccount:"Peer_Account",count:"MaxCnt",lastMessageTime:"LastMsgTime",withRecalledMessage:"WithRecalledMsg",direction:"GetDirection"},response:{LastMsgTime:"lastMessageTime",IsNeedReadReceipt:"needReadReceipt",IsPeerRead:"readReceiptSentByPeer"}}}}(e)),this._configMap.set(xn,function(e){return{head:t(t({},e),{},{servcmd:"".concat(x.NAME.OPEN_IM,".").concat(x.CMD.MODIFY_C2C_MESSAGE)}),body:{from:"",to:"",sequence:0,random:0,time:0,version:0,elements:void 0,cloudCustomData:void 0},keyMap:{request:{sequence:"MsgSeq",random:"MsgRandom",time:"MsgTime",version:"MsgVersion",type:"MsgType",content:"MsgContent"}}}}(e)),this._configMap.set(gi,function(e){return{head:t(t({},e),{},{servcmd:"".concat(x.NAME.GROUP,".").concat(x.CMD.GET_GROUP_ROAM_MESSAGES)}),body:{withRecalledMsg:1,groupID:"",count:15,sequence:"",topicID:void 0},keyMap:{request:{sequence:"ReqMsgSeq",count:"ReqMsgNumber",withRecalledMessage:"WithRecalledMsg"},response:{Random:"random",MsgTime:"time",MsgSeq:"sequence",ReqMsgSeq:"sequence",RspMsgList:"messageList",IsPlaceMsg:"isPlaceMessage",IsSystemMsg:"isSystemMessage",ToGroupId:"to",EnumFrom_AccountType:"fromAccountType",EnumTo_AccountType:"toAccountType",GroupCode:"groupCode",MsgPriority:"priority",MsgBody:"elements",MsgType:"type",MsgContent:"content",IsFinished:"complete",Download_Flag:"downloadFlag",ClientSeq:"clientSequence",ThumbUUID:"thumbUUID",VideoUUID:"videoUUID",ToTopicId:"topicID",InvisibleMsgSeq:"invisibleSequenceList"}}}}(e)),this._configMap.set(Rn,function(e){return{head:t(t({},e),{},{servcmd:"".concat(x.NAME.OPEN_IM,".").concat(x.CMD.SET_C2C_MESSAGE_READ)}),body:{C2CMsgReaded:void 0},keyMap:{request:{lastMessageTime:"LastedMsgTime"}}}}(e)),this._configMap.set(On,function(e){return{head:t(t({},e),{},{servcmd:"".concat(x.NAME.OPEN_IM,".").concat(x.CMD.SET_C2C_PEER_MUTE_NOTIFICATIONS)}),body:{userIDList:void 0,muteFlag:0},keyMap:{request:{userIDList:"Peer_Account",muteFlag:"Mute_Notifications"}}}}(e)),this._configMap.set(Nn,function(e){return{head:t(t({},e),{},{servcmd:"".concat(x.NAME.OPEN_IM,".").concat(x.CMD.GET_C2C_PEER_MUTE_NOTIFICATIONS)}),body:{updateSequence:0},keyMap:{response:{MuteNotificationsList:"muteFlagList"}}}}(e)),this._configMap.set(hi,function(e){return{head:t(t({},e),{},{servcmd:"".concat(x.NAME.GROUP,".").concat(x.CMD.SET_GROUP_MESSAGE_READ)}),body:{groupID:void 0,messageReadSeq:void 0,topicID:void 0},keyMap:{request:{messageReadSeq:"MsgReadedSeq"}}}}(e)),this._configMap.set(fi,function(e){return{head:t(t({},e),{},{servcmd:"".concat(x.NAME.OPEN_IM,".").concat(x.CMD.SET_ALL_MESSAGE_READ)}),body:{readAllC2CMessage:0,groupMessageReadInfoList:[]},keyMap:{request:{readAllC2CMessage:"C2CReadAllMsg",groupMessageReadInfoList:"GroupReadInfo",messageSequence:"MsgSeq"},response:{C2CReadAllMsg:"readAllC2CMessage",GroupReadInfoArray:"groupMessageReadInfoList"}}}}(e)),this._configMap.set(Gn,function(e){return{head:t(t({},e),{},{servcmd:"".concat(x.NAME.OPEN_IM,".").concat(x.CMD.DELETE_C2C_MESSAGE)}),body:{fromAccount:"",to:"",keyList:void 0},keyMap:{request:{keyList:"MsgKeyList"}}}}(e)),this._configMap.set(Si,function(e){return{head:t(t({},e),{},{servcmd:"".concat(x.NAME.GROUP,".").concat(x.CMD.DELETE_GROUP_MESSAGE)}),body:{groupID:"",deleter:"",keyList:void 0,topicID:void 0},keyMap:{request:{deleter:"Deleter_Account",keyList:"Seqs"}}}}(e)),this._configMap.set(po,function(e){return{head:t(t({},e),{},{servcmd:"".concat(x.NAME.IM_OPEN_TRANSLATE,".").concat(x.CMD.TRANSLATE_TEXT)}),body:{sourceTextList:void 0,SDKAppID:0,from:0,source:"",target:""},keyMap:{request:{sourceTextList:"SourceText",SDKAppID:"SdkAppId",from:"FromAccount"},response:{TargetText:"translatedTextList",RequestId:"requestID",CmdErrorCode:"error",ErrorCode:"code",ErrorInfo:"message"}}}}(e)),this._configMap.set(Ei,function(e){return{head:t(t({},e),{},{servcmd:"".concat(x.NAME.OPEN_IM,".").concat(x.CMD.MODIFY_GROUP_MESSAGE)}),body:{groupID:"",topicID:void 0,sequence:0,version:0,elements:void 0,cloudCustomData:void 0},keyMap:{request:{sequence:"MsgSeq",version:"MsgVersion",type:"MsgType",content:"MsgContent"}}}}(e)),this._configMap.set(_i,function(e){return{head:t(t({},e),{},{servcmd:"".concat(x.NAME.GROUP,".").concat(x.CMD.GET_READ_RECEIPT)}),body:{groupID:"",sequenceList:void 0},keyMap:{request:{sequence:"MsgSeq"}}}}(e)),this._configMap.set(mi,function(e){return{head:t(t({},e),{},{servcmd:"".concat(x.NAME.OPEN_IM,".").concat(x.CMD.SEND_C2C_READ_RECEIPT)}),body:{peerAccount:"",messageInfoList:void 0},keyMap:{request:{peerAccount:"Peer_Account",messageInfoList:"C2CMsgInfo",fromAccount:"From_Account",toAccount:"To_Account",sequence:"MsgSeq",random:"MsgRandom",time:"MsgTime",clientTime:"MsgClientTime"}}}}(e)),this._configMap.set(vi,function(e){return{head:t(t({},e),{},{servcmd:"".concat(x.NAME.GROUP,".").concat(x.CMD.SEND_READ_RECEIPT)}),body:{groupID:"",sequenceList:void 0},keyMap:{request:{sequenceList:"MsgSeqList",sequence:"MsgSeq"}}}}(e)),this._configMap.set(yi,function(e){return{head:t(t({},e),{},{servcmd:"".concat(x.NAME.GROUP,".").concat(x.CMD.GET_READ_RECEIPT_DETAIL)}),body:{groupID:"",sequence:void 0,flag:0,cursor:0,count:0},keyMap:{request:{sequence:"MsgSeq",count:"Num"},response:{ReadList:"readUserIDList",Read_Account:"userID",UnreadList:"unreadUserIDList",Unread_Account:"userID",IsFinish:"isCompleted"}}}}(e)),this._configMap.set(Fn,function(e){return{head:t(t({},e),{},{servcmd:"".concat(x.NAME.OPEN_IM_MSG_EXT,".").concat(x.CMD.MODIFY_C2C_MESSAGE_EXTENSIONS)}),body:{from:void 0,to:void 0,messageKey:void 0,operateType:void 0,extensionList:void 0}}}(e)),this._configMap.set(qn,function(e){return{head:t(t({},e),{},{servcmd:"".concat(x.NAME.OPEN_IM_MSG_EXT,".").concat(x.CMD.GET_C2C_MESSAGE_EXTENSIONS)}),body:{from:void 0,to:void 0,messageKey:void 0,startSequence:void 0}}}(e)),this._configMap.set(Ri,function(e){return{head:t(t({},e),{},{servcmd:"".concat(x.NAME.OPEN_IM_MSG_EXT,".").concat(x.CMD.MODIFY_GROUP_MESSAGE_EXTENSIONS)}),body:{groupID:void 0,topicID:void 0,messageSequence:void 0,operateType:void 0,extensionList:void 0}}}(e)),this._configMap.set(Oi,function(e){return{head:t(t({},e),{},{servcmd:"".concat(x.NAME.OPEN_IM_MSG_EXT,".").concat(x.CMD.GET_GROUP_MESSAGE_EXTENSIONS)}),body:{groupID:void 0,topicID:void 0,messageSequence:void 0,startSequence:void 0}}}(e)),this._configMap.set(Un,function(e){return{head:t(t({},e),{},{servcmd:"".concat(x.NAME.OPEN_IM,".").concat(x.CMD.GET_PEER_READ_TIME)}),body:{userIDList:void 0},keyMap:{request:{userIDList:"To_Account"},response:{ReadTime:"peerReadTimeList"}}}}(e)),this._configMap.set("get",function(e){return{head:t(t({},e),{},{servcmd:"".concat(x.NAME.RECENT_CONTACT,".").concat(x.CMD.GET_CONVERSATION_LIST)}),body:{fromAccount:void 0,count:0},keyMap:{request:{},response:{SessionItem:"conversations",ToAccount:"groupID",To_Account:"userID",UnreadMsgCount:"unreadCount",MsgGroupReadedSeq:"messageReadSeq",C2cPeerReadTime:"c2cPeerReadTime"}}}}(e)),this._configMap.set(Bn,function(e){return{head:t(t({},e),{},{servcmd:"".concat(x.NAME.RECENT_CONTACT,".").concat(x.CMD.PAGING_GET_CONVERSATION_LIST)}),body:{fromAccount:void 0,timeStamp:void 0,startIndex:void 0,pinnedTimeStamp:void 0,pinnedStartIndex:void 0,orderType:void 0,messageAssistFlag:4,assistFlag:15},keyMap:{request:{messageAssistFlag:"MsgAssistFlags",assistFlag:"AssistFlags",pinnedTimeStamp:"TopTimeStamp",pinnedStartIndex:"TopStartIndex"},response:{SessionItem:"conversations",ToAccount:"groupID",To_Account:"userID",UnreadMsgCount:"unreadCount",MsgGroupReadedSeq:"messageReadSeq",C2cPeerReadTime:"c2cPeerReadTime",LastMsgFlags:"lastMessageFlag",TopFlags:"isPinned",TopTimeStamp:"pinnedTimeStamp",TopStartIndex:"pinnedStartIndex",GroupId:"convGroupID"}}}}(e)),this._configMap.set($n,function(e){return{head:t(t({},e),{},{servcmd:"".concat(x.NAME.RECENT_CONTACT,".").concat(x.CMD.DELETE_CONVERSATION)}),body:{fromAccount:"",conversationList:void 0,clearHistoryMessage:void 0},keyMap:{request:{toGroupID:"ToGroupid",clearHistoryMessage:"ClearRamble",conversationList:"ContactItem"},response:{ResultItem:"resultList",ToGroupid:"groupID",ResultCode:"code",ResultInfo:"info"}}}}(e)),this._configMap.set(Vn,function(e){return{head:t(t({},e),{},{servcmd:"".concat(x.NAME.RECENT_CONTACT,".").concat(x.CMD.CLEAR_HISTORY_MESSAGE)}),body:{fromAccount:"",toAccount:void 0,type:1,toGroupID:void 0},keyMap:{request:{toGroupID:"ToGroupid"}}}}(e)),this._configMap.set("top",function(e){return{head:t(t({},e),{},{servcmd:"".concat(x.NAME.RECENT_CONTACT,".").concat(x.CMD.PIN_CONVERSATION)}),body:{fromAccount:"",operationType:1,itemList:void 0},keyMap:{request:{itemList:"RecentContactItem"}}}}(e)),this._configMap.set(Hn,function(e){return{head:t(t({},e),{},{servcmd:"".concat(x.NAME.OPEN_IM,".").concat(x.CMD.DELETE_GROUP_AT_TIPS)}),body:{messageListToDelete:void 0},keyMap:{request:{messageListToDelete:"DelMsgList",messageSeq:"MsgSeq",messageRandom:"MsgRandom"}}}}(e)),this._configMap.set(Kn,function(e){return{head:t(t({},e),{},{servcmd:"".concat(x.NAME.RECENT_CONTACT,".").concat(x.CMD.MARK_CONVERSATION)}),body:{fromAccount:"",itemList:void 0},keyMap:{request:{itemList:"MarkItem",operationType:"OptType",groupID:"ToGroupId"},response:{ToGroupId:"groupID",OptType:"operationType"}}}}(e)),this._configMap.set(jn,function(e){return{head:t(t({},e),{},{servcmd:"".concat(x.NAME.RECENT_CONTACT,".").concat(x.CMD.MARK_CONVERSATION)}),body:{fromAccount:"",itemList:void 0},keyMap:{request:{itemList:"MarkItem",operationType:"OptType",groupID:"ToGroupId"},response:{ToGroupId:"groupID",OptType:"operationType"}}}}(e)),this._configMap.set(zn,function(e){return{head:t(t({},e),{},{servcmd:"".concat(x.NAME.RECENT_CONTACT,".").concat(x.CMD.CREATE_CONVERSATION_GROUP)}),body:{fromAccount:"",itemList:void 0},keyMap:{request:{itemList:"GroupContactItem",groupID:"ToGroupId"},response:{GroupId:"convGroupID",ToGroupId:"groupID",OptType:"operationType"}}}}(e)),this._configMap.set(Yn,function(e){return{head:t(t({},e),{},{servcmd:"".concat(x.NAME.RECENT_CONTACT,".").concat(x.CMD.DELETE_CONVERSATION_GROUP)}),body:{fromAccount:"",groupName:void 0},keyMap:{request:{},response:{GroupId:"convGroupID"}}}}(e)),this._configMap.set(Wn,function(e){return{head:t(t({},e),{},{servcmd:"".concat(x.NAME.RECENT_CONTACT,".").concat(x.CMD.UPDATE_CONVERSATION_GROUP)}),body:{fromAccount:"",updateType:void 0,updateGroup:void 0},keyMap:{request:{oldName:"OldGroupName",newName:"NewGroupName",groupID:"ToGroupId",operationType:"ContactOptType",groupName:"OldGroupName",updateItem:"ContactUpdateItem"},response:{ContactOptType:"operationType",ToGroupId:"groupID",GroupId:"convGroupID"}}}}(e)),this._configMap.set(Jn,function(e){return{head:t(t({},e),{},{servcmd:"".concat(x.NAME.RECENT_CONTACT,".").concat(x.CMD.UPDATE_CONVERSATION_GROUP)}),body:{fromAccount:"",updateType:void 0,updateGroup:{groupName:void 0,updateGroupType:void 0,updateItem:void 0}},keyMap:{request:{},response:{}}}}(e)),this._configMap.set(Xn,function(e){return{head:t(t({},e),{},{servcmd:"".concat(x.NAME.RECENT_CONTACT,".").concat(x.CMD.UPDATE_CONVERSATION_GROUP)}),body:{fromAccount:"",updateType:void 0,updateGroup:void 0},keyMap:{request:{},response:{}}}}(e)),this._configMap.set(Zn,function(e){return{head:t(t({},e),{},{servcmd:"".concat(x.NAME.RECENT_CONTACT,".").concat(x.CMD.GET_CONVERSATION_GROUP_LIST)}),body:{fromAccount:"",startTime:void 0,startIndex:void 0},keyMap:{request:{},response:{GroupId:"convGroupID",ToGroupId:"groupID",OptType:"operationType",CustomMark:"customData",ContactGroupId:"convGroupIDList"}}}}(e)),this._configMap.set(En,function(e){return{head:t(t({},e),{},{servcmd:"".concat(x.NAME.PROFILE,".").concat(x.CMD.PORTRAIT_GET)}),body:{fromAccount:"",userItem:[]},keyMap:{request:{toAccount:"To_Account",standardSequence:"StandardSequence",customSequence:"CustomSequence"}}}}(e)),this._configMap.set(Dn,function(e){return{head:t(t({},e),{},{servcmd:"".concat(x.NAME.PROFILE,".").concat(x.CMD.PORTRAIT_SET)}),body:{fromAccount:"",profileItem:[{tag:Oe.NICK,value:""},{tag:Oe.GENDER,value:""},{tag:Oe.ALLOWTYPE,value:""},{tag:Oe.AVATAR,value:""}]},keyMap:{request:{toAccount:"To_Account",standardSequence:"StandardSequence",customSequence:"CustomSequence"}}}}(e)),this._configMap.set(wn,function(e){return{head:t(t({},e),{},{servcmd:"".concat(x.NAME.FRIEND,".").concat(x.CMD.GET_BLACKLIST)}),body:{fromAccount:"",startIndex:0,maxLimited:30,lastSequence:0},keyMap:{response:{CurruentSequence:"currentSequence"}}}}(e)),this._configMap.set(An,function(e){return{head:t(t({},e),{},{servcmd:"".concat(x.NAME.FRIEND,".").concat(x.CMD.ADD_BLACKLIST)}),body:{fromAccount:"",toAccount:[]}}}(e)),this._configMap.set(bn,function(e){return{head:t(t({},e),{},{servcmd:"".concat(x.NAME.FRIEND,".").concat(x.CMD.DELETE_BLACKLIST)}),body:{fromAccount:"",toAccount:[]}}}(e)),this._configMap.set(io,function(e){return{head:t(t({},e),{},{servcmd:"".concat(x.NAME.IM_OPEN_STATUS,".").concat(x.CMD.SET_SELF_STATUS)}),body:{customStatus:""},keyMap:{}}}(e)),this._configMap.set(oo,function(e){return{head:t(t({},e),{},{servcmd:"".concat(x.NAME.IM_OPEN_STATUS,".").concat(x.CMD.GET_USER_STATUS)}),body:{userIDList:void 0},keyMap:{response:{UserStatusList:"successUserList",ErrorList:"failureUserList",To_Account:"userID",Invalid_Account:"invalidUserID",Status:"statusType"}}}}(e)),this._configMap.set(so,function(e){return{head:t(t({},e),{},{servcmd:"".concat(x.NAME.IM_OPEN_STATUS,".").concat(x.CMD.SUBSCRIBE_USER_STATUS)}),body:{userIDList:void 0},keyMap:{response:{ErrorList:"failureUserList",To_Account:"userID",Invalid_Account:"invalidUserID"}}}}(e)),this._configMap.set(ro,function(e){return{head:t(t({},e),{},{servcmd:"".concat(x.NAME.IM_OPEN_STATUS,".").concat(x.CMD.UNSUBSCRIBE_USER_STATUS)}),body:{userIDList:void 0,unsubscribeAll:void 0},keyMap:{response:{ErrorList:"failureUserList",To_Account:"userID",Invalid_Account:"invalidUserID"}}}}(e)),this._configMap.set(Qn,function(e){return{head:t(t({},e),{},{servcmd:"".concat(x.NAME.GROUP,".").concat(x.CMD.GET_JOINED_GROUPS)}),body:{memberAccount:"",limit:void 0,offset:void 0,groupType:void 0,responseFilter:{groupBaseInfoFilter:void 0,selfInfoFilter:void 0},isSupportTopic:0},keyMap:{request:{memberAccount:"Member_Account"},response:{GroupIdList:"groups",NoUnreadSeqList:"excludedUnreadSequenceList",MsgSeq:"readedSequence",LastRecallTime:"_lastRevokedTime"}}}}(e)),this._configMap.set(ei,function(e){return{head:t(t({},e),{},{servcmd:"".concat(x.NAME.GROUP,".").concat(x.CMD.GET_GROUP_INFO)}),body:{groupIDList:void 0,responseFilter:{groupBaseInfoFilter:["Type","Name","Introduction","Notification","FaceUrl","Owner_Account","CreateTime","InfoSeq","LastInfoTime","LastMsgTime","MemberNum","MaxMemberNum","ApplyJoinOption","NextMsgSeq","ShutUpAllMember"],groupCustomFieldFilter:void 0,memberInfoFilter:void 0,memberCustomFieldFilter:void 0}},keyMap:{request:{groupIDList:"GroupIdList",groupCustomField:"AppDefinedData",memberCustomField:"AppMemberDefinedData",groupCustomFieldFilter:"AppDefinedDataFilter_Group",memberCustomFieldFilter:"AppDefinedDataFilter_GroupMember"},response:{GroupIdList:"groups",AppDefinedData:"groupCustomField",AppMemberDefinedData:"memberCustomField",AppDefinedDataFilter_Group:"groupCustomFieldFilter",AppDefinedDataFilter_GroupMember:"memberCustomFieldFilter",InfoSeq:"infoSequence",MemberList:"members",GroupInfo:"groups",ShutUpUntil:"muteUntil",ShutUpAllMember:"muteAllMembers"}}}}(e)),this._configMap.set(ti,function(e){return{head:t(t({},e),{},{servcmd:"".concat(x.NAME.GROUP,".").concat(x.CMD.CREATE_GROUP)}),body:{type:void 0,name:void 0,groupID:void 0,ownerID:void 0,introduction:void 0,notification:void 0,maxMemberNum:void 0,joinOption:void 0,memberList:void 0,groupCustomField:void 0,memberCustomField:void 0,webPushFlag:1,avatar:"",isSupportTopic:void 0,inviteOption:void 0},keyMap:{request:{ownerID:"Owner_Account",userID:"Member_Account",avatar:"FaceUrl",maxMemberNum:"MaxMemberCount",joinOption:"ApplyJoinOption",groupCustomField:"AppDefinedData",memberCustomField:"AppMemberDefinedData",inviteOption:"InviteJoinOption"},response:{HugeGroupFlag:"avChatRoomFlag",OverJoinedGroupLimit_Account:"overLimitUserIDList"}}}}(e)),this._configMap.set(ni,function(e){return{head:t(t({},e),{},{servcmd:"".concat(x.NAME.GROUP,".").concat(x.CMD.DESTROY_GROUP)}),body:{groupID:void 0}}}(e)),this._configMap.set(ii,function(e){return{head:t(t({},e),{},{servcmd:"".concat(x.NAME.GROUP,".").concat(x.CMD.MODIFY_GROUP_INFO)}),body:{groupID:void 0,name:void 0,introduction:void 0,notification:void 0,avatar:void 0,joinOption:void 0,groupCustomField:void 0,muteAllMembers:void 0,inviteOption:void 0},keyMap:{request:{groupCustomField:"AppDefinedData",muteAllMembers:"ShutUpAllMember",joinOption:"ApplyJoinOption",avatar:"FaceUrl",inviteOption:"InviteJoinOption"},response:{AppDefinedData:"groupCustomField",ShutUpAllMember:"muteAllMembers"}}}}(e)),this._configMap.set(oi,function(e){return{head:t(t({},e),{},{servcmd:"".concat(x.NAME.GROUP,".").concat(x.CMD.APPLY_JOIN_GROUP)}),body:{groupID:void 0,applyMessage:void 0,userDefinedField:void 0,webPushFlag:1,historyMessageFlag:void 0},keyMap:{request:{applyMessage:"ApplyMsg",historyMessageFlag:"HugeGroupHistoryMsgFlag"},response:{HugeGroupFlag:"avChatRoomFlag",AVChatRoomKey:"avChatRoomKey",RspMsgList:"messageList",ToGroupId:"to"}}}}(e)),this._configMap.set(si,function(e){return e.a2,e.tinyid,{head:t(t({},v(e,Cr)),{},{servcmd:"".concat(x.NAME.BIG_GROUP_NO_AUTH,".").concat(x.CMD.APPLY_JOIN_GROUP)}),body:{groupID:void 0,applyMessage:void 0,userDefinedField:void 0,webPushFlag:1},keyMap:{request:{applyMessage:"ApplyMsg"},response:{HugeGroupFlag:"avChatRoomFlag"}}}}(e)),this._configMap.set(ri,function(e){return{head:t(t({},e),{},{servcmd:"".concat(x.NAME.GROUP,".").concat(x.CMD.QUIT_GROUP)}),body:{groupID:void 0}}}(e)),this._configMap.set(ai,function(e){return{head:t(t({},e),{},{servcmd:"".concat(x.NAME.GROUP,".").concat(x.CMD.SEARCH_GROUP_BY_ID)}),body:{groupIDList:void 0,responseFilter:{groupBasePublicInfoFilter:["Type","Name","Introduction","Notification","FaceUrl","CreateTime","Owner_Account","LastInfoTime","LastMsgTime","NextMsgSeq","MemberNum","MaxMemberNum","ApplyJoinOption","InviteJoinOption"]}},keyMap:{response:{}}}}(e)),this._configMap.set(ci,function(e){return{head:t(t({},e),{},{servcmd:"".concat(x.NAME.GROUP,".").concat(x.CMD.CHANGE_GROUP_OWNER)}),body:{groupID:void 0,newOwnerID:void 0},keyMap:{request:{newOwnerID:"NewOwner_Account"}}}}(e)),this._configMap.set(ui,function(e){return{head:t(t({},e),{},{servcmd:"".concat(x.NAME.GROUP,".").concat(x.CMD.HANDLE_APPLY_JOIN_GROUP)}),body:{groupID:void 0,applicant:void 0,handleAction:void 0,handleMessage:void 0,authentication:void 0,messageKey:void 0,userDefinedField:void 0},keyMap:{request:{applicant:"Applicant_Account",handleAction:"HandleMsg",handleMessage:"ApprovalMsg",messageKey:"MsgKey"}}}}(e)),this._configMap.set(li,function(e){return{head:t(t({},e),{},{servcmd:"".concat(x.NAME.GROUP,".").concat(x.CMD.HANDLE_INVITE_JOIN_GROUP)}),body:{groupID:void 0,applicant:void 0,invitee:void 0,handleAction:void 0,handleMessage:void 0,authentication:void 0,userDefinedField:void 0},keyMap:{request:{applicant:"Applicant_Account",invitee:"Invited_Account",handleAction:"HandleMsg",handleMessage:"ApprovalMsg"}}}}(e)),this._configMap.set(di,function(e){return{head:t(t({},e),{},{servcmd:"".concat(x.NAME.GROUP,".").concat(x.CMD.HANDLE_GROUP_INVITATION)}),body:{groupID:void 0,inviter:void 0,handleAction:void 0,handleMessage:void 0,authentication:void 0,messageKey:void 0,userDefinedField:void 0},keyMap:{request:{inviter:"Inviter_Account",handleAction:"HandleMsg",handleMessage:"ApprovalMsg",messageKey:"MsgKey"}}}}(e)),this._configMap.set(Mi,function(e){return{head:t(t({},e),{},{servcmd:"".concat(x.NAME.GROUP,".").concat(x.CMD.GET_GROUP_APPLICATION)}),body:{startTime:void 0,limit:void 0,handleAccount:void 0},keyMap:{request:{handleAccount:"Handle_Account"},response:{To_Account:"userID"}}}}(e)),this._configMap.set(Ii,function(e){return{head:t(t({},e),{},{servcmd:"".concat(x.NAME.OPEN_IM,".").concat(x.CMD.DELETE_GROUP_SYSTEM_MESSAGE)}),body:{messageListToDelete:void 0},keyMap:{request:{messageListToDelete:"DelMsgList",messageSeq:"MsgSeq",messageRandom:"MsgRandom"}}}}(e)),this._configMap.set(Ci,function(e){return{head:t(t({},e),{},{servcmd:"".concat(x.NAME.BIG_GROUP_LONG_POLLING,".").concat(x.CMD.AVCHATROOM_LONG_POLL)}),body:{USP:1,startSeq:1,startBroadcastSeq:void 0,holdTime:90,key:void 0,simplifiedMessage:void 0},keyMap:{request:{USP:"USP"},response:{ToGroupId:"groupID",RspBroadcastMsgList:"broadcastMessageList",IsSystemMsg:"isSystemMessage"}}}}(e)),this._configMap.set(Ti,function(e){return e.a2,e.tinyid,{head:t(t({},v(e,Tr)),{},{servcmd:"".concat(x.NAME.BIG_GROUP_LONG_POLLING_NO_AUTH,".").concat(x.CMD.AVCHATROOM_LONG_POLL)}),body:{USP:1,startSeq:1,holdTime:90,key:void 0,simplifiedMessage:void 0},keyMap:{request:{USP:"USP"},response:{ToGroupId:"groupID",RspBroadcastMsgList:"broadcastMessageList",IsSystemMsg:"isSystemMessage"}}}}(e)),this._configMap.set(ki,function(e){return{head:t(t({},e),{},{servcmd:"".concat(x.NAME.GROUP,".").concat(x.CMD.GET_ONLINE_MEMBER_NUM)}),body:{groupID:void 0}}}(e)),this._configMap.set(Di,function(e){return{head:t(t({},e),{},{servcmd:"".concat(x.NAME.GROUP,".").concat(x.CMD.SET_GROUP_ATTRIBUTES)}),body:{groupID:void 0,groupAttributeList:void 0,mainSequence:void 0,avChatRoomKey:void 0,attributeControl:["RaceConflict"]},keyMap:{request:{key:"key",value:"value"}}}}(e)),this._configMap.set(wi,function(e){return{head:t(t({},e),{},{servcmd:"".concat(x.NAME.GROUP,".").concat(x.CMD.MODIFY_GROUP_ATTRIBUTES)}),body:{groupID:void 0,groupAttributeList:void 0,mainSequence:void 0,avChatRoomKey:void 0,attributeControl:["RaceConflict"]},keyMap:{request:{key:"key",value:"value"}}}}(e)),this._configMap.set(Ai,function(e){return{head:t(t({},e),{},{servcmd:"".concat(x.NAME.GROUP,".").concat(x.CMD.DELETE_GROUP_ATTRIBUTES)}),body:{groupID:void 0,groupAttributeList:void 0,mainSequence:void 0,avChatRoomKey:void 0,attributeControl:["RaceConflict"]},keyMap:{request:{key:"key"}}}}(e)),this._configMap.set(bi,function(e){return{head:t(t({},e),{},{servcmd:"".concat(x.NAME.GROUP,".").concat(x.CMD.CLEAR_GROUP_ATTRIBUTES)}),body:{groupID:void 0,mainSequence:void 0,avChatRoomKey:void 0,attributeControl:["RaceConflict"]}}}(e)),this._configMap.set(Li,function(e){return{head:t(t({},e),{},{servcmd:"".concat(x.NAME.GROUP_ATTR,".").concat(x.CMD.GET_GROUP_ATTRIBUTES)}),body:{groupID:void 0,avChatRoomKey:void 0,groupType:1},keyMap:{request:{avChatRoomKey:"Key",groupType:"GroupType"}}}}(e)),this._configMap.set(Ni,function(e){return{head:t(t({},e),{},{servcmd:"".concat(x.NAME.GROUP,".").concat(x.CMD.GET_GROUP_NOTIFY)}),body:{notifyType:1,groupID:"",beginTime:0,endTime:0,limit:20},keyMap:{request:{},response:{NextMsgTime:"nextRevokedTime",NotifyMsgList:"notifyList"}}}}(e)),this._configMap.set(Pi,function(e){return{head:t(t({},e),{},{servcmd:"".concat(x.NAME.GROUP,".").concat(x.CMD.UPDATE_GROUP_COUNTER)}),body:{groupID:void 0,counterList:void 0,avChatRoomKey:void 0,mode:void 0},keyMap:{request:{counterList:"GroupCounter"}}}}(e)),this._configMap.set(Ui,function(e){return{head:t(t({},e),{},{servcmd:"".concat(x.NAME.GROUP,".").concat(x.CMD.GET_GROUP_COUNTER)}),body:{groupID:void 0,keyList:[],avChatRoomKey:void 0},keyMap:{request:{keyList:"GroupCounterKeys"}}}}(e)),this._configMap.set(Qi,function(e){return{head:t(t({},e),{},{servcmd:"".concat(x.NAME.GROUP_COMMUNITY,".").concat(x.CMD.CREATE_TOPIC)}),body:{groupID:void 0,topicName:void 0,avatar:void 0,customData:void 0,topicID:void 0,notification:void 0,introduction:void 0},keyMap:{request:{avatar:"FaceUrl"}}}}(e)),this._configMap.set(eo,function(e){return{head:t(t({},e),{},{servcmd:"".concat(x.NAME.GROUP_COMMUNITY,".").concat(x.CMD.DELETE_TOPIC)}),body:{groupID:void 0,topicIDList:void 0},keyMap:{request:{topicIDList:"TopicIdList"},response:{DestroyResultItem:"resultList"}}}}(e)),this._configMap.set(to,function(e){return{head:t(t({},e),{},{servcmd:"".concat(x.NAME.GROUP_COMMUNITY,".").concat(x.CMD.UPDATE_TOPIC_PROFILE)}),body:{groupID:void 0,topicID:void 0,avatar:void 0,customData:void 0,notification:void 0,introduction:void 0,muteAllMembers:void 0,topicName:void 0},keyMap:{request:{avatar:"FaceUrl",muteAllMembers:"ShutUpAllMember"}}}}(e)),this._configMap.set(no,function(e){return{head:t(t({},e),{},{servcmd:"".concat(x.NAME.GROUP_COMMUNITY,".").concat(x.CMD.GET_TOPIC_LIST)}),body:{groupID:void 0,topicIDList:void 0,MemberInfoFilter:["NoUnreadSeqList"]},keyMap:{request:{topicIDList:"TopicIdList"},response:{TopicAndSelfInfo:"topicInfoList",TopicInfo:"topic",GroupID:"groupID",ShutUpTime:"muteTime",ShutUpAllFlag:"muteAllMembers",LastMsgTime:"lastMessageTime",MsgSeq:"readedSequence",LastMsgSeq:"sequence",NoUnreadSeqList:"excludedUnreadSequenceList"}}}}(e)),this._configMap.set(Gi,function(e){return{head:t(t({},e),{},{servcmd:"".concat(x.NAME.GROUP,".").concat(x.CMD.GET_GROUP_MEMBER_LIST)}),body:{groupID:void 0,limit:0,offset:void 0,next:void 0,memberRoleFilter:void 0,memberInfoFilter:["Role","NameCard","ShutUpUntil","JoinTime"],memberCustomFieldFilter:void 0},keyMap:{request:{memberCustomFieldFilter:"AppDefinedDataFilter_GroupMember"},response:{AppMemberDefinedData:"memberCustomField",AppDefinedDataFilter_GroupMember:"memberCustomFieldFilter",MemberList:"members",ShutUpUntil:"muteUntil"}}}}(e)),this._configMap.set(xi,function(e){return{head:t(t({},e),{},{servcmd:"".concat(x.NAME.GROUP_AVCHATROOM,".").concat(x.CMD.GET_AVCHATROOM_MEMBER_LIST)}),body:{groupID:void 0,offset:void 0,filter:void 0},keyMap:{request:{offset:"Timestamp",filter:"Mark"},response:{NextTimestamp:"offset"}}}}(e)),this._configMap.set(Fi,function(e){return{head:t(t({},e),{},{servcmd:"".concat(x.NAME.GROUP,".").concat(x.CMD.GET_GROUP_MEMBER_INFO)}),body:{groupID:void 0,userIDList:void 0,memberInfoFilter:void 0,memberCustomFieldFilter:void 0},keyMap:{request:{userIDList:"Member_List_Account",memberCustomFieldFilter:"AppDefinedDataFilter_GroupMember"},response:{MemberList:"members",ShutUpUntil:"muteUntil",AppDefinedDataFilter_GroupMember:"memberCustomFieldFilter",AppMemberDefinedData:"memberCustomField"}}}}(e)),this._configMap.set(qi,function(e){return{head:t(t({},e),{},{servcmd:"".concat(x.NAME.GROUP,".").concat(x.CMD.ADD_GROUP_MEMBER)}),body:{groupID:void 0,silence:void 0,userIDList:void 0},keyMap:{request:{userID:"Member_Account",userIDList:"MemberList"},response:{MemberList:"members"}}}}(e)),this._configMap.set(Bi,function(e){return{head:t(t({},e),{},{servcmd:"".concat(x.NAME.GROUP,".").concat(x.CMD.DELETE_GROUP_MEMBER)}),body:{groupID:void 0,userIDList:void 0,reason:void 0},keyMap:{request:{userIDList:"MemberToDel_Account"}}}}(e)),this._configMap.set($i,function(e){return{head:t(t({},e),{},{servcmd:"".concat(x.NAME.GROUP,".").concat(x.CMD.BAN_AVCHATROOM_MEMBER)}),body:{groupID:void 0,userIDList:void 0,duration:void 0,reason:""},keyMap:{request:{userIDList:"Members_Account",duration:"Duration",reason:"Description"}}}}(e)),this._configMap.set(Vi,function(e){return{head:t(t({},e),{},{servcmd:"".concat(x.NAME.GROUP,".").concat(x.CMD.MODIFY_GROUP_MEMBER_INFO)}),body:{groupID:void 0,topicID:void 0,userID:void 0,messageRemindType:void 0,nameCard:void 0,role:void 0,memberCustomField:void 0,muteTime:void 0},keyMap:{request:{userID:"Member_Account",memberCustomField:"AppMemberDefinedData",muteTime:"ShutUpTime",messageRemindType:"MsgFlag"}}}}(e)),this._configMap.set(Hi,function(e){return{head:t(t({},e),{},{servcmd:"".concat(x.NAME.GROUP_AVCHATROOM,".").concat(x.CMD.MARK_AVCHATROOM_MEMBER_INFO)}),body:{groupID:void 0,operationType:1,memberList:[]},keyMap:{request:{operationType:"CommandType",memberList:"MemberList",markType:"Marks",userID:"Member_Account"},response:{CommandType:"operationType",Marks:"markType",Member_Account:"userID"}}}}(e)),this._configMap.set(zi,function(e){return{head:t(t({},e),{},{servcmd:"".concat(x.NAME.IM_OPEN_STAT,".").concat(x.CMD.TIM_WEB_REPORT_V2)}),body:{header:{},event:[],quality:[]},keyMap:{request:{SDKType:"sdk_type",SDKVersion:"sdk_version",deviceType:"device_type",platform:"platform",instanceID:"instance_id",traceID:"trace_id",SDKAppID:"sdk_app_id",userID:"user_id",tinyID:"tiny_id",extension:"extension",timestamp:"timestamp",networkType:"network_type",eventType:"event_type",code:"error_code",message:"error_message",moreMessage:"more_message",duplicate:"duplicate",costTime:"cost_time",level:"level",qualityType:"quality_type",reportIndex:"report_index",wholePeriod:"whole_period",totalCount:"total_count",rttCount:"success_count_business",successRateOfRequest:"percent_business",countLessThan1Second:"success_count_business",percentOfCountLessThan1Second:"percent_business",countLessThan3Second:"success_count_platform",percentOfCountLessThan3Second:"percent_platform",successCountOfBusiness:"success_count_business",successRateOfBusiness:"percent_business",successCountOfPlatform:"success_count_platform",successRateOfPlatform:"percent_platform",successCountOfMessageReceived:"success_count_business",successRateOfMessageReceived:"percent_business",avgRTT:"average_value",avgDelay:"average_value",avgValue:"average_value",uiPlatform:"ui_platform"}}}}(i)),this._configMap.set("alive",function(e){return{head:t(t({},e),{},{servcmd:"".concat(x.NAME.HEARTBEAT,".").concat(x.CMD.ALIVE)}),body:{}}}(e)),this._configMap.set("msg_push",function(e){return{head:t(t({},e),{},{servcmd:"".concat(x.NAME.IM_OPEN_PUSH,".").concat(x.CMD.MESSAGE_PUSH)}),body:{},keyMap:{response:{C2cMsgArray:"C2CMessageArray",GroupMsgArray:"groupMessageArray",GroupTips:"groupTips",C2cNotifyMsgArray:"C2CNotifyMessageArray",C2cMsgInfo:"C2CReadReceiptArray",ClientSeq:"clientSequence",MsgPriority:"priority",NoticeSeq:"noticeSequence",MsgContent:"content",MsgType:"type",MsgBody:"elements",ToGroupId:"to",Desc:"description",Ext:"extension",IsSyncMsg:"isSyncMessage",Flag:"needSync",NeedAck:"needAck",PendencyAdd_Account:"userID",ProfileImNick:"nick",PendencyType:"applicationType",C2CReadAllMsg:"readAllC2CMessage",IsNeedReadReceipt:"needReadReceipt",Status:"statusType"}}}}(e)),this._configMap.set("multi_msg_push_ws",function(e){return{head:t(t({},e),{},{servcmd:"".concat(x.NAME.IM_OPEN_PUSH,".").concat(x.CMD.MULTI_MESSAGE_PUSH)}),body:{},keyMap:{response:{GroupMsgArray:"groupMessageArray",GroupTips:"groupTips",ClientSeq:"clientSequence",MsgPriority:"priority",NoticeSeq:"noticeSequence",MsgContent:"content",MsgType:"type",MsgBody:"elements",ToGroupId:"to",Desc:"description",Ext:"extension",IsSyncMsg:"isSyncMessage",Flag:"needSync",NeedAck:"needAck",PendencyType:"applicationType"}}}}(e)),this._configMap.set(Yi,function(e){return{head:t(t({},e),{},{servcmd:"".concat(x.NAME.OPEN_IM,".").concat(x.CMD.MESSAGE_PUSH_ACK)}),body:{sessionData:void 0},keyMap:{request:{sessionData:"SessionData"}}}}(e)),this._configMap.set("stat_forceoffline",function(e){return{head:t(t({},e),{},{servcmd:"".concat(x.NAME.IM_OPEN_STATUS,".").concat(x.CMD.STATUS_FORCE_OFFLINE)}),body:{},keyMap:{response:{C2cNotifyMsgArray:"C2CNotifyMessageArray",NoticeSeq:"noticeSequence",KickoutMsgNotify:"kickoutMsgNotify",NewInstInfo:"newInstanceInfo"}}}}(e)),this._configMap.set(Ji,function(e){return{head:t(t({},e),{},{servcmd:"".concat(x.NAME.IM_LONG_MESSAGE,".").concat(x.CMD.DOWNLOAD_MERGER_MESSAGE)}),body:{downloadKey:""},keyMap:{response:{Data:"data",Desc:"description",Ext:"extension",Download_Flag:"downloadFlag",ThumbUUID:"thumbUUID",VideoUUID:"videoUUID"}}}}(e)),this._configMap.set(Wi,function(e){return{head:t(t({},e),{},{servcmd:"".concat(x.NAME.IM_LONG_MESSAGE,".").concat(x.CMD.UPLOAD_MERGER_MESSAGE)}),body:{messageList:[]},keyMap:{request:{fromAccount:"From_Account",toAccount:"To_Account",msgTimeStamp:"MsgTimeStamp",msgSeq:"MsgSeq",msgRandom:"MsgRandom",msgBody:"MsgBody",type:"MsgType",content:"MsgContent",data:"Data",description:"Desc",extension:"Ext",sizeType:"Type",uuid:"UUID",url:"",imageUrl:"URL",fileUrl:"Url",remoteAudioUrl:"Url",remoteVideoUrl:"VideoUrl",thumbUUID:"ThumbUUID",videoUUID:"VideoUUID",videoUrl:"",downloadFlag:"Download_Flag",from:"From_Account",time:"MsgTimeStamp",messageRandom:"MsgRandom",messageSequence:"MsgSeq",elements:"MsgBody",clientSequence:"ClientSeq",payload:"MsgContent",messageList:"MsgList",messageNumber:"MsgNum",abstractList:"AbstractList",messageBody:"MsgBody"}}}}(e)),this._configMap.set(uo,function(e){return{head:t(t({},e),{},{servcmd:"".concat(x.NAME.IM_OPEN_STATUS,".").concat(x.CMD.SET_TOKEN)}),body:{tokenID:"",pushMsg:0,sdkAppID:0,businessID:"",deviceBrand:"",deviceToken:"",isTpns:0,isWebUniapp:0},keyMap:{request:{tokenID:"TokenID",pushMsg:"PushMsg",sdkAppID:"EnterVersion",businessID:"BusiID",deviceBrand:"InstType",deviceToken:"VarToken",isTpns:"IsTpns"}}}}(e)),this._configMap.set(co,function(e){return{head:t(t({},e),{},{servcmd:"".concat(x.NAME.IM_OPEN_STATUS,".").concat(x.CMD.STAT_FOREGROUND)}),body:{isWebUniapp:0}}}(e)),this._configMap.set(ao,function(e){return{head:t(t({},e),{},{servcmd:"".concat(x.NAME.IM_OPEN_STATUS,".").concat(x.CMD.STAT_BACKGROUND)}),body:{C2CUnread:0,GroupUnread:0,isWebUniapp:0},keyMap:{request:{c2cUnreadCount:"C2cUnread",groupUnreadCount:"GrpUnread"}}}}(e))}},{key:"has",value:function(e){return this._configMap.has(e)}},{key:"get",value:function(e){return this._configMap.get(e)}},{key:"update",value:function(){this._fillConfigMap()}},{key:"getKeyMap",value:function(e){return this.has(e)?this.get(e).keyMap||{}:(Le.w("".concat(this._n,".getKeyMap unknown protocolName:").concat(e)),{})}},{key:"getProtocolData",value:function(e){var t=e.protocolName,n=e.requestData,i=this.get(t),o=null;if(n){var s=this._simpleDeepCopy(i),r=this._updateService(n,s),a=r.body,c=Object.create(null);for(var u in a)if(Object.prototype.hasOwnProperty.call(a,u)){if(c[u]=a[u],void 0===n[u])continue;c[u]=n[u]}r.body=c,o=this._getUplinkData(r)}else o=this._getUplinkData(i);return o}},{key:"_getUplinkData",value:function(e){var t=this._requestDataCleaner(e),n=St(t.head),i=function(e,t){var n=0;return function e(t,i){if(++n>100)return n--,t;if(ze(t)){var o=t.map((function(t){return Ke(t)?e(t,i):t}));return n--,o}if(Ke(t)){var s=(r=t,a=function(e,t){if(!Qe(t))return!1;if((o=t)!==cr(o))for(var n=0;n<ar.ignoreKeyWord.length&&!t.includes(ar.ignoreKeyWord[n]);n++);var o;return Ye(i[t])?function(e){return"OPPOChannelID"===e?e:e[0].toUpperCase()+cr(e).slice(1)}(t):i[t]},c=Object.create(null),Object.keys(r).forEach((function(e){var t=a(r[e],e);t&&(c[t]=r[e])})),c);return s=mt(s,(function(t,n){return ze(t)||Ke(t)?e(t,i):t})),n--,s}var r,a,c}(e,t)}(t.body,this._getRequestKeyMap(n));return t.body=i,t}},{key:"_updateService",value:function(e,t){var n=St(t.head);if(this._isFromGroupRequest(t)){var i=e.type,o=e.groupID,s=void 0===o?void 0:o,r=e.groupIDList,a=void 0===r?[]:r;Ye(s)&&(s=a[0]||""),ht({type:i,groupID:s})&&(t.head.servcmd="".concat(x.NAME.GROUP_COMMUNITY,".").concat(n))}return t}},{key:"_isFromGroupRequest",value:function(e){return e.head.servcmd.includes(x.NAME.GROUP)||e.head.servcmd.includes(x.NAME.GROUP_ATTR)}},{key:"_getRequestKeyMap",value:function(e){var n=this.getKeyMap(e);return t(t({},ar.request),n.request)}},{key:"_requestDataCleaner",value:function(e){var t=Array.isArray(e)?[]:Object.create(null);for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&Qe(i)&&null!==e[i]&&void 0!==e[i]&&("object"!==n(e[i])?t[i]=e[i]:t[i]=this._requestDataCleaner.bind(this)(e[i]));return t}},{key:"_simpleDeepCopy",value:function(e){for(var t,n=Object.keys(e),i={},o=0,s=n.length;o<s;o++)t=n[o],ze(e[t])?i[t]=Array.from(e[t]):Ke(e[t])?i[t]=this._simpleDeepCopy(e[t]):i[t]=e[t];return i}}]),e}(),Sr=[Yi],Er=function(){function e(t){r(this,e),this._sessionModule=t,this._n="DownlinkHandler",this._eventHandlerMap=new Map,this._eventHandlerMap.set("C2CMessageArray",this._c2cMessageArrayHandler.bind(this)),this._eventHandlerMap.set("groupMessageArray",this._groupMessageArrayHandler.bind(this)),this._eventHandlerMap.set("groupTips",this._groupTipsHandler.bind(this)),this._eventHandlerMap.set("C2CNotifyMessageArray",this._C2CNotifyMessageArrayHandler.bind(this)),this._eventHandlerMap.set("C2CReadReceiptArray",this._C2CReadReceiptArrayHandler.bind(this)),this._eventHandlerMap.set("profileModify",this._profileHandler.bind(this)),this._eventHandlerMap.set("friendListMod",this._relationChainHandler.bind(this)),this._eventHandlerMap.set("recentContactMod",this._recentContactHandler.bind(this)),this._eventHandlerMap.set("readAllC2CMessage",this._allMessageReadHandler.bind(this)),this._eventHandlerMap.set("c2cMessageModified",this._c2cMessageModifiedHandler.bind(this)),this._eventHandlerMap.set("groupMessageModified",this._groupMessageModifiedHandler.bind(this)),this._eventHandlerMap.set("userStatusList",this._userStatusListHandler.bind(this)),this._eventHandlerMap.set("messageExtensionNotify",this._messageExtensionNotifyHandler.bind(this)),this._keys=C(this._eventHandlerMap.keys())}return u(e,[{key:"_c2cMessageArrayHandler",value:function(e){var t=this._sessionModule.getModule(6);t&&(e.dataList.forEach((function(e){if(1===e.isSyncMessage){var t=e.from;e.from=e.to,e.to=t}})),1===e.needSync&&this._sessionModule.getModule(19).startOnlineSync(),t.onNewC2CMessage({dataList:e.dataList,isInstantMessage:!0}))}},{key:"_c2cMessageModifiedHandler",value:function(e){var t=this._sessionModule.getModule(6);t&&t.onC2CMessageModified(e)}},{key:"_groupMessageArrayHandler",value:function(e){var t=this._sessionModule.getModule(7);t&&t.onNewGroupMessage({event:e.event,dataList:e.dataList,isInstantMessage:!0})}},{key:"_groupMessageModifiedHandler",value:function(e){var t=this._sessionModule.getModule(7);t&&t.onGroupMessageModified(e)}},{key:"_groupTipsHandler",value:function(e){var t=this._sessionModule.getModule(7);if(t){var n=e.event,i=e.dataList,o=e.isInstantMessage,s=void 0===o||o,r=e.isSyncingEnded;switch(n){case 4:case 6:t.onNewGroupTips({event:n,dataList:i});break;case 5:for(var a=0;a<i.length;a++)if(ze(i[a].elements.revokedInfos))t.onGroupMessageRevoked({dataList:i});else if(ze(i[a].elements.groupMessageReadNotice))t.onGroupMessageReadNotice({dataList:i});else{if(!ze(i[a].elements.readReceiptList)){t.onNewGroupSystemNotice({dataList:i,isInstantMessage:s,isSyncingEnded:r});break}t.onReadReceiptList({dataList:i})}break;case 12:this._sessionModule.getModule(11).onNewGroupAtTips({dataList:i});break;default:Le.l("".concat(this._n,"._groupTipsHandler unknown event:").concat(n," dataList:"),i)}}}},{key:"_C2CNotifyMessageArrayHandler",value:function(e){var t=this,n=e.dataList;if(ze(n)){var i=this._sessionModule.getModule(6);n.forEach((function(e){if(je(e))if(e.hasOwnProperty("kickoutMsgNotify")){var o=e.kickoutMsgNotify,s=o.kickType,r=o.newInstanceInfo,a=void 0===r?{}:r;1===s?t._sessionModule.onMultipleAccountKickedOut(a):2===s?t._sessionModule.onMultipleDeviceKickedOut(a):3===s&&t._sessionModule.onRestApiKickedOut(a)}else e.hasOwnProperty("c2cMessageRevokedNotify")?i&&i.onC2CMessageRevoked({dataList:n}):e.hasOwnProperty("c2cMessageReadReceipt")?i&&i.onC2CMessageReadReceipt({dataList:n}):e.hasOwnProperty("c2cMessageReadNotice")?i&&i.onC2CMessageReadNotice({dataList:n}):e.hasOwnProperty("muteNotificationsSync")&&t._sessionModule.getModule(11).onC2CMessageRemindTypeSynced({dataList:n})}))}}},{key:"_C2CReadReceiptArrayHandler",value:function(e){this._sessionModule.getModule(6).onReadReceiptList(e)}},{key:"_profileHandler",value:function(e){this._sessionModule.getModule(4).onProfileModified({dataList:e.dataList});var t=this._sessionModule.getModule(8);t&&t.onFriendProfileModified({dataList:e.dataList})}},{key:"_relationChainHandler",value:function(e){this._sessionModule.getModule(4).onRelationChainModified({dataList:e.dataList});var t=this._sessionModule.getModule(8);t&&t.onRelationChainModified({dataList:e.dataList})}},{key:"_recentContactHandler",value:function(e){var t=e.dataList;if(ze(t)){var n=this._sessionModule.getModule(11);n&&t.forEach((function(e){var t=e.pushType;if(1===t){var i=e.recentContactDeleteItem;n.onConversationDeleted(i.recentContactList)}else if(2===t){var o=e.recentContactTopItem;n.onConversationPinned(o.recentContactList)}else if(3===t){var s=e.recentContactTopItem;n.onConversationUnpinned(s.recentContactList)}else if(4===t){var r=e.recentContactMarkContact;n.onConversationMarkUpdated(r.recentContactMarkContactItem)}else if(5===t){var a=e.recentContactCreateContactGroup;n.onConversationGroupCreated(a.msgContactGroupContactItem)}else if(6===t){var c=e.recentContactDelContactGroup;n.onConversationGroupDeleted(c.msgGroupItem)}else if(7===t){var u=e.recentContactUpdateContactGroup,l=u.updateType,d=u.msgUpdateGroup,p=u.msgUpdateContact;if(1===l){var h=d.updateGroupType;1===h?n.onConversationGroupNameUpdated(d):2===h&&n.onConversationInGroupUpdated(d)}else 2===l&&n.onConversationAddedToOrDeletedFromGroup(p)}}))}}},{key:"_allMessageReadHandler",value:function(e){var t=e.dataList,n=this._sessionModule.getModule(11);n&&n.onPushedAllMessageRead(t)}},{key:"_userStatusListHandler",value:function(e){this._sessionModule.getModule(4).onUserStatusUpdated(e)}},{key:"_messageExtensionNotifyHandler",value:function(e){this._sessionModule.getModule(3).onMessageExtensionNotify(e)}},{key:"onMessage",value:function(e){var t=this,n=e.body;if(this._filterMessageFromIMOpenPush(e)){var i=n.eventArray,o=n.isInstantMessage,s=n.isSyncingEnded,r=n.needSync;if(ze(i))for(var a=null,c=null,u=0,l=0,d=i.length;l<d;l++){u=(a=i[l]).event;var p=Object.keys(a).find((function(e){return-1!==t._keys.indexOf(e)}));p?(c=14===u?{readAllC2CMessage:a[p],groupMessageReadInfoList:a.groupMessageReadNotice||[]}:16===u?{userID:a.userID,readReceiptList:a[p]}:a[p],this._eventHandlerMap.get(p)({event:u,dataList:c,isInstantMessage:o,isSyncingEnded:s,needSync:r})):Le.l("".concat(this._n,".onMessage unknown eventItem:").concat(a))}}}},{key:"_filterMessageFromIMOpenPush",value:function(e){var t=e.head,n=e.body,i=t.servcmd,o=!1;if(Ye(i)||(o=i.includes(x.NAME.IM_CONFIG_MANAGER)||i.includes(x.NAME.OVERLOAD_PUSH)||i.includes(x.NAME.STAT_SERVICE)),!o)return!0;if(i.includes(x.CMD.PUSHED_CLOUD_CONTROL_CONFIG))this._sessionModule.getModule(23).onPushedCloudControlConfig(n);else if(i.includes(x.CMD.PUSHED_COMMERCIAL_CONFIG))this._sessionModule.getModule(27).onPushedConfig(n);else if(i.includes(x.CMD.OVERLOAD_NOTIFY))this._sessionModule.onPushedServerOverload(n);else if(i.includes(x.CMD.KICK_OTHER)){var s=Date.now();this._sessionModule.reLoginOnKickOther();var r=new wo("kickOther"),a=this._sessionModule.getModule(1).getLastWsHelloTs(),c=s-a;r.setMessage("last wshello time:".concat(a," diff:").concat(c,"ms")).setNetworkType(this._sessionModule.getNetworkType()).end()}return!1}}]),e}(),Dr=[{cmd:x.CMD.GET_GROUP_INFO,interval:1,count:20},{cmd:x.CMD.GET_AVCHATROOM_MEMBER_LIST,interval:3,count:1},{cmd:x.CMD.GET_GROUP_APPLICATION,interval:1,count:15},{cmd:x.CMD.GET_TOPIC_LIST,interval:1,count:10},{cmd:x.CMD.SET_GROUP_ATTRIBUTES,interval:5,count:10},{cmd:x.CMD.MODIFY_GROUP_ATTRIBUTES,interval:5,count:10},{cmd:x.CMD.DELETE_GROUP_ATTRIBUTES,interval:5,count:10},{cmd:x.CMD.CLEAR_GROUP_ATTRIBUTES,interval:5,count:10},{cmd:x.CMD.GET_GROUP_ATTRIBUTES,interval:5,count:20},{cmd:x.CMD.UPDATE_GROUP_COUNTER,interval:5,count:20},{cmd:x.CMD.GET_GROUP_COUNTER,interval:5,count:20},{cmd:x.CMD.SET_ALL_MESSAGE_READ,interval:1,count:1},{cmd:x.CMD.GET_USER_STATUS,interval:5,count:20},{cmd:x.CMD.SUBSCRIBE_USER_STATUS,interval:5,count:20},{cmd:x.CMD.UNSUBSCRIBE_USER_STATUS,interval:5,count:20}],wr=function(e){d(i,e);var n=M(i);function i(e){var t;return r(this,i),(t=n.call(this,e))._n="SessionModule",t._platform=t.getPlatform(),t._protocolHandler=new kr(m(t)),t._messageDispatcher=new Er(m(t)),t._commandFrequencyLimitMap=new Map,t._commandRequestInfoMap=new Map,t._serverOverloadInfoMap=new Map,t._init(),t.getInnerEmitterInstance().on(Qo,t._onCloudConfigUpdated,m(t)),t}return u(i,[{key:"_init",value:function(){this._updateCommandFrequencyLimitMap(Dr)}},{key:"_onCloudConfigUpdated",value:function(){var e=this.getCloudConfig("cmd_frequency_limit");Ye(e)||(e=JSON.parse(e),this._updateCommandFrequencyLimitMap(e))}},{key:"_updateCommandFrequencyLimitMap",value:function(e){var t=this;e.forEach((function(e){t._commandFrequencyLimitMap.set(e.cmd,{interval:e.interval,count:e.count})}))}},{key:"updateProtocolConfig",value:function(){this._protocolHandler.update()}},{key:"request",value:function(e){Le.d("".concat(this._n,".request options:"),e);var t=e.protocolName,n=e.tjgID;if(!this._protocolHandler.has(t))return Le.w("".concat(this._n,".request unknown protocol:").concat(t)),Wo({code:ho.CANNOT_FIND_PROTOCOL});var i=this.getProtocolData(e),o=i.head.servcmd;if(this._isFrequencyOverLimit(o))return Wo({code:ho.OVER_FREQUENCY_LIMIT});if(this._isServerOverload(o))return Wo({code:ho.OPEN_SERVICE_OVERLOAD_ERROR});Gt(n)||(i.head.tjgID=n);var s=this.getModule(21);return Sr.includes(t)?s.simplySend(i):s.send(i)}},{key:"getKeyMap",value:function(e){return this._protocolHandler.getKeyMap(e)}},{key:"genCommonHead",value:function(){var e=this.getModule(12);return{ver:"v4",platform:this._platform,websdkappid:U,websdkversion:P,a2:e.getA2Key()||void 0,tinyid:e.getTinyID()||void 0,status_instid:e.getStatusInstanceID(),sdkappid:e.getSDKAppID(),contenttype:e.getContentType(),reqtime:0,identifier:e.getA2Key()?void 0:e.getUserID(),usersig:e.getA2Key()?void 0:e.getUserSig(),sdkability:192371,tjgID:""}}},{key:"genCosSpecifiedHead",value:function(){var e=this.getModule(12);return{ver:"v4",platform:this._platform,websdkappid:U,websdkversion:P,sdkappid:e.getSDKAppID(),contenttype:e.getContentType(),reqtime:0,identifier:e.getUserID(),usersig:e.getUserSig(),status_instid:e.getStatusInstanceID(),sdkability:192371}}},{key:"genSSOReportHead",value:function(){var e=this.getModule(12);return{ver:"v4",platform:this._platform,websdkappid:U,websdkversion:P,sdkappid:e.getSDKAppID(),contenttype:"",reqtime:0,identifier:"",usersig:"",status_instid:e.getStatusInstanceID(),sdkability:192371}}},{key:"getProtocolData",value:function(e){return this._protocolHandler.getProtocolData(e)}},{key:"trans",value:function(e){var n=e.servcmd,i=e.data,o={head:t(t({},this.genCommonHead()),{},{servcmd:n}),body:i};return this.getModule(21).send(o)}},{key:"sendComboMessage",value:function(e){var n=e.servcmd,i=e.data,o={head:t(t({},this.genCommonHead()),{},{servcmd:n}),body:i};return this.getModule(21).send(o)}},{key:"onErrorCodeNotZero",value:function(e){var t=e.errorCode;if(t===ho.HELLO_ANSWER_KICKED_OUT){var n=e.kickType,i=e.newInstanceInfo,o=void 0===i?{}:i;1===n?this.onMultipleAccountKickedOut(o):2===n?this.onMultipleDeviceKickedOut(o):3===n&&this.onRestApiKickedOut(o)}t!==ho.MESSAGE_A2KEY_EXPIRED&&t!==ho.ACCOUNT_A2KEY_EXPIRED||(this._onUserSigExpired(),this.getModule(21).reConnect())}},{key:"onMessage",value:function(e){var t=e.body,n=t.needAck,i=void 0===n?0:n,o=t.sessionData;1===i&&this._sendACK(o),this._messageDispatcher.onMessage(e)}},{key:"onReconnected",value:function(){this._reLoginOnReconnected()}},{key:"reLoginOnKickOther",value:function(){Le.l("".concat(this._n,".reLoginOnKickOther")),this._reLogin()}},{key:"_reLoginOnReconnected",value:function(){Le.l("".concat(this._n,"._reLoginOnReconnected")),this._reLogin()}},{key:"_reLogin",value:function(){var e=this;if(this.isLoggedIn()){var t=0,n=this.getModule(28);n.canIUseOfflinePush()&&(t=n.getUniAppPlatform()),this.request({protocolName:Mn,requestData:{isWebUniapp:t}}).then((function(t){var n=t.data.instanceID;e.getModule(12).setStatusInstanceID(n),Le.l("".concat(e._n,"._reLogin ok.")),e.getModule(11).syncConversationList().then((function(){Le.l("".concat(e._n,"._reLogin, sync conversation list ok.")),e.getModule(25).start()})),e.getModule(7).updateLocalMainSequenceOnReconnected();var i=e.getModule(10);i.resetGetTopicTime(),i.getTopicListOnReconnected()}))}}},{key:"onMultipleAccountKickedOut",value:function(e){this.getModule(1).onMultipleAccountKickedOut(e)}},{key:"onMultipleDeviceKickedOut",value:function(e){this.getModule(1).onMultipleDeviceKickedOut(e)}},{key:"_onUserSigExpired",value:function(){this.getModule(1).onUserSigExpired()}},{key:"onRestApiKickedOut",value:function(e){this.getModule(1).onRestApiKickedOut(e)}},{key:"_sendACK",value:function(e){this.request({protocolName:Yi,requestData:{sessionData:e}})}},{key:"_isFrequencyOverLimit",value:function(e){var t=e.split(".")[1];if(!this._commandFrequencyLimitMap.has(t))return!1;if(!this._commandRequestInfoMap.has(t))return this._commandRequestInfoMap.set(t,{startTime:Date.now(),requestCount:1}),!1;var n=this._commandFrequencyLimitMap.get(t),i=n.count,o=n.interval,s=this._commandRequestInfoMap.get(t),r=s.startTime,a=s.requestCount;if(Date.now()-r>1e3*o)return this._commandRequestInfoMap.set(t,{startTime:Date.now(),requestCount:1}),!1;a+=1,this._commandRequestInfoMap.set(t,{startTime:r,requestCount:a});var c=!1;return a>i&&(c=!0),c}},{key:"_isServerOverload",value:function(e){if(!this._serverOverloadInfoMap.has(e))return!1;var t=this._serverOverloadInfoMap.get(e),n=t.overloadTime,i=t.waitingTime,o=!1;return Date.now()-n<=1e3*i?o=!0:(this._serverOverloadInfoMap.delete(e),o=!1),o}},{key:"onPushedServerOverload",value:function(e){var t=e.overloadCommand,n=e.waitingTime;this._serverOverloadInfoMap.set(t,{overloadTime:Date.now(),waitingTime:n}),Le.w("".concat(this._n,".onPushedServerOverload waitingTime:").concat(n,"s"))}},{key:"reset",value:function(){Le.l("".concat(this._n,".reset")),this._updateCommandFrequencyLimitMap(Dr),this._commandRequestInfoMap.clear(),this._serverOverloadInfoMap.clear()}}]),i}(yn),Ar=function(e){d(n,e);var t=M(n);function n(e){var i;return r(this,n),(i=t.call(this,e))._n="MessageLossDetectionModule",i._maybeLostSequencesMap=new Map,i._firstRoundRet=[],i}return u(n,[{key:"onMessageMaybeLost",value:function(e,t,n){this._maybeLostSequencesMap.has(e)||this._maybeLostSequencesMap.set(e,[]);for(var i=this._maybeLostSequencesMap.get(e),o=0;o<n;o++)-1===i.indexOf(t+o)&&i.push(t+o)}},{key:"detectFirstRound",value:function(e,t){var n=this._maybeLostSequencesMap.get(e);if(!Gt(n)&&!Gt(t)){var i=n.filter((function(e){return-1===t.indexOf(e)}));0===i.length?Le.i("".concat(this._n,".detectFirstRound no message loss. conversationID:").concat(e)):this._firstRoundRet=this._firstRoundRet.concat(i),n.length=0}}},{key:"detectSecondRound",value:function(e,t){if(!Gt(this._firstRoundRet)&&!Gt(t)){var n=this._firstRoundRet.filter((function(e){return-1===t.indexOf(e)}));this._firstRoundRet.length=0;var i,o=n.length;0!==o&&(o<=5?i=e+"-"+n.join("-"):(n.sort((function(e,t){return e-t})),i=e+" start:"+n[0]+" end:"+n[o-1]+" count:"+o),new wo("messageLoss").setMessage(i).setNetworkType(this.getNetworkType()).setLevel("warning").end(),Le.i("".concat(this._n,".detectSecondRound message loss detected. conversationID:").concat(e," lostSequences:").concat(n)))}}},{key:"reset",value:function(){Le.l("".concat(this._n,".reset")),this._maybeLostSequencesMap.clear(),this._firstRoundRet.length=0}}]),n}(yn),br=function(e){d(n,e);var t=M(n);function n(e){var i;return r(this,n),(i=t.call(this,e))._n="CloudControlModule",i._cloudConfig=new Map,i._expiredTime=0,i._version=0,i._isFetching=!1,i}return u(n,[{key:"getCloudConfig",value:function(e){return Ye(e)?this._cloudConfig:this._cloudConfig.has(e)?this._cloudConfig.get(e):void 0}},{key:"_canFetchConfig",value:function(){return this.isLoggedIn()&&!this._isFetching&&Date.now()>=this._expiredTime}},{key:"fetchConfig",value:function(){var e=this,t=this._canFetchConfig();if(Le.l("".concat(this._n,".fetchConfig canFetchConfig:").concat(t)),t){var n=new wo("fetchCloudControlConfig"),i=this.getModule(12).getSDKAppID();this._isFetching=!0,this.request({protocolName:Xi,requestData:{SDKAppID:i,version:this._version}}).then((function(t){e._isFetching=!1,n.setMessage("version:".concat(e._version," newVersion:").concat(t.data.version," config:").concat(t.data.cloudControlConfig)).setNetworkType(e.getNetworkType()).end(),Le.l("".concat(e._n,".fetchConfig ok")),e._parseCloudControlConfig(t.data)})).catch((function(t){e._isFetching=!1,e.probeNetwork().then((function(e){var i=I(e,2),o=i[0],s=i[1];n.setError(t,o,s).end()})),Le.l("".concat(e._n,".fetchConfig failed. error:"),t),e._setExpiredTimeOnResponseError(12e4)}))}}},{key:"onPushedCloudControlConfig",value:function(e){Le.l("".concat(this._n,".onPushedCloudControlConfig")),new wo("pushedCloudControlConfig").setNetworkType(this.getNetworkType()).setMessage("newVersion:".concat(e.version," config:").concat(e.cloudControlConfig)).end(),this._parseCloudControlConfig(e)}},{key:"onCheckTimer",value:function(e){this._canFetchConfig()&&this.fetchConfig()}},{key:"_parseCloudControlConfig",value:function(e){var t=this,n="".concat(this._n,"._parseCloudControlConfig"),i=e.errorCode,o=e.errorMessage,s=e.cloudControlConfig,r=e.version,a=e.expiredTime;if(0===i){if(this._version!==r){var c=null;try{c=JSON.parse(s)}catch(h){this.isPrivateNetWork()||Le.e("".concat(n," JSON parse error. cloudControlConfig:"),s)}c&&(this._cloudConfig.clear(),Object.keys(c).forEach((function(e){t._cloudConfig.set(e,c[e])})),this._version=r,this.emitInnerEvent(Qo))}this._expiredTime=Date.now()+1e3*a}else Ye(i)?(Le.l("".concat(n," failed. Invalid message format:"),e),this._setExpiredTimeOnResponseError(36e5)):(Le.e("".concat(n," errorCode:").concat(i," errorMessage:").concat(o)),this._setExpiredTimeOnResponseError(12e4))}},{key:"_setExpiredTimeOnResponseError",value:function(e){this._expiredTime=Date.now()+e}},{key:"reset",value:function(){Le.l("".concat(this._n,".reset")),this._cloudConfig.clear(),this._expiredTime=0,this._version=0,this._isFetching=!1}}]),n}(yn),Lr=function(e){d(n,e);var t=M(n);function n(e){var i;return r(this,n),(i=t.call(this,e))._n="RecoverMessageModule",i.PULL_LIMIT_COUNT=15,i}return u(n,[{key:"start",value:function(){this._recoverGroupChat(),this._recoverC2CChat()}},{key:"_recoverGroupChat",value:function(){var e,t,n=this,i=this._getLocalConversationList().filter((function(e){return e.type===b.CONV_GROUP&&e.groupProfile.type!==b.GRP_AVCHATROOM})),o=this.getModule(11),s=0,r=0,a=0;i.forEach((function(i){var c=i.conversationID,u=i.lastMessage;t=c.replace(b.CONV_GROUP,""),e=o.getLocalLastMessage(c),u&&0!==u.lastSequence&&e?(r=u.lastSequence,s=e.sequence,a=r-s,s>0&&a>=1&&a<300?n._recoverGroupMessage({groupID:t,localLastMessageSequence:s,remoteLastMessageSequence:r}):n._getGroupNotify(t)):n._getGroupNotify(t)}))}},{key:"_recoverC2CChat",value:function(){var e,t=this,n=this._getLocalConversationList().filter((function(e){return e.type===b.CONV_C2C})),i=this.getModule(11),o=0,s=0,r=0,a=[Promise.resolve()];n.forEach((function(n){var c=n.conversationID,u=n.lastMessage;e=i.getLocalLastMessage(c),u&&0!==u.lastTime&&e&&(s=u.lastTime,o=e.time,r=s-o,o>0&&r>=1&&r<=600&&a.push(t._recoverC2CMessage({conversationID:c,localLastMessageTime:o,remoteLastMessageTime:s})))})),Promise.all(a).then((function(){Le.l("".concat(t._n,"._recoverC2CChat all promise fulfilled, start to sync unread messages")),t.getModule(19).startSyncOnReconnected()}))}},{key:"_getLocalConversationList",value:function(){return this.getModule(11).getLocalConversationList()}},{key:"_recoverGroupMessage",value:function(e){var t=this,n="".concat(this._n,"._recoverGroupMessage");Le.l("".concat(n," options:"),e);var i=e.groupID,o=e.localLastMessageSequence,s=e.remoteLastMessageSequence;this._getGroupRomaingMessage({groupID:i,sequence:o}).then((function(e){var o=e.data,r=o.complete,a=o.messageList;if(!Ye(a)){var c=a[0].sequence;Le.l("".concat(n," pkgLastMessageSequence:").concat(c," complete:").concat(r)),c<s&&2!==r&&t._recoverGroupMessage({groupID:i,localLastMessageSequence:c,remoteLastMessageSequence:s}),new wo("recoverMessage").setNetworkType(t.getNetworkType()).setMessage("groupID:".concat(i," complete:").concat(r," messageList length:").concat(a.length)).end(),t.getModule(7).onNewGroupMessage({dataList:a,isInstantMessage:!1,updateUnreadCount:!1}),t._getGroupNotify(i)}}))}},{key:"_getGroupNotify",value:function(e){this.getModule(7).getGroupNotify(e)}},{key:"_getGroupRomaingMessage",value:function(e){var t=e.groupID,n=e.sequence;return this.request({protocolName:gi,requestData:{groupID:t,count:this.PULL_LIMIT_COUNT,sequence:n+this.PULL_LIMIT_COUNT-1}})}},{key:"_recoverC2CMessage",value:function(e){var t=this,n="".concat(this._n,"._recoverC2CMessage");Le.l("".concat(this._n,"._recoverC2CMessage options:"),e);var i=e.conversationID,o=e.localLastMessageTime,s=e.remoteLastMessageTime;return this._getC2CRoamingMessage({conversationID:i,time:o}).then((function(e){var o=e.data,r=o.complete,a=o.messageList;if(!Ye(a)){var c=a.length;new wo("recoverMessage").setNetworkType(t.getNetworkType()).setMessage("".concat(i," complete:").concat(r," messageList length:").concat(c)).end(),t.getModule(6).onNewC2CMessage({dataList:a,isInstantMessage:!0});var u=a[c-1].time;if(Le.l("".concat(n," pkgLastMessageTime:").concat(u," complete:").concat(r)),u<s&&1!==r)return t._recoverC2CMessage({conversationID:i,localLastMessageTime:u,remoteLastMessageTime:s})}}))}},{key:"_getC2CRoamingMessage",value:function(e){var t=e.conversationID,n=e.time;return this.request({protocolName:Pn,requestData:{peerAccount:t.replace(b.CONV_C2C,""),count:this.PULL_LIMIT_COUNT+1,lastMessageTime:n,direction:1}})}},{key:"reset",value:function(){Le.l("".concat(this._n,".reset"))}}]),n}(yn),Rr=function(){function e(){r(this,e),this._n="AvgE2EDelay",this._e2eDelayArray=[]}return u(e,[{key:"addMessageDelay",value:function(e){var t=De()-e;t>=0&&this._e2eDelayArray.push(t)}},{key:"_calcAvg",value:function(e,t){if(0===t)return 0;var n=0;return e.forEach((function(e){n+=e})),Et(n/t,1)}},{key:"_calcCountWithLimit",value:function(e){var t=e.e2eDelayArray,n=e.min,i=e.max;return t.filter((function(e){return n<=e&&e<i})).length}},{key:"_calcPercent",value:function(e,t){var n=Et(e/t*100,2);return n>100&&(n=100),n}},{key:"_checkE2EDelayException",value:function(e,t){var n=e.filter((function(e){return e>t}));if(n.length>0){var i=n.length,o=Math.min.apply(Math,C(n)),s=Math.max.apply(Math,C(n)),r=this._calcAvg(n,i),a=Et(i/e.length*100,2);a>50&&new wo("messageE2EDelayException").setMessage("count:".concat(i," min:").concat(o," max:").concat(s," avg:").concat(r," percent:").concat(a)).setLevel("warning").end()}}},{key:"getStatResult",value:function(){var e=this._e2eDelayArray.length;if(0===e)return null;var t=C(this._e2eDelayArray),n=this._calcCountWithLimit({e2eDelayArray:t,min:0,max:1}),i=this._calcCountWithLimit({e2eDelayArray:t,min:1,max:3}),o=this._calcPercent(n,e),s=this._calcPercent(i,e),r=this._calcAvg(t,e);return this._checkE2EDelayException(t,3),t.length=0,this.reset(),{totalCount:e,countLessThan1Second:n,percentOfCountLessThan1Second:o,countLessThan3Second:i,percentOfCountLessThan3Second:s,avgDelay:r}}},{key:"reset",value:function(){this._e2eDelayArray.length=0}}]),e}(),Or=function(){function e(){r(this,e),this._n="AvgRTT",this._requestCount=0,this._rttArray=[]}return u(e,[{key:"addRequestCount",value:function(){this._requestCount+=1}},{key:"addRTT",value:function(e){this._rttArray.push(e)}},{key:"_calcTotalCount",value:function(){return this._requestCount}},{key:"_calcRTTCount",value:function(e){return e.length}},{key:"_calcSuccessRateOfRequest",value:function(e,t){if(0===t)return 0;var n=Et(e/t*100,2);return n>100&&(n=100),n}},{key:"_calcAvg",value:function(e,t){if(0===t)return 0;var n=0;return e.forEach((function(e){n+=e})),parseInt(n/t)}},{key:"_calcMax",value:function(){return Math.max.apply(Math,C(this._rttArray))}},{key:"_calcMin",value:function(){return Math.min.apply(Math,C(this._rttArray))}},{key:"getStatResult",value:function(){var e=this._calcTotalCount(),t=C(this._rttArray);if(0===e)return null;var n=this._calcRTTCount(t),i=this._calcSuccessRateOfRequest(n,e),o=this._calcAvg(t,n);return Le.l("".concat(this._n,".getStatResult max:").concat(this._calcMax()," min:").concat(this._calcMin()," avg:").concat(o)),this.reset(),{totalCount:e,rttCount:n,successRateOfRequest:i,avgRTT:o}}},{key:"reset",value:function(){this._requestCount=0,this._rttArray.length=0}}]),e}(),Nr=function(){function e(){r(this,e),this._map=new Map}return u(e,[{key:"initMap",value:function(e){var t=this;e.forEach((function(e){t._map.set(e,{totalCount:0,successCount:0,failedCountOfUserSide:0,costArray:[],fileSizeArray:[]})}))}},{key:"addTotalCount",value:function(e){return!(Ye(e)||!this._map.has(e))&&(this._map.get(e).totalCount+=1,!0)}},{key:"addSuccessCount",value:function(e){return!(Ye(e)||!this._map.has(e))&&(this._map.get(e).successCount+=1,!0)}},{key:"addFailedCountOfUserSide",value:function(e){return!(Ye(e)||!this._map.has(e))&&(this._map.get(e).failedCountOfUserSide+=1,!0)}},{key:"addCost",value:function(e,t){return!(Ye(e)||!this._map.has(e))&&(this._map.get(e).costArray.push(t),!0)}},{key:"addFileSize",value:function(e,t){return!(Ye(e)||!this._map.has(e))&&(this._map.get(e).fileSizeArray.push(t),!0)}},{key:"_calcSuccessRateOfBusiness",value:function(e){if(Ye(e)||!this._map.has(e))return-1;var t=this._map.get(e),n=Et(t.successCount/t.totalCount*100,2);return n>100&&(n=100),n}},{key:"_calcSuccessRateOfPlatform",value:function(e){if(Ye(e)||!this._map.has(e))return-1;var t=this._map.get(e),n=this._calcSuccessCountOfPlatform(e)/t.totalCount*100;return(n=Et(n,2))>100&&(n=100),n}},{key:"_calcTotalCount",value:function(e){return Ye(e)||!this._map.has(e)?-1:this._map.get(e).totalCount}},{key:"_calcSuccessCountOfBusiness",value:function(e){return Ye(e)||!this._map.has(e)?-1:this._map.get(e).successCount}},{key:"_calcSuccessCountOfPlatform",value:function(e){if(Ye(e)||!this._map.has(e))return-1;var t=this._map.get(e);return t.successCount+t.failedCountOfUserSide}},{key:"_calcAvg",value:function(e){return Ye(e)||!this._map.has(e)?-1:e===Mo?this._calcAvgSpeed(e):this._calcAvgCost(e)}},{key:"_calcAvgCost",value:function(e){var t=this._map.get(e).costArray.length;if(0===t)return 0;var n=0;return this._map.get(e).costArray.forEach((function(e){n+=e})),parseInt(n/t)}},{key:"_calcAvgSpeed",value:function(e){var t=0,n=0;return this._map.get(e).costArray.forEach((function(e){t+=e})),this._map.get(e).fileSizeArray.forEach((function(e){n+=e})),parseInt(1e3*n/t)}},{key:"getStatResult",value:function(e){var t=this._calcTotalCount(e);if(0===t)return null;var n=this._calcSuccessCountOfBusiness(e),i=this._calcSuccessRateOfBusiness(e),o=this._calcSuccessCountOfPlatform(e),s=this._calcSuccessRateOfPlatform(e),r=this._calcAvg(e);return this.reset(e),{totalCount:t,successCountOfBusiness:n,successRateOfBusiness:i,successCountOfPlatform:o,successRateOfPlatform:s,avgValue:r}}},{key:"reset",value:function(e){Ye(e)?this._map.clear():this._map.set(e,{totalCount:0,successCount:0,failedCountOfUserSide:0,costArray:[],fileSizeArray:[]})}}]),e}(),Pr=function(){function e(){r(this,e),this._lastMap=new Map,this._currentMap=new Map}return u(e,[{key:"initMap",value:function(e){var t=this;e.forEach((function(e){t._lastMap.set(e,new Map),t._currentMap.set(e,new Map)}))}},{key:"addMessageSequence",value:function(e){var t=e.key,n=e.message;if(Ye(t)||!this._lastMap.has(t)||!this._currentMap.has(t))return!1;var i=n.conversationID,o=n.sequence,s=i.replace(b.CONV_GROUP,"");if(0===this._lastMap.get(t).size)this._addCurrentMap(e);else if(this._lastMap.get(t).has(s)){var r=this._lastMap.get(t).get(s),a=r.length-1;o>r[0]&&o<r[a]?(r.push(o),r.sort(),this._lastMap.get(t).set(s,r)):this._addCurrentMap(e)}else this._addCurrentMap(e);return!0}},{key:"_addCurrentMap",value:function(e){var t=e.key,n=e.message,i=n.conversationID,o=n.sequence,s=i.replace(b.CONV_GROUP,"");this._currentMap.get(t).has(s)||this._currentMap.get(t).set(s,[]),this._currentMap.get(t).get(s).push(o)}},{key:"_copyData",value:function(e){if(!Ye(e)){this._lastMap.set(e,new Map);var t,n=this._lastMap.get(e),i=w(this._currentMap.get(e));try{for(i.s();!(t=i.n()).done;){var o=I(t.value,2),s=o[0],r=o[1];n.set(s,r)}}catch(d){i.e(d)}finally{i.f()}n=null,this._currentMap.set(e,new Map)}}},{key:"getStatResult",value:function(e){if(Ye(this._currentMap.get(e))||Ye(this._lastMap.get(e)))return null;if(0===this._lastMap.get(e).size)return this._copyData(e),null;var t=0,n=0;if(this._lastMap.get(e).forEach((function(e,i){var o=C(e.values()),s=o.length,r=o[s-1]-o[0]+1;t+=r,n+=s})),0===t)return null;var i=Et(n/t*100,2);return i>100&&(i=100),this._copyData(e),{totalCount:t,successCountOfMessageReceived:n,successRateOfMessageReceived:i}}},{key:"reset",value:function(){this._currentMap.clear(),this._lastMap.clear()}}]),e}(),Ur=function(e){d(i,e);var n=M(i);function i(e){var t;r(this,i),(t=n.call(this,e))._n="QualityStatModule",t.TAG="im-ssolog-quality-stat",t.reportIndex=0,t.wholePeriod=!1,t._qualityItems=[fo,go,_o,vo,mo,yo,Mo,Io,Co,To],t._messageSentItems=[_o,vo,mo,yo,Mo],t._messageReceivedItems=[Io,Co,To],t.REPORT_INTERVAL=120,t.REPORT_SDKAPPID_BLACKLIST=[],t.REPORT_TINYID_WHITELIST=[],t._statInfoArr=[],t._avgRTT=new Or,t._avgE2EDelay=new Rr,t._rateMessageSent=new Nr,t._rateMessageReceived=new Pr;var o=t.getInnerEmitterInstance();return o.on(Zo,t._onLoginSuccess,m(t)),o.on(Qo,t._onCloudConfigUpdated,m(t)),t}return u(i,[{key:"_onLoginSuccess",value:function(){var e=this;this._rateMessageSent.initMap(this._messageSentItems),this._rateMessageReceived.initMap(this._messageReceivedItems);var t=this.getModule(13),n=t.getItem(this.TAG,!1);!Gt(n)&&Je(n.forEach)&&(Le.l("".concat(this._n,"._onLoginSuccess get quality stat logs from local storage, count:").concat(n.length)),n.forEach((function(t){e._statInfoArr.push(t)})),t.removeItem(this.TAG,!1))}},{key:"_onCloudConfigUpdated",value:function(){var e=this.getCloudConfig("q_rpt_interval"),t=this.getCloudConfig("q_rpt_sdkappid_bl"),n=this.getCloudConfig("q_rpt_tinyid_wl");Ye(e)||(this.REPORT_INTERVAL=Number(e)),Ye(t)||(this.REPORT_SDKAPPID_BLACKLIST=t.split(",").map((function(e){return Number(e)}))),Ye(n)||(this.REPORT_TINYID_WHITELIST=n.split(","))}},{key:"onCheckTimer",value:function(e){this.isLoggedIn()&&e%this.REPORT_INTERVAL==0&&(this.wholePeriod=!0,this._report())}},{key:"addRequestCount",value:function(){this._avgRTT.addRequestCount()}},{key:"addRTT",value:function(e){this._avgRTT.addRTT(e)}},{key:"addMessageDelay",value:function(e){this._avgE2EDelay.addMessageDelay(e)}},{key:"addTotalCount",value:function(e){this._rateMessageSent.addTotalCount(e)||Le.w("".concat(this._n,".addTotalCount invalid key:"),e)}},{key:"addSuccessCount",value:function(e){this._rateMessageSent.addSuccessCount(e)||Le.w("".concat(this._n,".addSuccessCount invalid key:"),e)}},{key:"addFailedCountOfUserSide",value:function(e){this._rateMessageSent.addFailedCountOfUserSide(e)||Le.w("".concat(this._n,".addFailedCountOfUserSide invalid key:"),e)}},{key:"addCost",value:function(e,t){this._rateMessageSent.addCost(e,t)||Le.w("".concat(this._n,".addCost invalid key or cost:"),e,t)}},{key:"addFileSize",value:function(e,t){this._rateMessageSent.addFileSize(e,t)||Le.w("".concat(this._n,".addFileSize invalid key or size:"),e,t)}},{key:"addMessageSequence",value:function(e){this._rateMessageReceived.addMessageSequence(e)||Le.w("".concat(this._n,".addMessageSequence invalid key:"),e.key)}},{key:"_getQualityItem",value:function(e){var n={},i=Eo[this.getNetworkType()];Ye(i)&&(i=8);var o={qualityType:ko[e],timestamp:Se(),networkType:i,extension:""};switch(e){case fo:n=this._avgRTT.getStatResult();break;case go:n=this._avgE2EDelay.getStatResult();break;case _o:case vo:case mo:case yo:case Mo:n=this._rateMessageSent.getStatResult(e);break;case Io:case Co:case To:n=this._rateMessageReceived.getStatResult(e)}return null===n?null:t(t({},o),n)}},{key:"_report",value:function(e){var t=this,n=[],i=null;Ye(e)?this._qualityItems.forEach((function(e){null!==(i=t._getQualityItem(e))&&(i.reportIndex=t.reportIndex,i.wholePeriod=t.wholePeriod,n.push(i))})):null!==(i=this._getQualityItem(e))&&(i.reportIndex=this.reportIndex,i.wholePeriod=this.wholePeriod,n.push(i)),Le.d("".concat(this._n,"._report"),n),this._statInfoArr.length>0&&(n=n.concat(this._statInfoArr),this._statInfoArr=[]);var o=this.getModule(12),s=o.getSDKAppID(),r=o.getTinyID();Dt(this.REPORT_SDKAPPID_BLACKLIST,s)&&!wt(this.REPORT_TINYID_WHITELIST,r)&&(n=[]),n.length>0&&this._doReport(n)}},{key:"_doReport",value:function(e){var n=this,i={header:Bs(this),quality:e};this.request({protocolName:zi,requestData:t({},i)}).then((function(){n.reportIndex++,n.wholePeriod=!1})).catch((function(t){Le.w("".concat(n._n,"._doReport, online:").concat(n.getNetworkType()," error:"),t),n._statInfoArr=n._statInfoArr.concat(e),n._flushAtOnce()}))}},{key:"_flushAtOnce",value:function(){var e=this.getModule(13),t=e.getItem(this.TAG,!1),n=this._statInfoArr,i="".concat(this._n,"._flushAtOnce");if(Gt(t))Le.l("".concat(i," count:").concat(n.length)),e.setItem(this.TAG,n,!0,!1);else{var o=n.concat(t);o.length>10&&(o=o.slice(0,10)),Le.l("".concat(i," count:").concat(o.length)),e.setItem(this.TAG,o,!0,!1)}this._statInfoArr=[]}},{key:"reset",value:function(){Le.l("".concat(this._n,".reset")),this._report(),this.reportIndex=0,this.wholePeriod=!1,this.REPORT_SDKAPPID_BLACKLIST=[],this.REPORT_TINYID_WHITELIST=[],this._avgRTT.reset(),this._avgE2EDelay.reset(),this._rateMessageSent.reset(),this._rateMessageReceived.reset()}}]),i}(yn),Gr=function(e){d(n,e);var t=M(n);function n(e){var i;return r(this,n),(i=t.call(this,e))._n="WorkerTimerModule",i._isWorkerEnabled=!0,i._workerTimer=null,i._timerID=-1,i._init(),i.getInnerEmitterInstance().on(Qo,i._onCloudConfigUpdated,m(i)),i}return u(n,[{key:"isWorkerEnabled",value:function(){return this._isWorkerEnabled&&ve}},{key:"startWorkerTimer",value:function(){Le.l("".concat(this._n,".startWorkerTimer")),this._workerTimer&&this._workerTimer.postMessage("start")}},{key:"stopWorkerTimer",value:function(){Le.l("".concat(this._n,".stopWorkerTimer")),this._workerTimer&&this._workerTimer.postMessage("stop")}},{key:"_init",value:function(){if(ve){var e=URL.createObjectURL(new Blob(['let interval = -1;onmessage = function(event) {  if (event.data === "start") {    if (interval > 0) {      clearInterval(interval);    }    interval = setInterval(() => {      postMessage("");    }, 1000);    postMessage(interval);  } else if (event.data === "stop") {    clearInterval(interval);    interval = -1;  }};'],{type:"application/javascript; charset=utf-8"}));this._workerTimer=new Worker(e);var t=this;this._workerTimer.onmessage=function(e){e.data?(t._timerID=e.data,Le.l("".concat(t._n,"._init seed:").concat(t._timerID))):t._m.onCheckTimer()}}}},{key:"_onCloudConfigUpdated",value:function(){var e=this.getCloudConfig("enable_worker");Le.l("".concat(this._n,"._onCloudConfigUpdated enableWorker:").concat(e)),Ye(e)||"1"===e?!this._isWorkerEnabled&&ve&&(this._isWorkerEnabled=!0,this.startWorkerTimer(),this._m.onWorkerTimerEnabled()):this._isWorkerEnabled&&ve&&(this._isWorkerEnabled=!1,this.stopWorkerTimer(),this._m.onWorkerTimerDisabled())}},{key:"terminate",value:function(){Le.l("".concat(this._n,".terminate")),this._workerTimer&&(this._workerTimer.terminate(),this._workerTimer=null,this._timerID=-1)}},{key:"getTimerID",value:function(){return this._timerID}},{key:"reset",value:function(){Le.l("".concat(this._n,".reset"))}}]),n}(yn),xr=function(){function e(){r(this,e),this._n="PurchasedFeatureHandler",this._purchasedFeatureMap=new Map}return u(e,[{key:"isValidPurchaseBits",value:function(e){return e&&"string"==typeof e&&e.length>=1&&e.length<=64&&/[01]{1,64}/.test(e)}},{key:"parsePurchaseBits",value:function(e){var t="".concat(this._n,".parsePurchaseBits");if(this.isValidPurchaseBits(e)){this._purchasedFeatureMap.clear();for(var n=null,i=e.length-1,o=0;i>=0;i--,o++)n=o<32?new R(0,Math.pow(2,o)).toString():new R(Math.pow(2,o-32),0).toString(),"1"===e[i]?this._purchasedFeatureMap.set(n,!0):this._purchasedFeatureMap.set(n,!1)}else Le.w("".concat(t," invalid purchase bits:").concat(e))}},{key:"hasPurchasedFeature",value:function(e){return!!this._purchasedFeatureMap.get(e)}},{key:"isFeatureEnabled",value:function(e){for(var t=parseInt(e).toString(2),n=void 0,i=!0,o=t.length-1,s=0;o>=0;o--,s++)if("1"===t.charAt(o)&&(n=s<32?new R(0,Math.pow(2,s)).toString():new R(Math.pow(2,s-32),0).toString(),!this._purchasedFeatureMap.get(n))){i=!1;break}return Le.l("".concat(this._n,".isFeatureEnabled decimalNumber:").concat(e," binaryString:").concat(t," ret:").concat(i)),Yo({enabled:i})}},{key:"clear",value:function(){this._purchasedFeatureMap.clear()}}]),e}(),Fr=function(){function e(t){r(this,e),this._m=t,this._n="CommercialConfigModule",this._expiredTime=0,this._isFetching=!1,this._purchasedFeatureHandler=new xr}return u(e,[{key:"_canFetch",value:function(){return this._getModule(12).isLoggedIn()?!this._isFetching&&Date.now()>=this._expiredTime:(this._expiredTime=Date.now()+2e3,!1)}},{key:"onCheckTimer",value:function(e){this._canFetch()&&this.fetchConfig()}},{key:"fetchConfig",value:function(){var e=this,t=this._canFetch(),n="".concat(this._n,".fetchConfig");if(Le.l("".concat(n," canFetch:").concat(t)),t){var i=this._getModule(15),o=new wo("fetchCommercialConfig");o.setNetworkType(i.getNetworkType());var s=this._getModule(12).getSDKAppID(),r=this._getModule(20);this._isFetching=!0,r.request({protocolName:Zi,requestData:{SDKAppID:s}}).then((function(t){o.setMessage("purchaseBits:".concat(t.data.purchaseBits)).end(),Le.l("".concat(n," ok.")),e._parseConfig(t.data),e._isFetching=!1})).catch((function(t){i.probe().then((function(e){var n=I(e,2),i=n[0],s=n[1];o.setError(t,i,s).end()})),e._isFetching=!1}))}}},{key:"onPushedConfig",value:function(e){var t="".concat(this._n,".onPushedConfig");Le.l("".concat(t)),new wo("pushedCommercialConfig").setNetworkType(this._getModule(15).getNetworkType()).setMessage("purchaseBits:".concat(e.purchaseBits)).end(),this._parseConfig(e)}},{key:"_parseConfig",value:function(e){var t="".concat(this._n,"._parseConfig"),n=e.errorCode,i=e.errorMessage,o=e.purchaseBits,s=e.expiredTime;0===n?(this._purchasedFeatureHandler.parsePurchaseBits(o),this._expiredTime=Date.now()+1e3*s):Ye(n)?(Le.l("".concat(t," failed. Invalid message format:"),e),this._setExpiredTimeOnResponseError(36e5)):(Le.e("".concat(t," errorCode:").concat(n," errorMessage:").concat(i)),this._setExpiredTimeOnResponseError(12e4))}},{key:"_setExpiredTimeOnResponseError",value:function(e){this._expiredTime=Date.now()+e}},{key:"canIUse",value:function(e){return this._purchasedFeatureHandler.hasPurchasedFeature(e)}},{key:"isFeatureEnabled",value:function(e){return this._purchasedFeatureHandler.isFeatureEnabled(e)}},{key:"_getModule",value:function(e){return this._m.getModule(e)}},{key:"reset",value:function(){Le.l("".concat(this._n,".reset")),this._expiredTime=0,this._isFetching=!1,this._purchasedFeatureHandler.clear()}}]),e}(),qr=function(e){d(n,e);var t=M(n);function n(e){var i;return r(this,n),(i=t.call(this,e))._m=e,i._n="OfflinePushModule",i._offlinePushPlugin=void 0,i._androidPushConfig={huaweiPushBussinessId:"",xiaomiPushBussinessId:"",xiaomiPushAppId:"",xiaomiPushAppKey:"",meizuPushBussinessId:"",meizuPushAppId:"",meizuPushAppKey:"",vivoPushBussinessId:"",fcmPushBussinessId:"",oppoPushBussinessId:"",oppoPushAppKey:"",oppoPushAppSecret:"",honorPushBussinessId:""},i._deviceToken="",i._businessID=0,i._iosBusinessID=0,i._c2cUnreadCount=0,i._groupUnreadCount=0,i._isWebUniapp=0,i}return u(n,[{key:"registerPlugin",value:function(e){if(z){this._offlinePushPlugin=e["tim-offline-push-plugin"];var t=e.offlinePushConfig||{},n=t.huaweiBusinessID,i=t.xiaomiBusinessID,o=t.xiaomiAppID,s=t.xiaomiAppKey,r=t.meizuBusinessID,a=t.meizuAppID,c=t.meizuAppKey,u=t.vivoBusinessID,l=t.oppoBusinessID,d=t.oppoAppKey,p=t.oppoAppSecret,h=t.honorBusinessID,f=t.iosBusinessID;this._androidPushConfig.huaweiPushBussinessId=n,this._androidPushConfig.xiaomiPushBussinessId=i,this._androidPushConfig.xiaomiPushAppId=o,this._androidPushConfig.xiaomiPushAppKey=s,this._androidPushConfig.meizuPushBussinessId=r,this._androidPushConfig.meizuPushAppId=a,this._androidPushConfig.meizuPushAppKey=c,this._androidPushConfig.vivoPushBussinessId=u,this._androidPushConfig.oppoPushBussinessId=l,this._androidPushConfig.oppoPushAppKey=d,this._androidPushConfig.oppoPushAppSecret=p,this._androidPushConfig.honorPushBussinessId=h,new wo("registerPlugin").setMessage("tim-offline-push-plugin").setMoreMessage("isExist:".concat(!Ye(this._offlinePushPlugin))).end(!0),Le.l("".concat(this._n,".").concat("registerPlugin"," ok. offlinePushConfig:").concat(JSON.stringify(e.offlinePushConfig))),this._iosBusinessID=f,this._setAppShowListener()}else this.outputWarning("OfflinePushInUniapp")}},{key:"init",value:function(){this._isWebUniapp=this.getUniAppPlatform(),this._getDeviceToken()}},{key:"_getDeviceToken",value:function(){var e=this,t="".concat(this._n,".").concat("_getDeviceToken");if(Je(this._offlinePushPlugin.getDeviceToken)){var n="androidPushConfig:".concat(JSON.stringify(this._androidPushConfig),", iosBusinessID:").concat(this._iosBusinessID);Le.l("".concat(t," start. ").concat(n)),new wo("_getDeviceToken").setMessage("".concat(n)).end(!0),this._offlinePushPlugin.getDeviceToken(this._androidPushConfig,(function(i){var o=new wo("getDeviceTokenRes"),s=i.code,r=i.msg;if(0===s){var a=i.data,c=a.deviceToken,u=a.deviceBrand,l=a.deviceType,d=a.bussinessId;e._deviceToken=c,e._businessID=d||e._iosBusinessID,n="deviceToken:".concat(c,", deviceBrand:").concat(u||l,", businessID:").concat(e._businessID),Le.l("".concat(t," ok. ").concat(n)),o.setMessage(n).end(!0),e._setToken()}else o.setMessage("code:".concat(s,", msg:").concat(r)).end(!0),Le.e("".concat(t," failed. error:"),i)}))}else Le.e("".concat(t," getDeviceToken is not a function"))}},{key:"canIUseOfflinePush",value:function(){return z&&!Ye(this._offlinePushPlugin)}},{key:"_setAppShowListener",value:function(){var e=this,t="".concat(this._n,".").concat("_setAppShowListener");Ye(this._offlinePushPlugin)?Le.e("".concat(t," offlinePushPlugin is undefined")):Je(this._offlinePushPlugin.setAppShowListener)?(new wo("_setAppShowListener").end(!0),Le.l("".concat(t," start")),this._offlinePushPlugin.setAppShowListener((function(n){var i=(n||{}).appShow;new wo("setAppShowListenerRes").setMessage("appShow:".concat(i)).end(!0),Le.l("".concat(t," ok. appShow:").concat(i)),e._m.isReady()&&(0===i?(e._getConvUnreadCount(),e._onBackground()):1===i&&e._onForeground())}))):Le.e("".concat(t," setAppShowListener is not a function"))}},{key:"getDeviceBrand",value:function(){if(!Ye(this._offlinePushPlugin)&&Je(this._offlinePushPlugin.getDeviceType)){var e=(this._offlinePushPlugin.getDeviceType()||{}).deviceType;return Le.l("".concat(this._n,".getDeviceBrand ok. deviceType:").concat(e)),e}}},{key:"_setToken",value:function(){var e,t=this,n="".concat(this._n,"._setToken"),i=this.getModule(12),o=1,s="",r="";Gt(this._deviceToken)&&(o=0);var a=this.getUniAppPlatform(),c=this.getDeviceBrand();a===N.IOS||a===N.IPAD||a===N.MAC?r=this._deviceToken:a===N.ANDROID&&(s=this._deviceToken);var u=new wo("offlinePushSetToken");return e="deviceToken:".concat(r||s,", businessID:").concat(this._businessID,", ")+"deviceBrand:".concat(c,", isWebUniapp:").concat(this._isWebUniapp,", pushMsg:").concat(o,", platform:").concat(a),u.setMessage("".concat(e)),Le.l("".concat(n," ").concat(e)),this.request({protocolName:uo,requestData:{tokenID:s,pushMsg:o,sdkAppID:i.getSDKAppID(),businessID:parseInt(this._businessID),deviceBrand:c,deviceToken:r,isWebUniapp:this._isWebUniapp}}).then((function(e){return u.end(),Le.l("".concat(n," ok")),e})).catch((function(e){return t.probeNetwork().then((function(t){var n=I(t,2),i=n[0],o=n[1];u.setError(e,i,o).end()})),Le.e("".concat(n," failed. error:"),e),Wo(e)}))}},{key:"_getConvUnreadCount",value:function(){var e=this;this._c2cUnreadCount=0,this._groupUnreadCount=0,this.getModule(11).getLocalConversationList().forEach((function(t){t.type===b.CONV_C2C&&(e._c2cUnreadCount+=t.unreadCount),t.type===b.CONV_GROUP&&(e._groupUnreadCount+=t.unreadCount)}))}},{key:"_onBackground",value:function(){var e=this,t="".concat(this._n,".").concat("_onBackground"),n=new wo("_onBackground");this.request({protocolName:ao,requestData:{c2cUnreadCount:this._c2cUnreadCount,groupUnreadCount:this._groupUnreadCount,isWebUniapp:this._isWebUniapp}}).then((function(i){return n.setMessage("c2cUnreadCount: ".concat(e._c2cUnreadCount,", groupUnreadCount: ").concat(e._groupUnreadCount)).end(),Le.l("".concat(t," ok")),i})).catch((function(i){e.probeNetwork().then((function(e){var t=I(e,2),o=t[0],s=t[1];n.setError(i,o,s).end()})),Le.e("".concat(t," failed. error:"),i)}))}},{key:"_onForeground",value:function(){var e=this,t="".concat(this._n,".").concat("_onForeground"),n=new wo("_onForeground");this.request({protocolName:co,requestData:{isWebUniapp:this._isWebUniapp}}).then((function(e){return n.end(),Le.l("".concat(t," ok")),e})).catch((function(i){e.probeNetwork().then((function(e){var t=I(e,2),o=t[0],s=t[1];n.setError(i,o,s).end()})),Le.e("".concat(t," failed. error:"),i)}))}},{key:"getUniAppPlatform",value:function(){var e=uni.getSystemInfoSync().platform,t=this.getDeviceBrand();return"ios"===e?N.IOS:"android"===e?N.ANDROID:1002===t?N.IPAD:1001===t?N.MAC:void 0}},{key:"reset",value:function(){this._deviceToken="",this._businessID=0,this._c2cUnreadCount=0,this._groupUnreadCount=0,this._isWebUniapp=0,Le.l("".concat(this._n,".reset"))}}]),n}(yn),Br=function(e){d(n,e);var t=M(n);function n(e){var i;return r(this,n),(i=t.call(this,e))._n="ProfanityFilterModule",i._plugin=null,i._filterConfigMap=new Map,i._startIndex=0,i._version=0,i._canIUseLexicon=!1,i._isFetching=!1,i._expiredTime=0,i}return u(n,[{key:"init",value:function(){var e=this.getModule(18).getPlugin("tim-profanity-filter-plugin");e?(this._plugin=new e({logger:Le,isArray:ze,isMap:Be,isDevMode:this.isDevMode()}),this._getLexicon()):this.outputWarning("ProfanityPluginNotFound")}},{key:"onCheckTimer",value:function(){this._plugin&&this._canIUseLexicon&&this.isLoggedIn()&&!this._isFetching&&Date.now()>=this._expiredTime&&this._getLexicon()}},{key:"filterMessage",value:function(e,t){var n=!0;if(!this._plugin||!this._canIUseLexicon)return n;if(t&&t.messageControlInfo&&!0===t.messageControlInfo.excludedFromContentModeration)return n;var i=e.type,o=e.conversationType;if(i!==b.MSG_TEXT&&i!==b.MSG_CUSTOM)return n;var s,r="".concat(this._n,".filterMessage");if(Le.l("".concat(r)),i===b.MSG_TEXT){if(o===b.CONV_C2C?s="c2c_text_message":o===b.CONV_GROUP&&(s="group_text_message"),!this._isConfigOn(s))return n;var a=this._plugin.filter(e.payload.text),c=a.type,u=a.modifiedText;1===c?n=!1:2===c&&(e.payload.text=u)}else if(i===b.MSG_CUSTOM){if(o===b.CONV_C2C?s="c2c_custom_message":o===b.CONV_GROUP&&(s="group_custom_message"),!this._isConfigOn(s))return n;var l=this._plugin.filter(e.payload.data),d=this._plugin.filter(e.payload.description),p=this._plugin.filter(e.payload.extension);1===l.type||1===d.type||1===p.type?n=!1:(2===l.type&&(e.payload.data=l.modifiedText),2===d.type&&(e.payload.description=d.modifiedText),2===p.type&&(e.payload.extension=p.modifiedText))}return Le.l("".concat(r," done. isAllowedToSend:").concat(n)),n}},{key:"filterText",value:function(e,t){var n="".concat(this._n,".filterText"),i={isAllowedToSend:!0,modifiedText:e};if(!this._plugin||!this._canIUseLexicon)return i;if(!this._isConfigOn(t))return i;Le.l("".concat(n));var o=this._plugin.filter(e),s=o.type,r=o.modifiedText;return 1===s?i.isAllowedToSend=!1:2===s&&(i.modifiedText=r),Le.l("".concat(n," done. ret:"),i),i}},{key:"_getLexicon",value:function(){var e=this,t=new wo("profanityFilter"),n="".concat(this._n,"._getLexicon");this._isFetching=!0,this.request({protocolName:lo,requestData:{startIndex:this._startIndex,version:this._version}}).then((function(i){var o=i.data,s=o.errorInfo,r=o.filterConfig,a=o.lexicon,c=o.strToken,u=o.completeFlag,l=o.nextStartIndex,d=o.version,p=o.expiredTime,h=s.errorCode,f=s.errorMessage;return 0!==h?(e._isFetching=!1,Le.w("".concat(n," failed. error:"),s),void t.setCode(h).setMessage(f).end()):(e._onFilterConfig(r),e._getToken(c),1===u?(Le.l("".concat(n," done. version:").concat(d," expiredTime:").concat(p)),e._version=d,e._canIUseLexicon=!0,e._isFetching=!1,e._expiredTime=Date.now()+1e3*p,void e._plugin.onLexiconCompleted(a)):(e._startIndex=l,e._plugin.onLexiconSliced(a),void e._getLexicon()))})).catch((function(i){e.probeNetwork().then((function(e){var n=I(e,2),o=n[0],s=n[1];t.setError(i,o,s).end()})),e._isFetching=!1,Le.l("".concat(n," failed. error:"),i)}))}},{key:"_onFilterConfig",value:function(e){var t=this;Gt(e)||(this._filterConfigMap.clear(),Object.keys(e).forEach((function(n){t._filterConfigMap.set(n,e[n])})),Le.l("".concat(this._n,"._onFilterConfig. keys:").concat(Array.from(this._filterConfigMap.keys())," values:").concat(Array.from(this._filterConfigMap.values()))))}},{key:"_isConfigOn",value:function(e){return 1===this._filterConfigMap.get(e)}},{key:"_getToken",value:function(e){if(He(e)){var t=e.length,n="";if(t%2==0)for(var i=0;i<=t-1;i+=2)n+=e[i+1],n+=e[i];else{for(var o=0;o<t-1;o+=2)n+=e[o+1],n+=e[o];n+=e[t-1]}this._plugin.onToken(n)}}},{key:"reset",value:function(){Le.l("".concat(this._n,".reset")),this._plugin&&(this._plugin.reset(),this._plugin=null),this._filterConfigMap.clear(),this._startIndex=0,this._version=0,this._canIUseLexicon=!1,this._isFetching=!1,this._expiredTime=0}}]),n}(yn),$r=function(){function e(t){r(this,e),this._m=t,this._n="TransCmdModule"}return u(e,[{key:"sendTRTCCustomData",value:function(e){return this._trans(t({serv:x.NAME.TUIROOM_SVR},e))}},{key:"_trans",value:function(e){Le.d("".concat(this._n,"._trans. options:").concat(JSON.stringify(e)));var t=e.serv,n=e.data;return this._m.getModule(20).trans({servcmd:"".concat(t,".*"),data:He(n)?JSON.parse(n):n})}},{key:"reset",value:function(){Le.l("".concat(this._n,".reset"))}}]),e}(),Vr=function(){function e(t){r(this,e),this._m=t,this._n="ErrorMessageModule",this.TIM_ERROR_ASSISTANCE="tim_error_assistance",this.STORAGE_EXPIRES_TIME=6048e5,this._map=new Map,this._init()}return u(e,[{key:"_init",value:function(){var e=this._getStorageModule().getItem(this.TIM_ERROR_ASSISTANCE,!1);if(e){var t=JSON.parse(e);this._needToUpdate(t)?this._fetch():this._fillMap(t.message)}else this._fetch()}},{key:"_needToUpdate",value:function(e){var t=e.localSavedTime,n=e.localSavedVersion,i=t&&(new Date).getTime()-t>=this.STORAGE_EXPIRES_TIME,o=!n||"2.27.2"!==n;return Le.l("".concat(this._n,"._needToUpdate isTimeout:").concat(i," isDifferentVersion:").concat(o)),i||o}},{key:"_fetch",value:function(){if(!this._m.getModule(12).isPrivateNetWork()){var e="https://web.sdk.qcloud.com/im/download/error-message/0.0.1/tim-error-message.txt",t="application/x-www-form-urlencoded;charset=UTF-8",n="".concat(this._n,"._fetch ok in"),i=this;if(W)X.request({url:e,method:"GET",timeout:3e3,header:{"content-type":t},dataType:"text",success:function(e){i._fillAndSave(e.data),Le.l("".concat(n," mini program"))},fail:function(){}});else{var o=new XMLHttpRequest,s=setTimeout((function(){o.abort()}),3e3);o.onreadystatechange=function(){4===o.readyState&&(clearTimeout(s),200!==o.status&&304!==o.status||(Le.l("".concat(n," browser")),i._fillAndSave(o.responseText)))},o.open("GET",e,!0),o.setRequestHeader("Content-type",t),o.send()}}}},{key:"_fillAndSave",value:function(e){this._fillMap(e),this._getStorageModule().setItem(this.TIM_ERROR_ASSISTANCE,JSON.stringify({message:e,localSavedTime:(new Date).getTime(),localSavedVersion:"2.27.2"}),!0,!1)}},{key:"_getStorageModule",value:function(){return this._m.getModule(13)}},{key:"_fillMap",value:function(e){this._map.clear();for(var t,n,i,o=e.split(";\n"),s=o.length,r=new RegExp(/'/g),a=0;a<s;a++)if(t=o[a].indexOf(":"),n=o[a].slice(0,t),i=o[a].slice(t+1,o[a].length),!n.startsWith("//")){if(Ye(i))continue;this._map.set(n,i.replace(r,""))}}},{key:"get",value:function(e){var t=e.isIntl,n=e.key,i=e.replacement1,o=e.replacement2,s="".concat(n,t?"_en":"_cn");!this._map.has(s)&&this._map.has(n)&&(s=n);var r="";return this._map.has(s)?(r=this._map.get(s),Ye(i)||(r=r.replace("$replacement1",i)),Ye(o)||(r=r.replace("$replacement2",o)),r):r}},{key:"reset",value:function(){Le.l("".concat(this._n,".reset"))}}]),e}(),Hr=function(){function e(t){r(this,e);var n=new wo("sdkConstruct");this._n="ModuleManager",this._isReady=!1,this._reason=ho.USER_NOT_LOGGED_IN,this._startLoginTs=0,this._moduleMap=new Map,this._innerEmitter=null,this._outerEmitter=null,this._checkCount=0,this._checkTimer=-1,this._moduleMap.set(12,new Us(this,t)),this._moduleMap.set(27,new Fr(this)),this._moduleMap.set(23,new br(this)),this._moduleMap.set(24,new Gr(this)),this._moduleMap.set(26,new Ur(this)),this._moduleMap.set(21,new Ir(this)),this._moduleMap.set(20,new wr(this)),this._moduleMap.set(1,new Gs(this)),this._moduleMap.set(2,new nr(this)),this._moduleMap.set(3,new ir(this)),this._moduleMap.set(31,new or(this)),this._moduleMap.set(4,new Ps(this)),this._moduleMap.set(6,new Jo(this)),this._moduleMap.set(11,new hs(this)),this._moduleMap.set(7,new Ts(this)),this._moduleMap.set(9,new Ss(this)),this._moduleMap.set(10,new As(this)),this._moduleMap.set(13,new Fs(this)),this._moduleMap.set(32,new Vr(this)),this._moduleMap.set(14,new $s(this)),this._moduleMap.set(15,new js(this)),this._moduleMap.set(16,new Ys(this)),this._moduleMap.set(17,new Js(this)),this._moduleMap.set(18,new sr(this)),this._moduleMap.set(19,new rr(this)),this._moduleMap.set(22,new Ar(this)),this._moduleMap.set(25,new Lr(this)),this._moduleMap.set(28,new qr(this)),this._moduleMap.set(29,new Br(this)),this._moduleMap.set(30,new $r(this)),this._eventThrottleMap=new Map;var i=t.instanceID,o=t.oversea,s=t.SDKAppID,a="instanceID:".concat(i," SDKAppID:").concat(s," host:").concat(It()," oversea:").concat(o," inBrowser:").concat(J," inMiniApp:").concat(W)+" workerAvailable:".concat(ve," UserAgent:").concat(Z);wo.bindEventStatModule(this._moduleMap.get(14)),n.setMessage("".concat(a," ").concat(function(){var e="";if(W)try{var t=X.getSystemInfoSync(),n=t.model,i=t.version,o=t.system,s=t.platform,r=t.SDKVersion;e="model:".concat(n," version:").concat(i," system:").concat(o," platform:").concat(s," SDKVersion:").concat(r)}catch(a){e=""}return e}())).end(),Le.i("SDK ".concat(a)),jo.prototype._getErrorMessage=this.getErrorMessage.bind(this),this._readyList=void 0,this._ssoLogForReady=null,this._initReadyList()}return u(e,[{key:"_startTimer",value:function(){var e=this._moduleMap.get(24),t=e.isWorkerEnabled();Le.l("".concat(this._n,".startTimer isWorkerEnabled:").concat(t," seed:").concat(this._checkTimer)),t?e.startWorkerTimer():this._startMainThreadTimer()}},{key:"_startMainThreadTimer",value:function(){this._checkTimer<0&&(this._checkTimer=setInterval(this.onCheckTimer.bind(this),1e3)),Le.l("".concat(this._n,"._startMainThreadTimer seed:").concat(this._checkTimer))}},{key:"stopTimer",value:function(){var e=this._moduleMap.get(24),t=e.isWorkerEnabled();Le.l("".concat(this._n,".stopTimer isWorkerEnabled:").concat(t," seed:").concat(this._checkTimer)),t?e.stopWorkerTimer():this._stopMainThreadTimer()}},{key:"_stopMainThreadTimer",value:function(){Le.l("".concat(this._n,"._stopMainThreadTimer")),this._checkTimer>0&&(clearInterval(this._checkTimer),this._checkTimer=-1,this._checkCount=0)}},{key:"_stopMainThreadSocket",value:function(){Le.l("".concat(this._n,"._stopMainThreadSocket"));var e=this._moduleMap.get(21);e.setIsWorkerEnabled(!0),e.reConnect()}},{key:"_startMainThreadSocket",value:function(){Le.l("".concat(this._n,"._startMainThreadSocket"));var e=this._moduleMap.get(21);e.setIsWorkerEnabled(!1),e.reConnect()}},{key:"onWorkerTimerEnabled",value:function(){Le.l("".concat(this._n,".onWorkerTimerEnabled, disable main thread timer and socket")),this._stopMainThreadTimer(),this._stopMainThreadSocket()}},{key:"onWorkerTimerDisabled",value:function(){Le.l("".concat(this._n,".onWorkerTimerDisabled, enable main thread timer and socket")),this._startMainThreadTimer(),this._startMainThreadSocket()}},{key:"onCheckTimer",value:function(){this._checkCount+=1;var e,t=w(this._moduleMap);try{for(t.s();!(e=t.n()).done;){var n=I(e.value,2)[1];n.onCheckTimer&&n.onCheckTimer(this._checkCount)}}catch(r){t.e(r)}finally{t.f()}}},{key:"_initReadyList",value:function(){var e=this;this._readyList=[this._moduleMap.get(1),this._moduleMap.get(11)],this._readyList.forEach((function(t){t.ready((function(){return e._onModuleReady()}))}))}},{key:"_onModuleReady",value:function(){var e=!0;if(this._readyList.forEach((function(t){t.isReady()||(e=!1)})),e&&!this._isReady){this._isReady=!0,this._outerEmitter.emit(A.SDK_READY);var t=Date.now()-this._startLoginTs;Le.w("SDK is ready. cost ".concat(t," ms")),this._startLoginTs=Date.now();var n=this._moduleMap.get(15).getNetworkType(),i=this._ssoLogForReady.getStartTs()+ke;this._ssoLogForReady.setNetworkType(n).setMessage(t).start(i).end()}}},{key:"login",value:function(){0===this._startLoginTs&&(Ee(),this._startLoginTs=Date.now(),this._startTimer(),this._moduleMap.get(15).start(),this._ssoLogForReady=new wo("sdkReady"),this._reason=ho.LOGGING_IN)}},{key:"onLoginFailed",value:function(){this._startLoginTs=0}},{key:"getOuterEmitterInstance",value:function(){return null===this._outerEmitter&&(this._outerEmitter=new zs,function(e){zo=e}(this._outerEmitter),this._outerEmitter._emit=this._outerEmitter.emit,this._outerEmitter.emit=function(e,t){var n=this;if(e===A.CONVERSATION_LIST_UPDATED||e===A.FRIEND_LIST_UPDATED||e===A.GROUP_LIST_UPDATED||e===A.TOTAL_UNREAD_MESSAGE_COUNT_UPDATED)if(this._eventThrottleMap.has(e)){var i=Date.now(),o=this._eventThrottleMap.get(e);i-o.last<=1e3?(o.timeoutID&&clearTimeout(o.timeoutID),o.timeoutID=setTimeout((function(){o.last=Date.now(),n._outerEmitter._emit.apply(n._outerEmitter,[e,{name:e,data:n._getEventData(e)}])}),1e3)):(o.last=i,this._outerEmitter._emit.apply(this._outerEmitter,[e,{name:e,data:this._getEventData(e)}]))}else this._eventThrottleMap.set(e,{last:Date.now(),timeoutID:-1}),this._outerEmitter._emit.apply(this._outerEmitter,[e,{name:e,data:this._getEventData(e)}]);else this._outerEmitter._emit.apply(this._outerEmitter,[e,{name:e,data:arguments[1]}])}.bind(this)),this._outerEmitter}},{key:"_getEventData",value:function(e){return e===A.CONVERSATION_LIST_UPDATED?this._moduleMap.get(11).getLocalConversationList():e===A.FRIEND_LIST_UPDATED?this._moduleMap.get(8).getLocalFriendList(!1):e===A.GROUP_LIST_UPDATED?this._moduleMap.get(7).getLocalGroupList():e===A.TOTAL_UNREAD_MESSAGE_COUNT_UPDATED?this._moduleMap.get(11).getTotalUnreadMessageCount():void 0}},{key:"getInnerEmitterInstance",value:function(){return null===this._innerEmitter&&(this._innerEmitter=new zs,this._innerEmitter._emit=this._innerEmitter.emit,this._innerEmitter.emit=function(e,t){var n;n=je(arguments[1])&&arguments[1].data?[e,{name:arguments[0],data:arguments[1].data}]:[e,{name:arguments[0],data:arguments[1]}],this._innerEmitter._emit.apply(this._innerEmitter,n)}.bind(this)),this._innerEmitter}},{key:"hasModule",value:function(e){return this._moduleMap.has(e)}},{key:"getModule",value:function(e){return this._moduleMap.get(e)}},{key:"isReady",value:function(){return this._isReady}},{key:"isIntl",value:function(){return this.getModule(12).isIntl()}},{key:"getNotReadyReason",value:function(){return this._reason}},{key:"setNotReadyReason",value:function(e){this._reason=e}},{key:"getErrorMessage",value:function(e,t,n){return this._moduleMap.get(32).get({key:e,replacement1:t,replacement2:n,isIntl:this.isIntl()})}},{key:"outputWarning",value:function(e,t,n){var i=this.getErrorMessage(e,t,n);i&&Le.w(i)}},{key:"onError",value:function(e){var t="code:".concat(e.code," message:").concat(e.message);Le.w("Oops! ".concat(t)),new wo("error").setMessage(t).setNetworkType(this.getModule(15).getNetworkType()).setLevel("error").end(),this.getOuterEmitterInstance().emit(A.ERROR,e)}},{key:"restartTimer",value:function(){Le.l("".concat(this._n,".restartTimer")),this.stopTimer(),this._startTimer(),this.getModule(7).restartPolling()}},{key:"getTimerID",value:function(){var e=this._moduleMap.get(24);return e.isWorkerEnabled()?e.getTimerID():this._checkTimer}},{key:"reset",value:function(){Le.l("".concat(this._n,".reset")),Ee();var e,t=w(this._moduleMap);try{for(t.s();!(e=t.n()).done;){var n=I(e.value,2)[1];n.reset&&n.reset()}}catch(l){t.e(l)}finally{t.f()}this._startLoginTs=0,this._initReadyList(),this._isReady=!1,this.stopTimer(),this._outerEmitter.emit(A.SDK_NOT_READY);var i,o=w(this._eventThrottleMap);try{for(o.s();!(i=o.n()).done;){var s=I(i.value,2)[1];s.timeoutID&&clearTimeout(s.timeoutID)}}catch(l){o.e(l)}finally{o.f()}this._eventThrottleMap.clear()}}]),e}(),Kr=function(){function e(t){r(this,e),this._funcMap=new Map,this._m=t}return u(e,[{key:"defense",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0;if("string"!=typeof e)return null;if(0===e.length)return null;if("function"!=typeof t)return null;if(this._funcMap.has(e)&&this._funcMap.get(e).has(t))return this._funcMap.get(e).get(t);this._funcMap.has(e)||this._funcMap.set(e,new Map);var i=null;return this._funcMap.get(e).has(t)?i=this._funcMap.get(e).get(t):(i=this._pack(e,t,n),this._funcMap.get(e).set(t,i)),i}},{key:"defenseOnce",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0;return"function"!=typeof t?null:this._pack(e,t,n)}},{key:"find",value:function(e,t){return"string"!=typeof e||0===e.length||"function"!=typeof t?null:this._funcMap.has(e)&&this._funcMap.get(e).has(t)?this._funcMap.get(e).get(t):(this._m.outputWarning("ListenerFnNotFound",e),null)}},{key:"delete",value:function(e,t){return"function"==typeof t&&!!this._funcMap.has(e)&&!!this._funcMap.get(e).has(t)&&(this._funcMap.get(e).delete(t),0===this._funcMap.get(e).size&&this._funcMap.delete(e),!0)}},{key:"_pack",value:function(e,t,n){var i=this;return function(){try{t.apply(n,Array.from(arguments))}catch(p){var o=Object.values(A).indexOf(e),s="CallbackError";if(-1!==o){var r=Object.keys(A)[o];i._m.outputWarning(s,r,p)}var a=new wo(s);a.setMessage("eventName:".concat(e)).setMoreMessage(p.message).end()}}}}]),e}(),jr=function(){function e(t){r(this,e);var n={SDKAppID:t.SDKAppID,unlimitedAVChatRoom:t.unlimitedAVChatRoom||!1,scene:t.scene||"",oversea:t.oversea||!1,instanceID:Mt(),devMode:t.devMode||!1,proxyServer:t.proxyServer||void 0,fileUploadProxy:t.fileUploadProxy||void 0,fileDownloadProxy:t.fileDownloadProxy||t.fileUploadProxy||void 0};this._m=new Hr(n),this._safetyCallbackFactory=new Kr(this._m)}return u(e,[{key:"onError",value:function(e){this._m.onError(e)}},{key:"login",value:function(e){return this._m.login(),this._getModule(1).login(e)}},{key:"logout",value:function(){var e=this;return this._getModule(1).logout().then((function(t){return e._m.reset(),t}))}},{key:"isReady",value:function(){return this._m.isReady()}},{key:"isIntl",value:function(){return this._m.isIntl()}},{key:"getNotReadyReason",value:function(){return this._m.getNotReadyReason()}},{key:"getErrorMessage",value:function(e,t,n){return this._m.getErrorMessage(e,t,n)}},{key:"_getModule",value:function(e){return this._m.getModule(e)}},{key:"destroy",value:function(){var e=this;return this.logout().finally((function(){e._m.stopTimer(),e._getModule(24).terminate(),e._getModule(21).dealloc();var t=e._m.getOuterEmitterInstance(),n=e._getModule(12);t.emit(A.SDK_DESTROY,{SDKAppID:n.getSDKAppID()})}))}},{key:"on",value:function(e,t,n){Le.d("on","eventName:".concat(e)),this._m.getOuterEmitterInstance().on(e,this._safetyCallbackFactory.defense(e,t,n),n)}},{key:"once",value:function(e,t,n){Le.d("once","eventName:".concat(e)),this._m.getOuterEmitterInstance().once(e,this._safetyCallbackFactory.defenseOnce(e,t,n),n||this)}},{key:"off",value:function(e,t,n,i){Le.d("off","eventName:".concat(e));var o=this._safetyCallbackFactory.find(e,t);null!==o&&(this._m.getOuterEmitterInstance().off(e,o,n,i),this._safetyCallbackFactory.delete(e,t))}},{key:"registerPlugin",value:function(e){Ye(e["tim-offline-push-plugin"])?this._getModule(18).registerPlugin(e):this._getModule(28).registerPlugin(e)}},{key:"setLogLevel",value:function(e){if(e<=0){var t=this.getErrorMessage("TIM_ASCII_ART");t&&s("log",t," at node_modules/tim-wx-sdk/tim-wx.js:1");var n=this.getErrorMessage("API_REFER");n&&(Ot()?s("log","%c ".concat("IM SDK API ->"," %c"),"background:#ff9d00; padding:1px; border-radius:3px; color: #fff","background:transparent",n," at node_modules/tim-wx-sdk/tim-wx.js:1"):s("log","IM SDK API ->",n," at node_modules/tim-wx-sdk/tim-wx.js:1"));var i=this.getErrorMessage("DOCS_GUIDE");i&&s("log",i," at node_modules/tim-wx-sdk/tim-wx.js:1")}Le.setLevel(e)}},{key:"createTextMessage",value:function(e){return this._getModule(2).createTextMessage(e)}},{key:"createTextAtMessage",value:function(e){return this._getModule(2).createTextMessage(e)}},{key:"createImageMessage",value:function(e){return this._getModule(2).createImageMessage(e)}},{key:"createAudioMessage",value:function(e){return this._getModule(2).createAudioMessage(e)}},{key:"createVideoMessage",value:function(e){return this._getModule(2).createVideoMessage(e)}},{key:"createCustomMessage",value:function(e){return this._getModule(2).createCustomMessage(e)}},{key:"createFaceMessage",value:function(e){return this._getModule(2).createFaceMessage(e)}},{key:"createFileMessage",value:function(e){return this._getModule(2).createFileMessage(e)}},{key:"createLocationMessage",value:function(e){return this._getModule(2).createLocationMessage(e)}},{key:"createMergerMessage",value:function(e){return this._getModule(2).createMergerMessage(e)}},{key:"downloadMergerMessage",value:function(e){return e.type!==b.MSG_MERGER?Wo({code:ho.MESSAGE_MERGER_TYPE_INVALID}):Gt(e.payload.downloadKey)?Wo({code:ho.MESSAGE_MERGER_KEY_INVALID}):this._getModule(2).downloadMergerMessage(e).catch((function(e){return Wo({code:ho.MESSAGE_MERGER_DOWNLOAD_FAIL})}))}},{key:"createForwardMessage",value:function(e){return this._getModule(2).createForwardMessage(e)}},{key:"sendMessage",value:function(e,t){return e instanceof Ho?this._getModule(2).sendMessageInstance(e,t):Wo({code:ho.MESSAGE_SEND_NEED_MESSAGE_INSTANCE})}},{key:"callExperimentalAPI",value:function(e,t){return"sendComboMessage"===e?this._getModule(31).sendMessage(t):"handleGroupInvitation"===e?this._getModule(7).handleGroupInvitation(t):"isCommercialAbilityEnabled"===e?this._getModule(27).isFeatureEnabled(t):"isIntl"===e?this.isIntl():"sendTRTCCustomData"===e?this._getModule(30).sendTRTCCustomData(t):"getTimerID"===e?this._m.getTimerID():Wo({code:ho.INVALID_OPERATION})}},{key:"revokeMessage",value:function(e){return this._getModule(2).revokeMessage(e)}},{key:"resendMessage",value:function(e){return this._getModule(2).resendMessage(e)}},{key:"deleteMessage",value:function(e){return this._getModule(2).deleteMessage(e)}},{key:"translateText",value:function(e){return this._getModule(2).translateText(e)}},{key:"setMessageExtensions",value:function(e,t){return this._getModule(3).setMessageExtensions(e,t)}},{key:"getMessageExtensions",value:function(e){return this._getModule(3).getMessageExtensions(e)}},{key:"deleteMessageExtensions",value:function(e,t){return this._getModule(3).deleteMessageExtensions(e,t)}},{key:"modifyMessage",value:function(e){return this._getModule(2).modifyRemoteMessage(e)}},{key:"getMessageList",value:function(e){return this._getModule(11).getMessageList(e)}},{key:"getMessageListHopping",value:function(e){return this._getModule(11).getMessageListHopping(e)}},{key:"sendMessageReadReceipt",value:function(e){return this._getModule(11).sendReadReceipt(e)}},{key:"getMessageReadReceiptList",value:function(e){return this._getModule(11).getReadReceiptList(e)}},{key:"getGroupMessageReadMemberList",value:function(e){return this._getModule(7).getReadReceiptDetail(e)}},{key:"findMessage",value:function(e){return this._getModule(11).findMessage(e)}},{key:"setMessageRead",value:function(e){return this._getModule(11).setMessageRead(e)}},{key:"getConversationList",value:function(e){return this._getModule(11).getConversationList(e)}},{key:"getConversationProfile",value:function(e){return this._getModule(11).getConversationProfile(e)}},{key:"deleteConversation",value:function(e){return this._getModule(11).deleteConversation(e)}},{key:"clearHistoryMessage",value:function(e){return this._getModule(11).clearHistoryMessage(e)}},{key:"pinConversation",value:function(e){return this._getModule(11).pinConversation(e)}},{key:"setAllMessageRead",value:function(e){return this._getModule(11).setAllMessageRead(e)}},{key:"setMessageRemindType",value:function(e){return this._getModule(11).setMessageRemindType(e)}},{key:"getTotalUnreadMessageCount",value:function(){return this._getModule(11).getTotalUnreadMessageCount()}},{key:"setConversationCustomData",value:function(e){return this._getModule(11).setConversationCustomData(e)}},{key:"markConversation",value:function(e){return this._getModule(11).markConversation(e)}},{key:"getConversationGroupList",value:function(){return this._getModule(11).getConversationGroupList()}},{key:"createConversationGroup",value:function(e){return this._getModule(11).createConversationGroup(e)}},{key:"deleteConversationGroup",value:function(e){return this._getModule(11).deleteConversationGroup(e)}},{key:"renameConversationGroup",value:function(e){return this._getModule(11).renameConversationGroup(e)}},{key:"addConversationsToGroup",value:function(e){return this._getModule(11).addConversationsToGroup(e)}},{key:"deleteConversationsFromGroup",value:function(e){return this._getModule(11).deleteConversationsFromGroup(e)}},{key:"getMyProfile",value:function(){return this._getModule(4).getMyProfile()}},{key:"getUserProfile",value:function(e){return this._getModule(4).getUserProfile(e)}},{key:"updateMyProfile",value:function(e){return this._getModule(4).updateMyProfile(e)}},{key:"getBlacklist",value:function(){return this._getModule(4).getLocalBlacklist()}},{key:"addToBlacklist",value:function(e){return this._getModule(4).addBlacklist(e)}},{key:"removeFromBlacklist",value:function(e){return this._getModule(4).deleteBlacklist(e)}},{key:"setSelfStatus",value:function(e){return this._getModule(4).setSelfStatus(e)}},{key:"getUserStatus",value:function(e){return this._getModule(4).getUserStatus(e)}},{key:"subscribeUserStatus",value:function(e){return this._getModule(4).subscribeUserStatus(e)}},{key:"unsubscribeUserStatus",value:function(e){return this._getModule(4).unsubscribeUserStatus(e)}},{key:"getFriendList",value:function(){var e=this._getModule(8);return e?e.getLocalFriendList():Wo({code:ho.CANNOT_FIND_MODULE})}},{key:"addFriend",value:function(e){var t=this._getModule(8);return t?t.addFriend(e):Wo({code:ho.CANNOT_FIND_MODULE})}},{key:"deleteFriend",value:function(e){var t=this._getModule(8);return t?t.deleteFriend(e):Wo({code:ho.CANNOT_FIND_MODULE})}},{key:"checkFriend",value:function(e){var t=this._getModule(8);return t?t.checkFriend(e):Wo({code:ho.CANNOT_FIND_MODULE})}},{key:"getFriendProfile",value:function(e){var t=this._getModule(8);return t?t.getFriendProfile(e):Wo({code:ho.CANNOT_FIND_MODULE})}},{key:"updateFriend",value:function(e){var t=this._getModule(8);return t?t.updateFriend(e):Wo({code:ho.CANNOT_FIND_MODULE})}},{key:"getFriendApplicationList",value:function(){var e=this._getModule(8);return e?e.getLocalFriendApplicationList():Wo({code:ho.CANNOT_FIND_MODULE})}},{key:"acceptFriendApplication",value:function(e){var t=this._getModule(8);return t?t.acceptFriendApplication(e):Wo({code:ho.CANNOT_FIND_MODULE})}},{key:"refuseFriendApplication",value:function(e){var t=this._getModule(8);return t?t.refuseFriendApplication(e):Wo({code:ho.CANNOT_FIND_MODULE})}},{key:"deleteFriendApplication",value:function(e){var t=this._getModule(8);return t?t.deleteFriendApplication(e):Wo({code:ho.CANNOT_FIND_MODULE})}},{key:"setFriendApplicationRead",value:function(){var e=this._getModule(8);return e?e.setFriendApplicationRead():Wo({code:ho.CANNOT_FIND_MODULE})}},{key:"getFriendGroupList",value:function(){var e=this._getModule(8);return e?e.getLocalFriendGroupList():Wo({code:ho.CANNOT_FIND_MODULE})}},{key:"createFriendGroup",value:function(e){var t=this._getModule(8);return t?t.createFriendGroup(e):Wo({code:ho.CANNOT_FIND_MODULE})}},{key:"deleteFriendGroup",value:function(e){var t=this._getModule(8);return t?t.deleteFriendGroup(e):Wo({code:ho.CANNOT_FIND_MODULE})}},{key:"addToFriendGroup",value:function(e){var t=this._getModule(8);return t?t.addToFriendGroup(e):Wo({code:ho.CANNOT_FIND_MODULE})}},{key:"removeFromFriendGroup",value:function(e){var t=this._getModule(8);return t?t.removeFromFriendGroup(e):Wo({code:ho.CANNOT_FIND_MODULE})}},{key:"renameFriendGroup",value:function(e){var t=this._getModule(8);return t?t.renameFriendGroup(e):Wo({code:ho.CANNOT_FIND_MODULE})}},{key:"getGroupList",value:function(e){return this._getModule(7).getGroupList(e)}},{key:"getGroupProfile",value:function(e){return this._getModule(7).getGroupProfile(e)}},{key:"createGroup",value:function(e){return this._getModule(7).createGroup(e)}},{key:"dismissGroup",value:function(e){return this._getModule(7).dismissGroup(e)}},{key:"updateGroupProfile",value:function(e){return this._getModule(7).updateGroupProfile(e)}},{key:"joinGroup",value:function(e){return this._getModule(7).joinGroup(e)}},{key:"quitGroup",value:function(e){return this._getModule(7).quitGroup(e)}},{key:"searchGroupByID",value:function(e){return this._getModule(7).searchGroupByID(e)}},{key:"getGroupOnlineMemberCount",value:function(e){return this._getModule(7).getGroupOnlineMemberCount(e)}},{key:"changeGroupOwner",value:function(e){return this._getModule(7).changeGroupOwner(e)}},{key:"getGroupApplicationList",value:function(){return this._getModule(7).getGroupApplicationList()}},{key:"handleGroupApplication",value:function(e){return this._getModule(7).handleGroupApplication(e)}},{key:"initGroupAttributes",value:function(e){return this._getModule(7).initGroupAttributes(e)}},{key:"setGroupAttributes",value:function(e){return this._getModule(7).setGroupAttributes(e)}},{key:"deleteGroupAttributes",value:function(e){return this._getModule(7).deleteGroupAttributes(e)}},{key:"getGroupAttributes",value:function(e){return this._getModule(7).getGroupAttributes(e)}},{key:"setGroupCounters",value:function(e){return this._getModule(7).setGroupCounters(e)}},{key:"increaseGroupCounter",value:function(e){return this._getModule(7).increaseGroupCounter(e)}},{key:"decreaseGroupCounter",value:function(e){return this._getModule(7).decreaseGroupCounter(e)}},{key:"getGroupCounters",value:function(e){return this._getModule(7).getGroupCounters(e)}},{key:"getGroupMemberList",value:function(e){return this._getModule(9).getGroupMemberList(e)}},{key:"getGroupMemberProfile",value:function(e){return this._getModule(9).getGroupMemberProfile(e)}},{key:"addGroupMember",value:function(e){return this._getModule(9).addGroupMember(e)}},{key:"deleteGroupMember",value:function(e){return this._getModule(9).deleteGroupMember(e)}},{key:"setGroupMemberMuteTime",value:function(e){return this._getModule(9).setGroupMemberMuteTime(e)}},{key:"setGroupMemberRole",value:function(e){return this._getModule(9).setGroupMemberRole(e)}},{key:"setGroupMemberNameCard",value:function(e){return this._getModule(9).setGroupMemberNameCard(e)}},{key:"setGroupMemberCustomField",value:function(e){return this._getModule(9).setGroupMemberCustomField(e)}},{key:"markGroupMemberList",value:function(e){return this._getModule(9).markGroupMemberList(e)}},{key:"getJoinedCommunityList",value:function(){return this._getModule(10).getJoinedCommunityList()}},{key:"createTopicInCommunity",value:function(e){return this._getModule(10).createTopicInCommunity(e)}},{key:"deleteTopicFromCommunity",value:function(e){return this._getModule(10).deleteTopicFromCommunity(e)}},{key:"updateTopicProfile",value:function(e){return this._getModule(10).updateTopicProfile(e)}},{key:"getTopicList",value:function(e){return this._getModule(10).getTopicList(e)}}]),e}(),zr={login:1,logout:1,destroy:1,on:1,off:1,ready:1,setLogLevel:1,joinGroup:1,quitGroup:1,registerPlugin:1,getGroupOnlineMemberCount:1};function Yr(e,t){if(e.isReady()||1===zr[t])return!0;var n=e.getNotReadyReason(),i={code:n,message:"".concat(e.getErrorMessage(n)," | ").concat(t," | ").concat(e.getErrorMessage(ho.SDK_IS_NOT_READY))};return e.onError(i),i}var Wr={},Jr={create:function(e){var n=0,i=e.SDKAppID;if(Ve(i))n=i;else if(n=parseInt(i),isNaN(i))return Le.e("".concat("TIM.create"," failed. Failed to parse the SDKAppID, please check the arguments")),null;if(n&&Wr[n])return Wr[n];Le.l("".concat("TIM.create"));var o=new jr(t(t({},e),{},{SDKAppID:n}));o.on(A.SDK_DESTROY,(function(e){Wr[e.data.SDKAppID]=null,delete Wr[e.data.SDKAppID]}));var s=function(e){var t=Object.create(null);return Object.keys(mn).forEach((function(n){if(e[n]){var i=new L;t[n]=function(){var t=Array.from(arguments);return i.use((function(t,i){var o=Yr(e,n);return!0===o?i():Wo(o)})).use((function(e,t){if(!0===xt(e,vn[n],n))return t()})).use((function(t,i){return e[n].apply(e,t)})),i.run(t)}}})),t}(o);return Wr[n]=s,vn.hookGetAPITips(o.getErrorMessage.bind(o)),Le.l("".concat("TIM.create"," ok")),s}};return Jr.TYPES=b,Jr.EVENT=A,Jr.VERSION="2.27.2",Le.l("TIM.VERSION:".concat(Jr.VERSION)),Jr}))}).call(this,n("fe07")["default"],n("c8ba"),n("0de9")["default"])},b82f:function(e,t,n){"use strict";n.r(t);var i=n("1d9f"),o=n("75c6");for(var s in o)["default"].indexOf(s)<0&&function(e){n.d(t,e,(function(){return o[e]}))}(s);var r=n("f0c5"),a=Object(r["a"])(o["default"],i["b"],i["c"],!1,null,null,null,!1,i["a"],void 0);t["default"]=a.exports},b951:function(e,t,n){"use strict";n.r(t);var i=n("d2f2"),o=n("9dcf");for(var s in o)["default"].indexOf(s)<0&&function(e){n.d(t,e,(function(){return o[e]}))}(s);var r=n("f0c5"),a=Object(r["a"])(o["default"],i["b"],i["c"],!1,null,null,null,!1,i["a"],void 0);t["default"]=a.exports},bc7d:function(e,t,n){"use strict";n.r(t);var i=n("7573"),o=n("6b38");for(var s in o)["default"].indexOf(s)<0&&function(e){n.d(t,e,(function(){return o[e]}))}(s);var r=n("f0c5"),a=Object(r["a"])(o["default"],i["b"],i["c"],!1,null,null,null,!1,i["a"],void 0);t["default"]=a.exports},bf51:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i={name:"Header",data:function(){return{uid:"",imgUrl:"",token:"",name:""}},mounted:function(){},created:function(){this.getStorage()},methods:{toSearch:function(){uni.navigateTo({url:"../search/search"})},toGroup:function(){uni.navigateTo({url:"../group/group"})},getStorage:function(){try{var e=uni.getStorageSync("user");e?(this.uid=e.id,this.imgUrl=this.serverUrl+e.imgUrl,this.name=e.name,this.token=e.token,this.$forceUpdate()):uni.navigateTo({url:"../login/login"})}catch(t){}}}};t.default=i},c081:function(e,t,n){"use strict";n.r(t);var i=n("6b3a"),o=n.n(i);for(var s in i)["default"].indexOf(s)<0&&function(e){n.d(t,e,(function(){return i[e]}))}(s);t["default"]=o.a},c135:function(e,t){e.exports=function(e){if(Array.isArray(e))return e},e.exports.__esModule=!0,e.exports["default"]=e.exports},c240:function(e,t){e.exports=function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")},e.exports.__esModule=!0,e.exports["default"]=e.exports},c374:function(e,t,n){(function(e,i,o){var s,r,a,c=n("9523"),u=n("3c96"),l=n("8962"),d=n("970b"),p=n("5bc3"),h=n("ed6d"),f=n("6b58"),g=n("36c6"),_=n("7037");function v(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function m(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return y(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return y(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var i=0,o=function(){};return{s:o,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s,r=!0,a=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return r=e.done,e},e:function(e){a=!0,s=e},f:function(){try{r||null==n.return||n.return()}finally{if(a)throw s}}}}function y(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}function M(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,i=g(e);if(t){var o=g(this).constructor;n=Reflect.construct(i,arguments,o)}else n=i.apply(this,arguments);return f(this,n)}}!function(e,n){"object"==_(t)&&"object"==_(o)?o.exports=n():(r=[],s=n,a="function"===typeof s?s.apply(t,r):s,void 0===a||(o.exports=a))}(window,(function(){return function(e){var t={};function n(i){if(t[i])return t[i].exports;var o=t[i]={i:i,l:!1,exports:{}};return e[i].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=e,n.c=t,n.d=function(e,t,i){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==_(e)&&e&&e.__esModule)return e;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(i,o,function(t){return e[t]}.bind(null,o));return i},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=18)}([function(e,t){e.exports=function(){return function(){}}},function(e,t,n){function i(e){if(e)return function(e){for(var t in i.prototype)e[t]=i.prototype[t];return e}(e)}e.exports=i,i.prototype.on=i.prototype.addEventListener=function(e,t){return this._callbacks=this._callbacks||{},(this._callbacks["$"+e]=this._callbacks["$"+e]||[]).push(t),this},i.prototype.once=function(e,t){function n(){this.off(e,n),t.apply(this,arguments)}return n.fn=t,this.on(e,n),this},i.prototype.off=i.prototype.removeListener=i.prototype.removeAllListeners=i.prototype.removeEventListener=function(e,t){if(this._callbacks=this._callbacks||{},0==arguments.length)return this._callbacks={},this;var n,i=this._callbacks["$"+e];if(!i)return this;if(1==arguments.length)return delete this._callbacks["$"+e],this;for(var o=0;o<i.length;o++)if((n=i[o])===t||n.fn===t){i.splice(o,1);break}return 0===i.length&&delete this._callbacks["$"+e],this},i.prototype.emit=function(e){this._callbacks=this._callbacks||{};for(var t=new Array(arguments.length-1),n=this._callbacks["$"+e],i=1;i<arguments.length;i++)t[i-1]=arguments[i];if(n){i=0;for(var o=(n=n.slice(0)).length;i<o;++i)n[i].apply(this,t)}return this},i.prototype.listeners=function(e){return this._callbacks=this._callbacks||{},this._callbacks["$"+e]||[]},i.prototype.hasListeners=function(e){return!!this.listeners(e).length}},function(e,t,n){var i=n(25),o=n(26),s=String.fromCharCode(30);e.exports={protocol:4,encodePacket:i,encodePayload:function(e,t){var n=e.length,o=new Array(n),r=0;e.forEach((function(e,a){i(e,!1,(function(e){o[a]=e,++r===n&&t(o.join(s))}))}))},decodePacket:o,decodePayload:function(e,t){for(var n=e.split(s),i=[],r=0;r<n.length;r++){var a=o(n[r],t);if(i.push(a),"error"===a.type)break}return i}}},function(e,t){e.exports="undefined"!=typeof self?self:"undefined"!=typeof window?window:Function("return this")()},function(e,t,n){var i=n(2),o=n(1),s=n(0)("engine.io-client:transport");e.exports=function(e){"use strict";h(n,e);var t=M(n);function n(e){var i;return d(this,n),i=t.call(this),i.opts=e,i.query=e.query,i.readyState="",i.socket=e.socket,i}return p(n,[{key:"onError",value:function(e,t){var n=new Error(e);return n.type="TransportError",n.description=t,this.emit("error",n),this}},{key:"open",value:function(){return"closed"!==this.readyState&&""!==this.readyState||(this.readyState="opening",this.doOpen()),this}},{key:"close",value:function(){return"opening"!==this.readyState&&"open"!==this.readyState||(this.doClose(),this.onClose()),this}},{key:"send",value:function(e){"open"===this.readyState?this.write(e):s("transport is not open, discarding packets")}},{key:"onOpen",value:function(){this.readyState="open",this.writable=!0,this.emit("open")}},{key:"onData",value:function(e){var t=i.decodePacket(e,this.socket.binaryType);this.onPacket(t)}},{key:"onPacket",value:function(e){this.emit("packet",e)}},{key:"onClose",value:function(){this.readyState="closed",this.emit("close")}}]),n}(o)},function(e,t){t.encode=function(e){var t="";for(var n in e)e.hasOwnProperty(n)&&(t.length&&(t+="&"),t+=encodeURIComponent(n)+"="+encodeURIComponent(e[n]));return t},t.decode=function(e){for(var t={},n=e.split("&"),i=0,o=n.length;i<o;i++){var s=n[i].split("=");t[decodeURIComponent(s[0])]=decodeURIComponent(s[1])}return t}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Decoder=t.Encoder=t.PacketType=t.protocol=void 0;var i,o=n(1),s=n(38),r=n(16),a=n(0)("socket.io-parser");t.protocol=5,function(e){e[e.CONNECT=0]="CONNECT",e[e.DISCONNECT=1]="DISCONNECT",e[e.EVENT=2]="EVENT",e[e.ACK=3]="ACK",e[e.CONNECT_ERROR=4]="CONNECT_ERROR",e[e.BINARY_EVENT=5]="BINARY_EVENT",e[e.BINARY_ACK=6]="BINARY_ACK"}(i=t.PacketType||(t.PacketType={})),t.Encoder=function(){function e(){d(this,e)}return p(e,[{key:"encode",value:function(e){return a("encoding packet %j",e),e.type!==i.EVENT&&e.type!==i.ACK||!r.hasBinary(e)?[this.encodeAsString(e)]:(e.type=e.type===i.EVENT?i.BINARY_EVENT:i.BINARY_ACK,this.encodeAsBinary(e))}},{key:"encodeAsString",value:function(e){var t=""+e.type;return e.type!==i.BINARY_EVENT&&e.type!==i.BINARY_ACK||(t+=e.attachments+"-"),e.nsp&&"/"!==e.nsp&&(t+=e.nsp+","),null!=e.id&&(t+=e.id),null!=e.data&&(t+=JSON.stringify(e.data)),a("encoded %j as %s",e,t),t}},{key:"encodeAsBinary",value:function(e){var t=s.deconstructPacket(e),n=this.encodeAsString(t.packet),i=t.buffers;return i.unshift(n),i}}]),e}();var c=function(e){h(n,e);var t=M(n);function n(){return d(this,n),t.call(this)}return p(n,[{key:"add",value:function(e){var t;if("string"==typeof e)t=this.decodeString(e),t.type===i.BINARY_EVENT||t.type===i.BINARY_ACK?(this.reconstructor=new u(t),0===t.attachments&&l(g(n.prototype),"emit",this).call(this,"decoded",t)):l(g(n.prototype),"emit",this).call(this,"decoded",t);else{if(!r.isBinary(e)&&!e.base64)throw new Error("Unknown type: "+e);if(!this.reconstructor)throw new Error("got binary data when not reconstructing a packet");t=this.reconstructor.takeBinaryData(e),t&&(this.reconstructor=null,l(g(n.prototype),"emit",this).call(this,"decoded",t))}}},{key:"decodeString",value:function(e){var t=0,o={type:Number(e.charAt(0))};if(void 0===i[o.type])throw new Error("unknown packet type "+o.type);if(o.type===i.BINARY_EVENT||o.type===i.BINARY_ACK){for(var s=t+1;"-"!==e.charAt(++t)&&t!=e.length;);var r=e.substring(s,t);if(r!=Number(r)||"-"!==e.charAt(t))throw new Error("Illegal attachments");o.attachments=Number(r)}if("/"===e.charAt(t+1)){for(var c=t+1;++t;){if(","===e.charAt(t))break;if(t===e.length)break}o.nsp=e.substring(c,t)}else o.nsp="/";var u=e.charAt(t+1);if(""!==u&&Number(u)==u){for(var l=t+1;++t;){var d=e.charAt(t);if(null==d||Number(d)!=d){--t;break}if(t===e.length)break}o.id=Number(e.substring(l,t+1))}if(e.charAt(++t)){var p=function(e){try{return JSON.parse(e)}catch(e){return!1}}(e.substr(t));if(!n.isPayloadValid(o.type,p))throw new Error("invalid payload");o.data=p}return a("decoded %s as %j",e,o),o}},{key:"destroy",value:function(){this.reconstructor&&this.reconstructor.finishedReconstruction()}}],[{key:"isPayloadValid",value:function(e,t){switch(e){case i.CONNECT:return"object"==_(t);case i.DISCONNECT:return void 0===t;case i.CONNECT_ERROR:return"string"==typeof t||"object"==_(t);case i.EVENT:case i.BINARY_EVENT:return Array.isArray(t)&&"string"==typeof t[0];case i.ACK:case i.BINARY_ACK:return Array.isArray(t)}}}]),n}(o);t.Decoder=c;var u=function(){function e(t){d(this,e),this.packet=t,this.buffers=[],this.reconPack=t}return p(e,[{key:"takeBinaryData",value:function(e){if(this.buffers.push(e),this.buffers.length===this.reconPack.attachments){var t=s.reconstructPacket(this.reconPack,this.buffers);return this.finishedReconstruction(),t}return null}},{key:"finishedReconstruction",value:function(){this.reconPack=null,this.buffers=[]}}]),e}()},function(e,t){var n=/^(?:(?![^:@]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,i=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];e.exports=function(e){var t=e,o=e.indexOf("["),s=e.indexOf("]");-1!=o&&-1!=s&&(e=e.substring(0,o)+e.substring(o,s).replace(/:/g,";")+e.substring(s,e.length));for(var r,a,c=n.exec(e||""),u={},l=14;l--;)u[i[l]]=c[l]||"";return-1!=o&&-1!=s&&(u.source=t,u.host=u.host.substring(1,u.host.length-1).replace(/;/g,":"),u.authority=u.authority.replace("[","").replace("]","").replace(/;/g,":"),u.ipv6uri=!0),u.pathNames=function(e,t){var n=t.replace(/\/{2,9}/g,"/").split("/");return"/"!=t.substr(0,1)&&0!==t.length||n.splice(0,1),"/"==t.substr(t.length-1,1)&&n.splice(n.length-1,1),n}(0,u.path),u.queryKey=(r=u.query,a={},r.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,(function(e,t,n){t&&(a[t]=n)})),a),u}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Manager=void 0;var i=n(21),o=n(15),s=n(1),r=n(6),a=n(17),c=n(39),u=n(0)("socket.io-client:manager");t.Manager=function(e){h(n,e);var t=M(n);function n(e,i){var o;d(this,n),o=t.call(this),o.nsps={},o.subs=[],e&&"object"==_(e)&&(i=e,e=void 0),(i=i||{}).path=i.path||"/socket.io",o.opts=i,o.reconnection(!1!==i.reconnection),o.reconnectionAttempts(i.reconnectionAttempts||1/0),o.reconnectionDelay(i.reconnectionDelay||1e3),o.reconnectionDelayMax(i.reconnectionDelayMax||5e3),o.randomizationFactor(i.randomizationFactor||.5),o.backoff=new c({min:o.reconnectionDelay(),max:o.reconnectionDelayMax(),jitter:o.randomizationFactor()}),o.timeout(null==i.timeout?2e4:i.timeout),o._readyState="closed",o.uri=e;var s=i.parser||r;return o.encoder=new s.Encoder,o.decoder=new s.Decoder,o._autoConnect=!1!==i.autoConnect,o._autoConnect&&o.open(),o}return p(n,[{key:"reconnection",value:function(e){return arguments.length?(this._reconnection=!!e,this):this._reconnection}},{key:"reconnectionAttempts",value:function(e){return void 0===e?this._reconnectionAttempts:(this._reconnectionAttempts=e,this)}},{key:"reconnectionDelay",value:function(e){var t;return void 0===e?this._reconnectionDelay:(this._reconnectionDelay=e,null===(t=this.backoff)||void 0===t||t.setMin(e),this)}},{key:"randomizationFactor",value:function(e){var t;return void 0===e?this._randomizationFactor:(this._randomizationFactor=e,null===(t=this.backoff)||void 0===t||t.setJitter(e),this)}},{key:"reconnectionDelayMax",value:function(e){var t;return void 0===e?this._reconnectionDelayMax:(this._reconnectionDelayMax=e,null===(t=this.backoff)||void 0===t||t.setMax(e),this)}},{key:"timeout",value:function(e){return arguments.length?(this._timeout=e,this):this._timeout}},{key:"maybeReconnectOnOpen",value:function(){!this._reconnecting&&this._reconnection&&0===this.backoff.attempts&&this.reconnect()}},{key:"open",value:function(e){var t=this;if(u("readyState %s",this._readyState),~this._readyState.indexOf("open"))return this;u("opening %s",this.uri),this.engine=i(this.uri,this.opts);var o=this.engine,s=this;this._readyState="opening",this.skipReconnect=!1;var r=a.on(o,"open",(function(){s.onopen(),e&&e()})),c=a.on(o,"error",(function(i){u("error"),s.cleanup(),s._readyState="closed",l(g(n.prototype),"emit",t).call(t,"error",i),e?e(i):s.maybeReconnectOnOpen()}));if(!1!==this._timeout){var d=this._timeout;u("connect attempt will timeout after %d",d),0===d&&r();var p=setTimeout((function(){u("connect attempt timed out after %d",d),r(),o.close(),o.emit("error",new Error("timeout"))}),d);this.subs.push((function(){clearTimeout(p)}))}return this.subs.push(r),this.subs.push(c),this}},{key:"connect",value:function(e){return this.open(e)}},{key:"onopen",value:function(){u("open"),this.cleanup(),this._readyState="open",l(g(n.prototype),"emit",this).call(this,"open");var e=this.engine;this.subs.push(a.on(e,"ping",this.onping.bind(this)),a.on(e,"data",this.ondata.bind(this)),a.on(e,"error",this.onerror.bind(this)),a.on(e,"close",this.onclose.bind(this)),a.on(this.decoder,"decoded",this.ondecoded.bind(this)))}},{key:"onping",value:function(){l(g(n.prototype),"emit",this).call(this,"ping")}},{key:"ondata",value:function(e){this.decoder.add(e)}},{key:"ondecoded",value:function(e){l(g(n.prototype),"emit",this).call(this,"packet",e)}},{key:"onerror",value:function(e){u("error",e),l(g(n.prototype),"emit",this).call(this,"error",e)}},{key:"socket",value:function(e,t){var n=this.nsps[e];return n||(n=new o.Socket(this,e,t),this.nsps[e]=n),n}},{key:"_destroy",value:function(e){for(var t=Object.keys(this.nsps),n=0,i=t;n<i.length;n++){var o=i[n];if(this.nsps[o].active)return void u("socket %s is still active, skipping close",o)}this._close()}},{key:"_packet",value:function(e){u("writing packet %j",e),e.query&&0===e.type&&(e.nsp+="?"+e.query);for(var t=this.encoder.encode(e),n=0;n<t.length;n++)this.engine.write(t[n],e.options)}},{key:"cleanup",value:function(){u("cleanup"),this.subs.forEach((function(e){return e()})),this.subs.length=0,this.decoder.destroy()}},{key:"_close",value:function(){u("disconnect"),this.skipReconnect=!0,this._reconnecting=!1,"opening"===this._readyState&&this.cleanup(),this.backoff.reset(),this._readyState="closed",this.engine&&this.engine.close()}},{key:"disconnect",value:function(){return this._close()}},{key:"onclose",value:function(e){u("onclose"),this.cleanup(),this.backoff.reset(),this._readyState="closed",l(g(n.prototype),"emit",this).call(this,"close",e),this._reconnection&&!this.skipReconnect&&this.reconnect()}},{key:"reconnect",value:function(){var e=this;if(this._reconnecting||this.skipReconnect)return this;var t=this;if(this.backoff.attempts>=this._reconnectionAttempts)u("reconnect failed"),this.backoff.reset(),l(g(n.prototype),"emit",this).call(this,"reconnect_failed"),this._reconnecting=!1;else{var i=this.backoff.duration();u("will wait %dms before reconnect attempt",i),this._reconnecting=!0;var o=setTimeout((function(){t.skipReconnect||(u("attempting reconnect"),l(g(n.prototype),"emit",e).call(e,"reconnect_attempt",t.backoff.attempts),t.skipReconnect||t.open((function(i){i?(u("reconnect attempt error"),t._reconnecting=!1,t.reconnect(),l(g(n.prototype),"emit",e).call(e,"reconnect_error",i)):(u("reconnect success"),t.onreconnect())})))}),i);this.subs.push((function(){clearTimeout(o)}))}}},{key:"onreconnect",value:function(){var e=this.backoff.attempts;this._reconnecting=!1,this.backoff.reset(),l(g(n.prototype),"emit",this).call(this,"reconnect",e)}}]),n}(s)},function(e,t,n){var i=n(10),o=n(24),s=n(28),r=n(29);t.polling=function(e){var t,n=!1,r=!1,a=!1!==e.jsonp;if("undefined"!=typeof location){var c="https:"===location.protocol,u=location.port;u||(u=c?443:80),n=e.hostname!==location.hostname||u!==e.port,r=e.secure!==c}if(e.xdomain=n,e.xscheme=r,t=new i(e),"open"in t&&!e.forceJSONP)return new o(e);if(!a)throw new Error("JSONP disabled");return new s(e)},t.websocket=r},function(e,t,n){var i=n(23),o=n(3);e.exports=function(e){var t=e.xdomain,n=e.xscheme,s=e.enablesXDR;try{if("undefined"!=typeof XMLHttpRequest&&(!t||i))return new XMLHttpRequest}catch(e){}try{if("undefined"!=typeof XDomainRequest&&!n&&s)return new XDomainRequest}catch(e){}if(!t)try{return new(o[["Active"].concat("Object").join("X")])("Microsoft.XMLHTTP")}catch(e){}}},function(e,t,n){var i=n(4),o=n(5),s=n(2),r=n(13),a=n(0)("engine.io-client:polling");e.exports=function(e){"use strict";h(n,e);var t=M(n);function n(){return d(this,n),t.apply(this,arguments)}return p(n,[{key:"name",get:function(){return"polling"}},{key:"doOpen",value:function(){this.poll()}},{key:"pause",value:function(e){var t=this;function n(){a("paused"),t.readyState="paused",e()}if(this.readyState="pausing",this.polling||!this.writable){var i=0;this.polling&&(a("we are currently polling - waiting to pause"),i++,this.once("pollComplete",(function(){a("pre-pause polling complete"),--i||n()}))),this.writable||(a("we are currently writing - waiting to pause"),i++,this.once("drain",(function(){a("pre-pause writing complete"),--i||n()})))}else n()}},{key:"poll",value:function(){a("polling"),this.polling=!0,this.doPoll(),this.emit("poll")}},{key:"onData",value:function(e){var t=this;a("polling got data %s",e),s.decodePayload(e,this.socket.binaryType).forEach((function(e,n,i){if("opening"===t.readyState&&"open"===e.type&&t.onOpen(),"close"===e.type)return t.onClose(),!1;t.onPacket(e)})),"closed"!==this.readyState&&(this.polling=!1,this.emit("pollComplete"),"open"===this.readyState?this.poll():a('ignoring poll - transport state "%s"',this.readyState))}},{key:"doClose",value:function(){var e=this;function t(){a("writing close packet"),e.write([{type:"close"}])}"open"===this.readyState?(a("transport open - closing"),t()):(a("transport not open - deferring close"),this.once("open",t))}},{key:"write",value:function(e){var t=this;this.writable=!1,s.encodePayload(e,(function(e){t.doWrite(e,(function(){t.writable=!0,t.emit("drain")}))}))}},{key:"uri",value:function(){var e=this.query||{},t=this.opts.secure?"https":"http",n="";return!1!==this.opts.timestampRequests&&(e[this.opts.timestampParam]=r()),this.supportsBinary||e.sid||(e.b64=1),e=o.encode(e),this.opts.port&&("https"===t&&443!==Number(this.opts.port)||"http"===t&&80!==Number(this.opts.port))&&(n=":"+this.opts.port),e.length&&(e="?"+e),t+"://"+(-1!==this.opts.hostname.indexOf(":")?"["+this.opts.hostname+"]":this.opts.hostname)+n+this.opts.path+e}}]),n}(i)},function(e,t){var n=Object.create(null);n.open="0",n.close="1",n.ping="2",n.pong="3",n.message="4",n.upgrade="5",n.noop="6";var i=Object.create(null);Object.keys(n).forEach((function(e){i[n[e]]=e})),e.exports={PACKET_TYPES:n,PACKET_TYPES_REVERSE:i,ERROR_PACKET:{type:"error",data:"parser error"}}},function(e,t,n){"use strict";var i,o="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_".split(""),s={},r=0,a=0;function c(e){var t="";do{t=o[e%64]+t,e=Math.floor(e/64)}while(e>0);return t}function u(){var e=c(+new Date);return e!==i?(r=0,i=e):e+"."+c(r++)}for(;a<64;a++)s[o[a]]=a;u.encode=c,u.decode=function(e){var t=0;for(a=0;a<e.length;a++)t=64*t+s[e.charAt(a)];return t},e.exports=u},function(e,t){e.exports.pick=function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return n.reduce((function(t,n){return e.hasOwnProperty(n)&&(t[n]=e[n]),t}),{})}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Socket=void 0;var i=n(6),o=n(1),s=n(17),r=n(0)("socket.io-client:socket"),a=Object.freeze({connect:1,connect_error:1,disconnect:1,disconnecting:1,newListener:1,removeListener:1});t.Socket=function(e){h(n,e);var t=M(n);function n(e,i,o){var s;return d(this,n),s=t.call(this),s.receiveBuffer=[],s.sendBuffer=[],s.ids=0,s.acks={},s.flags={},s.io=e,s.nsp=i,s.ids=0,s.acks={},s.receiveBuffer=[],s.sendBuffer=[],s.connected=!1,s.disconnected=!0,s.flags={},o&&o.auth&&(s.auth=o.auth),s.io._autoConnect&&s.open(),s}return p(n,[{key:"subEvents",value:function(){if(!this.subs){var e=this.io;this.subs=[s.on(e,"open",this.onopen.bind(this)),s.on(e,"packet",this.onpacket.bind(this)),s.on(e,"error",this.onerror.bind(this)),s.on(e,"close",this.onclose.bind(this))]}}},{key:"active",get:function(){return!!this.subs}},{key:"connect",value:function(){return this.connected||(this.subEvents(),this.io._reconnecting||this.io.open(),"open"===this.io._readyState&&this.onopen()),this}},{key:"open",value:function(){return this.connect()}},{key:"send",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return t.unshift("message"),this.emit.apply(this,t),this}},{key:"emit",value:function(e){if(a.hasOwnProperty(e))throw new Error('"'+e+'" is a reserved event name');for(var t=arguments.length,n=new Array(t>1?t-1:0),o=1;o<t;o++)n[o-1]=arguments[o];n.unshift(e);var s={type:i.PacketType.EVENT,data:n,options:{}};s.options.compress=!1!==this.flags.compress,"function"==typeof n[n.length-1]&&(r("emitting packet with ack id %d",this.ids),this.acks[this.ids]=n.pop(),s.id=this.ids++);var c=this.io.engine&&this.io.engine.transport&&this.io.engine.transport.writable;return!this.flags.volatile||c&&this.connected?this.connected?this.packet(s):this.sendBuffer.push(s):r("discard packet as the transport is not currently writable"),this.flags={},this}},{key:"packet",value:function(e){e.nsp=this.nsp,this.io._packet(e)}},{key:"onopen",value:function(){var e=this;r("transport is open - connecting"),"function"==typeof this.auth?this.auth((function(t){e.packet({type:i.PacketType.CONNECT,data:t})})):this.packet({type:i.PacketType.CONNECT,data:this.auth})}},{key:"onerror",value:function(e){this.connected||l(g(n.prototype),"emit",this).call(this,"connect_error",e)}},{key:"onclose",value:function(e){r("close (%s)",e),this.connected=!1,this.disconnected=!0,delete this.id,l(g(n.prototype),"emit",this).call(this,"disconnect",e)}},{key:"onpacket",value:function(e){if(e.nsp===this.nsp)switch(e.type){case i.PacketType.CONNECT:if(e.data&&e.data.sid){var t=e.data.sid;this.onconnect(t)}else l(g(n.prototype),"emit",this).call(this,"connect_error",new Error("It seems you are trying to reach a Socket.IO server in v2.x with a v3.x client, but they are not compatible (more information here: https://socket.io/docs/v3/migrating-from-2-x-to-3-0/)"));break;case i.PacketType.EVENT:case i.PacketType.BINARY_EVENT:this.onevent(e);break;case i.PacketType.ACK:case i.PacketType.BINARY_ACK:this.onack(e);break;case i.PacketType.DISCONNECT:this.ondisconnect();break;case i.PacketType.CONNECT_ERROR:var o=new Error(e.data.message);o.data=e.data.data,l(g(n.prototype),"emit",this).call(this,"connect_error",o)}}},{key:"onevent",value:function(e){var t=e.data||[];r("emitting event %j",t),null!=e.id&&(r("attaching ack callback to event"),t.push(this.ack(e.id))),this.connected?this.emitEvent(t):this.receiveBuffer.push(Object.freeze(t))}},{key:"emitEvent",value:function(e){if(this._anyListeners&&this._anyListeners.length){var t,i=this._anyListeners.slice(),o=m(i);try{for(o.s();!(t=o.n()).done;){var s=t.value;s.apply(this,e)}}catch(r){o.e(r)}finally{o.f()}}l(g(n.prototype),"emit",this).apply(this,e)}},{key:"ack",value:function(e){var t=this,n=!1;return function(){for(var o=arguments.length,s=new Array(o),a=0;a<o;a++)s[a]=arguments[a];n||(n=!0,r("sending ack %j",s),t.packet({type:i.PacketType.ACK,id:e,data:s}))}}},{key:"onack",value:function(e){var t=this.acks[e.id];"function"==typeof t?(r("calling ack %s with %j",e.id,e.data),t.apply(this,e.data),delete this.acks[e.id]):r("bad ack %s",e.id)}},{key:"onconnect",value:function(e){r("socket connected with id %s",e),this.id=e,this.connected=!0,this.disconnected=!1,l(g(n.prototype),"emit",this).call(this,"connect"),this.emitBuffered()}},{key:"emitBuffered",value:function(){var e=this;this.receiveBuffer.forEach((function(t){return e.emitEvent(t)})),this.receiveBuffer=[],this.sendBuffer.forEach((function(t){return e.packet(t)})),this.sendBuffer=[]}},{key:"ondisconnect",value:function(){r("server disconnect (%s)",this.nsp),this.destroy(),this.onclose("io server disconnect")}},{key:"destroy",value:function(){this.subs&&(this.subs.forEach((function(e){return e()})),this.subs=void 0),this.io._destroy(this)}},{key:"disconnect",value:function(){return this.connected&&(r("performing disconnect (%s)",this.nsp),this.packet({type:i.PacketType.DISCONNECT})),this.destroy(),this.connected&&this.onclose("io client disconnect"),this}},{key:"close",value:function(){return this.disconnect()}},{key:"compress",value:function(e){return this.flags.compress=e,this}},{key:"volatile",get:function(){return this.flags.volatile=!0,this}},{key:"onAny",value:function(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.push(e),this}},{key:"prependAny",value:function(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.unshift(e),this}},{key:"offAny",value:function(e){if(!this._anyListeners)return this;if(e){for(var t=this._anyListeners,n=0;n<t.length;n++)if(e===t[n])return t.splice(n,1),this}else this._anyListeners=[];return this}},{key:"listenersAny",value:function(){return this._anyListeners||[]}}]),n}(o)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.hasBinary=t.isBinary=void 0;var i="function"==typeof ArrayBuffer,o=Object.prototype.toString,s="function"==typeof Blob||"undefined"!=typeof Blob&&"[object BlobConstructor]"===o.call(Blob),r="function"==typeof File||"undefined"!=typeof File&&"[object FileConstructor]"===o.call(File);function a(e){return i&&(e instanceof ArrayBuffer||function(e){return"function"==typeof ArrayBuffer.isView?ArrayBuffer.isView(e):e.buffer instanceof ArrayBuffer}(e))||s&&e instanceof Blob||r&&e instanceof File}t.isBinary=a,t.hasBinary=function e(t,n){if(!t||"object"!=_(t))return!1;if(Array.isArray(t)){for(var i=0,o=t.length;i<o;i++)if(e(t[i]))return!0;return!1}if(a(t))return!0;if(t.toJSON&&"function"==typeof t.toJSON&&1===arguments.length)return e(t.toJSON(),!0);for(var s in t)if(Object.prototype.hasOwnProperty.call(t,s)&&e(t[s]))return!0;return!1}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.on=void 0,t.on=function(e,t,n){return e.on(t,n),function(){e.off(t,n)}}},function(e,t,n){e.exports=n(19)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Socket=t.io=t.Manager=t.protocol=void 0;var i=n(20),o=n(8),s=n(15);Object.defineProperty(t,"Socket",{enumerable:!0,get:function(){return s.Socket}});var r=n(0)("socket.io-client");e.exports=t=c;var a=t.managers={};function c(e,t){"object"==_(e)&&(t=e,e=void 0),t=t||{};var n,s=i.url(e),c=s.source,u=s.id,l=s.path,d=a[u]&&l in a[u].nsps;return t.forceNew||t["force new connection"]||!1===t.multiplex||d?(r("ignoring socket cache for %s",c),n=new o.Manager(c,t)):(a[u]||(r("new io instance for %s",c),a[u]=new o.Manager(c,t)),n=a[u]),s.query&&!t.query&&(t.query=s.query),n.socket(s.path,t)}t.io=c;var u=n(6);Object.defineProperty(t,"protocol",{enumerable:!0,get:function(){return u.protocol}}),t.connect=c;var l=n(8);Object.defineProperty(t,"Manager",{enumerable:!0,get:function(){return l.Manager}})},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.url=void 0;var i=n(7),o=n(0)("socket.io-client:url");t.url=function(e,t){var n=e;t=t||"undefined"!=typeof location&&location,null==e&&(e=t.protocol+"//"+t.host),"string"==typeof e&&("/"===e.charAt(0)&&(e="/"===e.charAt(1)?t.protocol+e:t.host+e),/^(https?|wss?):\/\//.test(e)||(o("protocol-less url %s",e),e=void 0!==t?t.protocol+"//"+e:"https://"+e),o("parse %s",e),n=i(e)),n.port||(/^(http|ws)$/.test(n.protocol)?n.port="80":/^(http|ws)s$/.test(n.protocol)&&(n.port="443")),n.path=n.path||"/";var s=-1!==n.host.indexOf(":")?"["+n.host+"]":n.host;return n.id=n.protocol+"://"+s+":"+n.port,n.href=n.protocol+"://"+s+(t&&t.port===n.port?"":":"+n.port),n}},function(e,t,n){var i=n(22);e.exports=function(e,t){return new i(e,t)},e.exports.Socket=i,e.exports.protocol=i.protocol,e.exports.Transport=n(4),e.exports.transports=n(9),e.exports.parser=n(2)},function(e,t,n){var i=n(9),o=n(1),s=n(0)("engine.io-client:socket"),r=n(2),a=n(7),c=n(5),u=function(e){"use strict";h(n,e);var t=M(n);function n(e){var i,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return d(this,n),i=t.call(this),e&&"object"==_(e)&&(o=e,e=null),e?(e=a(e),o.hostname=e.host,o.secure="https"===e.protocol||"wss"===e.protocol,o.port=e.port,e.query&&(o.query=e.query)):o.host&&(o.hostname=a(o.host).host),i.secure=null!=o.secure?o.secure:"undefined"!=typeof location&&"https:"===location.protocol,o.hostname&&!o.port&&(o.port=i.secure?"443":"80"),i.hostname=o.hostname||("undefined"!=typeof location?location.hostname:"localhost"),i.port=o.port||("undefined"!=typeof location&&location.port?location.port:i.secure?443:80),i.transports=o.transports||["polling","websocket"],i.readyState="",i.writeBuffer=[],i.prevBufferLen=0,i.opts=Object.assign({path:"/engine.io",agent:!1,withCredentials:!1,upgrade:!0,jsonp:!0,timestampParam:"t",rememberUpgrade:!1,rejectUnauthorized:!0,perMessageDeflate:{threshold:1024},transportOptions:{}},o),i.opts.path=i.opts.path.replace(/\/$/,"")+"/","string"==typeof i.opts.query&&(i.opts.query=c.decode(i.opts.query)),i.id=null,i.upgrades=null,i.pingInterval=null,i.pingTimeout=null,i.pingTimeoutTimer=null,"function"==typeof addEventListener&&(addEventListener("beforeunload",(function(){i.transport&&(i.transport.removeAllListeners(),i.transport.close())}),!1),"localhost"!==i.hostname&&(i.offlineEventListener=function(){i.onClose("transport close")},addEventListener("offline",i.offlineEventListener,!1))),i.open(),i}return p(n,[{key:"createTransport",value:function(e){s('creating transport "%s"',e);var t=function(e){var t={};for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);return t}(this.opts.query);t.EIO=r.protocol,t.transport=e,this.id&&(t.sid=this.id);var n=Object.assign({},this.opts.transportOptions[e],this.opts,{query:t,socket:this,hostname:this.hostname,secure:this.secure,port:this.port});return s("options: %j",n),new i[e](n)}},{key:"open",value:function(){var e;if(this.opts.rememberUpgrade&&n.priorWebsocketSuccess&&-1!==this.transports.indexOf("websocket"))e="websocket";else{if(0===this.transports.length){var t=this;return void setTimeout((function(){t.emit("error","No transports available")}),0)}e=this.transports[0]}this.readyState="opening";try{e=this.createTransport(e)}catch(e){return s("error while creating transport: %s",e),this.transports.shift(),void this.open()}e.open(),this.setTransport(e)}},{key:"setTransport",value:function(e){s("setting transport %s",e.name);var t=this;this.transport&&(s("clearing existing transport %s",this.transport.name),this.transport.removeAllListeners()),this.transport=e,e.on("drain",(function(){t.onDrain()})).on("packet",(function(e){t.onPacket(e)})).on("error",(function(e){t.onError(e)})).on("close",(function(){t.onClose("transport close")}))}},{key:"probe",value:function(e){s('probing transport "%s"',e);var t=this.createTransport(e,{probe:1}),i=!1,o=this;function r(){if(o.onlyBinaryUpgrades){var r=!this.supportsBinary&&o.transport.supportsBinary;i=i||r}i||(s('probe transport "%s" opened',e),t.send([{type:"ping",data:"probe"}]),t.once("packet",(function(r){if(!i)if("pong"===r.type&&"probe"===r.data){if(s('probe transport "%s" pong',e),o.upgrading=!0,o.emit("upgrading",t),!t)return;n.priorWebsocketSuccess="websocket"===t.name,s('pausing current transport "%s"',o.transport.name),o.transport.pause((function(){i||"closed"!==o.readyState&&(s("changing transport and sending upgrade packet"),p(),o.setTransport(t),t.send([{type:"upgrade"}]),o.emit("upgrade",t),t=null,o.upgrading=!1,o.flush())}))}else{s('probe transport "%s" failed',e);var a=new Error("probe error");a.transport=t.name,o.emit("upgradeError",a)}})))}function a(){i||(i=!0,p(),t.close(),t=null)}function c(n){var i=new Error("probe error: "+n);i.transport=t.name,a(),s('probe transport "%s" failed because of error: %s',e,n),o.emit("upgradeError",i)}function u(){c("transport closed")}function l(){c("socket closed")}function d(e){t&&e.name!==t.name&&(s('"%s" works - aborting "%s"',e.name,t.name),a())}function p(){t.removeListener("open",r),t.removeListener("error",c),t.removeListener("close",u),o.removeListener("close",l),o.removeListener("upgrading",d)}n.priorWebsocketSuccess=!1,t.once("open",r),t.once("error",c),t.once("close",u),this.once("close",l),this.once("upgrading",d),t.open()}},{key:"onOpen",value:function(){if(s("socket open"),this.readyState="open",n.priorWebsocketSuccess="websocket"===this.transport.name,this.emit("open"),this.flush(),"open"===this.readyState&&this.opts.upgrade&&this.transport.pause){s("starting upgrade probes");for(var e=0,t=this.upgrades.length;e<t;e++)this.probe(this.upgrades[e])}}},{key:"onPacket",value:function(e){if("opening"===this.readyState||"open"===this.readyState||"closing"===this.readyState)switch(s('socket receive: type "%s", data "%s"',e.type,e.data),this.emit("packet",e),this.emit("heartbeat"),e.type){case"open":this.onHandshake(JSON.parse(e.data));break;case"ping":this.resetPingTimeout(),this.sendPacket("pong"),this.emit("pong");break;case"error":var t=new Error("server error");t.code=e.data,this.onError(t);break;case"message":this.emit("data",e.data),this.emit("message",e.data)}else s('packet received with socket readyState "%s"',this.readyState)}},{key:"onHandshake",value:function(e){this.emit("handshake",e),this.id=e.sid,this.transport.query.sid=e.sid,this.upgrades=this.filterUpgrades(e.upgrades),this.pingInterval=e.pingInterval,this.pingTimeout=e.pingTimeout,this.onOpen(),"closed"!==this.readyState&&this.resetPingTimeout()}},{key:"resetPingTimeout",value:function(){var e=this;clearTimeout(this.pingTimeoutTimer),this.pingTimeoutTimer=setTimeout((function(){e.onClose("ping timeout")}),this.pingInterval+this.pingTimeout),this.opts.autoUnref&&this.pingTimeoutTimer.unref()}},{key:"onDrain",value:function(){this.writeBuffer.splice(0,this.prevBufferLen),this.prevBufferLen=0,0===this.writeBuffer.length?this.emit("drain"):this.flush()}},{key:"flush",value:function(){"closed"!==this.readyState&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length&&(s("flushing %d packets in socket",this.writeBuffer.length),this.transport.send(this.writeBuffer),this.prevBufferLen=this.writeBuffer.length,this.emit("flush"))}},{key:"write",value:function(e,t,n){return this.sendPacket("message",e,t,n),this}},{key:"send",value:function(e,t,n){return this.sendPacket("message",e,t,n),this}},{key:"sendPacket",value:function(e,t,n,i){if("function"==typeof t&&(i=t,t=void 0),"function"==typeof n&&(i=n,n=null),"closing"!==this.readyState&&"closed"!==this.readyState){(n=n||{}).compress=!1!==n.compress;var o={type:e,data:t,options:n};this.emit("packetCreate",o),this.writeBuffer.push(o),i&&this.once("flush",i),this.flush()}}},{key:"close",value:function(){var e=this;function t(){e.onClose("forced close"),s("socket closing - telling transport to close"),e.transport.close()}function n(){e.removeListener("upgrade",n),e.removeListener("upgradeError",n),t()}function i(){e.once("upgrade",n),e.once("upgradeError",n)}return"opening"!==this.readyState&&"open"!==this.readyState||(this.readyState="closing",this.writeBuffer.length?this.once("drain",(function(){this.upgrading?i():t()})):this.upgrading?i():t()),this}},{key:"onError",value:function(e){s("socket error %j",e),n.priorWebsocketSuccess=!1,this.emit("error",e),this.onClose("transport error",e)}},{key:"onClose",value:function(e,t){if("opening"===this.readyState||"open"===this.readyState||"closing"===this.readyState){s('socket close with reason: "%s"',e);clearTimeout(this.pingIntervalTimer),clearTimeout(this.pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),"function"==typeof removeEventListener&&removeEventListener("offline",this.offlineEventListener,!1),this.readyState="closed",this.id=null,this.emit("close",e,t),this.writeBuffer=[],this.prevBufferLen=0}}},{key:"filterUpgrades",value:function(e){for(var t=[],n=0,i=e.length;n<i;n++)~this.transports.indexOf(e[n])&&t.push(e[n]);return t}}]),n}(o);u.priorWebsocketSuccess=!1,u.protocol=r.protocol,e.exports=u},function(e,t){try{e.exports="undefined"!=typeof XMLHttpRequest&&"withCredentials"in new XMLHttpRequest}catch(t){e.exports=!1}},function(e,t,n){var i=n(10),o=n(11),s=n(1),r=n(14),a=r.pick,c=n(3),u=n(0)("engine.io-client:polling-xhr");function l(){}var g=null!=new i({xdomain:!1}).responseType,_=function(e){"use strict";h(n,e);var t=M(n);function n(e,i){var o;return d(this,n),o=t.call(this),o.opts=i,o.method=i.method||"GET",o.uri=e,o.async=!1!==i.async,o.data=void 0!==i.data?i.data:null,o.create(),o}return p(n,[{key:"create",value:function(){var e=a(this.opts,"agent","enablesXDR","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","autoUnref");e.xdomain=!!this.opts.xd,e.xscheme=!!this.opts.xs;var t=this.xhr=new i(e),o=this;try{u("xhr open %s: %s",this.method,this.uri),t.open(this.method,this.uri,this.async);try{if(this.opts.extraHeaders)for(var s in t.setDisableHeaderCheck&&t.setDisableHeaderCheck(!0),this.opts.extraHeaders)this.opts.extraHeaders.hasOwnProperty(s)&&t.setRequestHeader(s,this.opts.extraHeaders[s])}catch(e){}if("POST"===this.method)try{t.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch(e){}try{t.setRequestHeader("Accept","*/*")}catch(e){}"withCredentials"in t&&(t.withCredentials=this.opts.withCredentials),this.opts.requestTimeout&&(t.timeout=this.opts.requestTimeout),this.hasXDR()?(t.onload=function(){o.onLoad()},t.onerror=function(){o.onError(t.responseText)}):t.onreadystatechange=function(){4===t.readyState&&(200===t.status||1223===t.status?o.onLoad():setTimeout((function(){o.onError("number"==typeof t.status?t.status:0)}),0))},u("xhr data %s",this.data),t.send(this.data)}catch(e){return void setTimeout((function(){o.onError(e)}),0)}"undefined"!=typeof document&&(this.index=n.requestsCount++,n.requests[this.index]=this)}},{key:"onSuccess",value:function(){this.emit("success"),this.cleanup()}},{key:"onData",value:function(e){this.emit("data",e),this.onSuccess()}},{key:"onError",value:function(e){this.emit("error",e),this.cleanup(!0)}},{key:"cleanup",value:function(e){if(void 0!==this.xhr&&null!==this.xhr){if(this.hasXDR()?this.xhr.onload=this.xhr.onerror=l:this.xhr.onreadystatechange=l,e)try{this.xhr.abort()}catch(e){}"undefined"!=typeof document&&delete n.requests[this.index],this.xhr=null}}},{key:"onLoad",value:function(){var e=this.xhr.responseText;null!==e&&this.onData(e)}},{key:"hasXDR",value:function(){return"undefined"!=typeof XDomainRequest&&!this.xs&&this.enablesXDR}},{key:"abort",value:function(){this.cleanup()}}]),n}(s);function v(){for(var e in _.requests)_.requests.hasOwnProperty(e)&&_.requests[e].abort()}_.requestsCount=0,_.requests={},"undefined"!=typeof document&&("function"==typeof attachEvent?attachEvent("onunload",v):"function"==typeof addEventListener&&addEventListener("onpagehide"in c?"pagehide":"unload",v,!1)),e.exports=function(e){"use strict";h(n,e);var t=M(n);function n(e){var i;if(d(this,n),i=t.call(this,e),"undefined"!=typeof location){var o="https:"===location.protocol,s=location.port;s||(s=o?443:80),i.xd="undefined"!=typeof location&&e.hostname!==location.hostname||s!==e.port,i.xs=e.secure!==o}var r=e&&e.forceBase64;return i.supportsBinary=g&&!r,f(i)}return p(n,[{key:"request",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object.assign(e,{xd:this.xd,xs:this.xs},this.opts),new _(this.uri(),e)}},{key:"doWrite",value:function(e,t){var n=this.request({method:"POST",data:e}),i=this;n.on("success",t),n.on("error",(function(e){i.onError("xhr post error",e)}))}},{key:"doPoll",value:function(){u("xhr poll");var e=this.request(),t=this;e.on("data",(function(e){t.onData(e)})),e.on("error",(function(e){t.onError("xhr poll error",e)})),this.pollXhr=e}}]),n}(o),e.exports.Request=_},function(e,t,n){var i=n(12),o=i.PACKET_TYPES,s="function"==typeof Blob||"undefined"!=typeof Blob&&"[object BlobConstructor]"===Object.prototype.toString.call(Blob),r="function"==typeof ArrayBuffer,a=function(e,t){var n=new FileReader;return n.onload=function(){var e=n.result.split(",")[1];t("b"+e)},n.readAsDataURL(e)};e.exports=function(e,t,n){var i,c=e.type,u=e.data;return s&&u instanceof Blob?t?n(u):a(u,n):r&&(u instanceof ArrayBuffer||(i=u,"function"==typeof ArrayBuffer.isView?ArrayBuffer.isView(i):i&&i.buffer instanceof ArrayBuffer))?t?n(u instanceof ArrayBuffer?u:u.buffer):a(new Blob([u]),n):n(o[c]+(u||""))}},function(e,t,n){var i,o=n(12),s=o.PACKET_TYPES_REVERSE,r=o.ERROR_PACKET;"function"==typeof ArrayBuffer&&(i=n(27));var a=function(e,t){if(i){var n=i.decode(e);return c(n,t)}return{base64:!0,data:e}},c=function(e,t){switch(t){case"blob":return e instanceof ArrayBuffer?new Blob([e]):e;case"arraybuffer":default:return e}};e.exports=function(e,t){if("string"!=typeof e)return{type:"message",data:c(e,t)};var n=e.charAt(0);return"b"===n?{type:"message",data:a(e.substring(1),t)}:s[n]?e.length>1?{type:s[n],data:e.substring(1)}:{type:s[n]}:r}},function(e,t){!function(e){"use strict";t.encode=function(t){var n,i=new Uint8Array(t),o=i.length,s="";for(n=0;n<o;n+=3)s+=e[i[n]>>2],s+=e[(3&i[n])<<4|i[n+1]>>4],s+=e[(15&i[n+1])<<2|i[n+2]>>6],s+=e[63&i[n+2]];return o%3==2?s=s.substring(0,s.length-1)+"=":o%3==1&&(s=s.substring(0,s.length-2)+"=="),s},t.decode=function(t){var n,i,o,s,r,a=.75*t.length,c=t.length,u=0;"="===t[t.length-1]&&(a--,"="===t[t.length-2]&&a--);var l=new ArrayBuffer(a),d=new Uint8Array(l);for(n=0;n<c;n+=4)i=e.indexOf(t[n]),o=e.indexOf(t[n+1]),s=e.indexOf(t[n+2]),r=e.indexOf(t[n+3]),d[u++]=i<<2|o>>4,d[u++]=(15&o)<<4|s>>2,d[u++]=(3&s)<<6|63&r;return l}}("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/")},function(e,t,n){var i,o=n(11),s=n(3),r=/\n/g,a=/\\n/g;e.exports=function(e){"use strict";h(n,e);var t=M(n);function n(e){var o;d(this,n),o=t.call(this,e),o.query=o.query||{},i||(i=s.___eio=s.___eio||[]),o.index=i.length;var r=u(o);return i.push((function(e){r.onData(e)})),o.query.j=o.index,o}return p(n,[{key:"supportsBinary",get:function(){return!1}},{key:"doClose",value:function(){this.script&&(this.script.onerror=function(){},this.script.parentNode.removeChild(this.script),this.script=null),this.form&&(this.form.parentNode.removeChild(this.form),this.form=null,this.iframe=null),l(g(n.prototype),"doClose",this).call(this)}},{key:"doPoll",value:function(){var e=this,t=document.createElement("script");this.script&&(this.script.parentNode.removeChild(this.script),this.script=null),t.async=!0,t.src=this.uri(),t.onerror=function(t){e.onError("jsonp poll error",t)};var n=document.getElementsByTagName("script")[0];n?n.parentNode.insertBefore(t,n):(document.head||document.body).appendChild(t),this.script=t,"undefined"!=typeof navigator&&/gecko/i.test(navigator.userAgent)&&setTimeout((function(){var e=document.createElement("iframe");document.body.appendChild(e),document.body.removeChild(e)}),100)}},{key:"doWrite",value:function(e,t){var n,i=this;if(!this.form){var o=document.createElement("form"),s=document.createElement("textarea"),c=this.iframeId="eio_iframe_"+this.index;o.className="socketio",o.style.position="absolute",o.style.top="-1000px",o.style.left="-1000px",o.target=c,o.method="POST",o.setAttribute("accept-charset","utf-8"),s.name="d",o.appendChild(s),document.body.appendChild(o),this.form=o,this.area=s}function u(){l(),t()}function l(){if(i.iframe)try{i.form.removeChild(i.iframe)}catch(e){i.onError("jsonp polling iframe removal error",e)}try{var t='<iframe src="javascript:0" name="'+i.iframeId+'">';n=document.createElement(t)}catch(e){n=document.createElement("iframe"),n.name=i.iframeId,n.src="javascript:0"}n.id=i.iframeId,i.form.appendChild(n),i.iframe=n}this.form.action=this.uri(),l(),e=e.replace(a,"\\\n"),this.area.value=e.replace(r,"\\n");try{this.form.submit()}catch(e){}this.iframe.attachEvent?this.iframe.onreadystatechange=function(){"complete"===i.iframe.readyState&&u()}:this.iframe.onload=u}}]),n}(o)},function(t,n,i){(function(n){var o=i(2),s=i(5),r=i(13),a=i(4),c=i(14),u=c.pick,l=i(3),f=i(0)("engine.io-client:websocket"),g=l.WebSocket||l.MozWebSocket,_=!0,v="arraybuffer";"undefined"==typeof window&&(g=i(35),_=!1,v="nodebuffer");var m="undefined"!=typeof navigator&&"string"==typeof navigator.product&&"reactnative"===navigator.product.toLowerCase(),y=function(t){"use strict";h(c,t);var i=M(c);function c(e){var t;return d(this,c),t=i.call(this,e),t.supportsBinary=!e.forceBase64,t}return p(c,[{key:"name",get:function(){return"websocket"}},{key:"doOpen",value:function(){if(this.check()){var t=this.uri(),n=this.opts.protocols,i=m?{}:u(this.opts,"agent","perMessageDeflate","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","localAddress","protocolVersion","origin","maxPayload","family","checkServerIdentity");this.opts.extraHeaders&&(i.headers=this.opts.extraHeaders);try{this.ws=_&&!m?n?new g(t,n):new g(t):new g(t,n,i)}catch(t){return e("log","error",t," at components/socket/uni-socket.io.js:1"),this.emit("error",t)}this.ws.binaryType=this.socket.binaryType||v,this.addEventListeners()}}},{key:"addEventListeners",value:function(){var e=this;this.ws.onopen=function(){e.opts.autoUnref&&e.ws._socket.unref(),e.onOpen()},this.ws.onclose=this.onClose.bind(this),this.ws.onmessage=function(t){return e.onData(t.data)},this.ws.onerror=function(t){return e.onError("websocket error",t)}}},{key:"write",value:function(e){var t=this;this.writable=!1;for(var i=e.length,s=0,r=i;s<r;s++)!function(e){o.encodePacket(e,t.supportsBinary,(function(o){var s={};!_&&(e.options&&(s.compress=e.options.compress),t.opts.perMessageDeflate)&&("string"==typeof o?n.byteLength(o):o.length)<t.opts.perMessageDeflate.threshold&&(s.compress=!1);try{_?t.ws.send(o):t.ws.send(o,s)}catch(e){f("websocket closed before onclose event")}--i||a()}))}(e[s]);function a(){t.emit("flush"),setTimeout((function(){t.writable=!0,t.emit("drain")}),0)}}},{key:"onClose",value:function(){a.prototype.onClose.call(this)}},{key:"doClose",value:function(){void 0!==this.ws&&(this.ws.close(),this.ws=null)}},{key:"uri",value:function(){var e=this.query||{},t=this.opts.secure?"wss":"ws",n="";return this.opts.port&&("wss"===t&&443!==Number(this.opts.port)||"ws"===t&&80!==Number(this.opts.port))&&(n=":"+this.opts.port),this.opts.timestampRequests&&(e[this.opts.timestampParam]=r()),this.supportsBinary||(e.b64=1),e=s.encode(e),e.length&&(e="?"+e),t+"://"+(-1!==this.opts.hostname.indexOf(":")?"["+this.opts.hostname+"]":this.opts.hostname)+n+this.opts.path+e}},{key:"check",value:function(){return!(!g||"__initialize"in g&&this.name===c.prototype.name)}}]),c}(a);t.exports=y}).call(this,i(30).Buffer)},function(e,t,n){"use strict";(function(e){
/*!
       * The buffer module from node.js, for the browser.
       *
       * @author   Feross Aboukhadijeh <http://feross.org>
       * @license  MIT
       */
var i=n(32),o=n(33),s=n(34);function r(){return c.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function a(e,t){if(r()<t)throw new RangeError("Invalid typed array length");return c.TYPED_ARRAY_SUPPORT?(e=new Uint8Array(t)).__proto__=c.prototype:(null===e&&(e=new c(t)),e.length=t),e}function c(e,t,n){if(!(c.TYPED_ARRAY_SUPPORT||this instanceof c))return new c(e,t,n);if("number"==typeof e){if("string"==typeof t)throw new Error("If encoding is specified then the first argument must be a string");return d(this,e)}return u(this,e,t,n)}function u(e,t,n,i){if("number"==typeof t)throw new TypeError('"value" argument must not be a number');return"undefined"!=typeof ArrayBuffer&&t instanceof ArrayBuffer?function(e,t,n,i){if(t.byteLength,n<0||t.byteLength<n)throw new RangeError("'offset' is out of bounds");if(t.byteLength<n+(i||0))throw new RangeError("'length' is out of bounds");return t=void 0===n&&void 0===i?new Uint8Array(t):void 0===i?new Uint8Array(t,n):new Uint8Array(t,n,i),c.TYPED_ARRAY_SUPPORT?(e=t).__proto__=c.prototype:e=p(e,t),e}(e,t,n,i):"string"==typeof t?function(e,t,n){if("string"==typeof n&&""!==n||(n="utf8"),!c.isEncoding(n))throw new TypeError('"encoding" must be a valid string encoding');var i=0|f(t,n),o=(e=a(e,i)).write(t,n);return o!==i&&(e=e.slice(0,o)),e}(e,t,n):function(e,t){if(c.isBuffer(t)){var n=0|h(t.length);return 0===(e=a(e,n)).length||t.copy(e,0,0,n),e}if(t){if("undefined"!=typeof ArrayBuffer&&t.buffer instanceof ArrayBuffer||"length"in t)return"number"!=typeof t.length||(i=t.length)!=i?a(e,0):p(e,t);if("Buffer"===t.type&&s(t.data))return p(e,t.data)}var i;throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}(e,t)}function l(e){if("number"!=typeof e)throw new TypeError('"size" argument must be a number');if(e<0)throw new RangeError('"size" argument must not be negative')}function d(e,t){if(l(t),e=a(e,t<0?0:0|h(t)),!c.TYPED_ARRAY_SUPPORT)for(var n=0;n<t;++n)e[n]=0;return e}function p(e,t){var n=t.length<0?0:0|h(t.length);e=a(e,n);for(var i=0;i<n;i+=1)e[i]=255&t[i];return e}function h(e){if(e>=r())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+r().toString(16)+" bytes");return 0|e}function f(e,t){if(c.isBuffer(e))return e.length;if("undefined"!=typeof ArrayBuffer&&"function"==typeof ArrayBuffer.isView&&(ArrayBuffer.isView(e)||e instanceof ArrayBuffer))return e.byteLength;"string"!=typeof e&&(e=""+e);var n=e.length;if(0===n)return 0;for(var i=!1;;)switch(t){case"ascii":case"latin1":case"binary":return n;case"utf8":case"utf-8":case void 0:return q(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*n;case"hex":return n>>>1;case"base64":return B(e).length;default:if(i)return q(e).length;t=(""+t).toLowerCase(),i=!0}}function g(e,t,n){var i=!1;if((void 0===t||t<0)&&(t=0),t>this.length)return"";if((void 0===n||n>this.length)&&(n=this.length),n<=0)return"";if((n>>>=0)<=(t>>>=0))return"";for(e||(e="utf8");;)switch(e){case"hex":return A(this,t,n);case"utf8":case"utf-8":return E(this,t,n);case"ascii":return D(this,t,n);case"latin1":case"binary":return w(this,t,n);case"base64":return S(this,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return b(this,t,n);default:if(i)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),i=!0}}function _(e,t,n){var i=e[t];e[t]=e[n],e[n]=i}function v(e,t,n,i,o){if(0===e.length)return-1;if("string"==typeof n?(i=n,n=0):n>2147483647?n=2147483647:n<-2147483648&&(n=-2147483648),n=+n,isNaN(n)&&(n=o?0:e.length-1),n<0&&(n=e.length+n),n>=e.length){if(o)return-1;n=e.length-1}else if(n<0){if(!o)return-1;n=0}if("string"==typeof t&&(t=c.from(t,i)),c.isBuffer(t))return 0===t.length?-1:m(e,t,n,i,o);if("number"==typeof t)return t&=255,c.TYPED_ARRAY_SUPPORT&&"function"==typeof Uint8Array.prototype.indexOf?o?Uint8Array.prototype.indexOf.call(e,t,n):Uint8Array.prototype.lastIndexOf.call(e,t,n):m(e,[t],n,i,o);throw new TypeError("val must be string, number or Buffer")}function m(e,t,n,i,o){var s,r=1,a=e.length,c=t.length;if(void 0!==i&&("ucs2"===(i=String(i).toLowerCase())||"ucs-2"===i||"utf16le"===i||"utf-16le"===i)){if(e.length<2||t.length<2)return-1;r=2,a/=2,c/=2,n/=2}function u(e,t){return 1===r?e[t]:e.readUInt16BE(t*r)}if(o){var l=-1;for(s=n;s<a;s++)if(u(e,s)===u(t,-1===l?0:s-l)){if(-1===l&&(l=s),s-l+1===c)return l*r}else-1!==l&&(s-=s-l),l=-1}else for(n+c>a&&(n=a-c),s=n;s>=0;s--){for(var d=!0,p=0;p<c;p++)if(u(e,s+p)!==u(t,p)){d=!1;break}if(d)return s}return-1}function y(e,t,n,i){n=Number(n)||0;var o=e.length-n;i?(i=Number(i))>o&&(i=o):i=o;var s=t.length;if(s%2!=0)throw new TypeError("Invalid hex string");i>s/2&&(i=s/2);for(var r=0;r<i;++r){var a=parseInt(t.substr(2*r,2),16);if(isNaN(a))return r;e[n+r]=a}return r}function M(e,t,n,i){return $(q(t,e.length-n),e,n,i)}function I(e,t,n,i){return $(function(e){for(var t=[],n=0;n<e.length;++n)t.push(255&e.charCodeAt(n));return t}(t),e,n,i)}function C(e,t,n,i){return I(e,t,n,i)}function T(e,t,n,i){return $(B(t),e,n,i)}function k(e,t,n,i){return $(function(e,t){for(var n,i,o,s=[],r=0;r<e.length&&!((t-=2)<0);++r)n=e.charCodeAt(r),i=n>>8,o=n%256,s.push(o),s.push(i);return s}(t,e.length-n),e,n,i)}function S(e,t,n){return 0===t&&n===e.length?i.fromByteArray(e):i.fromByteArray(e.slice(t,n))}function E(e,t,n){n=Math.min(e.length,n);for(var i=[],o=t;o<n;){var s,r,a,c,u=e[o],l=null,d=u>239?4:u>223?3:u>191?2:1;if(o+d<=n)switch(d){case 1:u<128&&(l=u);break;case 2:128==(192&(s=e[o+1]))&&(c=(31&u)<<6|63&s)>127&&(l=c);break;case 3:s=e[o+1],r=e[o+2],128==(192&s)&&128==(192&r)&&(c=(15&u)<<12|(63&s)<<6|63&r)>2047&&(c<55296||c>57343)&&(l=c);break;case 4:s=e[o+1],r=e[o+2],a=e[o+3],128==(192&s)&&128==(192&r)&&128==(192&a)&&(c=(15&u)<<18|(63&s)<<12|(63&r)<<6|63&a)>65535&&c<1114112&&(l=c)}null===l?(l=65533,d=1):l>65535&&(l-=65536,i.push(l>>>10&1023|55296),l=56320|1023&l),i.push(l),o+=d}return function(e){var t=e.length;if(t<=4096)return String.fromCharCode.apply(String,e);for(var n="",i=0;i<t;)n+=String.fromCharCode.apply(String,e.slice(i,i+=4096));return n}(i)}function D(e,t,n){var i="";n=Math.min(e.length,n);for(var o=t;o<n;++o)i+=String.fromCharCode(127&e[o]);return i}function w(e,t,n){var i="";n=Math.min(e.length,n);for(var o=t;o<n;++o)i+=String.fromCharCode(e[o]);return i}function A(e,t,n){var i=e.length;(!t||t<0)&&(t=0),(!n||n<0||n>i)&&(n=i);for(var o="",s=t;s<n;++s)o+=F(e[s]);return o}function b(e,t,n){for(var i=e.slice(t,n),o="",s=0;s<i.length;s+=2)o+=String.fromCharCode(i[s]+256*i[s+1]);return o}function L(e,t,n){if(e%1!=0||e<0)throw new RangeError("offset is not uint");if(e+t>n)throw new RangeError("Trying to access beyond buffer length")}function R(e,t,n,i,o,s){if(!c.isBuffer(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(t>o||t<s)throw new RangeError('"value" argument is out of bounds');if(n+i>e.length)throw new RangeError("Index out of range")}function O(e,t,n,i){t<0&&(t=65535+t+1);for(var o=0,s=Math.min(e.length-n,2);o<s;++o)e[n+o]=(t&255<<8*(i?o:1-o))>>>8*(i?o:1-o)}function N(e,t,n,i){t<0&&(t=4294967295+t+1);for(var o=0,s=Math.min(e.length-n,4);o<s;++o)e[n+o]=t>>>8*(i?o:3-o)&255}function P(e,t,n,i,o,s){if(n+i>e.length)throw new RangeError("Index out of range");if(n<0)throw new RangeError("Index out of range")}function U(e,t,n,i,s){return s||P(e,0,n,4),o.write(e,t,n,i,23,4),n+4}function G(e,t,n,i,s){return s||P(e,0,n,8),o.write(e,t,n,i,52,8),n+8}t.Buffer=c,t.SlowBuffer=function(e){return+e!=e&&(e=0),c.alloc(+e)},t.INSPECT_MAX_BYTES=50,c.TYPED_ARRAY_SUPPORT=void 0!==e.TYPED_ARRAY_SUPPORT?e.TYPED_ARRAY_SUPPORT:function(){try{var e=new Uint8Array(1);return e.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===e.foo()&&"function"==typeof e.subarray&&0===e.subarray(1,1).byteLength}catch(e){return!1}}(),t.kMaxLength=r(),c.poolSize=8192,c._augment=function(e){return e.__proto__=c.prototype,e},c.from=function(e,t,n){return u(null,e,t,n)},c.TYPED_ARRAY_SUPPORT&&(c.prototype.__proto__=Uint8Array.prototype,c.__proto__=Uint8Array,"undefined"!=typeof Symbol&&Symbol.species&&c[Symbol.species]===c&&Object.defineProperty(c,Symbol.species,{value:null,configurable:!0})),c.alloc=function(e,t,n){return function(e,t,n,i){return l(t),t<=0?a(e,t):void 0!==n?"string"==typeof i?a(e,t).fill(n,i):a(e,t).fill(n):a(e,t)}(null,e,t,n)},c.allocUnsafe=function(e){return d(null,e)},c.allocUnsafeSlow=function(e){return d(null,e)},c.isBuffer=function(e){return!(null==e||!e._isBuffer)},c.compare=function(e,t){if(!c.isBuffer(e)||!c.isBuffer(t))throw new TypeError("Arguments must be Buffers");if(e===t)return 0;for(var n=e.length,i=t.length,o=0,s=Math.min(n,i);o<s;++o)if(e[o]!==t[o]){n=e[o],i=t[o];break}return n<i?-1:i<n?1:0},c.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},c.concat=function(e,t){if(!s(e))throw new TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return c.alloc(0);var n;if(void 0===t)for(t=0,n=0;n<e.length;++n)t+=e[n].length;var i=c.allocUnsafe(t),o=0;for(n=0;n<e.length;++n){var r=e[n];if(!c.isBuffer(r))throw new TypeError('"list" argument must be an Array of Buffers');r.copy(i,o),o+=r.length}return i},c.byteLength=f,c.prototype._isBuffer=!0,c.prototype.swap16=function(){var e=this.length;if(e%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var t=0;t<e;t+=2)_(this,t,t+1);return this},c.prototype.swap32=function(){var e=this.length;if(e%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var t=0;t<e;t+=4)_(this,t,t+3),_(this,t+1,t+2);return this},c.prototype.swap64=function(){var e=this.length;if(e%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var t=0;t<e;t+=8)_(this,t,t+7),_(this,t+1,t+6),_(this,t+2,t+5),_(this,t+3,t+4);return this},c.prototype.toString=function(){var e=0|this.length;return 0===e?"":0===arguments.length?E(this,0,e):g.apply(this,arguments)},c.prototype.equals=function(e){if(!c.isBuffer(e))throw new TypeError("Argument must be a Buffer");return this===e||0===c.compare(this,e)},c.prototype.inspect=function(){var e="",n=t.INSPECT_MAX_BYTES;return this.length>0&&(e=this.toString("hex",0,n).match(/.{2}/g).join(" "),this.length>n&&(e+=" ... ")),"<Buffer "+e+">"},c.prototype.compare=function(e,t,n,i,o){if(!c.isBuffer(e))throw new TypeError("Argument must be a Buffer");if(void 0===t&&(t=0),void 0===n&&(n=e?e.length:0),void 0===i&&(i=0),void 0===o&&(o=this.length),t<0||n>e.length||i<0||o>this.length)throw new RangeError("out of range index");if(i>=o&&t>=n)return 0;if(i>=o)return-1;if(t>=n)return 1;if(this===e)return 0;for(var s=(o>>>=0)-(i>>>=0),r=(n>>>=0)-(t>>>=0),a=Math.min(s,r),u=this.slice(i,o),l=e.slice(t,n),d=0;d<a;++d)if(u[d]!==l[d]){s=u[d],r=l[d];break}return s<r?-1:r<s?1:0},c.prototype.includes=function(e,t,n){return-1!==this.indexOf(e,t,n)},c.prototype.indexOf=function(e,t,n){return v(this,e,t,n,!0)},c.prototype.lastIndexOf=function(e,t,n){return v(this,e,t,n,!1)},c.prototype.write=function(e,t,n,i){if(void 0===t)i="utf8",n=this.length,t=0;else if(void 0===n&&"string"==typeof t)i=t,n=this.length,t=0;else{if(!isFinite(t))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");t|=0,isFinite(n)?(n|=0,void 0===i&&(i="utf8")):(i=n,n=void 0)}var o=this.length-t;if((void 0===n||n>o)&&(n=o),e.length>0&&(n<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");i||(i="utf8");for(var s=!1;;)switch(i){case"hex":return y(this,e,t,n);case"utf8":case"utf-8":return M(this,e,t,n);case"ascii":return I(this,e,t,n);case"latin1":case"binary":return C(this,e,t,n);case"base64":return T(this,e,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return k(this,e,t,n);default:if(s)throw new TypeError("Unknown encoding: "+i);i=(""+i).toLowerCase(),s=!0}},c.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}},c.prototype.slice=function(e,t){var n,i=this.length;if((e=~~e)<0?(e+=i)<0&&(e=0):e>i&&(e=i),(t=void 0===t?i:~~t)<0?(t+=i)<0&&(t=0):t>i&&(t=i),t<e&&(t=e),c.TYPED_ARRAY_SUPPORT)(n=this.subarray(e,t)).__proto__=c.prototype;else{var o=t-e;n=new c(o,void 0);for(var s=0;s<o;++s)n[s]=this[s+e]}return n},c.prototype.readUIntLE=function(e,t,n){e|=0,t|=0,n||L(e,t,this.length);for(var i=this[e],o=1,s=0;++s<t&&(o*=256);)i+=this[e+s]*o;return i},c.prototype.readUIntBE=function(e,t,n){e|=0,t|=0,n||L(e,t,this.length);for(var i=this[e+--t],o=1;t>0&&(o*=256);)i+=this[e+--t]*o;return i},c.prototype.readUInt8=function(e,t){return t||L(e,1,this.length),this[e]},c.prototype.readUInt16LE=function(e,t){return t||L(e,2,this.length),this[e]|this[e+1]<<8},c.prototype.readUInt16BE=function(e,t){return t||L(e,2,this.length),this[e]<<8|this[e+1]},c.prototype.readUInt32LE=function(e,t){return t||L(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},c.prototype.readUInt32BE=function(e,t){return t||L(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},c.prototype.readIntLE=function(e,t,n){e|=0,t|=0,n||L(e,t,this.length);for(var i=this[e],o=1,s=0;++s<t&&(o*=256);)i+=this[e+s]*o;return i>=(o*=128)&&(i-=Math.pow(2,8*t)),i},c.prototype.readIntBE=function(e,t,n){e|=0,t|=0,n||L(e,t,this.length);for(var i=t,o=1,s=this[e+--i];i>0&&(o*=256);)s+=this[e+--i]*o;return s>=(o*=128)&&(s-=Math.pow(2,8*t)),s},c.prototype.readInt8=function(e,t){return t||L(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},c.prototype.readInt16LE=function(e,t){t||L(e,2,this.length);var n=this[e]|this[e+1]<<8;return 32768&n?4294901760|n:n},c.prototype.readInt16BE=function(e,t){t||L(e,2,this.length);var n=this[e+1]|this[e]<<8;return 32768&n?4294901760|n:n},c.prototype.readInt32LE=function(e,t){return t||L(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},c.prototype.readInt32BE=function(e,t){return t||L(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},c.prototype.readFloatLE=function(e,t){return t||L(e,4,this.length),o.read(this,e,!0,23,4)},c.prototype.readFloatBE=function(e,t){return t||L(e,4,this.length),o.read(this,e,!1,23,4)},c.prototype.readDoubleLE=function(e,t){return t||L(e,8,this.length),o.read(this,e,!0,52,8)},c.prototype.readDoubleBE=function(e,t){return t||L(e,8,this.length),o.read(this,e,!1,52,8)},c.prototype.writeUIntLE=function(e,t,n,i){e=+e,t|=0,n|=0,i||R(this,e,t,n,Math.pow(2,8*n)-1,0);var o=1,s=0;for(this[t]=255&e;++s<n&&(o*=256);)this[t+s]=e/o&255;return t+n},c.prototype.writeUIntBE=function(e,t,n,i){e=+e,t|=0,n|=0,i||R(this,e,t,n,Math.pow(2,8*n)-1,0);var o=n-1,s=1;for(this[t+o]=255&e;--o>=0&&(s*=256);)this[t+o]=e/s&255;return t+n},c.prototype.writeUInt8=function(e,t,n){return e=+e,t|=0,n||R(this,e,t,1,255,0),c.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),this[t]=255&e,t+1},c.prototype.writeUInt16LE=function(e,t,n){return e=+e,t|=0,n||R(this,e,t,2,65535,0),c.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):O(this,e,t,!0),t+2},c.prototype.writeUInt16BE=function(e,t,n){return e=+e,t|=0,n||R(this,e,t,2,65535,0),c.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):O(this,e,t,!1),t+2},c.prototype.writeUInt32LE=function(e,t,n){return e=+e,t|=0,n||R(this,e,t,4,4294967295,0),c.TYPED_ARRAY_SUPPORT?(this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e):N(this,e,t,!0),t+4},c.prototype.writeUInt32BE=function(e,t,n){return e=+e,t|=0,n||R(this,e,t,4,4294967295,0),c.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):N(this,e,t,!1),t+4},c.prototype.writeIntLE=function(e,t,n,i){if(e=+e,t|=0,!i){var o=Math.pow(2,8*n-1);R(this,e,t,n,o-1,-o)}var s=0,r=1,a=0;for(this[t]=255&e;++s<n&&(r*=256);)e<0&&0===a&&0!==this[t+s-1]&&(a=1),this[t+s]=(e/r>>0)-a&255;return t+n},c.prototype.writeIntBE=function(e,t,n,i){if(e=+e,t|=0,!i){var o=Math.pow(2,8*n-1);R(this,e,t,n,o-1,-o)}var s=n-1,r=1,a=0;for(this[t+s]=255&e;--s>=0&&(r*=256);)e<0&&0===a&&0!==this[t+s+1]&&(a=1),this[t+s]=(e/r>>0)-a&255;return t+n},c.prototype.writeInt8=function(e,t,n){return e=+e,t|=0,n||R(this,e,t,1,127,-128),c.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),e<0&&(e=255+e+1),this[t]=255&e,t+1},c.prototype.writeInt16LE=function(e,t,n){return e=+e,t|=0,n||R(this,e,t,2,32767,-32768),c.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):O(this,e,t,!0),t+2},c.prototype.writeInt16BE=function(e,t,n){return e=+e,t|=0,n||R(this,e,t,2,32767,-32768),c.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):O(this,e,t,!1),t+2},c.prototype.writeInt32LE=function(e,t,n){return e=+e,t|=0,n||R(this,e,t,4,2147483647,-2147483648),c.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24):N(this,e,t,!0),t+4},c.prototype.writeInt32BE=function(e,t,n){return e=+e,t|=0,n||R(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),c.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):N(this,e,t,!1),t+4},c.prototype.writeFloatLE=function(e,t,n){return U(this,e,t,!0,n)},c.prototype.writeFloatBE=function(e,t,n){return U(this,e,t,!1,n)},c.prototype.writeDoubleLE=function(e,t,n){return G(this,e,t,!0,n)},c.prototype.writeDoubleBE=function(e,t,n){return G(this,e,t,!1,n)},c.prototype.copy=function(e,t,n,i){if(n||(n=0),i||0===i||(i=this.length),t>=e.length&&(t=e.length),t||(t=0),i>0&&i<n&&(i=n),i===n)return 0;if(0===e.length||0===this.length)return 0;if(t<0)throw new RangeError("targetStart out of bounds");if(n<0||n>=this.length)throw new RangeError("sourceStart out of bounds");if(i<0)throw new RangeError("sourceEnd out of bounds");i>this.length&&(i=this.length),e.length-t<i-n&&(i=e.length-t+n);var o,s=i-n;if(this===e&&n<t&&t<i)for(o=s-1;o>=0;--o)e[o+t]=this[o+n];else if(s<1e3||!c.TYPED_ARRAY_SUPPORT)for(o=0;o<s;++o)e[o+t]=this[o+n];else Uint8Array.prototype.set.call(e,this.subarray(n,n+s),t);return s},c.prototype.fill=function(e,t,n,i){if("string"==typeof e){if("string"==typeof t?(i=t,t=0,n=this.length):"string"==typeof n&&(i=n,n=this.length),1===e.length){var o=e.charCodeAt(0);o<256&&(e=o)}if(void 0!==i&&"string"!=typeof i)throw new TypeError("encoding must be a string");if("string"==typeof i&&!c.isEncoding(i))throw new TypeError("Unknown encoding: "+i)}else"number"==typeof e&&(e&=255);if(t<0||this.length<t||this.length<n)throw new RangeError("Out of range index");if(n<=t)return this;var s;if(t>>>=0,n=void 0===n?this.length:n>>>0,e||(e=0),"number"==typeof e)for(s=t;s<n;++s)this[s]=e;else{var r=c.isBuffer(e)?e:q(new c(e,i).toString()),a=r.length;for(s=0;s<n-t;++s)this[s+t]=r[s%a]}return this};var x=/[^+\/0-9A-Za-z-_]/g;function F(e){return e<16?"0"+e.toString(16):e.toString(16)}function q(e,t){var n;t=t||1/0;for(var i=e.length,o=null,s=[],r=0;r<i;++r){if((n=e.charCodeAt(r))>55295&&n<57344){if(!o){if(n>56319){(t-=3)>-1&&s.push(239,191,189);continue}if(r+1===i){(t-=3)>-1&&s.push(239,191,189);continue}o=n;continue}if(n<56320){(t-=3)>-1&&s.push(239,191,189),o=n;continue}n=65536+(o-55296<<10|n-56320)}else o&&(t-=3)>-1&&s.push(239,191,189);if(o=null,n<128){if((t-=1)<0)break;s.push(n)}else if(n<2048){if((t-=2)<0)break;s.push(n>>6|192,63&n|128)}else if(n<65536){if((t-=3)<0)break;s.push(n>>12|224,n>>6&63|128,63&n|128)}else{if(!(n<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;s.push(n>>18|240,n>>12&63|128,n>>6&63|128,63&n|128)}}return s}function B(e){return i.toByteArray(function(e){if((e=function(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")}(e).replace(x,"")).length<2)return"";for(;e.length%4!=0;)e+="=";return e}(e))}function $(e,t,n,i){for(var o=0;o<i&&!(o+n>=t.length||o>=e.length);++o)t[o+n]=e[o];return o}}).call(this,n(31))},function(e,t){var n;n=function(){return this}();try{n=n||new Function("return this")()}catch(e){"object"==("undefined"===typeof window?"undefined":_(window))&&(n=window)}e.exports=n},function(e,t,n){"use strict";t.byteLength=function(e){var t=u(e),n=t[0],i=t[1];return 3*(n+i)/4-i},t.toByteArray=function(e){var t,n,i=u(e),r=i[0],a=i[1],c=new s(function(e,t,n){return 3*(t+n)/4-n}(0,r,a)),l=0,d=a>0?r-4:r;for(n=0;n<d;n+=4)t=o[e.charCodeAt(n)]<<18|o[e.charCodeAt(n+1)]<<12|o[e.charCodeAt(n+2)]<<6|o[e.charCodeAt(n+3)],c[l++]=t>>16&255,c[l++]=t>>8&255,c[l++]=255&t;return 2===a&&(t=o[e.charCodeAt(n)]<<2|o[e.charCodeAt(n+1)]>>4,c[l++]=255&t),1===a&&(t=o[e.charCodeAt(n)]<<10|o[e.charCodeAt(n+1)]<<4|o[e.charCodeAt(n+2)]>>2,c[l++]=t>>8&255,c[l++]=255&t),c},t.fromByteArray=function(e){for(var t,n=e.length,o=n%3,s=[],r=0,a=n-o;r<a;r+=16383)s.push(l(e,r,r+16383>a?a:r+16383));return 1===o?(t=e[n-1],s.push(i[t>>2]+i[t<<4&63]+"==")):2===o&&(t=(e[n-2]<<8)+e[n-1],s.push(i[t>>10]+i[t>>4&63]+i[t<<2&63]+"=")),s.join("")};for(var i=[],o=[],s="undefined"!=typeof Uint8Array?Uint8Array:Array,r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",a=0,c=r.length;a<c;++a)i[a]=r[a],o[r.charCodeAt(a)]=a;function u(e){var t=e.length;if(t%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var n=e.indexOf("=");return-1===n&&(n=t),[n,n===t?0:4-n%4]}function l(e,t,n){for(var o,s,r=[],a=t;a<n;a+=3)o=(e[a]<<16&16711680)+(e[a+1]<<8&65280)+(255&e[a+2]),r.push(i[(s=o)>>18&63]+i[s>>12&63]+i[s>>6&63]+i[63&s]);return r.join("")}o["-".charCodeAt(0)]=62,o["_".charCodeAt(0)]=63},function(e,t){
/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */
t.read=function(e,t,n,i,o){var s,r,a=8*o-i-1,c=(1<<a)-1,u=c>>1,l=-7,d=n?o-1:0,p=n?-1:1,h=e[t+d];for(d+=p,s=h&(1<<-l)-1,h>>=-l,l+=a;l>0;s=256*s+e[t+d],d+=p,l-=8);for(r=s&(1<<-l)-1,s>>=-l,l+=i;l>0;r=256*r+e[t+d],d+=p,l-=8);if(0===s)s=1-u;else{if(s===c)return r?NaN:1/0*(h?-1:1);r+=Math.pow(2,i),s-=u}return(h?-1:1)*r*Math.pow(2,s-i)},t.write=function(e,t,n,i,o,s){var r,a,c,u=8*s-o-1,l=(1<<u)-1,d=l>>1,p=23===o?Math.pow(2,-24)-Math.pow(2,-77):0,h=i?0:s-1,f=i?1:-1,g=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(a=isNaN(t)?1:0,r=l):(r=Math.floor(Math.log(t)/Math.LN2),t*(c=Math.pow(2,-r))<1&&(r--,c*=2),(t+=r+d>=1?p/c:p*Math.pow(2,1-d))*c>=2&&(r++,c/=2),r+d>=l?(a=0,r=l):r+d>=1?(a=(t*c-1)*Math.pow(2,o),r+=d):(a=t*Math.pow(2,d-1)*Math.pow(2,o),r=0));o>=8;e[n+h]=255&a,h+=f,a/=256,o-=8);for(r=r<<o|a,u+=o;u>0;e[n+h]=255&r,h+=f,r/=256,u-=8);e[n+h-f]|=128*g}},function(e,t){var n={}.toString;e.exports=Array.isArray||function(e){return"[object Array]"==n.call(e)}},function(e,t,n){var o=n(36),s=n(37),r=n(0)("@hyoga/uni-socket"),a=uni||i,u=function(e){"use strict";h(n,e);var t=M(n);function n(e,i,o){var s;return d(this,n),s=t.call(this),s._readyState=n.CONNECTING,s._socket=null,null!==e&&(Array.isArray(i)?i=i.join(", "):"object"==_(i)&&null!==i&&(o=i,i=void 0),s.initAsClient(e,i,o)),s}return p(n,[{key:"initAsClient",value:function(e,t,n){Object.assign(n,{url:e,header:{"content-type":"application/json"},protocols:t,timeout:25e3}),this._socket=this.createConnection(n),this.addSocketEventListeners()}},{key:"createConnection",value:function(e){return a.connectSocket(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?v(Object(n),!0).forEach((function(t){c(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):v(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({complete:function(){}},e))}},{key:"addSocketEventListeners",value:function(){var e=this;this._socket.onOpen((function(){e._readyState=n.OPEN,e.onopen()})),this._socket.onClose((function(t){r("onclose: ",t),e._readyState=n.CLOSED,e.onclose(t.code,t.reason)})),this._socket.onError((function(t){r("onerror: ",t),e.onerror(t)})),this._socket.onMessage((function(t){e.onmessage(t)}))}},{key:"send",value:function(e){if(r("send data: ",e,this._readyState),this._readyState===n.CONNECTING)throw new Error("WebSocket is not open: readyState 0 (CONNECTING)");"number"==typeof e&&(e=e.toString()),this._readyState===n.OPEN&&this._socket.send({data:e})}},{key:"close",value:function(e,t){r("close socket: ",e,t),this._readyState=n.CLOSING,this._socket.close({code:e,reason:t})}}]),n}(o);["CONNECTING","OPEN","CLOSING","CLOSED"].forEach((function(e,t){u[e]=t})),["open","error","close","message"].forEach((function(e){Object.defineProperty(u.prototype,"on"+e,{get:function(){for(var t=this.listeners(e),n=0;n<t.length;n++)if(t[n]._listener)return t[n]._listener},set:function(t){for(var n=this.listeners(e),i=0;i<n.length;i++)n[i]._listener&&this.removeListener(e,n[i]);this.addEventListener(e,t)}})})),u.prototype.addEventListener=s.addEventListener,u.prototype.removeEventListener=s.removeEventListener,e.exports=u},function(t,n,i){"use strict";var o,s="object"==("undefined"===typeof Reflect?"undefined":_(Reflect))?Reflect:null,r=s&&"function"==typeof s.apply?s.apply:function(e,t,n){return Function.prototype.apply.call(e,t,n)};o=s&&"function"==typeof s.ownKeys?s.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)};var a=Number.isNaN||function(e){return e!=e};function c(){c.init.call(this)}t.exports=c,t.exports.once=function(e,t){return new Promise((function(n,i){function o(){void 0!==s&&e.removeListener("error",s),n([].slice.call(arguments))}var s;"error"!==t&&(s=function(n){e.removeListener(t,o),i(n)},e.once("error",s)),e.once(t,o)}))},c.EventEmitter=c,c.prototype._events=void 0,c.prototype._eventsCount=0,c.prototype._maxListeners=void 0;var u=10;function l(e){if("function"!=typeof e)throw new TypeError('The "listener" argument must be of type Function. Received type '+_(e))}function d(e){return void 0===e._maxListeners?c.defaultMaxListeners:e._maxListeners}function p(t,n,i,o){var s,r,a,c;if(l(i),void 0===(r=t._events)?(r=t._events=Object.create(null),t._eventsCount=0):(void 0!==r.newListener&&(t.emit("newListener",n,i.listener?i.listener:i),r=t._events),a=r[n]),void 0===a)a=r[n]=i,++t._eventsCount;else if("function"==typeof a?a=r[n]=o?[i,a]:[a,i]:o?a.unshift(i):a.push(i),(s=d(t))>0&&a.length>s&&!a.warned){a.warned=!0;var u=new Error("Possible EventEmitter memory leak detected. "+a.length+" "+String(n)+" listeners added. Use emitter.setMaxListeners() to increase limit");u.name="MaxListenersExceededWarning",u.emitter=t,u.type=n,u.count=a.length,c=u,console&&console.warn&&e("warn",c," at components/socket/uni-socket.io.js:10")}return t}function h(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function f(e,t,n){var i={fired:!1,wrapFn:void 0,target:e,type:t,listener:n},o=h.bind(i);return o.listener=n,i.wrapFn=o,o}function g(e,t,n){var i=e._events;if(void 0===i)return[];var o=i[t];return void 0===o?[]:"function"==typeof o?n?[o.listener||o]:[o]:n?function(e){for(var t=new Array(e.length),n=0;n<t.length;++n)t[n]=e[n].listener||e[n];return t}(o):m(o,o.length)}function v(e){var t=this._events;if(void 0!==t){var n=t[e];if("function"==typeof n)return 1;if(void 0!==n)return n.length}return 0}function m(e,t){for(var n=new Array(t),i=0;i<t;++i)n[i]=e[i];return n}Object.defineProperty(c,"defaultMaxListeners",{enumerable:!0,get:function(){return u},set:function(e){if("number"!=typeof e||e<0||a(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");u=e}}),c.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},c.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||a(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},c.prototype.getMaxListeners=function(){return d(this)},c.prototype.emit=function(e){for(var t=[],n=1;n<arguments.length;n++)t.push(arguments[n]);var i="error"===e,o=this._events;if(void 0!==o)i=i&&void 0===o.error;else if(!i)return!1;if(i){var s;if(t.length>0&&(s=t[0]),s instanceof Error)throw s;var a=new Error("Unhandled error."+(s?" ("+s.message+")":""));throw a.context=s,a}var c=o[e];if(void 0===c)return!1;if("function"==typeof c)r(c,this,t);else{var u=c.length,l=m(c,u);for(n=0;n<u;++n)r(l[n],this,t)}return!0},c.prototype.addListener=function(e,t){return p(this,e,t,!1)},c.prototype.on=c.prototype.addListener,c.prototype.prependListener=function(e,t){return p(this,e,t,!0)},c.prototype.once=function(e,t){return l(t),this.on(e,f(this,e,t)),this},c.prototype.prependOnceListener=function(e,t){return l(t),this.prependListener(e,f(this,e,t)),this},c.prototype.removeListener=function(e,t){var n,i,o,s,r;if(l(t),void 0===(i=this._events))return this;if(void 0===(n=i[e]))return this;if(n===t||n.listener===t)0==--this._eventsCount?this._events=Object.create(null):(delete i[e],i.removeListener&&this.emit("removeListener",e,n.listener||t));else if("function"!=typeof n){for(o=-1,s=n.length-1;s>=0;s--)if(n[s]===t||n[s].listener===t){r=n[s].listener,o=s;break}if(o<0)return this;0===o?n.shift():function(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}(n,o),1===n.length&&(i[e]=n[0]),void 0!==i.removeListener&&this.emit("removeListener",e,r||t)}return this},c.prototype.off=c.prototype.removeListener,c.prototype.removeAllListeners=function(e){var t,n,i;if(void 0===(n=this._events))return this;if(void 0===n.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==n[e]&&(0==--this._eventsCount?this._events=Object.create(null):delete n[e]),this;if(0===arguments.length){var o,s=Object.keys(n);for(i=0;i<s.length;++i)"removeListener"!==(o=s[i])&&this.removeAllListeners(o);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(t=n[e]))this.removeListener(e,t);else if(void 0!==t)for(i=t.length-1;i>=0;i--)this.removeListener(e,t[i]);return this},c.prototype.listeners=function(e){return g(this,e,!0)},c.prototype.rawListeners=function(e){return g(this,e,!1)},c.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):v.call(e,t)},c.prototype.listenerCount=v,c.prototype.eventNames=function(){return this._eventsCount>0?o(this._events):[]}},function(e,t,n){"use strict";var i=p((function e(t,n){d(this,e),this.target=n,this.type=t})),o=function(e){h(n,e);var t=M(n);function n(e,i){var o;return d(this,n),o=t.call(this,"message",i),o.data=e,o}return p(n)}(i),s=function(e){h(n,e);var t=M(n);function n(e,i,o){var s;return d(this,n),s=t.call(this,"close",o),s.wasClean=o._closeFrameReceived&&o._closeFrameSent,s.reason=i,s.code=e,s}return p(n)}(i),r=function(e){h(n,e);var t=M(n);function n(e){return d(this,n),t.call(this,"open",e)}return p(n)}(i),a=function(e){h(n,e);var t=M(n);function n(e,i){var o;return d(this,n),o=t.call(this,"error",i),o.message=e.message,o.error=e,o}return p(n)}(i),c={addEventListener:function(e,t){function n(e){t.call(this,new o(e,this))}function i(e,n){t.call(this,new s(e,n,this))}function c(e){t.call(this,new a(e,this))}function u(){t.call(this,new r(this))}"function"==typeof t&&("message"===e?(n._listener=t,this.on(e,n)):"close"===e?(i._listener=t,this.on(e,i)):"error"===e?(c._listener=t,this.on(e,c)):"open"===e?(u._listener=t,this.on(e,u)):this.on(e,t))},removeEventListener:function(e,t){for(var n=this.listeners(e),i=0;i<n.length;i++)n[i]!==t&&n[i]._listener!==t||this.removeListener(e,n[i])}};e.exports=c},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.reconstructPacket=t.deconstructPacket=void 0;var i=n(16);t.deconstructPacket=function(e){var t=[],n=e.data,o=e;return o.data=function e(t,n){if(!t)return t;if(i.isBinary(t)){var o={_placeholder:!0,num:n.length};return n.push(t),o}if(Array.isArray(t)){for(var s=new Array(t.length),r=0;r<t.length;r++)s[r]=e(t[r],n);return s}if("object"==_(t)&&!(t instanceof Date)){var a={};for(var c in t)t.hasOwnProperty(c)&&(a[c]=e(t[c],n));return a}return t}(n,t),o.attachments=t.length,{packet:o,buffers:t}},t.reconstructPacket=function(e,t){return e.data=function e(t,n){if(!t)return t;if(t&&t._placeholder)return n[t.num];if(Array.isArray(t))for(var i=0;i<t.length;i++)t[i]=e(t[i],n);else if("object"==_(t))for(var o in t)t.hasOwnProperty(o)&&(t[o]=e(t[o],n));return t}(e.data,t),e.attachments=void 0,e}},function(e,t){function n(e){e=e||{},this.ms=e.min||100,this.max=e.max||1e4,this.factor=e.factor||2,this.jitter=e.jitter>0&&e.jitter<=1?e.jitter:0,this.attempts=0}e.exports=n,n.prototype.duration=function(){var e=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var t=Math.random(),n=Math.floor(t*this.jitter*e);e=0==(1&Math.floor(10*t))?e-n:e+n}return 0|Math.min(e,this.max)},n.prototype.reset=function(){this.attempts=0},n.prototype.setMin=function(e){this.ms=e},n.prototype.setMax=function(e){this.max=e},n.prototype.setJitter=function(e){this.jitter=e}}])}))}).call(this,n("0de9")["default"],n("fe07")["default"],n("62e4")(e))},c665:function(e,t){e.exports="/static/images/index/jiazai.png"},c8ba:function(e,t){var n;n=function(){return this}();try{n=n||new Function("return this")()}catch(i){"object"===typeof window&&(n=window)}e.exports=n},c931:function(e,t,n){"use strict";(function(e){var i=n("4ea4");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o=i(n("76e1")),s=i(n("52ef")),r={name:"Header",components:{ImageCropper:o.default},data:function(){this.getDate({format:!0});return{array:["\u7537","\u5973","\u672a\u77e5"],index:3,tempFilePath:"",cropFilePath:"../../static/images/index/\u9ed8\u8ba4\u5934\u50cf.jpeg",image:"",title:"",data:"\u4fee\u6539\u7684\u5185\u5bb9",oldData:"",pwd:void 0,type:"",animationData:{},isPwd:!1,isModfiy:!1,modifyHeight:"",id:"",uid:"",token:"",name:"",nickname:"",user:{}}},computed:{startDate:function(){return this.getDate("start")},endDate:function(){return this.getDate("end")}},onReady:function(){this.getElementStyle()},onLoad:function(e){this.id=e.id,this.getStorage(),this.getUser(),this.getNickname()},mounted:function(){},methods:{goBack:function(){var e=getCurrentPages(),t=e[e.length-2];uni.navigateBack({delta:1,success:function(){t.$vm.getUser()}})},getStorage:function(){try{var e=uni.getStorageSync("user");e?(this.uid=e.id,this.name=e.name,this.token=e.token):uni.navigateTo({url:"../login/login"})}catch(t){}},getUser:function(){var e=this;uni.request({url:this.serverUrl+"/user/detail",data:{id:this.id,token:this.token},method:"POST",success:function(t){var n=t.data.code;if(200==n){var i=t.data.result;if(i.imgUrl=e.serverUrl+t.data.result.imgUrl,void 0==i.explain&&(i.explain="\u8fd9\u4e2a\u4eba\u61d2\uff0c\u4ec0\u4e48\u90fd\u6ca1\u6709\u7559\u4e0b~"),0==e.nickname.length&&(e.nickname=i.name),void 0==i.birth)i.birth="0000-00-00";else{var o=s.default.dateTime_Three(i.birth);i.birth=o}void 0==i.phone&&(i.phone="0000"),e.ChooseSex(i.sex),e.user=i,e.cropFilePath=e.user.imgUrl}else 500==n?uni.showToast({title:"\u670d\u52a1\u5668\u51fa\u9519\u5566\uff01",icon:"none",duration:2e3}):300==n&&uni.navigateTo({url:"../login/login?name="+e.name})}})},getNickname:function(){var t=this;this.id!=this.uid&&uni.request({url:this.serverUrl+"/user/nicknameGet",data:{uid:this.uid,fid:this.id,token:this.token},method:"POST",success:function(n){var i=n.data.code;if(200==i){var o=n.data.result;e("log",o.nickname," at pages/user/userdetail.vue:290"),void 0!=o.nickname&&(t.nickname=o.nickname),e("log",o.nickname," at pages/user/userdetail.vue:295")}else 500==i?uni.showToast({title:"\u670d\u52a1\u5668\u51fa\u9519\u5566\uff01",icon:"none",duration:2e3}):300==i&&uni.navigateTo({url:"../login/login?name="+t.name})}})},ChooseSex:function(e){this.index="female"==e?1:"male"==e?0:2},changeTime:function(e){return s.default.dateTime_Two(e)},bindPickerChange:function(e){var t=this.index;if(this.index=e.detail.value,this.index!=t){var n="asexual";0==this.index?n="male":1==this.index&&(n="female"),this.upDate(n,"sex",void 0)}},bindDateChange:function(e){var t=this.data;this.data=e.detail.value,this.data!=t&&(this.upDate(this.data,"birth",void 0),this.user.birth=this.data)},getDate:function(e){var t=new Date,n=t.getFullYear(),i=t.getMonth()+1,o=t.getDate();return"start"===e?n-=60:"end"===e&&(n+=0),i=i>9?i:"0"+i,o=o>9?o:"0"+o,"".concat(n,"-").concat(i,"-").concat(o)},upload:function(){var e=this;uni.chooseImage({count:1,sizeType:["original","compressed"],sourceType:["album"],success:function(t){e.tempFilePath=t.tempFilePaths.shift()}})},confirm:function(t){var n=this;this.tempFilePath="",this.cropFilePath=t.detail.tempFilePath,this.image=t.detail.tempFilePath,uni.uploadFile({url:this.serverUrl+"/files/upload",filePath:this.cropFilePath,name:"file",fileType:this.image,formData:{url:"user",name:this.uid,token:this.token},success:function(i){var o=i.data;e("log",o," at pages/user/userdetail.vue:397");try{uni.setStorageSync("user",{id:n.uid,name:n.name,imgUrl:o,token:n.token})}catch(t){e("log","\u6570\u636e\u5b58\u50a8\u51fa\u9519"," at pages/user/userdetail.vue:407")}n.upDate(o,"imgUrl",void 0)},fail:function(t){e("log","this is errormes "+t.message," at pages/user/userdetail.vue:413")}})},cancel:function(){e("log","canceled"," at pages/user/userdetail.vue:418"),this.tempFilePath=""},getElementStyle:function(){var e=this,t=uni.createSelectorQuery().in(this);t.select(".modify").boundingClientRect((function(t){e.modifyHeight=t.height})).exec()},modify:function(e,t,n,i){this.oldData=n,this.type=e,this.data=n,this.title=t,this.isPwd=i,this.isModfiy=!this.isModfiy;var o=uni.createAnimation({duration:1e3,timingFunction:"ease"});this.isModfiy?o.bottom(0).step():o.bottom(-this.modifyHeight).step(),this.animationData=o.export()},modifySubmit:function(){if(this.data!=this.oldData&&this.data.length>0)if("nickname"==this.type)this.upDateFriendName(this.data),this.nickname=this.data;else if("email"==this.type){/^([a-zA-Z0-9]+[_|\_|\.]?)*[a-zA-Z0-9]+@([a-zA-Z0-9]+[_|\_|\.]?)*[a-zA-Z0-9]+\.[a-zA-Z]{2,3}$/.test(this.data)?(this.upDate(this.data,this.type,this.pwd),this.user[this.type]=this.data,this.pwd=void 0):uni.showToast({title:"\u4fee\u6539\u5931\u8d25,\u90ae\u7bb1\u683c\u5f0f\u9519\u8bef",icon:"none",duration:2e3})}else if("password"==this.type){/^(?=.*[A-Za-z])(?=.*\d)[A-Za-z\d]{8,}$/.test(this.data)?(this.upDate(this.data,this.type,this.pwd),this.pwd=void 0):uni.showToast({title:"\u8bf7\u51fa\u51658\u4e3a\u5bc6\u7801\u81f3\u5c11\u5305\u542b\u4e00\u4e2a\u5b57\u6bcd\u548c\u4e00\u4e2a\u6570\u5b57",icon:"none",duration:2e3})}else this.upDate(this.data,this.type,this.pwd),this.user[this.type]=this.data,this.pwd=void 0;this.modify()},upDate:function(t,n,i){var o=this;uni.request({url:this.serverUrl+"/user/update",data:{id:this.uid,data:t,type:n,password:i,token:this.token},method:"POST",success:function(t){var i=t.data.code;200==i?("password"==n&&(uni.removeStorage({key:"user",success:function(t){e("log","success"," at pages/user/userdetail.vue:521")}}),uni.navigateTo({url:"../login/login?name="+o.name})),uni.showToast({title:"\u4fee\u6539\u6210\u529f",icon:"none",duration:2e3})):400==i?(e("log","\u4fee\u6539\u5931\u8d25"," at pages/user/userdetail.vue:534"),uni.showToast({title:"\u4fee\u6539\u5931\u8d25,\u539f\u59cb\u5bc6\u7801\u9519\u8bef",icon:"none",duration:2e3})):500==i?uni.showToast({title:"\u670d\u52a1\u5668\u51fa\u9519\u5566\uff01",icon:"none",duration:2e3}):300==i&&uni.navigateTo({url:"../login/login?name="+o.name})}})},quit:function(){uni.removeStorage({key:"user",success:function(t){e("log","success"," at pages/user/userdetail.vue:560")}}),uni.navigateTo({url:"../login/login?name="+this.name})},deleteFriend:function(){var t=this;uni.showModal({title:"\u63d0\u793a",content:"\u786e\u8ba4\u5220\u9664\u597d\u53cb\u5417?",success:function(n){uni.request({url:t.serverUrl+"/friend/delete",data:{uid:t.uid,fid:t.id,token:t.token},method:"POST",success:function(n){var i=n.data.code;200==i?(e("log","\u597d\u53cb\u5220\u9664\u6210\u529f"," at pages/user/userdetail.vue:584"),uni.reLaunch({url:"../index/index"})):400==i?e("log","\u597d\u53cb\u5220\u9664\u5931\u8d25"," at pages/user/userdetail.vue:589"):500==i?uni.showToast({title:"\u670d\u52a1\u5668\u51fa\u9519\u5566\uff01",icon:"none",duration:2e3}):300==i&&uni.navigateTo({url:"../login/login?name="+t.name})}})}})},upDateFriendName:function(t){var n=this;this.data.length>0&&this.data!=this.oldData&&uni.request({url:this.serverUrl+"/user/nicknameUpdate",data:{uid:this.uid,fid:this.id,nickname:t,token:this.token},method:"POST",success:function(t){var i=t.data.code;200==i?e("log","\u6635\u79f0\u4fee\u6539\u6210\u529f"," at pages/user/userdetail.vue:622"):400==i?e("log","\u6635\u79f0\u4fee\u6539\u5931\u8d25"," at pages/user/userdetail.vue:624"):500==i?uni.showToast({title:"\u670d\u52a1\u5668\u51fa\u9519\u5566\uff01",icon:"none",duration:2e3}):300==i&&uni.navigateTo({url:"../login/login?name="+n.name})}})}}};t.default=r}).call(this,n("0de9")["default"])},cb48:function(e,t,n){"use strict";n.r(t);var i=n("2c8c"),o=n.n(i);for(var s in i)["default"].indexOf(s)<0&&function(e){n.d(t,e,(function(){return i[e]}))}(s);t["default"]=o.a},cd7d:function(e,t,n){"use strict";n.r(t);var i=n("7ef0"),o=n.n(i);for(var s in i)["default"].indexOf(s)<0&&function(e){n.d(t,e,(function(){return i[e]}))}(s);t["default"]=o.a},d0f9:function(e,t){e.exports="/static/images/index/add.png"},d2ac:function(e,t,n){"use strict";n.d(t,"b",(function(){return i})),n.d(t,"c",(function(){return o})),n.d(t,"a",(function(){}));var i=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("view",{staticClass:e._$s(0,"sc","content"),attrs:{_i:0}},[i("view",{staticClass:e._$s(1,"sc","top-bar"),attrs:{_i:1}},[i("navigator",{attrs:{url:e._$s(2,"a-url","../user/userpage?id="+e.uid),_i:2}},[i("image",{staticClass:e._$s(3,"sc","top-bar-left"),attrs:{src:e._$s(3,"a-src",e.imgUrl),_i:3}})]),i("view",{staticClass:e._$s(4,"sc","top-bar-center"),attrs:{_i:4}},[i("p",{staticClass:e._$s(5,"sc","nickname"),attrs:{_i:5}},[e._v(e._$s(5,"t0-0",e._s(e.name)))]),i("p",{staticClass:e._$s(6,"sc","status"),attrs:{_i:6}})]),i("view",{staticClass:e._$s(7,"sc","top-bar-right"),attrs:{_i:7},on:{click:e.toGroup}},[i("image",{staticClass:e._$s(8,"sc","image-right"),attrs:{src:e._$s(8,"a-src",n("d0f9")),_i:8}})])]),i("view",{staticClass:e._$s(9,"sc","search"),attrs:{_i:9},on:{click:e.toSearch}},[i("view",{staticClass:e._$s(10,"sc","selfStyle "),attrs:{_i:10}},[i("image",{staticClass:e._$s(11,"sc","image-search"),attrs:{src:e._$s(11,"a-src",n("306a")),_i:11}}),i("view",{staticClass:e._$s(12,"sc","title-search"),attrs:{_i:12}})])])])},o=[]},d2f2:function(e,t,n){"use strict";n.d(t,"b",(function(){return i})),n.d(t,"c",(function(){return o})),n.d(t,"a",(function(){}));var i=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("view",{staticClass:e._$s(0,"sc","box"),attrs:{_i:0}},[i("view",{staticClass:e._$s(1,"sc","top-bar"),attrs:{_i:1}},[i("view",{staticClass:e._$s(2,"sc","image"),attrs:{_i:2},on:{click:e.goBack}}),i("view",{staticClass:e._$s(3,"sc","title"),attrs:{_i:3}})]),i("view",{staticClass:e._$s(4,"sc","main"),attrs:{_i:4}},[i("view",{staticClass:e._$s(5,"sc","top"),attrs:{_i:5}},[i("view",{staticClass:e._$s(6,"sc","group-image"),attrs:{_i:6}},[i("image-cropper",{attrs:{src:e.tempFilePath,_i:7},on:{confirm:e.confirm,cancel:e.cancel}}),i("image",{staticClass:e._$s(8,"sc","head-image"),attrs:{src:e._$s(8,"a-src",e.cropFilePath),_i:8},on:{click:e.upload}})],1),i("view",{staticClass:e._$s(9,"sc","group-name"),attrs:{_i:9}},[i("input",{directives:[{name:"model",rawName:"v-model",value:e.name,expression:"name"}],staticClass:e._$s(10,"sc","group-name-input"),attrs:{_i:10},domProps:{value:e._$s(10,"v-model",e.name)},on:{input:function(t){t.target.composing||(e.name=t.target.value)}}}),i("view",{staticClass:e._$s(11,"sc","title"),attrs:{_i:11}})])]),i("view",{staticClass:e._$s(12,"sc","friends"),attrs:{_i:12}},e._l(e._$s(13,"f",{forItems:e.Friends}),(function(t,o,s,r){return i("view",{key:e._$s(13,"f",{forIndex:s,key:o}),staticClass:e._$s("13-"+r,"sc","user"),attrs:{_i:"13-"+r},on:{click:function(t){return e.selectFriend(o)}}},[i("view",{staticClass:e._$s("14-"+r,"sc","selected"),class:e._$s("14-"+r,"c",{isSelected:t.selected}),attrs:{_i:"14-"+r}},[i("image",{directives:[{name:"show",rawName:"v-show",value:e._$s("15-"+r,"v-show",t.selected),expression:"_$s((\"15-\"+$30),'v-show',item.selected)"}],staticClass:e._$s("15-"+r,"sc","selected-img"),attrs:{src:e._$s("15-"+r,"a-src",n("7d2f")),_i:"15-"+r}})]),i("image",{staticClass:e._$s("16-"+r,"sc","user-img"),attrs:{src:e._$s("16-"+r,"a-src",t.imgUrl),_i:"16-"+r}}),i("view",{staticClass:e._$s("17-"+r,"sc","name"),attrs:{_i:"17-"+r}},[e._v(e._$s("17-"+r,"t0-0",e._s(t.name)))])])})),0)]),i("view",{staticClass:e._$s(18,"sc","bottom-bar"),attrs:{_i:18}},[i("view",{staticClass:e._$s(19,"sc","bottom-btn"),attrs:{_i:19},on:{click:e.createGroup}},[e._v(e._$s(19,"t0-0",e._s(e.selectedNum)))])])])},o=[]},d602:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i={frindes:function(){var e=[{id:1,imgurl:"../../static/images/img/two.jpg",tip:2,name:"\u6708\u4eae",email:"xiaoli163.com",time:new Date,news:"\u8fd9\u6d88\u606f\u5c06\u4f7f\u5168\u4e16\u754c\u5d07\u62dc\u4ed6\u7684\u4eba\u90fd\u611f\u5230\u9ad8\u5174"},{id:2,imgurl:"../../static/images/img/two.jpg",tip:5,name:"\u5c0f\u72fc",email:"xiaoli163.com",time:new Date,news:"\u8fd9\u6d88\u606f\u5c06\u4f7f\u5168\u4e16\u754c\u5d07\u62dc\u4ed6\u7684\u4eba\u90fd\u611f\u5230\u9ad8\u5174"},{id:3,imgurl:"../../static/images/img/three.jpg",tip:2,name:"\u829d\u58eb",email:"xiaoli163.com",time:"Mon Dec 05 2022 10:38:15 GMT+0800 (\u4e2d\u56fd\u6807\u51c6\u65f6\u95f4)",news:"\u76ee\u524d\u6211\u4eec\u6ca1\u6709\u8fdb\u4e00\u6b65\u7684\u6d88\u606f"},{id:4,imgurl:"../../static/images/img/four.jpg",tip:12,name:"\u5c0f\u6a31",email:"xiaoli163.com",time:"Sta Dec 07 2022 12:38:15 GMT+0800 (\u4e2d\u56fd\u6807\u51c6\u65f6\u95f4)",news:"\u8fd9\u5bb6\u62a5\u7eb8\u83b7\u5f97\u5185\u90e8\u6d88\u606f\uff0c\u62a2\u5728\u6240\u6709\u7ade\u4e89\u5bf9\u624b\u4e4b\u524d\u53d1\u8868\u4e86\u3002"},{id:5,imgurl:"../../static/images/img/head (2).jpg",tip:1,name:"\u4e24\u5cb8",email:"xiaoli163.com",time:"Thu Dec 08 2022 16:58:15 GMT+0800 (\u4e2d\u56fd\u6807\u51c6\u65f6\u95f4)",news:"\u4ed6\u56e0\u6cc4\u6f0f\u6d88\u606f\u7ed9\u65b0\u95fb\u754c\u800c\u53d7\u5230\u8c34\u8d23"},{id:6,imgurl:"../../static/images/img/head (2).jpg",tip:1,name:"\u4e24\u5cb8",email:"xiaoli163.com",time:"Thu Dec 08 2022 16:58:15 GMT+0800 (\u4e2d\u56fd\u6807\u51c6\u65f6\u95f4)",news:"\u4ed6\u56e0\u6cc4\u6f0f\u6d88\u606f\u7ed9\u65b0\u95fb\u754c\u800c\u53d7\u5230\u8c34\u8d23"},{id:7,imgurl:"../../static/images/img/head (2).jpg",tip:1,name:"\u4e24\u5cb8",email:"xiaoli163.com",time:"Thu Dec 08 2022 16:58:15 GMT+0800 (\u4e2d\u56fd\u6807\u51c6\u65f6\u95f4)",news:"\u4ed6\u56e0\u6cc4\u6f0f\u6d88\u606f\u7ed9\u65b0\u95fb\u754c\u800c\u53d7\u5230\u8c34\u8d23"},{id:8,imgurl:"../../static/images/img/four.jpg",tip:12,name:"\u5c0f\u6a31",email:"xiaoli163.com",time:"Sta Dec 07 2022 12:38:15 GMT+0800 (\u4e2d\u56fd\u6807\u51c6\u65f6\u95f4)",news:"\u8fd9\u5bb6\u62a5\u7eb8\u83b7\u5f97\u5185\u90e8\u6d88\u606f\uff0c\u62a2\u5728\u6240\u6709\u7ade\u4e89\u5bf9\u624b\u4e4b\u524d\u53d1\u8868\u4e86\u3002"},{id:9,imgurl:"../../static/images/img/four.jpg",tip:12,name:"\u5c0f\u6a31",email:"xiaoli163.com",time:"Sta Dec 07 2022 12:38:15 GMT+0800 (\u4e2d\u56fd\u6807\u51c6\u65f6\u95f4)",news:"\u8fd9\u5bb6\u62a5\u7eb8\u83b7\u5f97\u5185\u90e8\u6d88\u606f\uff0c\u62a2\u5728\u6240\u6709\u7ade\u4e89\u5bf9\u624b\u4e4b\u524d\u53d1\u8868\u4e86\u3002"},{id:10,imgurl:"../../static/images/img/four.jpg",tip:12,name:"\u5c0f\u6a31",email:"xiaoli163.com",time:"Sta Dec 07 2022 12:38:15 GMT+0800 (\u4e2d\u56fd\u6807\u51c6\u65f6\u95f4)",news:"\u8fd9\u5bb6\u62a5\u7eb8\u83b7\u5f97\u5185\u90e8\u6d88\u606f\uff0c\u62a2\u5728\u6240\u6709\u7ade\u4e89\u5bf9\u624b\u4e4b\u524d\u53d1\u8868\u4e86\u3002"},{id:11,imgurl:"../../static/images/img/four.jpg",tip:12,name:"\u5c0f\u6a31",email:"xiaoli163.com",time:"Sta Dec 07 2022 12:38:15 GMT+0800 (\u4e2d\u56fd\u6807\u51c6\u65f6\u95f4)",news:"\u8fd9\u5bb6\u62a5\u7eb8\u83b7\u5f97\u5185\u90e8\u6d88\u606f\uff0c\u62a2\u5728\u6240\u6709\u7ade\u4e89\u5bf9\u624b\u4e4b\u524d\u53d1\u8868\u4e86\u3002"}];return e},isFriend:function(){return[{userID:1,friendID:2},{userID:1,friendID:3},{userID:1,friendID:3},{userID:1,friendID:3}]},message:function(){var e=[{id:"a",imgurl:"../../static/images/img/three.jpg",tip:16,time:new Date-120,message:"\u8fd9\u6d88\u606f\u5c06\u4f7f\u5168\u4e16\u754c\u5d07\u62dc\u4ed6\u7684\u4eba\u90fd\u611f\u5230\u9ad8\u5174",types:0},{id:"b",imgurl:"../../static/images/img/two.jpg",tip:15,time:new Date-140,message:"\u5728\u8bbe\u7f6e\u6eda\u52a8",types:0},{id:"b",imgurl:"../../static/images/img/two.jpg",tip:14,time:new Date-160,message:"two.jpg",types:1},{id:"b",imgurl:"../../static/images/img/two.jpg",tip:13,time:new Date-180,message:"iOS\u70b9\u51fb\u9876\u90e8\u72b6\u6001\u680f\u3001\u5b89\u5353\u53cc\u51fb\u6807\u9898\u680f\u65f6\uff0c\u6eda\u52a8\u6761\u8fd4\u56de\u9876\u90e8\uff0c\u53ea\u652f\u6301\u7ad6\u5411",types:0},{id:"b",imgurl:"../../static/images/img/two.jpg",tip:12,time:new Date-200,message:{name:"\u897f\u5357\u77f3\u6cb9\u5927\u5b66\u5de5\u7a0b\u5b66\u9662",address:"\u56db\u5ddd\u7701\u6210\u90fd\u5e02\u65b0\u90fd\u533a\u65b0\u90fd\u5927\u90538\u53f7\u897f\u5357\u77f3\u6cb9\u5927\u5b6621\u680bc\u533a333",latitude:"30.832413",longitude:"104.184586"},types:3},{id:"a",imgurl:"../../static/images/img/two.jpg",tip:11,time:new Date-200,message:{name:"\u897f\u5357\u77f3\u6cb9\u5927\u5b66\u5de5\u7a0b\u5b66\u9662",address:"\u56db\u5ddd\u7701\u6210\u90fd\u5e02\u65b0\u90fd\u533a\u65b0\u90fd\u5927\u90538\u53f7\u897f\u5357\u77f3\u6cb9\u5927\u5b6621\u680bc\u533a333",latitude:"30.832413",longitude:"104.184586"},types:3},{id:"b",imgurl:"../../static/images/img/two.jpg",tip:10,time:new Date-400,message:{voice:"b",time:20},types:2},{id:"a",imgurl:"../../static/images/img/three.jpg",tip:9,time:new Date-500,message:{voice:"a",time:60},types:2},{id:"a",imgurl:"../../static/images/img/three.jpg",tip:8,time:new Date-1e3,message:"\u8fd9\u6d88\u606f\u5c06\u4f7f\u5168\u4e16\u754c\u5d07\u62dc\u4ed6\u7684\u4eba\u90fd\u611f\u5230\u9ad8\u5174",types:0},{id:"b",imgurl:"../../static/images/img/two.jpg",tip:7,time:new Date-16e3,message:"\u5728\u8bbe\u7f6e\u6eda\u52a8",types:0},{id:"b",imgurl:"../../static/images/img/two.jpg",tip:6,time:new Date-6e4,message:"two.jpg",types:1},{id:"b",imgurl:"../../static/images/img/two.jpg",tip:5,time:new Date-12e4,message:"iOS\u70b9\u51fb\u9876\u90e8\u72b6\u6001\u680f\u3001\u5b89\u5353\u53cc\u51fb\u6807\u9898\u680f\u65f6\uff0c\u6eda\u52a8\u6761\u8fd4\u56de\u9876\u90e8\uff0c\u53ea\u652f\u6301\u7ad6\u5411",types:0},{id:"b",imgurl:"../../static/images/img/two.jpg",tip:4,time:new Date-18e4,message:"iOS\u70b9\u51fb\u9876\u90e8\u72b6\u6001\u680f\u3001\u5b89\u5353\u53cc\u51fb\u6807\u9898\u680f\u65f6\uff0c\u6eda\u52a8\u6761\u8fd4\u56de\u9876\u90e8\uff0c\u53ea\u652f\u6301\u7ad6\u5411",types:0},{id:"a",imgurl:"../../static/images/img/three.jpg",tip:3,time:new Date-24e4,message:"iOS\u70b9\u51fb\u9876\u90e8\u72b6\u6001\u680f\u3001\u5b89\u5353\u53cc\u51fb\u6807\u9898\u680f\u65f6\uff0c\u6eda\u52a8\u6761\u8fd4\u56de\u9876\u90e8\uff0c\u53ea\u652f\u6301\u7ad6\u5411",types:0},{id:"a",imgurl:"../../static/images/img/three.jpg",tip:2,time:"Sta Apr 29 2023 12:38:15 GMT+0800 (\u4e2d\u56fd\u6807\u51c6\u65f6\u95f4)",message:"three.jpg",types:1},{id:"a",imgurl:"../../static/images/img/three.jpg",tip:1,time:"Sta Apr 29 2023 12:38:15 GMT+0800 (\u4e2d\u56fd\u6807\u51c6\u65f6\u95f4)",message:"two.jpg",types:1}];return e}};t.default=i},d613:function(e,t,n){"use strict";n.d(t,"b",(function(){return i})),n.d(t,"c",(function(){return o})),n.d(t,"a",(function(){}));var i=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("view",{staticClass:e._$s(0,"sc","emoji"),attrs:{_i:0}},e._l(e._$s(1,"f",{forItems:e.emoji}),(function(t,i,o,s){return n("view",{key:e._$s(1,"f",{forIndex:o,key:i}),staticClass:e._$s("1-"+s,"sc","emoji-line"),attrs:{_i:"1-"+s}},e._l(e._$s("2-"+s,"f",{forItems:t}),(function(t,i,o,r){return n("view",{key:e._$s("2-"+s,"f",{forIndex:o,key:i}),staticClass:e._$s("2-"+s+"-"+r,"sc","emoji-line-item"),attrs:{_i:"2-"+s+"-"+r},on:{click:function(n){return e.clickEmoji(t)}}},[e._v(e._$s("2-"+s+"-"+r,"t0-0",e._s(t)))])})),0)})),0)},o=[]},d86e:function(e,t,n){"use strict";(function(e){var i=n("4ea4");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;i(n("d602"));var o=i(n("52ef")),s={name:"FriendInform",data:function(){return{requester:[],uid:"",token:"",msg:""}},onLoad:function(e){this.getStorage(),this.getFriends()},methods:{goBack:function(){uni.reLaunch({url:"../contacts/contact"})},changeTime:function(e){return o.default.dateTime_Two(e)},getStorage:function(){try{var e=uni.getStorageSync("user");e?(this.uid=e.id,this.token=e.token):uni.navigateTo({url:"../login/login"})}catch(t){}},getFriends:function(){var t=this;uni.request({url:this.serverUrl+"/home/getFriend",data:{uid:this.uid,state:1,token:this.token},method:"POST",success:function(n){var i=n.data.code;if(e("log",n," at pages/contacts/friendInform.vue:85"),200==i){for(var o=n.data.result,s=0;s<o.length;s++)o[s].imgUrl=t.serverUrl+o[s].imgUrl,t.getLastMsg(o,s);t.requester=o}else 500==i?uni.showToast({title:"\u670d\u52a1\u5668\u51fa\u9519\u5566\uff01",icon:"none",duration:2e3}):300==i&&uni.navigateTo({url:"../login/login?name="+t.name})}})},getLastMsg:function(e,t){var n=this;uni.request({url:this.serverUrl+"/home/getLastMsg",data:{uid:this.uid,fid:e[t].id,token:this.token},method:"POST",success:function(i){var o=i.data.code;if(200==o){var s=i.data.result,r=e[t];r.message=s.message,e.splice(t,1,r)}else 500==o?uni.showToast({title:"\u670d\u52a1\u5668\u51fa\u9519\u5566\uff01",icon:"none",duration:2e3}):300==o&&uni.navigateTo({url:"../login/login?name="+n.name})}})},rejectFriend:function(t){var n=this;uni.request({url:this.serverUrl+"/friend/delete",data:{uid:this.uid,fid:t,token:this.token},method:"POST",success:function(i){var o=i.data.code;if(200==o){e("log","\u62d2\u7edd"," at pages/contacts/friendInform.vue:153");for(var s=0;s<n.requester.length;s++)n.requester[s].id==t&&n.requester.splice(s,1)}else 500==o?uni.showToast({title:"\u670d\u52a1\u5668\u51fa\u9519\u5566\uff01",icon:"none",duration:2e3}):300==o&&uni.navigateTo({url:"../login/login?name="+n.name})}})},resolveFriend:function(t){var n=this;uni.request({url:this.serverUrl+"/friend/stateUpdate",data:{uid:this.uid,fid:t,token:this.token},method:"POST",success:function(i){var o=i.data.code;if(200==o){e("log","\u540c\u610f"," at pages/contacts/friendInform.vue:188");for(var s=0;s<n.requester.length;s++)n.requester[s].id==t&&n.requester.splice(s,1)}else 500==o?uni.showToast({title:"\u670d\u52a1\u5668\u51fa\u9519\u5566\uff01",icon:"none",duration:2e3}):300==o&&uni.navigateTo({url:"../login/login?name="+n.name})}})}}};t.default=s}).call(this,n("0de9")["default"])},dd47:function(e,t,n){"use strict";n.r(t);var i=n("ac05"),o=n.n(i);for(var s in i)["default"].indexOf(s)<0&&function(e){n.d(t,e,(function(){return i[e]}))}(s);t["default"]=o.a},df93:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i={debounce:function(e,t){var n,i=t||500;return function(){var t=this,o=arguments;n&&clearTimeout(n),n=setTimeout((function(){n=null,e.apply(t,o)}),i)}},ArraySort:function(e,t,n){var i;if(0==n){for(var o=1;o<e.length;o++)for(var s=o;s>0;s--)e[s][t]>e[s-1][t]&&(i=e[s],e[s]=e[s-1],e[s-1]=i);return e}if(1==n){for(var r=1;r<e.length;r++)for(var a=r;a>0;a--)e[a][t]<e[a-1][t]&&(i=e[a],e[a]=e[a-1],e[a-1]=i);return e}}};t.default=i},e036:function(e,t,n){"use strict";n.r(t);var i=n("bf51"),o=n.n(i);for(var s in i)["default"].indexOf(s)<0&&function(e){n.d(t,e,(function(){return i[e]}))}(s);t["default"]=o.a},e3aa:function(e,t,n){"use strict";n.r(t);var i=n("99cd"),o=n.n(i);for(var s in i)["default"].indexOf(s)<0&&function(e){n.d(t,e,(function(){return i[e]}))}(s);t["default"]=o.a},e50d:function(e,t,n){var i=n("7037")["default"];e.exports=function(e,t){if("object"!==i(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var o=n.call(e,t||"default");if("object"!==i(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)},e.exports.__esModule=!0,e.exports["default"]=e.exports},ed6d:function(e,t,n){var i=n("4a4b");e.exports=function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&i(e,t)},e.exports.__esModule=!0,e.exports["default"]=e.exports},f0c5:function(e,t,n){"use strict";function i(e,t,n,i,o,s,r,a,c,u){var l,d="function"===typeof e?e.options:e;if(c){d.components||(d.components={});var p=Object.prototype.hasOwnProperty;for(var h in c)p.call(c,h)&&!p.call(d.components,h)&&(d.components[h]=c[h])}if(u&&("function"===typeof u.beforeCreate&&(u.beforeCreate=[u.beforeCreate]),(u.beforeCreate||(u.beforeCreate=[])).unshift((function(){this[u.__module]=this})),(d.mixins||(d.mixins=[])).push(u)),t&&(d.render=t,d.staticRenderFns=n,d._compiled=!0),i&&(d.functional=!0),s&&(d._scopeId="data-v-"+s),r?(l=function(e){e=e||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext,e||"undefined"===typeof __VUE_SSR_CONTEXT__||(e=__VUE_SSR_CONTEXT__),o&&o.call(this,e),e&&e._registeredComponents&&e._registeredComponents.add(r)},d._ssrRegister=l):o&&(l=a?function(){o.call(this,this.$root.$options.shadowRoot)}:o),l)if(d.functional){d._injectStyles=l;var f=d.render;d.render=function(e,t){return l.call(t),f(e,t)}}else{var g=d.beforeCreate;d.beforeCreate=g?[].concat(g,l):[l]}return{exports:e,options:d}}n.d(t,"a",(function(){return i}))},f2a2:function(e,t){e.exports="/static/images/index/voiceleft.png"},f3ed:function(e,t,n){"use strict";n.d(t,"b",(function(){return i})),n.d(t,"c",(function(){return o})),n.d(t,"a",(function(){}));var i=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("view",{staticClass:e._$s(0,"sc","content"),attrs:{_i:0}},[i("view",{staticClass:e._$s(1,"sc","top-bar"),attrs:{_i:1}},[i("view",{staticClass:e._$s(2,"sc","search"),attrs:{_i:2}},[i("image",{staticClass:e._$s(3,"sc","search-image"),attrs:{src:e._$s(3,"a-src",n("306a")),_i:3}}),i("input",{staticClass:e._$s(4,"sc","search-input"),attrs:{_i:4},on:{input:e.search}})]),i("view",{staticClass:e._$s(5,"sc","remove"),attrs:{_i:5}},[i("span",{attrs:{_i:6},on:{click:e.goBack}})])]),i("view",{staticClass:e._$s(7,"sc","main"),attrs:{_i:7}},[i("view",{staticClass:e._$s(8,"sc","search-user"),attrs:{_i:8}},[i("view",{staticClass:e._$s(9,"sc","title"),attrs:{_i:9}}),e._l(e._$s(10,"f",{forItems:e.userArr}),(function(t,n,o,s){return i("view",{key:e._$s(10,"f",{forIndex:o,key:t.id}),staticClass:e._$s("10-"+s,"sc","list"),attrs:{_i:"10-"+s}},[i("navigator",{staticClass:e._$s("11-"+s,"sc","image"),attrs:{url:e._$s("11-"+s,"a-url","../user/userpage?id="+t._id),_i:"11-"+s}},[i("image",{staticClass:e._$s("12-"+s,"sc","image"),attrs:{src:e._$s("12-"+s,"a-src",t.imgUrl),_i:"12-"+s}})]),i("view",{staticClass:e._$s("13-"+s,"sc","detail"),attrs:{_i:"13-"+s}},[i("view",{staticClass:e._$s("14-"+s,"sc","name"),attrs:{_i:"14-"+s},domProps:{innerHTML:e._s(e._$s("14-"+s,"v-html",t.name))}}),i("view",{staticClass:e._$s("15-"+s,"sc","email"),attrs:{_i:"15-"+s},domProps:{innerHTML:e._s(e._$s("15-"+s,"v-html",t.email))}})]),i("view",{staticClass:e._$s("16-"+s,"sc","right"),attrs:{_i:"16-"+s}},[e._$s("17-"+s,"i",0==t.tip)?i("view",{staticClass:e._$s("17-"+s,"sc","send"),attrs:{_i:"17-"+s},on:{click:function(n){return e.toMessage(t,0)}}}):e._e(),e._$s("18-"+s,"i",1==t.tip)?i("view",{staticClass:e._$s("18-"+s,"sc","apply"),attrs:{_i:"18-"+s},on:{click:function(n){return e.addFrined(t._id)}}}):e._e()])])}))],2),i("view",{staticClass:e._$s(19,"sc","search-group"),attrs:{_i:19}},[i("view",{staticClass:e._$s(20,"sc","title"),attrs:{_i:20}}),e._l(e._$s(21,"f",{forItems:e.groupArr}),(function(t,n,o,s){return i("view",{key:e._$s(21,"f",{forIndex:o,key:t.id}),staticClass:e._$s("21-"+s,"sc","list"),attrs:{_i:"21-"+s}},[i("image",{staticClass:e._$s("22-"+s,"sc","image"),attrs:{src:e._$s("22-"+s,"a-src",t.imgUrl),_i:"22-"+s}}),i("view",{staticClass:e._$s("23-"+s,"sc","detail"),attrs:{_i:"23-"+s}},[i("view",{staticClass:e._$s("24-"+s,"sc","name"),attrs:{_i:"24-"+s},domProps:{innerHTML:e._s(e._$s("24-"+s,"v-html",t.name))}})]),i("view",{staticClass:e._$s("25-"+s,"sc","right"),attrs:{_i:"25-"+s}},[e._$s("26-"+s,"i",0==t.tip)?i("view",{staticClass:e._$s("26-"+s,"sc","send"),attrs:{_i:"26-"+s},on:{click:function(n){return e.toMessage(t,1)}}}):e._e(),e._$s("27-"+s,"i",1==t.tip)?i("view",{staticClass:e._$s("27-"+s,"sc","apply"),attrs:{_i:"27-"+s},on:{click:function(n){return e.addGroup(t)}}}):e._e()])])}))],2)]),i("view",{staticClass:e._$s(28,"sc","modify"),style:e._$s(28,"s",{bottom:-e.modifyHeight+"px"}),attrs:{animation:e._$s(28,"a-animation",e.animationData),_i:28}},[i("view",{staticClass:e._$s(29,"sc","modify-header"),attrs:{_i:29}},[i("view",{staticClass:e._$s(30,"sc","close"),attrs:{_i:30},on:{click:function(t){return e.modify()}}}),i("view",{staticClass:e._$s(31,"sc","title"),attrs:{_i:31}}),i("view",{staticClass:e._$s(32,"sc","define"),attrs:{_i:32},on:{click:e.addSubmit}})]),i("view",{staticClass:e._$s(33,"sc","modify-main"),attrs:{_i:33}},[i("textarea",{directives:[{name:"model",rawName:"v-model",value:e.msg,expression:"msg"}],staticClass:e._$s(34,"sc","modify-content"),attrs:{_i:34},domProps:{value:e._$s(34,"v-model",e.msg)},on:{input:function(t){t.target.composing||(e.msg=t.target.value)}}})])])])},o=[]},fadf:function(e,t){e.exports="/static/images/index/xiangji.png"},fbb2:function(e,t,n){"use strict";n.d(t,"b",(function(){return i})),n.d(t,"c",(function(){return o})),n.d(t,"a",(function(){}));var i=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("view",[i("Header",{attrs:{_i:1}}),e._$s(2,"i",!e.isReFresh)?i("view",{staticClass:e._$s(2,"sc","reFresh"),attrs:{_i:2}},[i("image",{attrs:{src:e._$s(3,"a-src",n("730c")),_i:3}}),i("view",{staticClass:e._$s(4,"sc","ref-title"),attrs:{_i:4}})]):e._e(),e._$s(5,"i",e.isOne)?i("view",{staticClass:e._$s(5,"sc","nobody"),attrs:{_i:5}},[i("image",{attrs:{src:e._$s(6,"a-src",n("b45f")),_i:6}}),i("view",{staticClass:e._$s(7,"sc","no-title"),attrs:{_i:7}}),i("navigator",{staticClass:e._$s(8,"sc","button"),attrs:{_i:8}})]):e._e(),i("view",{staticClass:e._$s(9,"sc","content"),attrs:{_i:9}},e._l(e._$s(10,"f",{forItems:e.friends}),(function(t,n,o,s){return i("view",{key:e._$s(10,"f",{forIndex:o,key:n}),staticClass:e._$s("10-"+s,"sc","contenList"),attrs:{_i:"10-"+s}},[i("view",{staticClass:e._$s("11-"+s,"sc","photo"),attrs:{_i:"11-"+s},on:{click:function(n){return e.toDetail(t)}}},[i("image",{staticClass:e._$s("12-"+s,"sc","image"),attrs:{src:e._$s("12-"+s,"a-src",t.imgUrl),_i:"12-"+s}})]),i("view",{staticClass:e._$s("13-"+s,"sc","message"),attrs:{_i:"13-"+s},on:{click:function(n){return e.toMessage(t)}}},[i("view",{staticClass:e._$s("14-"+s,"sc","name"),attrs:{_i:"14-"+s}},[e._v(e._$s("14-"+s,"t0-0",e._s(t.name)))]),i("view",{staticClass:e._$s("15-"+s,"sc","news"),attrs:{_i:"15-"+s}},[e._v(e._$s("15-"+s,"t0-0",e._s(t.message)))])]),i("view",{staticClass:e._$s("16-"+s,"sc","time"),attrs:{_i:"16-"+s}},[i("view",{staticClass:e._$s("17-"+s,"sc","datetime"),attrs:{_i:"17-"+s}},[e._v(e._$s("17-"+s,"t0-0",e._s(e.changTime(t.lastTime))))]),e._$s("18-"+s,"i",t.tip>0)?i("view",{staticClass:e._$s("18-"+s,"sc","num"),attrs:{_i:"18-"+s}},[e._v(e._$s("18-"+s,"t0-0",e._s(t.tip)))]):e._e()])])})),0)],1)},o=[]},fca7:function(e,t,n){"use strict";n.r(t);var i=n("9b3f"),o=n("54bc");for(var s in o)["default"].indexOf(s)<0&&function(e){n.d(t,e,(function(){return o[e]}))}(s);var r=n("f0c5"),a=Object(r["a"])(o["default"],i["b"],i["c"],!1,null,null,null,!1,i["a"],void 0);t["default"]=a.exports},fcd2:function(e,t,n){"use strict";n.r(t);var i=n("39c0"),o=n("dd47");for(var s in o)["default"].indexOf(s)<0&&function(e){n.d(t,e,(function(){return o[e]}))}(s);var r=n("f0c5"),a=Object(r["a"])(o["default"],i["b"],i["c"],!1,null,null,null,!1,i["a"],void 0);t["default"]=a.exports},fd70:function(e,t){e.exports="/static/images/index/photo.png"},fe07:function(e,t,n){"use strict";(function(e){var i=n("4ea4");Object.defineProperty(t,"__esModule",{value:!0}),t.Behavior=function(e){return e},t.Component=function(t){var n=function(t){var n=t.data,i=t.options,o=t.methods,s=t.behaviors,r=t.lifetimes,a=t.observers,l=t.relations,d=t.properties,h=t.pageLifetimes,f=t.externalClasses,g={mixins:[],props:{},watch:{},mpOptions:{mpObservers:[]}};return u(g),c(n,g),function(e,t){if(!e)return;t.mpOptions.options=e}(i,g),k(o,g),A(s,g),function(e,t){if(!e)return;S(e,t)}(r,g),function(e,t){if(!e)return;var n=t.mpOptions.mpObservers;Object.keys(e).forEach((function(t){n.push({paths:b(t),observer:e[t]})}))}(a,g),function(t,n){if(!t)return;Object.keys(t).forEach((function(n){var i=t[n];i.name=n,i.target=i.target?String(i.target):function(e,t){0===t.indexOf("/")&&(e="");var n=e.split("/"),i=t.split("/");n.pop();while(i.length){var o=i.shift();""!==o&&"."!==o&&(".."!==o?n.push(o):n.pop())}return n.join("/")}(e.__wxRoute,n)})),n.mpOptions.relations=t}(l,g),T(d,g),function(e,t){if(!e)return;I.forEach((function(n){var i=e[n];p(i)&&(t[M[n]]=i)}))}(h,g),function(e,t){if(!e)return;Array.isArray(e)||(e=[e]);t.mpOptions.externalClasses=e,t.mpOptions.properties||(t.mpOptions.properties=Object.create(null));e.forEach((function(e){t.mpOptions.properties[v(e)]={type:String,value:""}}))}(f,g),S(t,g),D(t),g}(t);n.mixins.unshift(X),n.mpOptions.path=e.__wxRoute,function(e){e.onServiceAttached||(e.onServiceAttached=[]);e.onServiceAttached.push((function(){G(this,"linked")}))}(n),e.__wxComponents[e.__wxRoute]=n},t.Page=function(t){var n=function(e){var t={mixins:[],mpOptions:{}};return u(t),c(e.data,t),function(e,t){var n=Object.create(null);Object.keys(e).forEach((function(t){var i=e[t];p(i)&&-1===C.indexOf(t)&&(n[t]=i)})),t.methods=n}(e,t),function(e,t){Object.keys(e).forEach((function(n){-1!==C.indexOf(n)&&(t[n]=e[n])}))}(e,t),t}(t);n.mixins.unshift(X),n.mpOptions.path=e.__wxRoute,e.__wxComponents[e.__wxRoute]=n},t.nextTick=t.default=void 0;var o,s=i(n("9523")),r=i(n("278c")),a=i(n("8bbf"));function c(e,t){e&&(t.mpOptions.data=e)}function u(t){t.components=e.__wxVueOptions.components}var l=Object.prototype.toString,d=Object.prototype.hasOwnProperty;function p(e){return"function"===typeof e}function h(e){return"[object Object]"===l.call(e)}function f(e,t){return d.call(e,t)}function g(){}var _=/-(\w)/g,v=function(e){var t=Object.create(null);return function(n){var i=t[n];return i||(t[n]=e(n))}}((function(e){return e.replace(_,(function(e,t){return t?t.toUpperCase():""}))})),m={created:"onServiceCreated",attached:"onServiceAttached",ready:"mounted",moved:"moved",detached:"destroyed"},y=Object.keys(m),M={show:"onPageShow",hide:"onPageHide",resize:"onPageResize"},I=Object.keys(M),C=["onLoad","onShow","onReady","onHide","onUnload","onPullDownRefresh","onReachBottom","onShareAppMessage","onPageScroll","onResize","onTabItemTap"];function T(e,t){e&&(t.mpOptions.properties=e)}function k(e,t){e&&(e.$emit&&(console.warn('Method "$emit" conflicts with an existing Vue instance method'),delete e.$emit),t.methods=e)}function S(e,t){y.forEach((function(n){f(e,n)&&(t[m[n]]||(t[m[n]]=[])).push(e[n])}))}var E={"wx://form-field":{},"wx://component-export":{}};function D(e,t){(function(e){var t=e.behaviors,n=e.definitionFilter,i=[];if(Array.isArray(t)&&t.forEach((function(t){t="string"===typeof t?E[t]:t,t.definitionFilter&&(i.push(t.definitionFilter),t.definitionFilter.call(null,e,[]))})),p(n));})(e)}var w={"wx://form-field":{beforeCreate:function(){var e=this.$options.mpOptions;e.properties||(e.properties=Object.create(null));var t=e.properties;f(t,"name")||(t.name={type:String}),f(t,"value")||(t.value={type:String})}}};function A(e,t){e&&e.forEach((function(e){"string"===typeof e?w[e]&&t.mixins.push(w[e]):t.mixins.push(function(e){var t=e.data,n=e.methods,i=e.behaviors,o=e.properties,s={watch:{},mpOptions:{mpObservers:[]}};return c(t,s),k(n,s),A(i,s),T(o,s),S(e,s),D(e),s}(e))}))}function b(e){return e.split(",").map((function(e){return function(e){return e.split(".")}(e)}))}function L(e,t,n,i){if(t){var o="_$".concat(e,"Handlers");(i[o]||(i[o]=[])).push((function(){t.call(i,n)}))}}function R(e,t,n){var i=e.name,o=n._$relationNodes||(n._$relationNodes=Object.create(null));(o[i]||(o[i]=[])).push(t),L("linked",e["linked"],t,n)}function O(e,t,n){L("unlinked",e["unlinked"],t,n)}function N(e,t,n){var i=e&&e.$options.mpOptions&&e.$options.mpOptions.relations;if(!i)return[];var o=Object.keys(i).find((function(e){var o=i[e];return o.target===t&&o.type===n}));return o?[i[o],e]:[]}function P(e,t,n){var i=n(e,e.$options.mpOptions.path),o=(0,r.default)(i,2),s=o[0],a=o[1];s&&(R(s,e,a),R(t,a,e),O(s,e,a),O(t,a,e))}function U(e){var t=e.$options.mpOptions||{},n=t.relations;n&&Object.keys(n).forEach((function(t){(function(e,t){var n=e.type;"parent"===n?P(t,e,(function(e,t){return N(e.$parent,t,"child")})):"ancestor"===n&&P(t,e,(function(e,t){var n=e.$parent;while(n){var i=N(n,t,"descendant");if(i.length)return i;n=n.$parent}return[]}))})(n[t],e)}))}function G(e,t){var n=e["_$".concat(t,"Handlers")];n&&n.forEach((function(e){return e()}))}var x={enumerable:!0,configurable:!0,get:g,set:g};function F(e,t,n){x.get=function(){return this[t][n]},x.set=function(e){this[t][n]=e},Object.defineProperty(e,n,x)}function q(e,t){var n=this;h(e)&&(Object.keys(e).forEach((function(t){(function(e,t,n){var i=e.replace(/\[(\d+?)\]/g,".$1").split(".");return i.reduce((function(e,n,o){if(o!==i.length-1)return"undefined"===typeof e[n]&&(e[n]={}),e[n];e[n]=t}),n),1===i.length})(t,e[t],n.data)&&!f(n,t)&&F(n,"__data__",t)})),this.$forceUpdate(),p(t)&&this.$nextTick(t))}var B=Object.prototype.toString,$=function(e){return function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1?arguments[1]:void 0,i=B.call(n);if("[object Array]"===i)return t=n.slice(0),t;if("[object Object]"===i){for(var o in n)t[o]=e(t[o],n[o]);return t}if("[object Date]"===i)return new Date(n.getTime());if("[object RegExp]"===i){var s=String(n),r=s.lastIndexOf("/");return new RegExp(s.slice(1,r),s.slice(r+1))}return n}("[object Array]"===B.call(e)?[]:{},e)},V=(o={},(0,s.default)(o,String,""),(0,s.default)(o,Number,0),(0,s.default)(o,Boolean,!1),(0,s.default)(o,Object,null),(0,s.default)(o,Array,[]),(0,s.default)(o,null,null),o);function H(e){return V[e]}function K(e){return h(e)?e.type:e}function j(e,t,n,i){var o=n[e];if(void 0!==o){var s=t[e],r=K(s);o=z(o,r);var a=s&&s.observer;return a&&setTimeout((function(){Y(a,i,o)}),4),o}return function(e){return h(e)?f(e,"value")?e.value:H(e.type):H(e)}(t[e])}function z(e,t){return t===Boolean?!!e:t===String?String(e):e}function Y(e,t,n,i){try{"function"===typeof e?e.call(t,n,i):"string"===typeof e&&"function"===typeof t[e]&&t[e](n,i)}catch(o){console.error("execute observer ".concat(e," callback fail! err: ").concat(o))}}function W(e){var t=e.$options.mpOptions&&e.$options.mpOptions.properties,n=e.$options.propsData;n&&t&&Object.keys(t).forEach((function(i){f(n,i)&&(e[i]=z(n[i],K(t[i])))}))}function J(e){var t=JSON.parse(JSON.stringify(e.$options.mpOptions.data||{}));e["__data__"]=t;var n={get:function(){return e["__data__"]},set:function(t){e["__data__"]=t}};Object.defineProperties(e,{data:n,properties:n}),e.setData=q,function(e,t){var n=e.$options.mpOptions.properties;if(n){var i=$(e.$options.propsData)||{},o=function(o){var s=!!h(n[o])&&n[o].observer,r=j(o,n,i,e);Object.defineProperty(t,o,{enumerable:!0,configurable:!0,get:function(){return r},set:function(t){var n=r;t===r||t!==t&&r!==r||(r=Array.isArray(t)?t.slice(0):t,s&&Y(s,e,t,n),e.$forceUpdate())}})};for(var s in n)o(s)}}(e,t),Object.keys(t).forEach((function(t){F(e,"__data__",t)}))}var X={beforeCreate:function(){this._renderProxy=this,this._$self=this,this._$noop=g},created:function(){J(this),function(e){var t=e.$emit;e.triggerEvent=function(n,i,o){var s={dataset:e.$el.dataset},r={target:s,currentTarget:s,detail:i,preventDefault:g,stopPropagation:g};t.call(e,n,r)},e.$emit=function(){e.triggerEvent.apply(e,arguments)},e.getRelationNodes=function(t){return(e._$relationNodes&&e._$relationNodes[t]||[]).filter((function(e){return!e._isDestroyed}))},e._$updateProperties=W}(this),U(this)},mounted:function(){(function(e){var t=e.$options.watch;t&&Object.keys(t).forEach((function(n){var i=t[n];if(i.mounted){var o=e[n],s=i.handler;"string"===typeof s&&(s=e[s]),s&&s.call(e,o,o)}}))})(this)},destroyed:function(){G(this,"unlinked")}};e.__wxRoute="",e.__wxComponents=Object.create(null),e.__wxVueOptions=Object.create(null);var Z=a.default.nextTick;t.nextTick=Z;var Q=uni.__$wx__,ee=Q;t.default=ee}).call(this,n("c8ba"))},fe67:function(e,t,n){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n={name:"Sign",data:function(){return{isUser:!1,isEmail:!1,isPwd:!1,look:!0,invalid:!1,flag:!0,email:"",user:"",password:"",isSign:!1}},mounted:function(){},computed:{IS_Sign:function(){return!this.isEmail&&this.password.length>7&&!this.isUser?this.isSign=!0:this.isSign=!1,this.isSign}},methods:{toLoginIn:function(){uni.navigateTo({url:"../login/login"})},changeLook:function(){this.look?(this.flag=!1,this.look=!this.look):(this.flag=!0,this.look=!this.look)},Email:function(t){this.email=t.detail.value,this.email.length>0?/^([a-zA-Z0-9]+[_|\_|\.]?)*[a-zA-Z0-9]+@([a-zA-Z0-9]+[_|\_|\.]?)*[a-zA-Z0-9]+\.[a-zA-Z]{2,3}$/.test(this.email)?(this.invalid=!1,this.MatchEmail()):(this.invalid=!0,e("log",this.serverUrl," at pages/sign/sign.vue:109")):this.invalid=!1},MatchEmail:function(){var e=this;uni.request({url:this.serverUrl+"/signup/repeat",data:{data:this.email,type:"email"},method:"POST",success:function(t){var n=t.data.code;if(200==n){var i=t.data.result;e.isEmail=i>0,e.IS_Sign}else 500==n&&uni.showToast({title:"\u670d\u52a1\u5668\u51fa\u9519\u5566\uff01",icon:"none",duration:1500})}})},Password:function(e){this.password=e.detail.value,/^(?=.*[A-Za-z])(?=.*\d)[A-Za-z\d]{8,}$/.test(this.password)?this.isPwd=!1:this.isPwd=!0,this.IS_Sign},MatchUser:function(e){var t=this;this.user=e.detail.value,this.user.length>0?uni.request({url:this.serverUrl+"/signup/repeat",data:{data:this.user,type:"name"},method:"POST",success:function(e){var n=e.data.code;if(200==n){var i=e.data.result;t.isUser=i>0,t.IS_Sign}else 500==n&&uni.showToast({title:"\u670d\u52a1\u5668\u51fa\u9519\u5566\uff01",icon:"none",duration:1500})}}):this.isUser=!1},Sign:function(){var t=this;this.IS_Sign&&uni.request({url:this.serverUrl+"/signup/sign",data:{name:this.user,password:this.password,email:this.email},method:"POST",success:function(n){var i=n.data.code;200==i?(e("log","\u6ce8\u518c\u6210\u529f"," at pages/sign/sign.vue:213"),uni.navigateTo({url:"../login/login?user="+t.user})):500==i&&uni.showToast({title:"\u670d\u52a1\u5668\u51fa\u9519\u5566\uff01",icon:"none",duration:1500})}})}}};t.default=n}).call(this,n("0de9")["default"])},fed8:function(e,t){e.exports="/static/images/index/phone.png"}},[["7d2d","app-config"]]]);